(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();const u={relayerUrl:"https://privacy-amm-relayer.workers.dev",network:"testnet",programId:"7DGg2ouvHsZecGDocaY1nu6ZmSDvSq9NsLSHd16ENHbQ"},s={wallet:null,publicKey:null,privateUtxos:[],poolState:null};document.addEventListener("DOMContentLoaded",()=>{S(),L(),O(),T(),N(),D(),G(),J()});function S(){const e=document.querySelectorAll(".nav-link");e.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault();const n=t.dataset.tab;e.forEach(o=>o.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active")),document.getElementById(`${n}-tab`).classList.add("active")})})}function L(){const e=document.getElementById("connect-wallet"),t=document.getElementById("disconnect-wallet");e.addEventListener("click",b),t.addEventListener("click",C),F()}async function b(){try{if(!window.solana||!window.solana.isPhantom){alert(`Please install Phantom wallet to use this app.
https://phantom.app/`);return}const e=await window.solana.connect();s.publicKey=e.publicKey.toString(),s.wallet=window.solana,g(!0),v(!0),console.log("Connected:",s.publicKey)}catch(e){console.error("Wallet connection failed:",e),alert("Failed to connect wallet: "+e.message)}}function C(){s.wallet&&s.wallet.disconnect(),s.wallet=null,s.publicKey=null,g(!1),v(!1)}function F(){var e;window.solana&&window.solana.isPhantom&&window.solana.isConnected&&(s.wallet=window.solana,s.publicKey=(e=window.solana.publicKey)==null?void 0:e.toString(),s.publicKey&&(g(!0),v(!0)))}function g(e){const t=document.getElementById("connect-wallet"),a=document.getElementById("wallet-info"),n=document.getElementById("wallet-address");e?(t.classList.add("hidden"),a.classList.remove("hidden"),n.textContent=H(s.publicKey)):(t.classList.remove("hidden"),a.classList.add("hidden"))}function v(e){document.getElementById("swap-btn").disabled=!e,document.getElementById("add-liquidity-btn").disabled=!e,document.getElementById("remove-liquidity-btn").disabled=!e,document.getElementById("deposit-btn").disabled=!e,document.getElementById("withdraw-btn").disabled=!e,e?document.getElementById("swap-btn").textContent="Swap":document.getElementById("swap-btn").textContent="Connect Wallet to Swap"}function O(){const e=document.getElementById("swap-from-amount"),t=document.getElementById("swap-direction"),a=document.getElementById("swap-btn");e.addEventListener("input",h),t.addEventListener("click",P),a.addEventListener("click",A)}function h(){const e=parseFloat(document.getElementById("swap-from-amount").value)||0,t=document.getElementById("swap-from-token").value;if(document.getElementById("swap-to-token").value,!s.poolState||e===0){document.getElementById("swap-to-amount").value="";return}const{reserveA:a,reserveB:n}=s.poolState;let o;if(t==="SOL"){const l=e*1e9;o=w(l,a,n),o=o/1e6}else{const l=e*1e6;o=w(l,n,a),o=o/1e9}document.getElementById("swap-to-amount").value=o.toFixed(6);const i=k(e,t);document.getElementById("price-impact").textContent=i.toFixed(2)+"%"}function w(e,t,a){const n=e*997,o=n*a,i=t*1e3+n;return Math.floor(o/i)}function k(e,t){if(!s.poolState||e===0)return 0;const{reserveA:a}=s.poolState;return(t==="SOL"?e*1e9:e*1e6)/a*100}function P(){const e=document.getElementById("swap-from-token"),t=document.getElementById("swap-to-token"),a=e.value;e.value=t.value,t.value=a,h()}async function A(){const e=parseFloat(document.getElementById("swap-from-amount").value),t=parseFloat(document.getElementById("swap-to-amount").value);if(document.getElementById("swap-from-token").value,!e||!t){alert("Please enter an amount");return}m("Generating ZK Proof...");try{await c(2e3),f("Submitting transaction..."),await c(1500);const n=await(await fetch(`${u.relayerUrl}/swap`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifiers:["0x123","0x456"],outputCommitments:["0x789","0xabc"]})})).json();n.success?p(n.signature,n.explorer):d(n.error||"Swap failed")}catch(a){console.error("Swap failed:",a),d(a.message)}}function T(){const e=document.querySelectorAll(".tabs-inner .tab-btn"),t=document.getElementById("add-liquidity-btn"),a=document.getElementById("remove-liquidity-btn");e.forEach(n=>{n.addEventListener("click",()=>{e.forEach(i=>i.classList.remove("active")),n.classList.add("active");const o=n.dataset.action;document.getElementById("add-liquidity").classList.toggle("hidden",o!=="add"),document.getElementById("remove-liquidity").classList.toggle("hidden",o!=="remove")})}),t.addEventListener("click",U),a.addEventListener("click",K),document.getElementById("add-token-a").addEventListener("input",E),document.getElementById("add-token-b").addEventListener("input",E),document.getElementById("remove-lp").addEventListener("input",q)}function E(){const e=parseFloat(document.getElementById("add-token-a").value)||0,t=parseFloat(document.getElementById("add-token-b").value)||0;if(!s.poolState||e===0||t===0){document.getElementById("lp-receive").textContent="0.00",document.getElementById("pool-share").textContent="0.00%";return}const{reserveA:a,reserveB:n,totalLpSupply:o}=s.poolState,i=e*1e9/a,l=t*1e6/n,r=Math.min(i,l)*o/1e6;document.getElementById("lp-receive").textContent=r.toFixed(2);const B=parseFloat(o)/1e6+r,x=r/B*100;document.getElementById("pool-share").textContent=x.toFixed(2)+"%"}function q(){const e=parseFloat(document.getElementById("remove-lp").value)||0;if(!s.poolState||e===0){document.getElementById("receive-sol").textContent="0.00",document.getElementById("receive-usdc").textContent="0.00";return}const{reserveA:t,reserveB:a,totalLpSupply:n}=s.poolState,o=e*1e6/n,i=o*t/1e9,l=o*a/1e6;document.getElementById("receive-sol").textContent=i.toFixed(4),document.getElementById("receive-usdc").textContent=l.toFixed(2)}async function U(){m("Generating ZK Proof for Add Liquidity...");try{await c(2500),f("Submitting transaction..."),await c(1500);const t=await(await fetch(`${u.relayerUrl}/add-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifiers:["0x123","0x456"],outputCommitment:"0x789"})})).json();t.success?p(t.signature,t.explorer):d(t.error)}catch(e){d(e.message)}}async function K(){m("Generating ZK Proof for Remove Liquidity...");try{await c(2e3),f("Submitting transaction..."),await c(1500);const t=await(await fetch(`${u.relayerUrl}/remove-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifier:"0x123",outputCommitments:["0x456","0x789"]})})).json();t.success?p(t.signature,t.explorer):d(t.error)}catch(e){d(e.message)}}function N(){document.getElementById("deposit-btn").addEventListener("click",j),document.getElementById("withdraw-btn").addEventListener("click",W),document.getElementById("confirm-deposit").addEventListener("click",M),document.getElementById("confirm-withdraw").addEventListener("click",$)}function I(){const e=s.privateUtxos;let t=0,a=0,n=0;e.forEach(r=>{r.assetId===0&&(t+=parseFloat(r.amount)),r.assetId===1&&(a+=parseFloat(r.amount)),r.assetId===2&&(n+=parseFloat(r.amount))});const i=t/1e9*150+a/1e6;document.getElementById("total-value").textContent="$"+i.toFixed(2),document.getElementById("utxo-count").textContent=e.length.toString();const l=document.getElementById("asset-list-content");e.length===0?l.innerHTML='<p class="empty-state">No private assets. Deposit to get started!</p>':l.innerHTML=`
            <div class="asset-item">SOL: ${(t/1e9).toFixed(4)}</div>
            <div class="asset-item">USDC: ${(a/1e6).toFixed(2)}</div>
            ${n>0?`<div class="asset-item">LP: ${(n/1e6).toFixed(2)}</div>`:""}
        `,document.getElementById("from-balance").textContent=(t/1e9).toFixed(4),document.getElementById("lp-balance").textContent=(n/1e6).toFixed(2)}async function M(){const e=parseFloat(document.getElementById("deposit-amount").value),t=document.getElementById("deposit-token").value;if(!e){alert("Please enter an amount");return}y(),m("Processing deposit...");try{await c(2e3);const n=await(await fetch(`${u.relayerUrl}/deposit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commitment:"0x"+Math.random().toString(16).slice(2),amount:t==="SOL"?e*1e9:e*1e6,assetType:t==="SOL"?0:1})})).json();if(n.success){const o={amount:(t==="SOL"?e*1e9:e*1e6).toString(),assetId:t==="SOL"?0:1,commitment:"0x"+Math.random().toString(16).slice(2)};s.privateUtxos.push(o),Z(),I(),p(n.signature,n.explorer)}else d(n.error)}catch(a){d(a.message)}}async function $(){const e=parseFloat(document.getElementById("withdraw-amount").value),t=document.getElementById("withdraw-recipient").value;if(!e||!t){alert("Please enter amount and recipient");return}y(),m("Generating ZK Proof for withdrawal...");try{await c(2500),f("Submitting transaction..."),await c(1500);const n=await(await fetch(`${u.relayerUrl}/withdraw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifier:"0x123",recipient:t,amount:e*1e9})})).json();n.success?p(n.signature,n.explorer):d(n.error)}catch(a){d(a.message)}}function D(){document.getElementById("modal-overlay").addEventListener("click",e=>{e.target.id==="modal-overlay"&&y()}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",y)})}function m(e){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("tx-modal").classList.remove("hidden"),document.getElementById("tx-status-text").textContent=e,document.getElementById("tx-spinner").style.display="block",document.getElementById("tx-success").classList.add("hidden"),document.getElementById("tx-error").classList.add("hidden"),document.querySelector(".tx-status").classList.remove("hidden")}function f(e){document.getElementById("tx-status-text").textContent=e}function p(e,t){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-success").classList.remove("hidden"),document.getElementById("tx-explorer-link").href=t}function d(e){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-error").classList.remove("hidden"),document.getElementById("tx-error-text").textContent=e}function j(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("deposit-modal").classList.remove("hidden")}function W(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("withdraw-modal").classList.remove("hidden")}function y(){document.getElementById("modal-overlay").classList.add("hidden"),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden"))}async function G(){try{const t=await(await fetch(`${u.relayerUrl}/pool`)).json();s.poolState={reserveA:parseFloat(t.reserveA),reserveB:parseFloat(t.reserveB),totalLpSupply:parseFloat(t.totalLpSupply)};const a=s.poolState.reserveB/s.poolState.reserveA*1e3;document.getElementById("swap-rate").textContent=`1 SOL = ${a.toFixed(2)} USDC`}catch(e){console.error("Failed to load pool state:",e),s.poolState={reserveA:1e13,reserveB:15e11,totalLpSupply:12247448713e3}}}function J(){try{const e=localStorage.getItem("privacy-amm-utxos");e&&(s.privateUtxos=JSON.parse(e))}catch(e){console.error("Failed to load UTXOs:",e)}I()}function Z(){localStorage.setItem("privacy-amm-utxos",JSON.stringify(s.privateUtxos))}function H(e){return e?e.slice(0,4)+"..."+e.slice(-4):""}function c(e){return new Promise(t=>setTimeout(t,e))}
