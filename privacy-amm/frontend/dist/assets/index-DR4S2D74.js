(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function n(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(e){if(e.ep)return;e.ep=!0;const c=n(e);fetch(e.href,c)}})();const Ta="modulepreload",Ua=function(i){return"/"+i},Vo={},Ra=function(t,n,o){let e=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),d=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));e=Promise.allSettled(n.map(b=>{if(b=Ua(b),b in Vo)return;Vo[b]=!0;const g=b.endsWith(".css"),s=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${s}`))return;const y=document.createElement("link");if(y.rel=g?"stylesheet":Ta,g||(y.as="script"),y.crossOrigin="",y.href=b,d&&y.setAttribute("nonce",d),document.head.appendChild(y),g)return new Promise((w,h)=>{y.addEventListener("load",w),y.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${b}`)))})}))}function c(f){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=f,window.dispatchEvent(d),!d.defaultPrevented)throw f}return e.then(f=>{for(const d of f||[])d.status==="rejected"&&c(d.reason);return t().catch(c)})},Na=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];function eo(i,t){if(!t||t==10)return BigInt(i);if(t==16)return i.slice(0,2)=="0x"?BigInt(i):BigInt("0x"+i)}const kt=eo;function Ga(i,t){let n=BigInt(0);t=BigInt(t);for(let o=0;o<i.length;o++)n=n*t+BigInt(i[o]);return n}function Nn(i){const t=i.toString(16);return(t.length-1)*4+Na[parseInt(t[0],16)]}function ke(i){return BigInt(i)<BigInt(0)}function Te(i){return!i}function Jn(i,t){return BigInt(i)<<BigInt(t)}function wn(i,t){return BigInt(i)>>BigInt(t)}const $a=Jn,ja=wn;function Mo(i){return(BigInt(i)&BigInt(1))==BigInt(1)}function Za(i){let t=BigInt(i);const n=[];for(;t;){if(t&BigInt(1)){const o=2-Number(t%BigInt(4));n.push(o),t=t-BigInt(o)}else n.push(0);t=t>>BigInt(1)}return n}function Ue(i){let t=BigInt(i);const n=[];for(;t;)t&BigInt(1)?n.push(1):n.push(0),t=t>>BigInt(1);return n}function Re(i){if(i>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Number too big");return Number(i)}function Wa(i,t){const n=[];let o=BigInt(i);for(t=BigInt(t);o;)n.unshift(Number(o%t)),o=o/t;return n}function zo(i,t){return BigInt(i)+BigInt(t)}function ln(i,t){return BigInt(i)-BigInt(t)}function Ne(i){return-BigInt(i)}function Ge(i,t){return BigInt(i)*BigInt(t)}function Da(i){return BigInt(i)*BigInt(i)}function Gn(i,t){return BigInt(i)**BigInt(t)}function Ka(i,t){return BigInt(i)**BigInt(t)}function Xa(i){return BigInt(i)>=0?BigInt(i):-BigInt(i)}function Bn(i,t){return BigInt(i)/BigInt(t)}function nn(i,t){return BigInt(i)%BigInt(t)}function pn(i,t){return BigInt(i)==BigInt(t)}function Va(i,t){return BigInt(i)!=BigInt(t)}function Ha(i,t){return BigInt(i)<BigInt(t)}function Fo(i,t){return BigInt(i)>BigInt(t)}function Qa(i,t){return BigInt(i)<=BigInt(t)}function $e(i,t){return BigInt(i)>=BigInt(t)}function ko(i,t){return BigInt(i)&BigInt(t)}function Ja(i,t){return BigInt(i)|BigInt(t)}function Ya(i,t){return BigInt(i)^BigInt(t)}function ti(i,t){return BigInt(i)&&BigInt(t)}function ni(i,t){return BigInt(i)||BigInt(t)}function oi(i){return!BigInt(i)}function Tn(i,t,n,o){const e="0000000"+n.toString(16),c=new Uint32Array(i.buffer,i.byteOffset+t,o/4),f=((e.length-7)*4-1>>5)+1;for(let d=0;d<f;d++)c[d]=parseInt(e.substring(e.length-8*d-8,e.length-8*d),16);for(let d=f;d<c.length;d++)c[d]=0;for(let d=c.length*4;d<o;d++)i[d]=Re(ko(wn(n,d*8),255))}function je(i,t,n,o){const e="0000000"+n.toString(16),c=new DataView(i.buffer,i.byteOffset+t,o),f=((e.length-7)*4-1>>5)+1;for(let d=0;d<f;d++)c.setUint32(o-d*4-4,parseInt(e.substring(e.length-8*d-8,e.length-8*d),16),!1);for(let d=0;d<o/4-f;d++)c[d]=0}function Un(i,t,n){n=n||i.byteLength,t=t||0;const o=new Uint32Array(i.buffer,i.byteOffset+t,n/4),e=new Array(n/4);return o.forEach((c,f)=>e[e.length-f-1]=c.toString(16).padStart(8,"0")),eo(e.join(""),16)}function Ze(i,t,n){n=n||i.byteLength,t=t||0;const o=new DataView(i.buffer,i.byteOffset+t,n),e=new Array(n/4);for(let c=0;c<n/4;c++)e[c]=o.getUint32(c*4,!1).toString(16).padStart(8,"0");return eo(e.join(""),16)}function We(i,t){return i.toString(t)}function Cn(i){const t=new Uint8Array(Math.floor((Nn(i)-1)/8)+1);return Tn(t,0,i,t.byteLength),t}const De=kt(0),Ln=kt(1);var ei=Object.freeze({__proto__:null,abs:Xa,add:zo,band:ko,bitLength:Nn,bits:Ue,bor:Ja,bxor:Ya,div:Bn,e:kt,eq:pn,exp:Ka,fromArray:Ga,fromRprBE:Ze,fromRprLE:Un,fromString:eo,geq:$e,gt:Fo,isNegative:ke,isOdd:Mo,isZero:Te,land:ti,leq:Qa,lnot:oi,lor:ni,lt:Ha,mod:nn,mul:Ge,naf:Za,neg:Ne,neq:Va,one:Ln,pow:Gn,shiftLeft:Jn,shiftRight:wn,shl:$a,shr:ja,square:Da,sub:ln,toArray:Wa,toLEBuff:Cn,toNumber:Re,toRprBE:je,toRprLE:Tn,toString:We,zero:De});function Ho(i,t,n){if(Te(n))return i.one;const o=Ue(n);if(o.length==0)return i.one;let e=t;for(let c=o.length-2;c>=0;c--)e=i.square(e),o[c]&&(e=i.mul(e,t));return e}function ai(i){if(i.m%2==1)if(pn(nn(i.p,4),1))if(pn(nn(i.p,8),1))if(pn(nn(i.p,16),1))ii(i);else if(pn(nn(i.p,16),9))ci(i);else throw new Error("Field withot sqrt");else if(pn(nn(i.p,8),5))si(i);else throw new Error("Field withot sqrt");else pn(nn(i.p,4),3)&&li(i);else{const t=nn(Gn(i.p,i.m/2),4);t==1?ri(i):t==3?di(i):ui(i)}}function ii(i){for(i.sqrt_q=Gn(i.p,i.m),i.sqrt_s=0,i.sqrt_t=ln(i.sqrt_q,1);!Mo(i.sqrt_t);)i.sqrt_s=i.sqrt_s+1,i.sqrt_t=Bn(i.sqrt_t,2);let t=i.one;for(;i.eq(t,i.one);){const n=i.random();i.sqrt_z=i.pow(n,i.sqrt_t),t=i.pow(i.sqrt_z,2**(i.sqrt_s-1))}i.sqrt_tm1d2=Bn(ln(i.sqrt_t,1),2),i.sqrt=function(n){const o=this;if(o.isZero(n))return o.zero;let e=o.pow(n,o.sqrt_tm1d2);const c=o.pow(o.mul(o.square(e),n),2**(o.sqrt_s-1));if(o.eq(c,o.negone))return null;let f=o.sqrt_s,d=o.mul(n,e),b=o.mul(d,e),g=o.sqrt_z;for(;!o.eq(b,o.one);){let s=o.square(b),y=1;for(;!o.eq(s,o.one);)s=o.square(s),y++;e=g;for(let w=0;w<f-y-1;w++)e=o.square(e);g=o.square(e),b=o.mul(b,g),d=o.mul(d,e),f=y}return o.geq(d,o.zero)?d:o.neg(d)}}function ci(i){i.sqrt=function(){throw new Error("Sqrt alg 4 not implemented")}}function si(i){i.sqrt=function(){throw new Error("Sqrt alg 3 not implemented")}}function li(i){i.sqrt_q=Gn(i.p,i.m),i.sqrt_e1=Bn(ln(i.sqrt_q,3),4),i.sqrt=function(t){if(this.isZero(t))return this.zero;const n=this.pow(t,this.sqrt_e1),o=this.mul(this.square(n),t);if(this.eq(o,this.negone))return null;const e=this.mul(n,t);return i.geq(e,i.zero)?e:i.neg(e)}}function ri(i){i.sqrt=function(){throw new Error("Sqrt alg 10 not implemented")}}function di(i){i.sqrt_q=Gn(i.p,i.m/2),i.sqrt_e34=Bn(ln(i.sqrt_q,3),4),i.sqrt_e12=Bn(ln(i.sqrt_q,1),2),i.frobenius=function(t,n){return t%2==1?i.conjugate(n):n},i.sqrt=function(t){const n=this,o=n.pow(t,n.sqrt_e34),e=n.mul(n.square(o),t),c=n.mul(n.frobenius(1,e),e);if(n.eq(c,n.negone))return null;const f=n.mul(o,t);let d;if(n.eq(e,n.negone))d=n.mul(f,[n.F.zero,n.F.one]);else{const b=n.pow(n.add(n.one,e),n.sqrt_e12);d=n.mul(b,f)}return n.geq(d,n.zero)?d:n.neg(d)}}function ui(i){i.sqrt=function(){throw new Error("Sqrt alg 8 not implemented")}}function dn(i,t,n,o,e){i[t]=i[t]+i[n]>>>0,i[e]=(i[e]^i[t])>>>0,i[e]=(i[e]<<16|i[e]>>>16&65535)>>>0,i[o]=i[o]+i[e]>>>0,i[n]=(i[n]^i[o])>>>0,i[n]=(i[n]<<12|i[n]>>>20&4095)>>>0,i[t]=i[t]+i[n]>>>0,i[e]=(i[e]^i[t])>>>0,i[e]=(i[e]<<8|i[e]>>>24&255)>>>0,i[o]=i[o]+i[e]>>>0,i[n]=(i[n]^i[o])>>>0,i[n]=(i[n]<<7|i[n]>>>25&127)>>>0}function _i(i){dn(i,0,4,8,12),dn(i,1,5,9,13),dn(i,2,6,10,14),dn(i,3,7,11,15),dn(i,0,5,10,15),dn(i,1,6,11,12),dn(i,2,7,8,13),dn(i,3,4,9,14)}class gi{constructor(t){t=t||[0,0,0,0,0,0,0,0],this.state=[1634760805,857760878,2036477234,1797285236,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],0,0,0,0],this.idx=16,this.buff=new Array(16)}nextU32(){return this.idx==16&&this.update(),this.buff[this.idx++]}nextU64(){return zo(Ge(this.nextU32(),4294967296),this.nextU32())}nextBool(){return(this.nextU32()&1)==1}update(){for(let t=0;t<16;t++)this.buff[t]=this.state[t];for(let t=0;t<10;t++)_i(this.buff);for(let t=0;t<16;t++)this.buff[t]=this.buff[t]+this.state[t]>>>0;this.idx=0,this.state[12]=this.state[12]+1>>>0,this.state[12]==0&&(this.state[13]=this.state[13]+1>>>0,this.state[13]==0&&(this.state[14]=this.state[14]+1>>>0,this.state[14]==0&&(this.state[15]=this.state[15]+1>>>0)))}}function Ke(i){let t=new Uint8Array(i);if(typeof globalThis.crypto<"u")globalThis.crypto.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.random()*4294967296>>>0;return t}function fi(){const i=Ke(32),t=new Uint32Array(i.buffer),n=[];for(let o=0;o<8;o++)n.push(t[o]);return n}let Xn=null;function To(){return Xn||(Xn=new gi(fi()),Xn)}class pi{constructor(t,n,o){this.F=n,this.G=t,this.opMulGF=o;let e=n.sqrt_t||n.t,c=n.sqrt_s||n.s,f=n.one;for(;n.eq(n.pow(f,n.half),n.one);)f=n.add(f,n.one);this.w=new Array(c+1),this.wi=new Array(c+1),this.w[c]=this.F.pow(f,e),this.wi[c]=this.F.inv(this.w[c]);let d=c-1;for(;d>=0;)this.w[d]=this.F.square(this.w[d+1]),this.wi[d]=this.F.square(this.wi[d+1]),d--;this.roots=[],this._setRoots(Math.min(c,15))}_setRoots(t){for(let n=t;n>=0&&!this.roots[n];n--){let o=this.F.one;const e=1<<n,c=new Array(e);for(let f=0;f<e;f++)c[f]=o,o=this.F.mul(o,this.w[n]);this.roots[n]=c}}fft(t){if(t.length<=1)return t;const n=Qo(t.length-1)+1;this._setRoots(n);const o=1<<n;if(t.length!=o)throw new Error("Size must be multiple of 2");return Yn(this,t,n,0,1)}ifft(t){if(t.length<=1)return t;const n=Qo(t.length-1)+1;this._setRoots(n);const o=1<<n;if(t.length!=o)throw new Error("Size must be multiple of 2");const e=Yn(this,t,n,0,1),c=this.F.inv(this.F.mulScalar(this.F.one,o)),f=new Array(o);for(let d=0;d<o;d++)f[d]=this.opMulGF(e[(o-d)%o],c);return f}}function Qo(i){return(i&4294901760?(i&=4294901760,16):0)|(i&4278255360?(i&=4278255360,8):0)|(i&4042322160?(i&=4042322160,4):0)|(i&3435973836?(i&=3435973836,2):0)|(i&2863311530)!==0}function Yn(i,t,n,o,e){const c=1<<n;if(c==1)return[t[o]];if(c==2)return[i.G.add(t[o],t[o+e]),i.G.sub(t[o],t[o+e])];const f=c>>1,d=Yn(i,t,n-1,o,e*2),b=Yn(i,t,n-1,o+e,e*2),g=new Array(c);for(let s=0;s<f;s++)g[s]=i.G.add(d[s],i.opMulGF(b[s],i.roots[n][s])),g[s+f]=i.G.sub(d[s],i.opMulGF(b[s],i.roots[n][s]));return g}class Li{constructor(t){this.type="F1",this.one=BigInt(1),this.zero=BigInt(0),this.p=BigInt(t),this.m=1,this.negone=this.p-this.one,this.two=BigInt(2),this.half=this.p>>this.one,this.bitLength=Nn(this.p),this.mask=(this.one<<BigInt(this.bitLength))-this.one,this.n64=Math.floor((this.bitLength-1)/64)+1,this.n32=this.n64*2,this.n8=this.n64*8,this.R=this.e(this.one<<BigInt(this.n64*64)),this.Ri=this.inv(this.R);const n=this.negone>>this.one;this.nqr=this.two;let o=this.pow(this.nqr,n);for(;!this.eq(o,this.negone);)this.nqr=this.nqr+this.one,o=this.pow(this.nqr,n);for(this.s=0,this.t=this.negone;(this.t&this.one)==this.zero;)this.s=this.s+1,this.t=this.t>>this.one;this.nqr_to_t=this.pow(this.nqr,this.t),ai(this),this.FFT=new pi(this,this,this.mul.bind(this)),this.fft=this.FFT.fft.bind(this.FFT),this.ifft=this.FFT.ifft.bind(this.FFT),this.w=this.FFT.w,this.wi=this.FFT.wi,this.shift=this.square(this.nqr),this.k=this.exp(this.nqr,2**this.s)}e(t,n){let o;if(n?n==16&&(o=BigInt("0x"+t)):o=BigInt(t),o<0){let e=-o;return e>=this.p&&(e=e%this.p),this.p-e}else return o>=this.p?o%this.p:o}add(t,n){const o=t+n;return o>=this.p?o-this.p:o}sub(t,n){return t>=n?t-n:this.p-n+t}neg(t){return t&&this.p-t}mul(t,n){return t*n%this.p}mulScalar(t,n){return t*this.e(n)%this.p}square(t){return t*t%this.p}eq(t,n){return t==n}neq(t,n){return t!=n}lt(t,n){const o=t>this.half?t-this.p:t,e=n>this.half?n-this.p:n;return o<e}gt(t,n){const o=t>this.half?t-this.p:t,e=n>this.half?n-this.p:n;return o>e}leq(t,n){const o=t>this.half?t-this.p:t,e=n>this.half?n-this.p:n;return o<=e}geq(t,n){const o=t>this.half?t-this.p:t,e=n>this.half?n-this.p:n;return o>=e}div(t,n){return this.mul(t,this.inv(n))}idiv(t,n){if(!n)throw new Error("Division by zero");return t/n}inv(t){if(!t)throw new Error("Division by zero");let n=this.zero,o=this.p,e=this.one,c=t%this.p;for(;c;){let f=o/c;[n,e]=[e,n-f*e],[o,c]=[c,o-f*c]}return n<this.zero&&(n+=this.p),n}mod(t,n){return t%n}pow(t,n){return Ho(this,t,n)}exp(t,n){return Ho(this,t,n)}band(t,n){const o=t&n&this.mask;return o>=this.p?o-this.p:o}bor(t,n){const o=(t|n)&this.mask;return o>=this.p?o-this.p:o}bxor(t,n){const o=(t^n)&this.mask;return o>=this.p?o-this.p:o}bnot(t){const n=t^this.mask;return n>=this.p?n-this.p:n}shl(t,n){if(Number(n)<this.bitLength){const o=t<<n&this.mask;return o>=this.p?o-this.p:o}else{const o=this.p-n;return Number(o)<this.bitLength?t>>o:this.zero}}shr(t,n){if(Number(n)<this.bitLength)return t>>n;{const o=this.p-n;if(Number(o)<this.bitLength){const e=t<<o&this.mask;return e>=this.p?e-this.p:e}else return 0}}land(t,n){return t&&n?this.one:this.zero}lor(t,n){return t||n?this.one:this.zero}lnot(t){return t?this.zero:this.one}sqrt_old(t){if(t==this.zero)return this.zero;if(this.pow(t,this.negone>>this.one)!=this.one)return null;let o=this.s,e=this.nqr_to_t,c=this.pow(t,this.t),f=this.pow(t,this.add(this.t,this.one)>>this.one);for(;c!=this.one;){let d=this.square(c),b=1;for(;d!=this.one;)b++,d=this.square(d);let g=e;for(let s=0;s<o-b-1;s++)g=this.square(g);o=b,e=this.square(g),c=this.mul(c,e),f=this.mul(f,g)}return f>this.p>>this.one&&(f=this.neg(f)),f}normalize(t,n){if(t=BigInt(t,n),t<0){let o=-t;return o>=this.p&&(o=o%this.p),this.p-o}else return t>=this.p?t%this.p:t}random(){const t=this.bitLength*2/8;let n=this.zero;for(let o=0;o<t;o++)n=(n<<BigInt(8))+BigInt(Ke(1)[0]);return n%this.p}toString(t,n){n=n||10;let o;return t>this.half&&n==10?o="-"+(this.p-t).toString(n):o=t.toString(n),o}isZero(t){return t==this.zero}fromRng(t){let n;do{n=this.zero;for(let o=0;o<this.n64;o++)n+=t.nextU64()<<BigInt(64*o);n&=this.mask}while(n>=this.p);return n=n*this.Ri%this.p,n}fft(t){return this.FFT.fft(t)}ifft(t){return this.FFT.ifft(t)}toRprLE(t,n,o){Tn(t,n,o,this.n64*8)}toRprBE(t,n,o){je(t,n,o,this.n64*8)}toRprBEM(t,n,o){return this.toRprBE(t,n,this.mul(this.R,o))}toRprLEM(t,n,o){return this.toRprLE(t,n,this.mul(this.R,o))}fromRprLE(t,n){return Un(t,n,this.n8)}fromRprBE(t,n){return Ze(t,n,this.n8)}fromRprLEM(t,n){return this.mul(this.fromRprLE(t,n),this.Ri)}fromRprBEM(t,n){return this.mul(this.fromRprBE(t,n),this.Ri)}toObject(t){return t}}var gn={};gn.bigInt2BytesLE=function(t,n){const o=Array(n);let e=BigInt(t);for(let c=0;c<n;c++)o[c]=Number(e&0xFFn),e=e>>8n;return o};gn.bigInt2U32LE=function(t,n){const o=Array(n);let e=BigInt(t);for(let c=0;c<n;c++)o[c]=Number(e&0xFFFFFFFFn),e=e>>32n;return o};gn.isOcamNum=function(i){return!(!Array.isArray(i)||i.length!=3||typeof i[0]!="number"||typeof i[1]!="number"||!Array.isArray(i[2]))};var hi=function(t,n,o){const e=o||"int";if(t.modules[e])return e;t.modules[e]={};const c=n*2,f=n*8;function d(){const C=t.addFunction(e+"_copy");C.addParam("px","i32"),C.addParam("pr","i32");const u=C.getCodeBuilder();for(let L=0;L<n;L++)C.addCode(u.i64_store(u.getLocal("pr"),L*8,u.i64_load(u.getLocal("px"),L*8)))}function b(){const C=t.addFunction(e+"_zero");C.addParam("pr","i32");const u=C.getCodeBuilder();for(let L=0;L<n;L++)C.addCode(u.i64_store(u.getLocal("pr"),L*8,u.i64_const(0)))}function g(){const C=t.addFunction(e+"_one");C.addParam("pr","i32");const u=C.getCodeBuilder();C.addCode(u.i64_store(u.getLocal("pr"),0,u.i64_const(1)));for(let L=1;L<n;L++)C.addCode(u.i64_store(u.getLocal("pr"),L*8,u.i64_const(0)))}function s(){const C=t.addFunction(e+"_isZero");C.addParam("px","i32"),C.setReturnType("i32");const u=C.getCodeBuilder();function L($){return $==0?u.ret(u.i64_eqz(u.i64_load(u.getLocal("px")))):u.if(u.i64_eqz(u.i64_load(u.getLocal("px"),$*8)),L($-1),u.ret(u.i32_const(0)))}C.addCode(L(n-1)),C.addCode(u.ret(u.i32_const(0)))}function y(){const C=t.addFunction(e+"_eq");C.addParam("px","i32"),C.addParam("py","i32"),C.setReturnType("i32");const u=C.getCodeBuilder();function L($){return $==0?u.ret(u.i64_eq(u.i64_load(u.getLocal("px")),u.i64_load(u.getLocal("py")))):u.if(u.i64_eq(u.i64_load(u.getLocal("px"),$*8),u.i64_load(u.getLocal("py"),$*8)),L($-1),u.ret(u.i32_const(0)))}C.addCode(L(n-1)),C.addCode(u.ret(u.i32_const(0)))}function w(){const C=t.addFunction(e+"_gte");C.addParam("px","i32"),C.addParam("py","i32"),C.setReturnType("i32");const u=C.getCodeBuilder();function L($){return $==0?u.ret(u.i64_ge_u(u.i64_load(u.getLocal("px")),u.i64_load(u.getLocal("py")))):u.if(u.i64_lt_u(u.i64_load(u.getLocal("px"),$*8),u.i64_load(u.getLocal("py"),$*8)),u.ret(u.i32_const(0)),u.if(u.i64_gt_u(u.i64_load(u.getLocal("px"),$*8),u.i64_load(u.getLocal("py"),$*8)),u.ret(u.i32_const(1)),L($-1)))}C.addCode(L(n-1)),C.addCode(u.ret(u.i32_const(0)))}function h(){const C=t.addFunction(e+"_add");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.setReturnType("i32"),C.addLocal("c","i64");const u=C.getCodeBuilder();C.addCode(u.setLocal("c",u.i64_add(u.i64_load32_u(u.getLocal("x")),u.i64_load32_u(u.getLocal("y"))))),C.addCode(u.i64_store32(u.getLocal("r"),u.getLocal("c")));for(let L=1;L<c;L++)C.addCode(u.setLocal("c",u.i64_add(u.i64_add(u.i64_load32_u(u.getLocal("x"),4*L),u.i64_load32_u(u.getLocal("y"),4*L)),u.i64_shr_u(u.getLocal("c"),u.i64_const(32))))),C.addCode(u.i64_store32(u.getLocal("r"),L*4,u.getLocal("c")));C.addCode(u.i32_wrap_i64(u.i64_shr_u(u.getLocal("c"),u.i64_const(32))))}function T(){const C=t.addFunction(e+"_sub");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.setReturnType("i32"),C.addLocal("c","i64");const u=C.getCodeBuilder();C.addCode(u.setLocal("c",u.i64_sub(u.i64_load32_u(u.getLocal("x")),u.i64_load32_u(u.getLocal("y"))))),C.addCode(u.i64_store32(u.getLocal("r"),u.i64_and(u.getLocal("c"),u.i64_const("0xFFFFFFFF"))));for(let L=1;L<c;L++)C.addCode(u.setLocal("c",u.i64_add(u.i64_sub(u.i64_load32_u(u.getLocal("x"),4*L),u.i64_load32_u(u.getLocal("y"),4*L)),u.i64_shr_s(u.getLocal("c"),u.i64_const(32))))),C.addCode(u.i64_store32(u.getLocal("r"),L*4,u.i64_and(u.getLocal("c"),u.i64_const("0xFFFFFFFF"))));C.addCode(u.i32_wrap_i64(u.i64_shr_s(u.getLocal("c"),u.i64_const(32))))}function k(){const C=t.addFunction(e+"_mul");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.addLocal("c0","i64"),C.addLocal("c1","i64");for(let m=0;m<c;m++)C.addLocal("x"+m,"i64"),C.addLocal("y"+m,"i64");const u=C.getCodeBuilder(),L=[],$=[];function K(m,I){let U,et;return L[m]?U=u.getLocal("x"+m):(U=u.teeLocal("x"+m,u.i64_load32_u(u.getLocal("x"),m*4)),L[m]=!0),$[I]?et=u.getLocal("y"+I):(et=u.teeLocal("y"+I,u.i64_load32_u(u.getLocal("y"),I*4)),$[I]=!0),u.i64_mul(U,et)}let J="c0",P="c1";for(let m=0;m<c*2-1;m++){for(let I=Math.max(0,m-c+1);I<=m&&I<c;I++){const U=m-I;C.addCode(u.setLocal(J,u.i64_add(u.i64_and(u.getLocal(J),u.i64_const(4294967295)),K(I,U)))),C.addCode(u.setLocal(P,u.i64_add(u.getLocal(P),u.i64_shr_u(u.getLocal(J),u.i64_const(32)))))}C.addCode(u.i64_store32(u.getLocal("r"),m*4,u.getLocal(J))),[J,P]=[P,J],C.addCode(u.setLocal(P,u.i64_shr_u(u.getLocal(J),u.i64_const(32))))}C.addCode(u.i64_store32(u.getLocal("r"),c*4*2-4,u.getLocal(J)))}function x(){const C=t.addFunction(e+"_square");C.addParam("x","i32"),C.addParam("r","i32"),C.addLocal("c0","i64"),C.addLocal("c1","i64"),C.addLocal("c0_old","i64"),C.addLocal("c1_old","i64");for(let I=0;I<c;I++)C.addLocal("x"+I,"i64");const u=C.getCodeBuilder(),L=[];function $(I,U){let et,Y;return L[I]?et=u.getLocal("x"+I):(et=u.teeLocal("x"+I,u.i64_load32_u(u.getLocal("x"),I*4)),L[I]=!0),L[U]?Y=u.getLocal("x"+U):(Y=u.teeLocal("x"+U,u.i64_load32_u(u.getLocal("x"),U*4)),L[U]=!0),u.i64_mul(et,Y)}let K="c0",J="c1",P="c0_old",m="c1_old";for(let I=0;I<c*2-1;I++){C.addCode(u.setLocal(K,u.i64_const(0)),u.setLocal(J,u.i64_const(0)));for(let U=Math.max(0,I-c+1);U<I+1>>1&&U<c;U++){const et=I-U;C.addCode(u.setLocal(K,u.i64_add(u.i64_and(u.getLocal(K),u.i64_const(4294967295)),$(U,et)))),C.addCode(u.setLocal(J,u.i64_add(u.getLocal(J),u.i64_shr_u(u.getLocal(K),u.i64_const(32)))))}C.addCode(u.setLocal(K,u.i64_shl(u.i64_and(u.getLocal(K),u.i64_const(4294967295)),u.i64_const(1)))),C.addCode(u.setLocal(J,u.i64_add(u.i64_shl(u.getLocal(J),u.i64_const(1)),u.i64_shr_u(u.getLocal(K),u.i64_const(32))))),I%2==0&&(C.addCode(u.setLocal(K,u.i64_add(u.i64_and(u.getLocal(K),u.i64_const(4294967295)),$(I>>1,I>>1)))),C.addCode(u.setLocal(J,u.i64_add(u.getLocal(J),u.i64_shr_u(u.getLocal(K),u.i64_const(32)))))),I>0&&(C.addCode(u.setLocal(K,u.i64_add(u.i64_and(u.getLocal(K),u.i64_const(4294967295)),u.i64_and(u.getLocal(P),u.i64_const(4294967295))))),C.addCode(u.setLocal(J,u.i64_add(u.i64_add(u.getLocal(J),u.i64_shr_u(u.getLocal(K),u.i64_const(32))),u.getLocal(m))))),C.addCode(u.i64_store32(u.getLocal("r"),I*4,u.getLocal(K))),C.addCode(u.setLocal(P,u.getLocal(J)),u.setLocal(m,u.i64_shr_u(u.getLocal(P),u.i64_const(32))))}C.addCode(u.i64_store32(u.getLocal("r"),c*4*2-4,u.getLocal(P)))}function O(){const C=t.addFunction(e+"_squareOld");C.addParam("x","i32"),C.addParam("r","i32");const u=C.getCodeBuilder();C.addCode(u.call(e+"_mul",u.getLocal("x"),u.getLocal("x"),u.getLocal("r")))}function B(){const C=t.addFunction(e+"__mul1");C.addParam("px","i32"),C.addParam("y","i64"),C.addParam("pr","i32"),C.addLocal("c","i64");const u=C.getCodeBuilder();C.addCode(u.setLocal("c",u.i64_mul(u.i64_load32_u(u.getLocal("px"),0,0),u.getLocal("y")))),C.addCode(u.i64_store32(u.getLocal("pr"),0,0,u.getLocal("c")));for(let L=1;L<c;L++)C.addCode(u.setLocal("c",u.i64_add(u.i64_mul(u.i64_load32_u(u.getLocal("px"),4*L,0),u.getLocal("y")),u.i64_shr_u(u.getLocal("c"),u.i64_const(32))))),C.addCode(u.i64_store32(u.getLocal("pr"),L*4,0,u.getLocal("c")))}function Q(){const C=t.addFunction(e+"__add1");C.addParam("x","i32"),C.addParam("y","i64"),C.addLocal("c","i64"),C.addLocal("px","i32");const u=C.getCodeBuilder();C.addCode(u.setLocal("px",u.getLocal("x"))),C.addCode(u.setLocal("c",u.i64_add(u.i64_load32_u(u.getLocal("px"),0,0),u.getLocal("y")))),C.addCode(u.i64_store32(u.getLocal("px"),0,0,u.getLocal("c"))),C.addCode(u.setLocal("c",u.i64_shr_u(u.getLocal("c"),u.i64_const(32)))),C.addCode(u.block(u.loop(u.br_if(1,u.i64_eqz(u.getLocal("c"))),u.setLocal("px",u.i32_add(u.getLocal("px"),u.i32_const(4))),u.setLocal("c",u.i64_add(u.i64_load32_u(u.getLocal("px"),0,0),u.getLocal("c"))),u.i64_store32(u.getLocal("px"),0,0,u.getLocal("c")),u.setLocal("c",u.i64_shr_u(u.getLocal("c"),u.i64_const(32))),u.br(0))))}function E(){B(),Q();const C=t.addFunction(e+"_div");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("c","i32"),C.addParam("r","i32"),C.addLocal("rr","i32"),C.addLocal("cc","i32"),C.addLocal("eX","i32"),C.addLocal("eY","i32"),C.addLocal("sy","i64"),C.addLocal("sx","i64"),C.addLocal("ec","i32");const u=C.getCodeBuilder(),L=u.i32_const(t.alloc(f)),$=u.i32_const(t.alloc(f)),K=u.i32_const(t.alloc(f)),J=u.getLocal("cc"),P=u.getLocal("rr"),m=t.alloc(f*2),I=u.i32_const(m),U=u.i32_const(m+f);C.addCode(u.if(u.getLocal("c"),u.setLocal("cc",u.getLocal("c")),u.setLocal("cc",$))),C.addCode(u.if(u.getLocal("r"),u.setLocal("rr",u.getLocal("r")),u.setLocal("rr",K))),C.addCode(u.call(e+"_copy",u.getLocal("x"),P)),C.addCode(u.call(e+"_copy",u.getLocal("y"),L)),C.addCode(u.call(e+"_zero",J)),C.addCode(u.call(e+"_zero",I)),C.addCode(u.setLocal("eX",u.i32_const(f-1))),C.addCode(u.setLocal("eY",u.i32_const(f-1))),C.addCode(u.block(u.loop(u.br_if(1,u.i32_or(u.i32_load8_u(u.i32_add(L,u.getLocal("eY")),0,0),u.i32_eq(u.getLocal("eY"),u.i32_const(3)))),u.setLocal("eY",u.i32_sub(u.getLocal("eY"),u.i32_const(1))),u.br(0)))),C.addCode(u.setLocal("sy",u.i64_add(u.i64_load32_u(u.i32_sub(u.i32_add(L,u.getLocal("eY")),u.i32_const(3)),0,0),u.i64_const(1)))),C.addCode(u.if(u.i64_eq(u.getLocal("sy"),u.i64_const(1)),u.drop(u.i64_div_u(u.i64_const(0),u.i64_const(0))))),C.addCode(u.block(u.loop(u.block(u.loop(u.br_if(1,u.i32_or(u.i32_load8_u(u.i32_add(P,u.getLocal("eX")),0,0),u.i32_eq(u.getLocal("eX"),u.i32_const(7)))),u.setLocal("eX",u.i32_sub(u.getLocal("eX"),u.i32_const(1))),u.br(0))),u.setLocal("sx",u.i64_load(u.i32_sub(u.i32_add(P,u.getLocal("eX")),u.i32_const(7)),0,0)),u.setLocal("sx",u.i64_div_u(u.getLocal("sx"),u.getLocal("sy"))),u.setLocal("ec",u.i32_sub(u.i32_sub(u.getLocal("eX"),u.getLocal("eY")),u.i32_const(4))),u.block(u.loop(u.br_if(1,u.i32_and(u.i64_eqz(u.i64_and(u.getLocal("sx"),u.i64_const("0xFFFFFFFF00000000"))),u.i32_ge_s(u.getLocal("ec"),u.i32_const(0)))),u.setLocal("sx",u.i64_shr_u(u.getLocal("sx"),u.i64_const(8))),u.setLocal("ec",u.i32_add(u.getLocal("ec"),u.i32_const(1))),u.br(0))),u.if(u.i64_eqz(u.getLocal("sx")),[...u.br_if(2,u.i32_eqz(u.call(e+"_gte",P,L))),...u.setLocal("sx",u.i64_const(1)),...u.setLocal("ec",u.i32_const(0))]),u.call(e+"__mul1",L,u.getLocal("sx"),U),u.drop(u.call(e+"_sub",P,u.i32_sub(U,u.getLocal("ec")),P)),u.call(e+"__add1",u.i32_add(J,u.getLocal("ec")),u.getLocal("sx")),u.br(0))))}function nt(){const C=t.addFunction(e+"_inverseMod");C.addParam("px","i32"),C.addParam("pm","i32"),C.addParam("pr","i32"),C.addLocal("t","i32"),C.addLocal("newt","i32"),C.addLocal("r","i32"),C.addLocal("qq","i32"),C.addLocal("qr","i32"),C.addLocal("newr","i32"),C.addLocal("swp","i32"),C.addLocal("x","i32"),C.addLocal("signt","i32"),C.addLocal("signnewt","i32"),C.addLocal("signx","i32");const u=C.getCodeBuilder(),L=u.i32_const(t.alloc(f)),$=u.i32_const(t.alloc(f)),K=u.i32_const(t.alloc(f)),J=u.i32_const(t.alloc(f)),P=u.i32_const(t.alloc(f)),m=u.i32_const(t.alloc(f)),I=u.i32_const(t.alloc(f*2)),U=u.i32_const(t.alloc(f));C.addCode(u.setLocal("t",L),u.call(e+"_zero",L),u.setLocal("signt",u.i32_const(0))),C.addCode(u.setLocal("r",$),u.call(e+"_copy",u.getLocal("pm"),$)),C.addCode(u.setLocal("newt",K),u.call(e+"_one",K),u.setLocal("signnewt",u.i32_const(0))),C.addCode(u.setLocal("newr",J),u.call(e+"_copy",u.getLocal("px"),J)),C.addCode(u.setLocal("qq",P)),C.addCode(u.setLocal("qr",m)),C.addCode(u.setLocal("x",U)),C.addCode(u.block(u.loop(u.br_if(1,u.call(e+"_isZero",u.getLocal("newr"))),u.call(e+"_div",u.getLocal("r"),u.getLocal("newr"),u.getLocal("qq"),u.getLocal("qr")),u.call(e+"_mul",u.getLocal("qq"),u.getLocal("newt"),I),u.if(u.getLocal("signt"),u.if(u.getLocal("signnewt"),u.if(u.call(e+"_gte",I,u.getLocal("t")),[...u.drop(u.call(e+"_sub",I,u.getLocal("t"),u.getLocal("x"))),...u.setLocal("signx",u.i32_const(0))],[...u.drop(u.call(e+"_sub",u.getLocal("t"),I,u.getLocal("x"))),...u.setLocal("signx",u.i32_const(1))]),[...u.drop(u.call(e+"_add",I,u.getLocal("t"),u.getLocal("x"))),...u.setLocal("signx",u.i32_const(1))]),u.if(u.getLocal("signnewt"),[...u.drop(u.call(e+"_add",I,u.getLocal("t"),u.getLocal("x"))),...u.setLocal("signx",u.i32_const(0))],u.if(u.call(e+"_gte",u.getLocal("t"),I),[...u.drop(u.call(e+"_sub",u.getLocal("t"),I,u.getLocal("x"))),...u.setLocal("signx",u.i32_const(0))],[...u.drop(u.call(e+"_sub",I,u.getLocal("t"),u.getLocal("x"))),...u.setLocal("signx",u.i32_const(1))]))),u.setLocal("swp",u.getLocal("t")),u.setLocal("t",u.getLocal("newt")),u.setLocal("newt",u.getLocal("x")),u.setLocal("x",u.getLocal("swp")),u.setLocal("signt",u.getLocal("signnewt")),u.setLocal("signnewt",u.getLocal("signx")),u.setLocal("swp",u.getLocal("r")),u.setLocal("r",u.getLocal("newr")),u.setLocal("newr",u.getLocal("qr")),u.setLocal("qr",u.getLocal("swp")),u.br(0)))),C.addCode(u.if(u.getLocal("signt"),u.drop(u.call(e+"_sub",u.getLocal("pm"),u.getLocal("t"),u.getLocal("pr"))),u.call(e+"_copy",u.getLocal("t"),u.getLocal("pr"))))}return d(),b(),s(),g(),y(),w(),h(),T(),k(),x(),O(),E(),nt(),t.exportFunction(e+"_copy"),t.exportFunction(e+"_zero"),t.exportFunction(e+"_one"),t.exportFunction(e+"_isZero"),t.exportFunction(e+"_eq"),t.exportFunction(e+"_gte"),t.exportFunction(e+"_add"),t.exportFunction(e+"_sub"),t.exportFunction(e+"_mul"),t.exportFunction(e+"_square"),t.exportFunction(e+"_squareOld"),t.exportFunction(e+"_div"),t.exportFunction(e+"_inverseMod"),e},Uo=function(t,n,o,e,c,f,d){const b=t.addFunction(n);b.addParam("base","i32"),b.addParam("scalar","i32"),b.addParam("scalarLength","i32"),b.addParam("r","i32"),b.addLocal("i","i32"),b.addLocal("b","i32");const g=b.getCodeBuilder(),s=g.i32_const(t.alloc(o));b.addCode(g.if(g.i32_eqz(g.getLocal("scalarLength")),[...g.call(d,g.getLocal("r")),...g.ret([])])),b.addCode(g.call(f,g.getLocal("base"),s)),b.addCode(g.call(d,g.getLocal("r"))),b.addCode(g.setLocal("i",g.getLocal("scalarLength"))),b.addCode(g.block(g.loop(g.setLocal("i",g.i32_sub(g.getLocal("i"),g.i32_const(1))),g.setLocal("b",g.i32_load8_u(g.i32_add(g.getLocal("scalar"),g.getLocal("i")))),...y(),g.br_if(1,g.i32_eqz(g.getLocal("i"))),g.br(0))));function y(){const w=[];for(let h=0;h<8;h++)w.push(...g.call(c,g.getLocal("r"),g.getLocal("r")),...g.if(g.i32_ge_u(g.getLocal("b"),g.i32_const(128>>h)),[...g.setLocal("b",g.i32_sub(g.getLocal("b"),g.i32_const(128>>h))),...g.call(e,g.getLocal("r"),s,g.getLocal("r"))]));return w}},Ro=mi;function mi(i,t){const n=i.modules[t].n64*8,o=i.addFunction(t+"_batchInverse");o.addParam("pIn","i32"),o.addParam("inStep","i32"),o.addParam("n","i32"),o.addParam("pOut","i32"),o.addParam("outStep","i32"),o.addLocal("itAux","i32"),o.addLocal("itIn","i32"),o.addLocal("itOut","i32"),o.addLocal("i","i32");const e=o.getCodeBuilder(),c=e.i32_const(i.alloc(n));o.addCode(e.setLocal("itAux",e.i32_load(e.i32_const(0))),e.i32_store(e.i32_const(0),e.i32_add(e.getLocal("itAux"),e.i32_mul(e.i32_add(e.getLocal("n"),e.i32_const(1)),e.i32_const(n))))),o.addCode(e.call(t+"_one",e.getLocal("itAux")),e.setLocal("itIn",e.getLocal("pIn")),e.setLocal("itAux",e.i32_add(e.getLocal("itAux"),e.i32_const(n))),e.setLocal("i",e.i32_const(0)),e.block(e.loop(e.br_if(1,e.i32_eq(e.getLocal("i"),e.getLocal("n"))),e.if(e.call(t+"_isZero",e.getLocal("itIn")),e.call(t+"_copy",e.i32_sub(e.getLocal("itAux"),e.i32_const(n)),e.getLocal("itAux")),e.call(t+"_mul",e.getLocal("itIn"),e.i32_sub(e.getLocal("itAux"),e.i32_const(n)),e.getLocal("itAux"))),e.setLocal("itIn",e.i32_add(e.getLocal("itIn"),e.getLocal("inStep"))),e.setLocal("itAux",e.i32_add(e.getLocal("itAux"),e.i32_const(n))),e.setLocal("i",e.i32_add(e.getLocal("i"),e.i32_const(1))),e.br(0))),e.setLocal("itIn",e.i32_sub(e.getLocal("itIn"),e.getLocal("inStep"))),e.setLocal("itAux",e.i32_sub(e.getLocal("itAux"),e.i32_const(n))),e.setLocal("itOut",e.i32_add(e.getLocal("pOut"),e.i32_mul(e.i32_sub(e.getLocal("n"),e.i32_const(1)),e.getLocal("outStep")))),e.call(t+"_inverse",e.getLocal("itAux"),e.getLocal("itAux")),e.block(e.loop(e.br_if(1,e.i32_eqz(e.getLocal("i"))),e.if(e.call(t+"_isZero",e.getLocal("itIn")),[...e.call(t+"_copy",e.getLocal("itAux"),e.i32_sub(e.getLocal("itAux"),e.i32_const(n))),...e.call(t+"_zero",e.getLocal("itOut"))],[...e.call(t+"_copy",e.i32_sub(e.getLocal("itAux"),e.i32_const(n)),c),...e.call(t+"_mul",e.getLocal("itAux"),e.getLocal("itIn"),e.i32_sub(e.getLocal("itAux"),e.i32_const(n))),...e.call(t+"_mul",e.getLocal("itAux"),c,e.getLocal("itOut"))]),e.setLocal("itIn",e.i32_sub(e.getLocal("itIn"),e.getLocal("inStep"))),e.setLocal("itOut",e.i32_sub(e.getLocal("itOut"),e.getLocal("outStep"))),e.setLocal("itAux",e.i32_sub(e.getLocal("itAux"),e.i32_const(n))),e.setLocal("i",e.i32_sub(e.getLocal("i"),e.i32_const(1))),e.br(0)))),o.addCode(e.i32_store(e.i32_const(0),e.getLocal("itAux")))}var Xe=bi;function bi(i,t,n,o,e,c){typeof c>"u"&&(o<e?c=!0:c=!1);const f=i.addFunction(t);f.addParam("pIn","i32"),f.addParam("n","i32"),f.addParam("pOut","i32"),f.addLocal("i","i32"),f.addLocal("itIn","i32"),f.addLocal("itOut","i32");const d=f.getCodeBuilder();c?f.addCode(d.setLocal("itIn",d.i32_add(d.getLocal("pIn"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.i32_const(o)))),d.setLocal("itOut",d.i32_add(d.getLocal("pOut"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.i32_const(e)))),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.call(n,d.getLocal("itIn"),d.getLocal("itOut")),d.setLocal("itIn",d.i32_sub(d.getLocal("itIn"),d.i32_const(o))),d.setLocal("itOut",d.i32_sub(d.getLocal("itOut"),d.i32_const(e))),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0)))):f.addCode(d.setLocal("itIn",d.getLocal("pIn")),d.setLocal("itOut",d.getLocal("pOut")),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.call(n,d.getLocal("itIn"),d.getLocal("itOut")),d.setLocal("itIn",d.i32_add(d.getLocal("itIn"),d.i32_const(o))),d.setLocal("itOut",d.i32_add(d.getLocal("itOut"),d.i32_const(e))),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}var yi=wi;function wi(i,t,n,o,e,c){typeof c>"u"&&(o<e?c=!0:c=!1);const f=i.addFunction(t);f.addParam("pIn1","i32"),f.addParam("pIn2","i32"),f.addParam("n","i32"),f.addParam("pOut","i32"),f.addLocal("i","i32"),f.addLocal("itIn1","i32"),f.addLocal("itIn2","i32"),f.addLocal("itOut","i32");const d=f.getCodeBuilder();c?f.addCode(d.setLocal("itIn1",d.i32_add(d.getLocal("pIn1"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.i32_const(o)))),d.setLocal("itIn2",d.i32_add(d.getLocal("pIn2"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.i32_const(o)))),d.setLocal("itOut",d.i32_add(d.getLocal("pOut"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.i32_const(e)))),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.call(n,d.getLocal("itIn1"),d.getLocal("itIn2"),d.getLocal("itOut")),d.setLocal("itIn1",d.i32_sub(d.getLocal("itIn1"),d.i32_const(o))),d.setLocal("itIn2",d.i32_sub(d.getLocal("itIn2"),d.i32_const(o))),d.setLocal("itOut",d.i32_sub(d.getLocal("itOut"),d.i32_const(e))),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0)))):f.addCode(d.setLocal("itIn1",d.getLocal("pIn1")),d.setLocal("itIn2",d.getLocal("pIn2")),d.setLocal("itOut",d.getLocal("pOut")),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.call(n,d.getLocal("itIn1"),d.getLocal("itIn2"),d.getLocal("itOut")),d.setLocal("itIn1",d.i32_add(d.getLocal("itIn1"),d.i32_const(o))),d.setLocal("itIn2",d.i32_add(d.getLocal("itIn2"),d.i32_const(o))),d.setLocal("itOut",d.i32_add(d.getLocal("itOut"),d.i32_const(e))),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}var $t={};function Ve(i,t){return i===t?0:i>t?1:-1}function No(i){return i*i}function He(i){return i%2n!==0n}function Go(i){return i%2n===0n}function ao(i){return i<0n}function Bi(i){return i>0n}function Qe(i){return ao(i)?i.toString(2).length-1:i.toString(2).length}function $n(i){return i<0n?-i:i}function xn(i){return $n(i)===1n}function Je(i,t){for(var n=0n,o=1n,e=t,c=$n(i),f,d,b;c!==0n;)f=e/c,d=n,b=e,n=o,e=c,o=d-f*o,c=b-f*c;if(!xn(e))throw new Error(i.toString()+" and "+t.toString()+" are not co-prime");return Ve(n,0n)===-1&&(n=n+t),ao(i)?-n:n}function Ye(i,t,n){if(n===0n)throw new Error("Cannot take modPow with modulus 0");var o=1n,e=i%n;for(ao(t)&&(t=t*-1n,e=Je(e,n));Bi(t);){if(e===0n)return 0n;He(t)&&(o=o*e%n),t=t/2n,e=No(e)%n}return o}function Ci(i,t){return i=i>=0n?i:-i,t=t>=0n?t:-t,i===t?0:i>t?1:-1}function Jo(i,t){return t===0n?!1:xn(t)?!0:Ci(t,2n)===0?Go(i):i%t===0n}function xi(i){var t=$n(i);if(xn(t))return!1;if(t===2n||t===3n||t===5n)return!0;if(Go(t)||Jo(t,3n)||Jo(t,5n))return!1;if(t<49n)return!0}function Fi(i){return i-1n}function Yo(i,t){for(var n=Fi(i),o=n,e=0,c,f,d;Go(o);)o=o/2n,e++;t:for(f=0;f<t.length;f++)if(!(i<t[f])&&(d=Ye(BigInt(t[f]),o,i),!(xn(d)||d===n))){for(c=e-1;c!=0;c--){if(d=No(d)%i,xn(d))return!1;if(d===n)continue t}return!1}return!0}function Ai(i){var t=xi(i);if(t!==void 0)return t;var n=$n(i),o=Qe(n);if(o<=64)return Yo(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var e=Math.log(2)*Number(o),c=Math.ceil(e),f=[],d=0;d<c;d++)f.push(BigInt(d+2));return Yo(n,f)}$t.bitLength=Qe;$t.isOdd=He;$t.isNegative=ao;$t.abs=$n;$t.isUnit=xn;$t.compare=Ve;$t.modInv=Je;$t.modPow=Ye;$t.isPrime=Ai;$t.square=No;const vi=hi,cn=gn,Ii=Uo,Si=Ro,_o=Xe,go=yi,{bitLength:Ei,modInv:fo,modPow:te,isPrime:ne,isOdd:Pi,square:Oi}=$t;var $o=function(t,n,o,e){const c=BigInt(n),f=Math.floor((Ei(c-1n)-1)/64)+1,d=f*2,b=f*8,g=o||"f1m";if(t.modules[g])return g;const s=vi(t,f,e),y=t.alloc(b,cn.bigInt2BytesLE(c,b)),w=t.alloc(cn.bigInt2BytesLE(Oi(1n<<BigInt(f*64))%c,b)),h=t.alloc(cn.bigInt2BytesLE((1n<<BigInt(f*64))%c,b)),T=t.alloc(cn.bigInt2BytesLE(0n,b)),k=c-1n,x=k>>1n,O=t.alloc(b,cn.bigInt2BytesLE(x,b)),B=x+1n,Q=t.alloc(b,cn.bigInt2BytesLE(B,b));t.modules[g]={pq:y,pR2:w,n64:f,q:c,pOne:h,pZero:T,pePlusOne:Q};function E(){const v=t.addFunction(g+"_one");v.addParam("pr","i32");const p=v.getCodeBuilder();v.addCode(p.call(s+"_copy",p.i32_const(h),p.getLocal("pr")))}function nt(){const v=t.addFunction(g+"_add");v.addParam("x","i32"),v.addParam("y","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.if(p.call(s+"_add",p.getLocal("x"),p.getLocal("y"),p.getLocal("r")),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))),p.if(p.call(s+"_gte",p.getLocal("r"),p.i32_const(y)),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))))))}function C(){const v=t.addFunction(g+"_sub");v.addParam("x","i32"),v.addParam("y","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.if(p.call(s+"_sub",p.getLocal("x"),p.getLocal("y"),p.getLocal("r")),p.drop(p.call(s+"_add",p.getLocal("r"),p.i32_const(y),p.getLocal("r")))))}function u(){const v=t.addFunction(g+"_neg");v.addParam("x","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.call(g+"_sub",p.i32_const(T),p.getLocal("x"),p.getLocal("r")))}function L(){const v=t.addFunction(g+"_isNegative");v.addParam("x","i32"),v.setReturnType("i32");const p=v.getCodeBuilder(),D=p.i32_const(t.alloc(b));v.addCode(p.call(g+"_fromMontgomery",p.getLocal("x"),D),p.call(s+"_gte",D,p.i32_const(Q)))}function $(){const v=t.addFunction(g+"_sign");v.addParam("x","i32"),v.setReturnType("i32");const p=v.getCodeBuilder(),D=p.i32_const(t.alloc(b));v.addCode(p.if(p.call(s+"_isZero",p.getLocal("x")),p.ret(p.i32_const(0))),p.call(g+"_fromMontgomery",p.getLocal("x"),D),p.if(p.call(s+"_gte",D,p.i32_const(Q)),p.ret(p.i32_const(-1))),p.ret(p.i32_const(1)))}function K(){const v=t.alloc(d*d*8),p=t.addFunction(g+"_mReduct");p.addParam("t","i32"),p.addParam("r","i32"),p.addLocal("np32","i64"),p.addLocal("c","i64"),p.addLocal("m","i64");const D=p.getCodeBuilder(),ut=Number(0x100000000n-fo(c,0x100000000n));p.addCode(D.setLocal("np32",D.i64_const(ut)));for(let st=0;st<d;st++){p.addCode(D.setLocal("c",D.i64_const(0))),p.addCode(D.setLocal("m",D.i64_and(D.i64_mul(D.i64_load32_u(D.getLocal("t"),st*4),D.getLocal("np32")),D.i64_const("0xFFFFFFFF"))));for(let rt=0;rt<d;rt++)p.addCode(D.setLocal("c",D.i64_add(D.i64_add(D.i64_load32_u(D.getLocal("t"),(st+rt)*4),D.i64_shr_u(D.getLocal("c"),D.i64_const(32))),D.i64_mul(D.i64_load32_u(D.i32_const(y),rt*4),D.getLocal("m"))))),p.addCode(D.i64_store32(D.getLocal("t"),(st+rt)*4,D.getLocal("c")));p.addCode(D.i64_store32(D.i32_const(v),st*4,D.i64_shr_u(D.getLocal("c"),D.i64_const(32))))}p.addCode(D.call(g+"_add",D.i32_const(v),D.i32_add(D.getLocal("t"),D.i32_const(d*4)),D.getLocal("r")))}function J(){const v=t.addFunction(g+"_mul");v.addParam("x","i32"),v.addParam("y","i32"),v.addParam("r","i32"),v.addLocal("c0","i64"),v.addLocal("c1","i64"),v.addLocal("np32","i64");for(let gt=0;gt<d;gt++)v.addLocal("x"+gt,"i64"),v.addLocal("y"+gt,"i64"),v.addLocal("m"+gt,"i64"),v.addLocal("q"+gt,"i64");const p=v.getCodeBuilder(),D=Number(0x100000000n-fo(c,0x100000000n));v.addCode(p.setLocal("np32",p.i64_const(D)));const ut=[],st=[],rt=[];function yt(gt,lt){let bt,Et;return ut[gt]?bt=p.getLocal("x"+gt):(bt=p.teeLocal("x"+gt,p.i64_load32_u(p.getLocal("x"),gt*4)),ut[gt]=!0),st[lt]?Et=p.getLocal("y"+lt):(Et=p.teeLocal("y"+lt,p.i64_load32_u(p.getLocal("y"),lt*4)),st[lt]=!0),p.i64_mul(bt,Et)}function dt(gt,lt){let bt,Et;return rt[gt]?bt=p.getLocal("q"+gt):(bt=p.teeLocal("q"+gt,p.i64_load32_u(p.i32_const(0),y+gt*4)),rt[gt]=!0),Et=p.getLocal("m"+lt),p.i64_mul(bt,Et)}let Lt="c0",It="c1";for(let gt=0;gt<d*2-1;gt++){for(let lt=Math.max(0,gt-d+1);lt<=gt&&lt<d;lt++){const bt=gt-lt;v.addCode(p.setLocal(Lt,p.i64_add(p.i64_and(p.getLocal(Lt),p.i64_const(4294967295)),yt(lt,bt)))),v.addCode(p.setLocal(It,p.i64_add(p.getLocal(It),p.i64_shr_u(p.getLocal(Lt),p.i64_const(32)))))}for(let lt=Math.max(1,gt-d+1);lt<=gt&&lt<d;lt++){const bt=gt-lt;v.addCode(p.setLocal(Lt,p.i64_add(p.i64_and(p.getLocal(Lt),p.i64_const(4294967295)),dt(lt,bt)))),v.addCode(p.setLocal(It,p.i64_add(p.getLocal(It),p.i64_shr_u(p.getLocal(Lt),p.i64_const(32)))))}gt<d&&(v.addCode(p.setLocal("m"+gt,p.i64_and(p.i64_mul(p.i64_and(p.getLocal(Lt),p.i64_const(4294967295)),p.getLocal("np32")),p.i64_const("0xFFFFFFFF")))),v.addCode(p.setLocal(Lt,p.i64_add(p.i64_and(p.getLocal(Lt),p.i64_const(4294967295)),dt(0,gt)))),v.addCode(p.setLocal(It,p.i64_add(p.getLocal(It),p.i64_shr_u(p.getLocal(Lt),p.i64_const(32)))))),gt>=d&&v.addCode(p.i64_store32(p.getLocal("r"),(gt-d)*4,p.getLocal(Lt))),[Lt,It]=[It,Lt],v.addCode(p.setLocal(It,p.i64_shr_u(p.getLocal(Lt),p.i64_const(32))))}v.addCode(p.i64_store32(p.getLocal("r"),d*4-4,p.getLocal(Lt))),v.addCode(p.if(p.i32_wrap_i64(p.getLocal(It)),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))),p.if(p.call(s+"_gte",p.getLocal("r"),p.i32_const(y)),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))))))}function P(){const v=t.addFunction(g+"_square");v.addParam("x","i32"),v.addParam("r","i32"),v.addLocal("c0","i64"),v.addLocal("c1","i64"),v.addLocal("c0_old","i64"),v.addLocal("c1_old","i64"),v.addLocal("np32","i64");for(let lt=0;lt<d;lt++)v.addLocal("x"+lt,"i64"),v.addLocal("m"+lt,"i64"),v.addLocal("q"+lt,"i64");const p=v.getCodeBuilder(),D=Number(0x100000000n-fo(c,0x100000000n));v.addCode(p.setLocal("np32",p.i64_const(D)));const ut=[],st=[];function rt(lt,bt){let Et,Tt;return ut[lt]?Et=p.getLocal("x"+lt):(Et=p.teeLocal("x"+lt,p.i64_load32_u(p.getLocal("x"),lt*4)),ut[lt]=!0),ut[bt]?Tt=p.getLocal("x"+bt):(Tt=p.teeLocal("x"+bt,p.i64_load32_u(p.getLocal("x"),bt*4)),ut[bt]=!0),p.i64_mul(Et,Tt)}function yt(lt,bt){let Et,Tt;return st[lt]?Et=p.getLocal("q"+lt):(Et=p.teeLocal("q"+lt,p.i64_load32_u(p.i32_const(0),y+lt*4)),st[lt]=!0),Tt=p.getLocal("m"+bt),p.i64_mul(Et,Tt)}let dt="c0",Lt="c1",It="c0_old",gt="c1_old";for(let lt=0;lt<d*2-1;lt++){v.addCode(p.setLocal(dt,p.i64_const(0)),p.setLocal(Lt,p.i64_const(0)));for(let bt=Math.max(0,lt-d+1);bt<lt+1>>1&&bt<d;bt++){const Et=lt-bt;v.addCode(p.setLocal(dt,p.i64_add(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),rt(bt,Et)))),v.addCode(p.setLocal(Lt,p.i64_add(p.getLocal(Lt),p.i64_shr_u(p.getLocal(dt),p.i64_const(32)))))}v.addCode(p.setLocal(dt,p.i64_shl(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),p.i64_const(1)))),v.addCode(p.setLocal(Lt,p.i64_add(p.i64_shl(p.getLocal(Lt),p.i64_const(1)),p.i64_shr_u(p.getLocal(dt),p.i64_const(32))))),lt%2==0&&(v.addCode(p.setLocal(dt,p.i64_add(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),rt(lt>>1,lt>>1)))),v.addCode(p.setLocal(Lt,p.i64_add(p.getLocal(Lt),p.i64_shr_u(p.getLocal(dt),p.i64_const(32)))))),lt>0&&(v.addCode(p.setLocal(dt,p.i64_add(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),p.i64_and(p.getLocal(It),p.i64_const(4294967295))))),v.addCode(p.setLocal(Lt,p.i64_add(p.i64_add(p.getLocal(Lt),p.i64_shr_u(p.getLocal(dt),p.i64_const(32))),p.getLocal(gt)))));for(let bt=Math.max(1,lt-d+1);bt<=lt&&bt<d;bt++){const Et=lt-bt;v.addCode(p.setLocal(dt,p.i64_add(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),yt(bt,Et)))),v.addCode(p.setLocal(Lt,p.i64_add(p.getLocal(Lt),p.i64_shr_u(p.getLocal(dt),p.i64_const(32)))))}lt<d&&(v.addCode(p.setLocal("m"+lt,p.i64_and(p.i64_mul(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),p.getLocal("np32")),p.i64_const("0xFFFFFFFF")))),v.addCode(p.setLocal(dt,p.i64_add(p.i64_and(p.getLocal(dt),p.i64_const(4294967295)),yt(0,lt)))),v.addCode(p.setLocal(Lt,p.i64_add(p.getLocal(Lt),p.i64_shr_u(p.getLocal(dt),p.i64_const(32)))))),lt>=d&&v.addCode(p.i64_store32(p.getLocal("r"),(lt-d)*4,p.getLocal(dt))),v.addCode(p.setLocal(It,p.getLocal(Lt)),p.setLocal(gt,p.i64_shr_u(p.getLocal(It),p.i64_const(32))))}v.addCode(p.i64_store32(p.getLocal("r"),d*4-4,p.getLocal(It))),v.addCode(p.if(p.i32_wrap_i64(p.getLocal(gt)),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))),p.if(p.call(s+"_gte",p.getLocal("r"),p.i32_const(y)),p.drop(p.call(s+"_sub",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))))))}function m(){const v=t.addFunction(g+"_squareOld");v.addParam("x","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.call(g+"_mul",p.getLocal("x"),p.getLocal("x"),p.getLocal("r")))}function I(){const v=t.addFunction(g+"_toMontgomery");v.addParam("x","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.call(g+"_mul",p.getLocal("x"),p.i32_const(w),p.getLocal("r")))}function U(){const v=t.alloc(b*2),p=t.addFunction(g+"_fromMontgomery");p.addParam("x","i32"),p.addParam("r","i32");const D=p.getCodeBuilder();p.addCode(D.call(s+"_copy",D.getLocal("x"),D.i32_const(v))),p.addCode(D.call(s+"_zero",D.i32_const(v+b))),p.addCode(D.call(g+"_mReduct",D.i32_const(v),D.getLocal("r")))}function et(){const v=t.addFunction(g+"_inverse");v.addParam("x","i32"),v.addParam("r","i32");const p=v.getCodeBuilder();v.addCode(p.call(g+"_fromMontgomery",p.getLocal("x"),p.getLocal("r"))),v.addCode(p.call(s+"_inverseMod",p.getLocal("r"),p.i32_const(y),p.getLocal("r"))),v.addCode(p.call(g+"_toMontgomery",p.getLocal("r"),p.getLocal("r")))}let Y=2n;if(ne(c))for(;te(Y,x,c)!==k;)Y=Y+1n;let j=0,ct=k;for(;!Pi(ct)&&ct!==0n;)j++,ct=ct>>1n;const H=t.alloc(b,cn.bigInt2BytesLE(ct,b)),at=te(Y,ct,c),Pt=t.alloc(cn.bigInt2BytesLE((at<<BigInt(f*64))%c,b)),vt=ct+1n>>1n,ht=t.alloc(b,cn.bigInt2BytesLE(vt,b));function A(){const v=t.addFunction(g+"_sqrt");v.addParam("n","i32"),v.addParam("r","i32"),v.addLocal("m","i32"),v.addLocal("i","i32"),v.addLocal("j","i32");const p=v.getCodeBuilder(),D=p.i32_const(h),ut=p.i32_const(t.alloc(b)),st=p.i32_const(t.alloc(b)),rt=p.i32_const(t.alloc(b)),yt=p.i32_const(t.alloc(b)),dt=p.i32_const(t.alloc(b));v.addCode(p.if(p.call(g+"_isZero",p.getLocal("n")),p.ret(p.call(g+"_zero",p.getLocal("r")))),p.setLocal("m",p.i32_const(j)),p.call(g+"_copy",p.i32_const(Pt),ut),p.call(g+"_exp",p.getLocal("n"),p.i32_const(H),p.i32_const(b),st),p.call(g+"_exp",p.getLocal("n"),p.i32_const(ht),p.i32_const(b),rt),p.block(p.loop(p.br_if(1,p.call(g+"_eq",st,D)),p.call(g+"_square",st,yt),p.setLocal("i",p.i32_const(1)),p.block(p.loop(p.br_if(1,p.call(g+"_eq",yt,D)),p.call(g+"_square",yt,yt),p.setLocal("i",p.i32_add(p.getLocal("i"),p.i32_const(1))),p.br(0))),p.call(g+"_copy",ut,dt),p.setLocal("j",p.i32_sub(p.i32_sub(p.getLocal("m"),p.getLocal("i")),p.i32_const(1))),p.block(p.loop(p.br_if(1,p.i32_eqz(p.getLocal("j"))),p.call(g+"_square",dt,dt),p.setLocal("j",p.i32_sub(p.getLocal("j"),p.i32_const(1))),p.br(0))),p.setLocal("m",p.getLocal("i")),p.call(g+"_square",dt,ut),p.call(g+"_mul",st,ut,st),p.call(g+"_mul",rt,dt,rt),p.br(0))),p.if(p.call(g+"_isNegative",rt),p.call(g+"_neg",rt,p.getLocal("r")),p.call(g+"_copy",rt,p.getLocal("r"))))}function a(){const v=t.addFunction(g+"_isSquare");v.addParam("n","i32"),v.setReturnType("i32");const p=v.getCodeBuilder(),D=p.i32_const(h),ut=p.i32_const(t.alloc(b));v.addCode(p.if(p.call(g+"_isZero",p.getLocal("n")),p.ret(p.i32_const(1))),p.call(g+"_exp",p.getLocal("n"),p.i32_const(O),p.i32_const(b),ut),p.call(g+"_eq",ut,D))}function F(){const v=t.addFunction(g+"_load");v.addParam("scalar","i32"),v.addParam("scalarLen","i32"),v.addParam("r","i32"),v.addLocal("p","i32"),v.addLocal("l","i32"),v.addLocal("i","i32"),v.addLocal("j","i32");const p=v.getCodeBuilder(),D=p.i32_const(t.alloc(b)),ut=t.alloc(b),st=p.i32_const(ut);v.addCode(p.call(s+"_zero",p.getLocal("r")),p.setLocal("i",p.i32_const(b)),p.setLocal("p",p.getLocal("scalar")),p.block(p.loop(p.br_if(1,p.i32_gt_u(p.getLocal("i"),p.getLocal("scalarLen"))),p.if(p.i32_eq(p.getLocal("i"),p.i32_const(b)),p.call(g+"_one",D),p.call(g+"_mul",D,p.i32_const(w),D)),p.call(g+"_mul",p.getLocal("p"),D,st),p.call(g+"_add",p.getLocal("r"),st,p.getLocal("r")),p.setLocal("p",p.i32_add(p.getLocal("p"),p.i32_const(b))),p.setLocal("i",p.i32_add(p.getLocal("i"),p.i32_const(b))),p.br(0))),p.setLocal("l",p.i32_rem_u(p.getLocal("scalarLen"),p.i32_const(b))),p.if(p.i32_eqz(p.getLocal("l")),p.ret([])),p.call(s+"_zero",st),p.setLocal("j",p.i32_const(0)),p.block(p.loop(p.br_if(1,p.i32_eq(p.getLocal("j"),p.getLocal("l"))),p.i32_store8(p.getLocal("j"),ut,p.i32_load8_u(p.getLocal("p"))),p.setLocal("p",p.i32_add(p.getLocal("p"),p.i32_const(1))),p.setLocal("j",p.i32_add(p.getLocal("j"),p.i32_const(1))),p.br(0))),p.if(p.i32_eq(p.getLocal("i"),p.i32_const(b)),p.call(g+"_one",D),p.call(g+"_mul",D,p.i32_const(w),D)),p.call(g+"_mul",st,D,st),p.call(g+"_add",p.getLocal("r"),st,p.getLocal("r")))}function l(){const v=t.addFunction(g+"_timesScalar");v.addParam("x","i32"),v.addParam("scalar","i32"),v.addParam("scalarLen","i32"),v.addParam("r","i32");const p=v.getCodeBuilder(),D=p.i32_const(t.alloc(b));v.addCode(p.call(g+"_load",p.getLocal("scalar"),p.getLocal("scalarLen"),D),p.call(g+"_toMontgomery",D,D),p.call(g+"_mul",p.getLocal("x"),D,p.getLocal("r")))}function R(){const v=t.addFunction(g+"_isOne");v.addParam("x","i32"),v.setReturnType("i32");const p=v.getCodeBuilder();v.addCode(p.ret(p.call(s+"_eq",p.getLocal("x"),p.i32_const(h))))}return t.exportFunction(s+"_copy",g+"_copy"),t.exportFunction(s+"_zero",g+"_zero"),t.exportFunction(s+"_isZero",g+"_isZero"),t.exportFunction(s+"_eq",g+"_eq"),R(),nt(),C(),u(),K(),J(),P(),m(),I(),U(),L(),$(),et(),E(),F(),l(),Si(t,g),_o(t,g+"_batchToMontgomery",g+"_toMontgomery",b,b),_o(t,g+"_batchFromMontgomery",g+"_fromMontgomery",b,b),_o(t,g+"_batchNeg",g+"_neg",b,b),go(t,g+"_batchAdd",g+"_add",b,b),go(t,g+"_batchSub",g+"_sub",b,b),go(t,g+"_batchMul",g+"_mul",b,b),t.exportFunction(g+"_add"),t.exportFunction(g+"_sub"),t.exportFunction(g+"_neg"),t.exportFunction(g+"_isNegative"),t.exportFunction(g+"_isOne"),t.exportFunction(g+"_sign"),t.exportFunction(g+"_mReduct"),t.exportFunction(g+"_mul"),t.exportFunction(g+"_square"),t.exportFunction(g+"_squareOld"),t.exportFunction(g+"_fromMontgomery"),t.exportFunction(g+"_toMontgomery"),t.exportFunction(g+"_inverse"),t.exportFunction(g+"_one"),t.exportFunction(g+"_load"),t.exportFunction(g+"_timesScalar"),Ii(t,g+"_exp",b,g+"_mul",g+"_square",s+"_copy",g+"_one"),t.exportFunction(g+"_exp"),t.exportFunction(g+"_batchInverse"),ne(c)&&(A(),a(),t.exportFunction(g+"_sqrt"),t.exportFunction(g+"_isSquare")),t.exportFunction(g+"_batchToMontgomery"),t.exportFunction(g+"_batchFromMontgomery"),g};const qi=$o,{bitLength:Mi}=$t;var ta=function(t,n,o,e,c){const f=BigInt(n),d=Math.floor((Mi(f-1n)-1)/64)+1,b=d*8,g=o||"f1";if(t.modules[g])return g;t.modules[g]={n64:d};const s=c||"int",y=qi(t,f,e,s),w=t.modules[y].pR2,h=t.modules[y].pq,T=t.modules[y].pePlusOne;function k(){const Q=t.alloc(b),E=t.addFunction(g+"_mul");E.addParam("x","i32"),E.addParam("y","i32"),E.addParam("r","i32");const nt=E.getCodeBuilder();E.addCode(nt.call(y+"_mul",nt.getLocal("x"),nt.getLocal("y"),nt.i32_const(Q))),E.addCode(nt.call(y+"_mul",nt.i32_const(Q),nt.i32_const(w),nt.getLocal("r")))}function x(){const Q=t.addFunction(g+"_square");Q.addParam("x","i32"),Q.addParam("r","i32");const E=Q.getCodeBuilder();Q.addCode(E.call(g+"_mul",E.getLocal("x"),E.getLocal("x"),E.getLocal("r")))}function O(){const Q=t.addFunction(g+"_inverse");Q.addParam("x","i32"),Q.addParam("r","i32");const E=Q.getCodeBuilder();Q.addCode(E.call(s+"_inverseMod",E.getLocal("x"),E.i32_const(h),E.getLocal("r")))}function B(){const Q=t.addFunction(g+"_isNegative");Q.addParam("x","i32"),Q.setReturnType("i32");const E=Q.getCodeBuilder();Q.addCode(E.call(s+"_gte",E.getLocal("x"),E.i32_const(T)))}return k(),x(),O(),B(),t.exportFunction(y+"_add",g+"_add"),t.exportFunction(y+"_sub",g+"_sub"),t.exportFunction(y+"_neg",g+"_neg"),t.exportFunction(g+"_mul"),t.exportFunction(g+"_square"),t.exportFunction(g+"_inverse"),t.exportFunction(g+"_isNegative"),t.exportFunction(y+"_copy",g+"_copy"),t.exportFunction(y+"_zero",g+"_zero"),t.exportFunction(y+"_one",g+"_one"),t.exportFunction(y+"_isZero",g+"_isZero"),t.exportFunction(y+"_eq",g+"_eq"),g};const zi=Uo,ki=Ro,po=gn;var na=function(t,n,o,e){if(t.modules[o])return o;const c=t.modules[e].n64*8,f=t.modules[e].q;t.modules[o]={n64:t.modules[e].n64*2};function d(){const P=t.addFunction(o+"_add");P.addParam("x","i32"),P.addParam("y","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("y"),Y=m.i32_add(m.getLocal("y"),m.i32_const(c)),j=m.getLocal("r"),ct=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_add",I,et,j),m.call(e+"_add",U,Y,ct))}function b(){const P=t.addFunction(o+"_timesScalar");P.addParam("x","i32"),P.addParam("scalar","i32"),P.addParam("scalarLen","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_timesScalar",I,m.getLocal("scalar"),m.getLocal("scalarLen"),et),m.call(e+"_timesScalar",U,m.getLocal("scalar"),m.getLocal("scalarLen"),Y))}function g(){const P=t.addFunction(o+"_sub");P.addParam("x","i32"),P.addParam("y","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("y"),Y=m.i32_add(m.getLocal("y"),m.i32_const(c)),j=m.getLocal("r"),ct=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_sub",I,et,j),m.call(e+"_sub",U,Y,ct))}function s(){const P=t.addFunction(o+"_neg");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_neg",I,et),m.call(e+"_neg",U,Y))}function y(){const P=t.addFunction(o+"_conjugate");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_copy",I,et),m.call(e+"_neg",U,Y))}function w(){const P=t.addFunction(o+"_isNegative");P.addParam("x","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.if(m.call(e+"_isZero",U),m.ret(m.call(e+"_isNegative",I))),m.ret(m.call(e+"_isNegative",U)))}function h(){const P=t.addFunction(o+"_mul");P.addParam("x","i32"),P.addParam("y","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("y"),Y=m.i32_add(m.getLocal("y"),m.i32_const(c)),j=m.getLocal("r"),ct=m.i32_add(m.getLocal("r"),m.i32_const(c)),H=m.i32_const(t.alloc(c)),at=m.i32_const(t.alloc(c)),Pt=m.i32_const(t.alloc(c)),vt=m.i32_const(t.alloc(c));P.addCode(m.call(e+"_mul",I,et,H),m.call(e+"_mul",U,Y,at),m.call(e+"_add",I,U,Pt),m.call(e+"_add",et,Y,vt),m.call(e+"_mul",Pt,vt,Pt),m.call(n,at,j),m.call(e+"_add",H,j,j),m.call(e+"_add",H,at,ct),m.call(e+"_sub",Pt,ct,ct))}function T(){const P=t.addFunction(o+"_mul1");P.addParam("x","i32"),P.addParam("y","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("y"),Y=m.getLocal("r"),j=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_mul",I,et,Y),m.call(e+"_mul",U,et,j))}function k(){const P=t.addFunction(o+"_square");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c)),j=m.i32_const(t.alloc(c)),ct=m.i32_const(t.alloc(c)),H=m.i32_const(t.alloc(c)),at=m.i32_const(t.alloc(c));P.addCode(m.call(e+"_mul",I,U,j),m.call(e+"_add",I,U,ct),m.call(n,U,H),m.call(e+"_add",I,H,H),m.call(n,j,at),m.call(e+"_add",at,j,at),m.call(e+"_mul",ct,H,et),m.call(e+"_sub",et,at,et),m.call(e+"_add",j,j,Y))}function x(){const P=t.addFunction(o+"_toMontgomery");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_toMontgomery",I,et),m.call(e+"_toMontgomery",U,Y))}function O(){const P=t.addFunction(o+"_fromMontgomery");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_fromMontgomery",I,et),m.call(e+"_fromMontgomery",U,Y))}function B(){const P=t.addFunction(o+"_copy");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c));P.addCode(m.call(e+"_copy",I,et),m.call(e+"_copy",U,Y))}function Q(){const P=t.addFunction(o+"_zero");P.addParam("x","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.call(e+"_zero",I),m.call(e+"_zero",U))}function E(){const P=t.addFunction(o+"_one");P.addParam("x","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.call(e+"_one",I),m.call(e+"_zero",U))}function nt(){const P=t.addFunction(o+"_eq");P.addParam("x","i32"),P.addParam("y","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("y"),Y=m.i32_add(m.getLocal("y"),m.i32_const(c));P.addCode(m.i32_and(m.call(e+"_eq",I,et),m.call(e+"_eq",U,Y)))}function C(){const P=t.addFunction(o+"_isZero");P.addParam("x","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.i32_and(m.call(e+"_isZero",I),m.call(e+"_isZero",U)))}function u(){const P=t.addFunction(o+"_inverse");P.addParam("x","i32"),P.addParam("r","i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c)),et=m.getLocal("r"),Y=m.i32_add(m.getLocal("r"),m.i32_const(c)),j=m.i32_const(t.alloc(c)),ct=m.i32_const(t.alloc(c)),H=m.i32_const(t.alloc(c)),at=m.i32_const(t.alloc(c));P.addCode(m.call(e+"_square",I,j),m.call(e+"_square",U,ct),m.call(n,ct,H),m.call(e+"_sub",j,H,H),m.call(e+"_inverse",H,at),m.call(e+"_mul",I,at,et),m.call(e+"_mul",U,at,Y),m.call(e+"_neg",Y,Y))}function L(){const P=t.addFunction(o+"_sign");P.addParam("x","i32"),P.addLocal("s","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.setLocal("s",m.call(e+"_sign",U)),m.if(m.getLocal("s"),m.ret(m.getLocal("s"))),m.ret(m.call(e+"_sign",I)))}function $(){const P=t.addFunction(o+"_isOne");P.addParam("x","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.getLocal("x"),U=m.i32_add(m.getLocal("x"),m.i32_const(c));P.addCode(m.ret(m.i32_and(m.call(e+"_isOne",I),m.call(e+"_isZero",U))))}function K(){const P=t.addFunction(o+"_sqrt");P.addParam("a","i32"),P.addParam("pr","i32");const m=P.getCodeBuilder(),I=m.i32_const(t.alloc(po.bigInt2BytesLE((BigInt(f||0)-3n)/4n,c))),U=m.i32_const(t.alloc(po.bigInt2BytesLE((BigInt(f||0)-1n)/2n,c))),et=m.getLocal("a"),Y=m.i32_const(t.alloc(c*2)),j=m.i32_const(t.alloc(c*2)),ct=m.i32_const(t.alloc(c*2)),H=t.alloc(c*2),at=m.i32_const(H),Pt=m.i32_const(H),vt=m.i32_const(H+c),ht=m.i32_const(t.alloc(c*2)),A=m.i32_const(t.alloc(c*2));P.addCode(m.call(o+"_one",at),m.call(o+"_neg",at,at),m.call(o+"_exp",et,I,m.i32_const(c),Y),m.call(o+"_square",Y,j),m.call(o+"_mul",et,j,j),m.call(o+"_conjugate",j,ct),m.call(o+"_mul",ct,j,ct),m.if(m.call(o+"_eq",ct,at),m.unreachable()),m.call(o+"_mul",Y,et,ht),m.if(m.call(o+"_eq",j,at),[...m.call(e+"_zero",Pt),...m.call(e+"_one",vt),...m.call(o+"_mul",at,ht,m.getLocal("pr"))],[...m.call(o+"_one",A),...m.call(o+"_add",A,j,A),...m.call(o+"_exp",A,U,m.i32_const(c),A),...m.call(o+"_mul",A,ht,m.getLocal("pr"))]))}function J(){const P=t.addFunction(o+"_isSquare");P.addParam("a","i32"),P.setReturnType("i32");const m=P.getCodeBuilder(),I=m.i32_const(t.alloc(po.bigInt2BytesLE((BigInt(f||0)-3n)/4n,c))),U=m.getLocal("a"),et=m.i32_const(t.alloc(c*2)),Y=m.i32_const(t.alloc(c*2)),j=m.i32_const(t.alloc(c*2)),ct=t.alloc(c*2),H=m.i32_const(ct);P.addCode(m.call(o+"_one",H),m.call(o+"_neg",H,H),m.call(o+"_exp",U,I,m.i32_const(c),et),m.call(o+"_square",et,Y),m.call(o+"_mul",U,Y,Y),m.call(o+"_conjugate",Y,j),m.call(o+"_mul",j,Y,j),m.if(m.call(o+"_eq",j,H),m.ret(m.i32_const(0))),m.ret(m.i32_const(1)))}return C(),$(),Q(),E(),B(),h(),T(),k(),d(),g(),s(),y(),x(),O(),nt(),u(),b(),L(),w(),t.exportFunction(o+"_isZero"),t.exportFunction(o+"_isOne"),t.exportFunction(o+"_zero"),t.exportFunction(o+"_one"),t.exportFunction(o+"_copy"),t.exportFunction(o+"_mul"),t.exportFunction(o+"_mul1"),t.exportFunction(o+"_square"),t.exportFunction(o+"_add"),t.exportFunction(o+"_sub"),t.exportFunction(o+"_neg"),t.exportFunction(o+"_sign"),t.exportFunction(o+"_conjugate"),t.exportFunction(o+"_fromMontgomery"),t.exportFunction(o+"_toMontgomery"),t.exportFunction(o+"_eq"),t.exportFunction(o+"_inverse"),ki(t,o),zi(t,o+"_exp",c*2,o+"_mul",o+"_square",o+"_copy",o+"_one"),K(),J(),t.exportFunction(o+"_exp"),t.exportFunction(o+"_timesScalar"),t.exportFunction(o+"_batchInverse"),t.exportFunction(o+"_sqrt"),t.exportFunction(o+"_isSquare"),t.exportFunction(o+"_isNegative"),o};const Ti=Uo,Ui=Ro;var oa=function(t,n,o,e){if(t.modules[o])return o;const c=t.modules[e].n64*8;t.modules[o]={n64:t.modules[e].n64*3};function f(){const u=t.addFunction(o+"_add");u.addParam("x","i32"),u.addParam("y","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("y"),m=L.i32_add(L.getLocal("y"),L.i32_const(c)),I=L.i32_add(L.getLocal("y"),L.i32_const(2*c)),U=L.getLocal("r"),et=L.i32_add(L.getLocal("r"),L.i32_const(c)),Y=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_add",$,P,U),L.call(e+"_add",K,m,et),L.call(e+"_add",J,I,Y))}function d(){const u=t.addFunction(o+"_timesScalar");u.addParam("x","i32"),u.addParam("scalar","i32"),u.addParam("scalarLen","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_timesScalar",$,L.getLocal("scalar"),L.getLocal("scalarLen"),P),L.call(e+"_timesScalar",K,L.getLocal("scalar"),L.getLocal("scalarLen"),m),L.call(e+"_timesScalar",J,L.getLocal("scalar"),L.getLocal("scalarLen"),I))}function b(){const u=t.addFunction(o+"_sub");u.addParam("x","i32"),u.addParam("y","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("y"),m=L.i32_add(L.getLocal("y"),L.i32_const(c)),I=L.i32_add(L.getLocal("y"),L.i32_const(2*c)),U=L.getLocal("r"),et=L.i32_add(L.getLocal("r"),L.i32_const(c)),Y=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_sub",$,P,U),L.call(e+"_sub",K,m,et),L.call(e+"_sub",J,I,Y))}function g(){const u=t.addFunction(o+"_neg");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_neg",$,P),L.call(e+"_neg",K,m),L.call(e+"_neg",J,I))}function s(){const u=t.addFunction(o+"_isNegative");u.addParam("x","i32"),u.setReturnType("i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c));u.addCode(L.if(L.call(e+"_isZero",J),L.if(L.call(e+"_isZero",K),L.ret(L.call(e+"_isNegative",$)),L.ret(L.call(e+"_isNegative",K)))),L.ret(L.call(e+"_isNegative",J)))}function y(){const u=t.addFunction(o+"_mul");u.addParam("x","i32"),u.addParam("y","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("y"),m=L.i32_add(L.getLocal("y"),L.i32_const(c)),I=L.i32_add(L.getLocal("y"),L.i32_const(2*c)),U=L.getLocal("r"),et=L.i32_add(L.getLocal("r"),L.i32_const(c)),Y=L.i32_add(L.getLocal("r"),L.i32_const(2*c)),j=L.i32_const(t.alloc(c)),ct=L.i32_const(t.alloc(c)),H=L.i32_const(t.alloc(c)),at=L.i32_const(t.alloc(c)),Pt=L.i32_const(t.alloc(c)),vt=L.i32_const(t.alloc(c)),ht=L.i32_const(t.alloc(c)),A=L.i32_const(t.alloc(c)),a=L.i32_const(t.alloc(c)),F=L.i32_const(t.alloc(c)),l=L.i32_const(t.alloc(c)),R=L.i32_const(t.alloc(c)),v=L.i32_const(t.alloc(c));u.addCode(L.call(e+"_mul",$,P,j),L.call(e+"_mul",K,m,ct),L.call(e+"_mul",J,I,H),L.call(e+"_add",$,K,at),L.call(e+"_add",P,m,Pt),L.call(e+"_add",$,J,vt),L.call(e+"_add",P,I,ht),L.call(e+"_add",K,J,A),L.call(e+"_add",m,I,a),L.call(e+"_add",j,ct,F),L.call(e+"_add",j,H,l),L.call(e+"_add",ct,H,R),L.call(e+"_mul",A,a,U),L.call(e+"_sub",U,R,U),L.call(n,U,U),L.call(e+"_add",j,U,U),L.call(e+"_mul",at,Pt,et),L.call(e+"_sub",et,F,et),L.call(n,H,v),L.call(e+"_add",et,v,et),L.call(e+"_mul",vt,ht,Y),L.call(e+"_sub",Y,l,Y),L.call(e+"_add",Y,ct,Y))}function w(){const u=t.addFunction(o+"_square");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c)),U=L.i32_const(t.alloc(c)),et=L.i32_const(t.alloc(c)),Y=L.i32_const(t.alloc(c)),j=L.i32_const(t.alloc(c)),ct=L.i32_const(t.alloc(c)),H=L.i32_const(t.alloc(c)),at=L.i32_const(t.alloc(c));u.addCode(L.call(e+"_square",$,U),L.call(e+"_mul",$,K,et),L.call(e+"_add",et,et,Y),L.call(e+"_sub",$,K,j),L.call(e+"_add",j,J,j),L.call(e+"_square",j,j),L.call(e+"_mul",K,J,ct),L.call(e+"_add",ct,ct,H),L.call(e+"_square",J,at),L.call(n,H,P),L.call(e+"_add",U,P,P),L.call(n,at,m),L.call(e+"_add",Y,m,m),L.call(e+"_add",U,at,I),L.call(e+"_sub",H,I,I),L.call(e+"_add",j,I,I),L.call(e+"_add",Y,I,I))}function h(){const u=t.addFunction(o+"_toMontgomery");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_toMontgomery",$,P),L.call(e+"_toMontgomery",K,m),L.call(e+"_toMontgomery",J,I))}function T(){const u=t.addFunction(o+"_fromMontgomery");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_fromMontgomery",$,P),L.call(e+"_fromMontgomery",K,m),L.call(e+"_fromMontgomery",J,I))}function k(){const u=t.addFunction(o+"_copy");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c));u.addCode(L.call(e+"_copy",$,P),L.call(e+"_copy",K,m),L.call(e+"_copy",J,I))}function x(){const u=t.addFunction(o+"_zero");u.addParam("x","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c));u.addCode(L.call(e+"_zero",$),L.call(e+"_zero",K),L.call(e+"_zero",J))}function O(){const u=t.addFunction(o+"_one");u.addParam("x","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c));u.addCode(L.call(e+"_one",$),L.call(e+"_zero",K),L.call(e+"_zero",J))}function B(){const u=t.addFunction(o+"_eq");u.addParam("x","i32"),u.addParam("y","i32"),u.setReturnType("i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("y"),m=L.i32_add(L.getLocal("y"),L.i32_const(c)),I=L.i32_add(L.getLocal("y"),L.i32_const(2*c));u.addCode(L.i32_and(L.i32_and(L.call(e+"_eq",$,P),L.call(e+"_eq",K,m)),L.call(e+"_eq",J,I)))}function Q(){const u=t.addFunction(o+"_isZero");u.addParam("x","i32"),u.setReturnType("i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c));u.addCode(L.i32_and(L.i32_and(L.call(e+"_isZero",$),L.call(e+"_isZero",K)),L.call(e+"_isZero",J)))}function E(){const u=t.addFunction(o+"_inverse");u.addParam("x","i32"),u.addParam("r","i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c)),P=L.getLocal("r"),m=L.i32_add(L.getLocal("r"),L.i32_const(c)),I=L.i32_add(L.getLocal("r"),L.i32_const(2*c)),U=L.i32_const(t.alloc(c)),et=L.i32_const(t.alloc(c)),Y=L.i32_const(t.alloc(c)),j=L.i32_const(t.alloc(c)),ct=L.i32_const(t.alloc(c)),H=L.i32_const(t.alloc(c)),at=L.i32_const(t.alloc(c)),Pt=L.i32_const(t.alloc(c)),vt=L.i32_const(t.alloc(c)),ht=L.i32_const(t.alloc(c)),A=L.i32_const(t.alloc(c));u.addCode(L.call(e+"_square",$,U),L.call(e+"_square",K,et),L.call(e+"_square",J,Y),L.call(e+"_mul",$,K,j),L.call(e+"_mul",$,J,ct),L.call(e+"_mul",K,J,H),L.call(n,H,at),L.call(e+"_sub",U,at,at),L.call(n,Y,Pt),L.call(e+"_sub",Pt,j,Pt),L.call(e+"_sub",et,ct,vt),L.call(e+"_mul",J,Pt,ht),L.call(e+"_mul",K,vt,A),L.call(e+"_add",ht,A,ht),L.call(n,ht,ht),L.call(e+"_mul",$,at,A),L.call(e+"_add",A,ht,ht),L.call(e+"_inverse",ht,ht),L.call(e+"_mul",ht,at,P),L.call(e+"_mul",ht,Pt,m),L.call(e+"_mul",ht,vt,I))}function nt(){const u=t.addFunction(o+"_sign");u.addParam("x","i32"),u.addLocal("s","i32"),u.setReturnType("i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(2*c));u.addCode(L.setLocal("s",L.call(e+"_sign",J)),L.if(L.getLocal("s"),L.ret(L.getLocal("s"))),L.setLocal("s",L.call(e+"_sign",K)),L.if(L.getLocal("s"),L.ret(L.getLocal("s"))),L.ret(L.call(e+"_sign",$)))}function C(){const u=t.addFunction(o+"_isOne");u.addParam("x","i32"),u.setReturnType("i32");const L=u.getCodeBuilder(),$=L.getLocal("x"),K=L.i32_add(L.getLocal("x"),L.i32_const(c)),J=L.i32_add(L.getLocal("x"),L.i32_const(c*2));u.addCode(L.ret(L.i32_and(L.i32_and(L.call(e+"_isOne",$),L.call(e+"_isZero",K)),L.call(e+"_isZero",J))))}return Q(),C(),x(),O(),k(),y(),w(),f(),b(),g(),nt(),h(),T(),B(),E(),d(),s(),t.exportFunction(o+"_isZero"),t.exportFunction(o+"_isOne"),t.exportFunction(o+"_zero"),t.exportFunction(o+"_one"),t.exportFunction(o+"_copy"),t.exportFunction(o+"_mul"),t.exportFunction(o+"_square"),t.exportFunction(o+"_add"),t.exportFunction(o+"_sub"),t.exportFunction(o+"_neg"),t.exportFunction(o+"_sign"),t.exportFunction(o+"_fromMontgomery"),t.exportFunction(o+"_toMontgomery"),t.exportFunction(o+"_eq"),t.exportFunction(o+"_inverse"),Ui(t,o),Ti(t,o+"_exp",c*3,o+"_mul",o+"_square",o+"_copy",o+"_one"),t.exportFunction(o+"_exp"),t.exportFunction(o+"_timesScalar"),t.exportFunction(o+"_batchInverse"),t.exportFunction(o+"_isNegative"),o},Ri=function(t,n,o,e,c,f,d,b){const g=t.addFunction(n);g.addParam("base","i32"),g.addParam("scalar","i32"),g.addParam("scalarLength","i32"),g.addParam("r","i32"),g.addLocal("old0","i32"),g.addLocal("nbits","i32"),g.addLocal("i","i32"),g.addLocal("last","i32"),g.addLocal("cur","i32"),g.addLocal("carry","i32"),g.addLocal("p","i32");const s=g.getCodeBuilder(),y=s.i32_const(t.alloc(o));function w(T){return s.i32_and(s.i32_shr_u(s.i32_load(s.i32_add(s.getLocal("scalar"),s.i32_and(s.i32_shr_u(T,s.i32_const(3)),s.i32_const(4294967292)))),s.i32_and(T,s.i32_const(31))),s.i32_const(1))}function h(T){return[...s.i32_store8(s.getLocal("p"),s.i32_const(T)),...s.setLocal("p",s.i32_add(s.getLocal("p"),s.i32_const(1)))]}g.addCode(s.if(s.i32_eqz(s.getLocal("scalarLength")),[...s.call(b,s.getLocal("r")),...s.ret([])]),s.setLocal("nbits",s.i32_shl(s.getLocal("scalarLength"),s.i32_const(3))),s.setLocal("old0",s.i32_load(s.i32_const(0))),s.setLocal("p",s.getLocal("old0")),s.i32_store(s.i32_const(0),s.i32_and(s.i32_add(s.i32_add(s.getLocal("old0"),s.i32_const(32)),s.getLocal("nbits")),s.i32_const(4294967288))),s.setLocal("i",s.i32_const(1)),s.setLocal("last",w(s.i32_const(0))),s.setLocal("carry",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("nbits"))),s.setLocal("cur",w(s.getLocal("i"))),s.if(s.getLocal("last"),s.if(s.getLocal("cur"),s.if(s.getLocal("carry"),[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(1)),...h(1)],[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(1)),...h(255)]),s.if(s.getLocal("carry"),[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(1)),...h(255)],[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(0)),...h(1)])),s.if(s.getLocal("cur"),s.if(s.getLocal("carry"),[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(1)),...h(0)],[...s.setLocal("last",s.i32_const(1)),...s.setLocal("carry",s.i32_const(0)),...h(0)]),s.if(s.getLocal("carry"),[...s.setLocal("last",s.i32_const(1)),...s.setLocal("carry",s.i32_const(0)),...h(0)],[...s.setLocal("last",s.i32_const(0)),...s.setLocal("carry",s.i32_const(0)),...h(0)]))),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0))),s.if(s.getLocal("last"),s.if(s.getLocal("carry"),[...h(255),...h(0),...h(1)],[...h(1)]),s.if(s.getLocal("carry"),[...h(0),...h(1)])),s.setLocal("p",s.i32_sub(s.getLocal("p"),s.i32_const(1))),s.call(d,s.getLocal("base"),y),s.call(b,s.getLocal("r")),s.block(s.loop(s.call(c,s.getLocal("r"),s.getLocal("r")),s.setLocal("cur",s.i32_load8_u(s.getLocal("p"))),s.if(s.getLocal("cur"),s.if(s.i32_eq(s.getLocal("cur"),s.i32_const(1)),s.call(e,s.getLocal("r"),y,s.getLocal("r")),s.call(f,s.getLocal("r"),y,s.getLocal("r")))),s.br_if(1,s.i32_eq(s.getLocal("old0"),s.getLocal("p"))),s.setLocal("p",s.i32_sub(s.getLocal("p"),s.i32_const(1))),s.br(0))),s.i32_store(s.i32_const(0),s.getLocal("old0")))},Ni=function(t,n,o,e,c){const d=t.modules[n].n64*8;function b(){const w=t.addFunction(o+"_getChunk");w.addParam("pScalar","i32"),w.addParam("scalarSize","i32"),w.addParam("startBit","i32"),w.addParam("chunkSize","i32"),w.addLocal("bitsToEnd","i32"),w.addLocal("mask","i32"),w.setReturnType("i32");const h=w.getCodeBuilder();w.addCode(h.setLocal("bitsToEnd",h.i32_sub(h.i32_mul(h.getLocal("scalarSize"),h.i32_const(8)),h.getLocal("startBit"))),h.if(h.i32_gt_s(h.getLocal("chunkSize"),h.getLocal("bitsToEnd")),h.setLocal("mask",h.i32_sub(h.i32_shl(h.i32_const(1),h.getLocal("bitsToEnd")),h.i32_const(1))),h.setLocal("mask",h.i32_sub(h.i32_shl(h.i32_const(1),h.getLocal("chunkSize")),h.i32_const(1)))),h.i32_and(h.i32_shr_u(h.i32_load(h.i32_add(h.getLocal("pScalar"),h.i32_shr_u(h.getLocal("startBit"),h.i32_const(3))),0,0),h.i32_and(h.getLocal("startBit"),h.i32_const(7))),h.getLocal("mask")))}function g(){const w=t.addFunction(o+"_chunk");w.addParam("pBases","i32"),w.addParam("pScalars","i32"),w.addParam("scalarSize","i32"),w.addParam("n","i32"),w.addParam("startBit","i32"),w.addParam("chunkSize","i32"),w.addParam("pr","i32"),w.addLocal("nChunks","i32"),w.addLocal("itScalar","i32"),w.addLocal("endScalar","i32"),w.addLocal("itBase","i32"),w.addLocal("i","i32"),w.addLocal("j","i32"),w.addLocal("nTable","i32"),w.addLocal("pTable","i32"),w.addLocal("idx","i32"),w.addLocal("pIdxTable","i32");const h=w.getCodeBuilder();w.addCode(h.if(h.i32_eqz(h.getLocal("n")),[...h.call(n+"_zero",h.getLocal("pr")),...h.ret([])]),h.setLocal("nTable",h.i32_shl(h.i32_const(1),h.getLocal("chunkSize"))),h.setLocal("pTable",h.i32_load(h.i32_const(0))),h.i32_store(h.i32_const(0),h.i32_add(h.getLocal("pTable"),h.i32_mul(h.getLocal("nTable"),h.i32_const(d)))),h.setLocal("j",h.i32_const(0)),h.block(h.loop(h.br_if(1,h.i32_eq(h.getLocal("j"),h.getLocal("nTable"))),h.call(n+"_zero",h.i32_add(h.getLocal("pTable"),h.i32_mul(h.getLocal("j"),h.i32_const(d)))),h.setLocal("j",h.i32_add(h.getLocal("j"),h.i32_const(1))),h.br(0))),h.setLocal("itBase",h.getLocal("pBases")),h.setLocal("itScalar",h.getLocal("pScalars")),h.setLocal("endScalar",h.i32_add(h.getLocal("pScalars"),h.i32_mul(h.getLocal("n"),h.getLocal("scalarSize")))),h.block(h.loop(h.br_if(1,h.i32_eq(h.getLocal("itScalar"),h.getLocal("endScalar"))),h.setLocal("idx",h.call(o+"_getChunk",h.getLocal("itScalar"),h.getLocal("scalarSize"),h.getLocal("startBit"),h.getLocal("chunkSize"))),h.if(h.getLocal("idx"),[...h.setLocal("pIdxTable",h.i32_add(h.getLocal("pTable"),h.i32_mul(h.i32_sub(h.getLocal("idx"),h.i32_const(1)),h.i32_const(d)))),...h.call(e,h.getLocal("pIdxTable"),h.getLocal("itBase"),h.getLocal("pIdxTable"))]),h.setLocal("itScalar",h.i32_add(h.getLocal("itScalar"),h.getLocal("scalarSize"))),h.setLocal("itBase",h.i32_add(h.getLocal("itBase"),h.i32_const(c))),h.br(0))),h.call(o+"_reduceTable",h.getLocal("pTable"),h.getLocal("chunkSize")),h.call(n+"_copy",h.getLocal("pTable"),h.getLocal("pr")),h.i32_store(h.i32_const(0),h.getLocal("pTable")))}function s(){const w=t.addFunction(o);w.addParam("pBases","i32"),w.addParam("pScalars","i32"),w.addParam("scalarSize","i32"),w.addParam("n","i32"),w.addParam("pr","i32"),w.addLocal("chunkSize","i32"),w.addLocal("nChunks","i32"),w.addLocal("itScalar","i32"),w.addLocal("endScalar","i32"),w.addLocal("itBase","i32"),w.addLocal("itBit","i32"),w.addLocal("i","i32"),w.addLocal("j","i32"),w.addLocal("nTable","i32"),w.addLocal("pTable","i32"),w.addLocal("idx","i32"),w.addLocal("pIdxTable","i32");const h=w.getCodeBuilder(),T=h.i32_const(t.alloc(d)),k=t.alloc([17,17,17,17,17,17,17,17,17,17,16,16,15,14,13,13,12,11,10,9,8,7,7,6,5,4,3,2,1,1,1,1]);w.addCode(h.call(n+"_zero",h.getLocal("pr")),h.if(h.i32_eqz(h.getLocal("n")),h.ret([])),h.setLocal("chunkSize",h.i32_load8_u(h.i32_clz(h.getLocal("n")),k)),h.setLocal("nChunks",h.i32_add(h.i32_div_u(h.i32_sub(h.i32_shl(h.getLocal("scalarSize"),h.i32_const(3)),h.i32_const(1)),h.getLocal("chunkSize")),h.i32_const(1))),h.setLocal("itBit",h.i32_mul(h.i32_sub(h.getLocal("nChunks"),h.i32_const(1)),h.getLocal("chunkSize"))),h.block(h.loop(h.br_if(1,h.i32_lt_s(h.getLocal("itBit"),h.i32_const(0))),h.if(h.i32_eqz(h.call(n+"_isZero",h.getLocal("pr"))),[...h.setLocal("j",h.i32_const(0)),...h.block(h.loop(h.br_if(1,h.i32_eq(h.getLocal("j"),h.getLocal("chunkSize"))),h.call(n+"_double",h.getLocal("pr"),h.getLocal("pr")),h.setLocal("j",h.i32_add(h.getLocal("j"),h.i32_const(1))),h.br(0)))]),h.call(o+"_chunk",h.getLocal("pBases"),h.getLocal("pScalars"),h.getLocal("scalarSize"),h.getLocal("n"),h.getLocal("itBit"),h.getLocal("chunkSize"),T),h.call(n+"_add",h.getLocal("pr"),T,h.getLocal("pr")),h.setLocal("itBit",h.i32_sub(h.getLocal("itBit"),h.getLocal("chunkSize"))),h.br(0))))}function y(){const w=t.addFunction(o+"_reduceTable");w.addParam("pTable","i32"),w.addParam("p","i32"),w.addLocal("half","i32"),w.addLocal("it1","i32"),w.addLocal("it2","i32"),w.addLocal("pAcc","i32");const h=w.getCodeBuilder();w.addCode(h.if(h.i32_eq(h.getLocal("p"),h.i32_const(1)),h.ret([])),h.setLocal("half",h.i32_shl(h.i32_const(1),h.i32_sub(h.getLocal("p"),h.i32_const(1)))),h.setLocal("it1",h.getLocal("pTable")),h.setLocal("it2",h.i32_add(h.getLocal("pTable"),h.i32_mul(h.getLocal("half"),h.i32_const(d)))),h.setLocal("pAcc",h.i32_sub(h.getLocal("it2"),h.i32_const(d))),h.block(h.loop(h.br_if(1,h.i32_eq(h.getLocal("it1"),h.getLocal("pAcc"))),h.call(n+"_add",h.getLocal("it1"),h.getLocal("it2"),h.getLocal("it1")),h.call(n+"_add",h.getLocal("pAcc"),h.getLocal("it2"),h.getLocal("pAcc")),h.setLocal("it1",h.i32_add(h.getLocal("it1"),h.i32_const(d))),h.setLocal("it2",h.i32_add(h.getLocal("it2"),h.i32_const(d))),h.br(0))),h.call(o+"_reduceTable",h.getLocal("pTable"),h.i32_sub(h.getLocal("p"),h.i32_const(1))),h.setLocal("p",h.i32_sub(h.getLocal("p"),h.i32_const(1))),h.block(h.loop(h.br_if(1,h.i32_eqz(h.getLocal("p"))),h.call(n+"_double",h.getLocal("pAcc"),h.getLocal("pAcc")),h.setLocal("p",h.i32_sub(h.getLocal("p"),h.i32_const(1))),h.br(0))),h.call(n+"_add",h.getLocal("pTable"),h.getLocal("pAcc"),h.getLocal("pTable")))}b(),y(),g(),s(),t.exportFunction(o),t.exportFunction(o+"_chunk")};const oe=Ri,En=Xe,ee=Ni;var ea=function(t,n,o,e){const c=t.modules[o].n64,f=c*8;if(t.modules[n])return n;t.modules[n]={n64:c*3};function d(){const A=t.addFunction(n+"_isZero");A.addParam("p1","i32"),A.setReturnType("i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_isZero",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))))}function b(){const A=t.addFunction(n+"_isZeroAffine");A.addParam("p1","i32"),A.setReturnType("i32");const a=A.getCodeBuilder();A.addCode(a.i32_and(a.call(o+"_isZero",a.getLocal("p1")),a.call(o+"_isZero",a.i32_add(a.getLocal("p1"),a.i32_const(f)))))}function g(){const A=t.addFunction(n+"_copy");A.addParam("ps","i32"),A.addParam("pd","i32");const a=A.getCodeBuilder();for(let F=0;F<c*3;F++)A.addCode(a.i64_store(a.getLocal("pd"),F*8,a.i64_load(a.getLocal("ps"),F*8)))}function s(){const A=t.addFunction(n+"_copyAffine");A.addParam("ps","i32"),A.addParam("pd","i32");const a=A.getCodeBuilder();for(let F=0;F<c*2;F++)A.addCode(a.i64_store(a.getLocal("pd"),F*8,a.i64_load(a.getLocal("ps"),F*8)))}function y(){const A=t.addFunction(n+"_zero");A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_zero",a.getLocal("pr"))),A.addCode(a.call(o+"_one",a.i32_add(a.getLocal("pr"),a.i32_const(f)))),A.addCode(a.call(o+"_zero",a.i32_add(a.getLocal("pr"),a.i32_const(f*2))))}function w(){const A=t.addFunction(n+"_zeroAffine");A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_zero",a.getLocal("pr"))),A.addCode(a.call(o+"_zero",a.i32_add(a.getLocal("pr"),a.i32_const(f))))}function h(){const A=t.addFunction(n+"_eq");A.addParam("p1","i32"),A.addParam("p2","i32"),A.setReturnType("i32"),A.addLocal("z1","i32"),A.addLocal("z2","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f));A.addCode(a.setLocal("z1",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))));const R=a.getLocal("z1"),v=a.getLocal("p2"),p=a.i32_add(a.getLocal("p2"),a.i32_const(f));A.addCode(a.setLocal("z2",a.i32_add(a.getLocal("p2"),a.i32_const(f*2))));const D=a.getLocal("z2"),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f)),Lt=a.i32_const(t.alloc(f)),It=a.i32_const(t.alloc(f)),gt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),a.ret(a.call(n+"_isZero",a.getLocal("p2")))),a.if(a.call(n+"_isZero",a.getLocal("p2")),a.ret(a.i32_const(0))),a.if(a.call(o+"_isOne",R),a.ret(a.call(n+"_eqMixed",a.getLocal("p2"),a.getLocal("p1")))),a.if(a.call(o+"_isOne",D),a.ret(a.call(n+"_eqMixed",a.getLocal("p1"),a.getLocal("p2")))),a.call(o+"_square",R,ut),a.call(o+"_square",D,st),a.call(o+"_mul",F,st,rt),a.call(o+"_mul",v,ut,yt),a.call(o+"_mul",R,ut,dt),a.call(o+"_mul",D,st,Lt),a.call(o+"_mul",l,Lt,It),a.call(o+"_mul",p,dt,gt),a.if(a.call(o+"_eq",rt,yt),a.if(a.call(o+"_eq",It,gt),a.ret(a.i32_const(1)))),a.ret(a.i32_const(0)))}function T(){const A=t.addFunction(n+"_eqMixed");A.addParam("p1","i32"),A.addParam("p2","i32"),A.setReturnType("i32"),A.addLocal("z1","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f));A.addCode(a.setLocal("z1",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))));const R=a.getLocal("z1"),v=a.getLocal("p2"),p=a.i32_add(a.getLocal("p2"),a.i32_const(f)),D=a.i32_const(t.alloc(f)),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),a.ret(a.call(n+"_isZeroAffine",a.getLocal("p2")))),a.if(a.call(n+"_isZeroAffine",a.getLocal("p2")),a.ret(a.i32_const(0))),a.if(a.call(o+"_isOne",R),a.ret(a.call(n+"_eqAffine",a.getLocal("p1"),a.getLocal("p2")))),a.call(o+"_square",R,D),a.call(o+"_mul",v,D,ut),a.call(o+"_mul",R,D,st),a.call(o+"_mul",p,st,rt),a.if(a.call(o+"_eq",F,ut),a.if(a.call(o+"_eq",l,rt),a.ret(a.i32_const(1)))),a.ret(a.i32_const(0)))}function k(){const A=t.addFunction(n+"_double");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.i32_add(a.getLocal("p1"),a.i32_const(f*2)),v=a.getLocal("pr"),p=a.i32_add(a.getLocal("pr"),a.i32_const(f)),D=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f)),Lt=a.i32_const(t.alloc(f)),It=a.i32_const(t.alloc(f)),gt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),[...a.call(n+"_copy",a.getLocal("p1"),a.getLocal("pr")),...a.ret([])]),a.if(a.call(o+"_isOne",R),[...a.ret(a.call(n+"_doubleAffine",a.getLocal("p1"),a.getLocal("pr"))),...a.ret([])]),a.call(o+"_square",F,ut),a.call(o+"_square",l,st),a.call(o+"_square",st,rt),a.call(o+"_add",F,st,yt),a.call(o+"_square",yt,yt),a.call(o+"_sub",yt,ut,yt),a.call(o+"_sub",yt,rt,yt),a.call(o+"_add",yt,yt,yt),a.call(o+"_add",ut,ut,dt),a.call(o+"_add",dt,ut,dt),a.call(o+"_square",dt,Lt),a.call(o+"_mul",l,R,It),a.call(o+"_add",yt,yt,v),a.call(o+"_sub",Lt,v,v),a.call(o+"_add",rt,rt,gt),a.call(o+"_add",gt,gt,gt),a.call(o+"_add",gt,gt,gt),a.call(o+"_sub",yt,v,p),a.call(o+"_mul",p,dt,p),a.call(o+"_sub",p,gt,p),a.call(o+"_add",It,It,D))}function x(){const A=t.addFunction(n+"_doubleAffine");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.getLocal("pr"),v=a.i32_add(a.getLocal("pr"),a.i32_const(f)),p=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),D=a.i32_const(t.alloc(f)),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZeroAffine",a.getLocal("p1")),[...a.call(n+"_toJacobian",a.getLocal("p1"),a.getLocal("pr")),...a.ret([])]),a.call(o+"_square",F,D),a.call(o+"_square",l,ut),a.call(o+"_square",ut,st),a.call(o+"_add",F,ut,rt),a.call(o+"_square",rt,rt),a.call(o+"_sub",rt,D,rt),a.call(o+"_sub",rt,st,rt),a.call(o+"_add",rt,rt,rt),a.call(o+"_add",D,D,yt),a.call(o+"_add",yt,D,yt),a.call(o+"_add",l,l,p),a.call(o+"_square",yt,R),a.call(o+"_sub",R,rt,R),a.call(o+"_sub",R,rt,R),a.call(o+"_add",st,st,dt),a.call(o+"_add",dt,dt,dt),a.call(o+"_add",dt,dt,dt),a.call(o+"_sub",rt,R,v),a.call(o+"_mul",v,yt,v),a.call(o+"_sub",v,dt,v))}function O(){const A=t.addFunction(n+"_eqAffine");A.addParam("p1","i32"),A.addParam("p2","i32"),A.setReturnType("i32"),A.addLocal("z1","i32");const a=A.getCodeBuilder();A.addCode(a.ret(a.i32_and(a.call(o+"_eq",a.getLocal("p1"),a.getLocal("p2")),a.call(o+"_eq",a.i32_add(a.getLocal("p1"),a.i32_const(f)),a.i32_add(a.getLocal("p2"),a.i32_const(f))))))}function B(){const A=t.addFunction(n+"_toMontgomery");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_toMontgomery",a.getLocal("p1"),a.getLocal("pr")));for(let F=1;F<3;F++)A.addCode(a.call(o+"_toMontgomery",a.i32_add(a.getLocal("p1"),a.i32_const(F*f)),a.i32_add(a.getLocal("pr"),a.i32_const(F*f))))}function Q(){const A=t.addFunction(n+"_toMontgomeryAffine");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_toMontgomery",a.getLocal("p1"),a.getLocal("pr")));for(let F=1;F<2;F++)A.addCode(a.call(o+"_toMontgomery",a.i32_add(a.getLocal("p1"),a.i32_const(F*f)),a.i32_add(a.getLocal("pr"),a.i32_const(F*f))))}function E(){const A=t.addFunction(n+"_fromMontgomery");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_fromMontgomery",a.getLocal("p1"),a.getLocal("pr")));for(let F=1;F<3;F++)A.addCode(a.call(o+"_fromMontgomery",a.i32_add(a.getLocal("p1"),a.i32_const(F*f)),a.i32_add(a.getLocal("pr"),a.i32_const(F*f))))}function nt(){const A=t.addFunction(n+"_fromMontgomeryAffine");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder();A.addCode(a.call(o+"_fromMontgomery",a.getLocal("p1"),a.getLocal("pr")));for(let F=1;F<2;F++)A.addCode(a.call(o+"_fromMontgomery",a.i32_add(a.getLocal("p1"),a.i32_const(F*f)),a.i32_add(a.getLocal("pr"),a.i32_const(F*f))))}function C(){const A=t.addFunction(n+"_add");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32"),A.addLocal("z1","i32"),A.addLocal("z2","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f));A.addCode(a.setLocal("z1",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))));const R=a.getLocal("z1"),v=a.getLocal("p2"),p=a.i32_add(a.getLocal("p2"),a.i32_const(f));A.addCode(a.setLocal("z2",a.i32_add(a.getLocal("p2"),a.i32_const(f*2))));const D=a.getLocal("z2"),ut=a.getLocal("pr"),st=a.i32_add(a.getLocal("pr"),a.i32_const(f)),rt=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f)),Lt=a.i32_const(t.alloc(f)),It=a.i32_const(t.alloc(f)),gt=a.i32_const(t.alloc(f)),lt=a.i32_const(t.alloc(f)),bt=a.i32_const(t.alloc(f)),Et=a.i32_const(t.alloc(f)),Tt=a.i32_const(t.alloc(f)),Yt=a.i32_const(t.alloc(f)),jt=a.i32_const(t.alloc(f)),tn=a.i32_const(t.alloc(f)),Rt=a.i32_const(t.alloc(f)),Dt=a.i32_const(t.alloc(f)),Xt=a.i32_const(t.alloc(f)),yn=a.i32_const(t.alloc(f)),an=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),[...a.call(n+"_copy",a.getLocal("p2"),a.getLocal("pr")),...a.ret([])]),a.if(a.call(n+"_isZero",a.getLocal("p2")),[...a.call(n+"_copy",a.getLocal("p1"),a.getLocal("pr")),...a.ret([])]),a.if(a.call(o+"_isOne",R),[...a.call(n+"_addMixed",v,F,ut),...a.ret([])]),a.if(a.call(o+"_isOne",D),[...a.call(n+"_addMixed",F,v,ut),...a.ret([])]),a.call(o+"_square",R,yt),a.call(o+"_square",D,dt),a.call(o+"_mul",F,dt,Lt),a.call(o+"_mul",v,yt,It),a.call(o+"_mul",R,yt,gt),a.call(o+"_mul",D,dt,lt),a.call(o+"_mul",l,lt,bt),a.call(o+"_mul",p,gt,Et),a.if(a.call(o+"_eq",Lt,It),a.if(a.call(o+"_eq",bt,Et),[...a.call(n+"_double",a.getLocal("p1"),a.getLocal("pr")),...a.ret([])])),a.call(o+"_sub",It,Lt,Tt),a.call(o+"_sub",Et,bt,Yt),a.call(o+"_add",Tt,Tt,jt),a.call(o+"_square",jt,jt),a.call(o+"_mul",Tt,jt,tn),a.call(o+"_add",Yt,Yt,Rt),a.call(o+"_mul",Lt,jt,Xt),a.call(o+"_square",Rt,Dt),a.call(o+"_add",Xt,Xt,yn),a.call(o+"_sub",Dt,tn,ut),a.call(o+"_sub",ut,yn,ut),a.call(o+"_mul",bt,tn,an),a.call(o+"_add",an,an,an),a.call(o+"_sub",Xt,ut,st),a.call(o+"_mul",st,Rt,st),a.call(o+"_sub",st,an,st),a.call(o+"_add",R,D,rt),a.call(o+"_square",rt,rt),a.call(o+"_sub",rt,yt,rt),a.call(o+"_sub",rt,dt,rt),a.call(o+"_mul",rt,Tt,rt))}function u(){const A=t.addFunction(n+"_addMixed");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32"),A.addLocal("z1","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f));A.addCode(a.setLocal("z1",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))));const R=a.getLocal("z1"),v=a.getLocal("p2"),p=a.i32_add(a.getLocal("p2"),a.i32_const(f)),D=a.getLocal("pr"),ut=a.i32_add(a.getLocal("pr"),a.i32_const(f)),st=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),rt=a.i32_const(t.alloc(f)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f)),Lt=a.i32_const(t.alloc(f)),It=a.i32_const(t.alloc(f)),gt=a.i32_const(t.alloc(f)),lt=a.i32_const(t.alloc(f)),bt=a.i32_const(t.alloc(f)),Et=a.i32_const(t.alloc(f)),Tt=a.i32_const(t.alloc(f)),Yt=a.i32_const(t.alloc(f)),jt=a.i32_const(t.alloc(f)),tn=a.i32_const(t.alloc(f)),Rt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),[...a.call(n+"_copyAffine",a.getLocal("p2"),a.getLocal("pr")),...a.call(o+"_one",a.i32_add(a.getLocal("pr"),a.i32_const(f*2))),...a.ret([])]),a.if(a.call(n+"_isZeroAffine",a.getLocal("p2")),[...a.call(n+"_copy",a.getLocal("p1"),a.getLocal("pr")),...a.ret([])]),a.if(a.call(o+"_isOne",R),[...a.call(n+"_addAffine",F,v,D),...a.ret([])]),a.call(o+"_square",R,rt),a.call(o+"_mul",v,rt,yt),a.call(o+"_mul",R,rt,dt),a.call(o+"_mul",p,dt,Lt),a.if(a.call(o+"_eq",F,yt),a.if(a.call(o+"_eq",l,Lt),[...a.call(n+"_doubleAffine",a.getLocal("p2"),a.getLocal("pr")),...a.ret([])])),a.call(o+"_sub",yt,F,It),a.call(o+"_sub",Lt,l,lt),a.call(o+"_square",It,gt),a.call(o+"_add",gt,gt,bt),a.call(o+"_add",bt,bt,bt),a.call(o+"_mul",It,bt,Et),a.call(o+"_add",lt,lt,Tt),a.call(o+"_mul",F,bt,jt),a.call(o+"_square",Tt,Yt),a.call(o+"_add",jt,jt,tn),a.call(o+"_sub",Yt,Et,D),a.call(o+"_sub",D,tn,D),a.call(o+"_mul",l,Et,Rt),a.call(o+"_add",Rt,Rt,Rt),a.call(o+"_sub",jt,D,ut),a.call(o+"_mul",ut,Tt,ut),a.call(o+"_sub",ut,Rt,ut),a.call(o+"_add",R,It,st),a.call(o+"_square",st,st),a.call(o+"_sub",st,rt,st),a.call(o+"_sub",st,gt,st))}function L(){const A=t.addFunction(n+"_addAffine");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32"),A.addLocal("z1","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f));A.addCode(a.setLocal("z1",a.i32_add(a.getLocal("p1"),a.i32_const(f*2))));const R=a.getLocal("p2"),v=a.i32_add(a.getLocal("p2"),a.i32_const(f)),p=a.getLocal("pr"),D=a.i32_add(a.getLocal("pr"),a.i32_const(f)),ut=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f)),yt=a.i32_const(t.alloc(f)),dt=a.i32_const(t.alloc(f)),Lt=a.i32_const(t.alloc(f)),It=a.i32_const(t.alloc(f)),gt=a.i32_const(t.alloc(f)),lt=a.i32_const(t.alloc(f)),bt=a.i32_const(t.alloc(f)),Et=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZeroAffine",a.getLocal("p1")),[...a.call(n+"_copyAffine",a.getLocal("p2"),a.getLocal("pr")),...a.call(o+"_one",a.i32_add(a.getLocal("pr"),a.i32_const(f*2))),...a.ret([])]),a.if(a.call(n+"_isZeroAffine",a.getLocal("p2")),[...a.call(n+"_copyAffine",a.getLocal("p1"),a.getLocal("pr")),...a.call(o+"_one",a.i32_add(a.getLocal("pr"),a.i32_const(f*2))),...a.ret([])]),a.if(a.call(o+"_eq",F,R),a.if(a.call(o+"_eq",l,v),[...a.call(n+"_doubleAffine",a.getLocal("p2"),a.getLocal("pr")),...a.ret([])])),a.call(o+"_sub",R,F,st),a.call(o+"_sub",v,l,yt),a.call(o+"_square",st,rt),a.call(o+"_add",rt,rt,dt),a.call(o+"_add",dt,dt,dt),a.call(o+"_mul",st,dt,Lt),a.call(o+"_add",yt,yt,It),a.call(o+"_mul",F,dt,lt),a.call(o+"_square",It,gt),a.call(o+"_add",lt,lt,bt),a.call(o+"_sub",gt,Lt,p),a.call(o+"_sub",p,bt,p),a.call(o+"_mul",l,Lt,Et),a.call(o+"_add",Et,Et,Et),a.call(o+"_sub",lt,p,D),a.call(o+"_mul",D,It,D),a.call(o+"_sub",D,Et,D),a.call(o+"_add",st,st,ut))}function $(){const A=t.addFunction(n+"_neg");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.i32_add(a.getLocal("p1"),a.i32_const(f*2)),v=a.getLocal("pr"),p=a.i32_add(a.getLocal("pr"),a.i32_const(f)),D=a.i32_add(a.getLocal("pr"),a.i32_const(f*2));A.addCode(a.call(o+"_copy",F,v),a.call(o+"_neg",l,p),a.call(o+"_copy",R,D))}function K(){const A=t.addFunction(n+"_negAffine");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.getLocal("pr"),v=a.i32_add(a.getLocal("pr"),a.i32_const(f));A.addCode(a.call(o+"_copy",F,R),a.call(o+"_neg",l,v))}function J(){const A=t.addFunction(n+"_sub");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f*3));A.addCode(a.call(n+"_neg",a.getLocal("p2"),F),a.call(n+"_add",a.getLocal("p1"),F,a.getLocal("pr")))}function P(){const A=t.addFunction(n+"_subMixed");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f*3));A.addCode(a.call(n+"_negAffine",a.getLocal("p2"),F),a.call(n+"_addMixed",a.getLocal("p1"),F,a.getLocal("pr")))}function m(){const A=t.addFunction(n+"_subAffine");A.addParam("p1","i32"),A.addParam("p2","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f*3));A.addCode(a.call(n+"_negAffine",a.getLocal("p2"),F),a.call(n+"_addAffine",a.getLocal("p1"),F,a.getLocal("pr")))}function I(){const A=t.addFunction(n+"_normalize");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.i32_add(a.getLocal("p1"),a.i32_const(f*2)),v=a.getLocal("pr"),p=a.i32_add(a.getLocal("pr"),a.i32_const(f)),D=a.i32_add(a.getLocal("pr"),a.i32_const(f*2)),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f)),rt=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),a.call(n+"_zero",a.getLocal("pr")),[...a.call(o+"_inverse",R,ut),...a.call(o+"_square",ut,st),...a.call(o+"_mul",ut,st,rt),...a.call(o+"_mul",F,st,v),...a.call(o+"_mul",l,rt,p),...a.call(o+"_one",D)]))}function U(){const A=t.addFunction(n+"_toAffine");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.i32_add(a.getLocal("p1"),a.i32_const(f*2)),v=a.getLocal("pr"),p=a.i32_add(a.getLocal("pr"),a.i32_const(f)),D=a.i32_const(t.alloc(f)),ut=a.i32_const(t.alloc(f)),st=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZero",a.getLocal("p1")),[...a.call(o+"_zero",v),...a.call(o+"_zero",p)],[...a.call(o+"_inverse",R,D),...a.call(o+"_square",D,ut),...a.call(o+"_mul",D,ut,st),...a.call(o+"_mul",F,ut,v),...a.call(o+"_mul",l,st,p)]))}function et(){const A=t.addFunction(n+"_toJacobian");A.addParam("p1","i32"),A.addParam("pr","i32");const a=A.getCodeBuilder(),F=a.getLocal("p1"),l=a.i32_add(a.getLocal("p1"),a.i32_const(f)),R=a.getLocal("pr"),v=a.i32_add(a.getLocal("pr"),a.i32_const(f)),p=a.i32_add(a.getLocal("pr"),a.i32_const(f*2));A.addCode(a.if(a.call(n+"_isZeroAffine",a.getLocal("p1")),a.call(n+"_zero",a.getLocal("pr")),[...a.call(o+"_one",p),...a.call(o+"_copy",l,v),...a.call(o+"_copy",F,R)]))}function Y(){const A=t.addFunction(n+"_batchToAffine");A.addParam("pIn","i32"),A.addParam("n","i32"),A.addParam("pOut","i32"),A.addLocal("pAux","i32"),A.addLocal("itIn","i32"),A.addLocal("itAux","i32"),A.addLocal("itOut","i32"),A.addLocal("i","i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f));A.addCode(a.setLocal("pAux",a.i32_load(a.i32_const(0))),a.i32_store(a.i32_const(0),a.i32_add(a.getLocal("pAux"),a.i32_mul(a.getLocal("n"),a.i32_const(f)))),a.call(o+"_batchInverse",a.i32_add(a.getLocal("pIn"),a.i32_const(f*2)),a.i32_const(f*3),a.getLocal("n"),a.getLocal("pAux"),a.i32_const(f)),a.setLocal("itIn",a.getLocal("pIn")),a.setLocal("itAux",a.getLocal("pAux")),a.setLocal("itOut",a.getLocal("pOut")),a.setLocal("i",a.i32_const(0)),a.block(a.loop(a.br_if(1,a.i32_eq(a.getLocal("i"),a.getLocal("n"))),a.if(a.call(o+"_isZero",a.getLocal("itAux")),[...a.call(o+"_zero",a.getLocal("itOut")),...a.call(o+"_zero",a.i32_add(a.getLocal("itOut"),a.i32_const(f)))],[...a.call(o+"_mul",a.getLocal("itAux"),a.i32_add(a.getLocal("itIn"),a.i32_const(f)),F),...a.call(o+"_square",a.getLocal("itAux"),a.getLocal("itAux")),...a.call(o+"_mul",a.getLocal("itAux"),a.getLocal("itIn"),a.getLocal("itOut")),...a.call(o+"_mul",a.getLocal("itAux"),F,a.i32_add(a.getLocal("itOut"),a.i32_const(f)))]),a.setLocal("itIn",a.i32_add(a.getLocal("itIn"),a.i32_const(f*3))),a.setLocal("itOut",a.i32_add(a.getLocal("itOut"),a.i32_const(f*2))),a.setLocal("itAux",a.i32_add(a.getLocal("itAux"),a.i32_const(f))),a.setLocal("i",a.i32_add(a.getLocal("i"),a.i32_const(1))),a.br(0))),a.i32_store(a.i32_const(0),a.getLocal("pAux")))}function j(){const A=t.addFunction(n+"__reverseBytes");A.addParam("pIn","i32"),A.addParam("n","i32"),A.addParam("pOut","i32"),A.addLocal("itOut","i32"),A.addLocal("itIn","i32");const a=A.getCodeBuilder();A.addCode(a.setLocal("itOut",a.i32_sub(a.i32_add(a.getLocal("pOut"),a.getLocal("n")),a.i32_const(1))),a.setLocal("itIn",a.getLocal("pIn")),a.block(a.loop(a.br_if(1,a.i32_lt_s(a.getLocal("itOut"),a.getLocal("pOut"))),a.i32_store8(a.getLocal("itOut"),a.i32_load8_u(a.getLocal("itIn"))),a.setLocal("itOut",a.i32_sub(a.getLocal("itOut"),a.i32_const(1))),a.setLocal("itIn",a.i32_add(a.getLocal("itIn"),a.i32_const(1))),a.br(0))))}function ct(){const A=t.addFunction(n+"_LEMtoC");A.addParam("pIn","i32"),A.addParam("pOut","i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f));A.addCode(a.if(a.call(n+"_isZeroAffine",a.getLocal("pIn")),[...a.call(o+"_zero",a.getLocal("pOut")),...a.i32_store8(a.getLocal("pOut"),a.i32_const(64)),...a.ret([])]),a.call(o+"_fromMontgomery",a.getLocal("pIn"),F),a.call(n+"__reverseBytes",F,a.i32_const(f),a.getLocal("pOut")),a.if(a.i32_eq(a.call(o+"_sign",a.i32_add(a.getLocal("pIn"),a.i32_const(f))),a.i32_const(-1)),a.i32_store8(a.getLocal("pOut"),a.i32_or(a.i32_load8_u(a.getLocal("pOut")),a.i32_const(128)))))}function H(){const A=t.addFunction(n+"_LEMtoU");A.addParam("pIn","i32"),A.addParam("pOut","i32");const a=A.getCodeBuilder(),F=t.alloc(f*2),l=a.i32_const(F),R=a.i32_const(F),v=a.i32_const(F+f);A.addCode(a.if(a.call(n+"_isZeroAffine",a.getLocal("pIn")),[...a.call(n+"_zeroAffine",a.getLocal("pOut")),...a.ret([])]),a.call(n+"_fromMontgomeryAffine",a.getLocal("pIn"),l),a.call(n+"__reverseBytes",R,a.i32_const(f),a.getLocal("pOut")),a.call(n+"__reverseBytes",v,a.i32_const(f),a.i32_add(a.getLocal("pOut"),a.i32_const(f))))}function at(){const A=t.addFunction(n+"_UtoLEM");A.addParam("pIn","i32"),A.addParam("pOut","i32");const a=A.getCodeBuilder(),F=t.alloc(f*2),l=a.i32_const(F),R=a.i32_const(F),v=a.i32_const(F+f);A.addCode(a.if(a.i32_and(a.i32_load8_u(a.getLocal("pIn")),a.i32_const(64)),[...a.call(n+"_zeroAffine",a.getLocal("pOut")),...a.ret([])]),a.call(n+"__reverseBytes",a.getLocal("pIn"),a.i32_const(f),R),a.call(n+"__reverseBytes",a.i32_add(a.getLocal("pIn"),a.i32_const(f)),a.i32_const(f),v),a.call(n+"_toMontgomeryAffine",l,a.getLocal("pOut")))}function Pt(){const A=t.addFunction(n+"_CtoLEM");A.addParam("pIn","i32"),A.addParam("pOut","i32"),A.addLocal("firstByte","i32"),A.addLocal("greatest","i32");const a=A.getCodeBuilder(),F=t.alloc(f*2),l=a.i32_const(F),R=a.i32_const(F+f);A.addCode(a.setLocal("firstByte",a.i32_load8_u(a.getLocal("pIn"))),a.if(a.i32_and(a.getLocal("firstByte"),a.i32_const(64)),[...a.call(n+"_zeroAffine",a.getLocal("pOut")),...a.ret([])]),a.setLocal("greatest",a.i32_and(a.getLocal("firstByte"),a.i32_const(128))),a.call(o+"_copy",a.getLocal("pIn"),R),a.i32_store8(R,a.i32_and(a.getLocal("firstByte"),a.i32_const(63))),a.call(n+"__reverseBytes",R,a.i32_const(f),l),a.call(o+"_toMontgomery",l,a.getLocal("pOut")),a.call(o+"_square",a.getLocal("pOut"),R),a.call(o+"_mul",a.getLocal("pOut"),R,R),a.call(o+"_add",R,a.i32_const(e),R),a.call(o+"_sqrt",R,R),a.call(o+"_neg",R,l),a.if(a.i32_eq(a.call(o+"_sign",R),a.i32_const(-1)),a.if(a.getLocal("greatest"),a.call(o+"_copy",R,a.i32_add(a.getLocal("pOut"),a.i32_const(f))),a.call(o+"_neg",R,a.i32_add(a.getLocal("pOut"),a.i32_const(f)))),a.if(a.getLocal("greatest"),a.call(o+"_neg",R,a.i32_add(a.getLocal("pOut"),a.i32_const(f))),a.call(o+"_copy",R,a.i32_add(a.getLocal("pOut"),a.i32_const(f))))))}function vt(){const A=t.addFunction(n+"_inCurveAffine");A.addParam("pIn","i32"),A.setReturnType("i32");const a=A.getCodeBuilder(),F=a.getLocal("pIn"),l=a.i32_add(a.getLocal("pIn"),a.i32_const(f)),R=a.i32_const(t.alloc(f)),v=a.i32_const(t.alloc(f));A.addCode(a.call(o+"_square",l,R),a.call(o+"_square",F,v),a.call(o+"_mul",F,v,v),a.call(o+"_add",v,a.i32_const(e),v),a.ret(a.call(o+"_eq",R,v)))}function ht(){const A=t.addFunction(n+"_inCurve");A.addParam("pIn","i32"),A.setReturnType("i32");const a=A.getCodeBuilder(),F=a.i32_const(t.alloc(f*2));A.addCode(a.call(n+"_toAffine",a.getLocal("pIn"),F),a.ret(a.call(n+"_inCurveAffine",F)))}return b(),d(),w(),y(),s(),g(),et(),O(),T(),h(),x(),k(),L(),u(),C(),K(),$(),m(),P(),J(),nt(),E(),Q(),B(),U(),vt(),ht(),Y(),I(),j(),H(),ct(),at(),Pt(),En(t,n+"_batchLEMtoU",n+"_LEMtoU",f*2,f*2),En(t,n+"_batchLEMtoC",n+"_LEMtoC",f*2,f),En(t,n+"_batchUtoLEM",n+"_UtoLEM",f*2,f*2),En(t,n+"_batchCtoLEM",n+"_CtoLEM",f,f*2,!0),En(t,n+"_batchToJacobian",n+"_toJacobian",f*2,f*3,!0),ee(t,n,n+"_multiexp",n+"_add",f*3),ee(t,n,n+"_multiexpAffine",n+"_addMixed",f*2),oe(t,n+"_timesScalar",f*3,n+"_add",n+"_double",n+"_sub",n+"_copy",n+"_zero"),oe(t,n+"_timesScalarAffine",f*2,n+"_addMixed",n+"_double",n+"_subMixed",n+"_copyAffine",n+"_zero"),t.exportFunction(n+"_isZero"),t.exportFunction(n+"_isZeroAffine"),t.exportFunction(n+"_eq"),t.exportFunction(n+"_eqMixed"),t.exportFunction(n+"_eqAffine"),t.exportFunction(n+"_copy"),t.exportFunction(n+"_copyAffine"),t.exportFunction(n+"_zero"),t.exportFunction(n+"_zeroAffine"),t.exportFunction(n+"_double"),t.exportFunction(n+"_doubleAffine"),t.exportFunction(n+"_add"),t.exportFunction(n+"_addMixed"),t.exportFunction(n+"_addAffine"),t.exportFunction(n+"_neg"),t.exportFunction(n+"_negAffine"),t.exportFunction(n+"_sub"),t.exportFunction(n+"_subMixed"),t.exportFunction(n+"_subAffine"),t.exportFunction(n+"_fromMontgomery"),t.exportFunction(n+"_fromMontgomeryAffine"),t.exportFunction(n+"_toMontgomery"),t.exportFunction(n+"_toMontgomeryAffine"),t.exportFunction(n+"_timesScalar"),t.exportFunction(n+"_timesScalarAffine"),t.exportFunction(n+"_normalize"),t.exportFunction(n+"_LEMtoU"),t.exportFunction(n+"_LEMtoC"),t.exportFunction(n+"_UtoLEM"),t.exportFunction(n+"_CtoLEM"),t.exportFunction(n+"_batchLEMtoU"),t.exportFunction(n+"_batchLEMtoC"),t.exportFunction(n+"_batchUtoLEM"),t.exportFunction(n+"_batchCtoLEM"),t.exportFunction(n+"_toAffine"),t.exportFunction(n+"_toJacobian"),t.exportFunction(n+"_batchToAffine"),t.exportFunction(n+"_batchToJacobian"),t.exportFunction(n+"_inCurve"),t.exportFunction(n+"_inCurveAffine"),n};const{isOdd:Gi,modInv:ae,modPow:Pn}=$t,Vn=gn;var aa=function(t,n,o,e,c){const d=t.modules[e].n64*8,g=t.modules[o].n64*8,s=t.modules[e].q;let y=s-1n,w=0;for(;!Gi(y);)w++,y=y>>1n;let h=2n;for(;Pn(h,s>>1n,s)===1n;)h=h+1n;const T=new Array(w+1);T[w]=Pn(h,y,s);let k=w-1;for(;k>=0;)T[k]=Pn(T[k+1],2n,s),k--;const x=[],O=(1n<<BigInt(d*8))%s;for(let F=0;F<T.length;F++){const l=T[F]*O%s;x.push(...Vn.bigInt2BytesLE(l,d))}const B=t.alloc(x),Q=new Array(w+1);Q[0]=1n;for(let F=1;F<=w;F++)Q[F]=Q[F-1]*2n;const E=[];for(let F=0;F<=w;F++){const l=ae(Q[F],s)*O%s;E.push(...Vn.bigInt2BytesLE(l,d))}const nt=t.alloc(E),C=Pn(h,2n,s),u=[],L=[];for(let F=0;F<=w;F++){const l=Pn(C,2n**BigInt(F),s),R=ae(s+1n-l,s);u.push(...Vn.bigInt2BytesLE(l*O%s,d)),L.push(...Vn.bigInt2BytesLE(R*O%s,d))}const $=t.alloc(u),K=t.alloc(L);function J(F){let l=0;for(let R=0;R<8;R++)F&1<<R&&(l=l|128>>R);return l}const P=Array(256);for(let F=0;F<256;F++)P[F]=J(F);const m=t.alloc(P);function I(){const F=t.addFunction(n+"__log2");F.addParam("n","i32"),F.setReturnType("i32"),F.addLocal("bits","i32"),F.addLocal("aux","i32");const l=F.getCodeBuilder();F.addCode(l.setLocal("aux",l.i32_shr_u(l.getLocal("n"),l.i32_const(1)))),F.addCode(l.setLocal("bits",l.i32_const(0))),F.addCode(l.block(l.loop(l.br_if(1,l.i32_eqz(l.getLocal("aux"))),l.setLocal("aux",l.i32_shr_u(l.getLocal("aux"),l.i32_const(1))),l.setLocal("bits",l.i32_add(l.getLocal("bits"),l.i32_const(1))),l.br(0)))),F.addCode(l.if(l.i32_ne(l.getLocal("n"),l.i32_shl(l.i32_const(1),l.getLocal("bits"))),l.unreachable())),F.addCode(l.if(l.i32_gt_u(l.getLocal("bits"),l.i32_const(w)),l.unreachable())),F.addCode(l.getLocal("bits"))}function U(){const F=t.addFunction(n+"_fft");F.addParam("px","i32"),F.addParam("n","i32"),F.addLocal("bits","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d));F.addCode(l.setLocal("bits",l.call(n+"__log2",l.getLocal("n"))),l.call(e+"_one",R),l.call(n+"_rawfft",l.getLocal("px"),l.getLocal("bits"),l.i32_const(0),R))}function et(){const F=t.addFunction(n+"_ifft");F.addParam("px","i32"),F.addParam("n","i32"),F.addLocal("bits","i32"),F.addLocal("pInv2","i32");const l=F.getCodeBuilder();F.addCode(l.setLocal("bits",l.call(n+"__log2",l.getLocal("n"))),l.setLocal("pInv2",l.i32_add(l.i32_const(nt),l.i32_mul(l.getLocal("bits"),l.i32_const(d)))),l.call(n+"_rawfft",l.getLocal("px"),l.getLocal("bits"),l.i32_const(1),l.getLocal("pInv2")))}function Y(){const F=t.addFunction(n+"_rawfft");F.addParam("px","i32"),F.addParam("bits","i32"),F.addParam("reverse","i32"),F.addParam("mulFactor","i32"),F.addLocal("s","i32"),F.addLocal("k","i32"),F.addLocal("j","i32"),F.addLocal("m","i32"),F.addLocal("mdiv2","i32"),F.addLocal("n","i32"),F.addLocal("pwm","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g)),p=l.i32_const(t.alloc(g));F.addCode(l.call(n+"__reversePermutation",l.getLocal("px"),l.getLocal("bits")),l.setLocal("n",l.i32_shl(l.i32_const(1),l.getLocal("bits"))),l.setLocal("s",l.i32_const(1)),l.block(l.loop(l.br_if(1,l.i32_gt_u(l.getLocal("s"),l.getLocal("bits"))),l.setLocal("m",l.i32_shl(l.i32_const(1),l.getLocal("s"))),l.setLocal("pwm",l.i32_add(l.i32_const(B),l.i32_mul(l.getLocal("s"),l.i32_const(d)))),l.setLocal("k",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_ge_u(l.getLocal("k"),l.getLocal("n"))),l.call(e+"_one",R),l.setLocal("mdiv2",l.i32_shr_u(l.getLocal("m"),l.i32_const(1))),l.setLocal("j",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_ge_u(l.getLocal("j"),l.getLocal("mdiv2"))),l.setLocal("idx1",l.i32_add(l.getLocal("px"),l.i32_mul(l.i32_add(l.getLocal("k"),l.getLocal("j")),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("idx1"),l.i32_mul(l.getLocal("mdiv2"),l.i32_const(g)))),l.call(c,l.getLocal("idx2"),R,v),l.call(o+"_copy",l.getLocal("idx1"),p),l.call(o+"_add",p,v,l.getLocal("idx1")),l.call(o+"_sub",p,v,l.getLocal("idx2")),l.call(e+"_mul",R,l.getLocal("pwm"),R),l.setLocal("j",l.i32_add(l.getLocal("j"),l.i32_const(1))),l.br(0))),l.setLocal("k",l.i32_add(l.getLocal("k"),l.getLocal("m"))),l.br(0))),l.setLocal("s",l.i32_add(l.getLocal("s"),l.i32_const(1))),l.br(0))),l.call(n+"__fftFinal",l.getLocal("px"),l.getLocal("bits"),l.getLocal("reverse"),l.getLocal("mulFactor")))}function j(){const F=t.addFunction(n+"__fftFinal");F.addParam("px","i32"),F.addParam("bits","i32"),F.addParam("reverse","i32"),F.addParam("mulFactor","i32"),F.addLocal("n","i32"),F.addLocal("ndiv2","i32"),F.addLocal("pInv2","i32"),F.addLocal("i","i32"),F.addLocal("mask","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(g));F.addCode(l.if(l.i32_and(l.i32_eqz(l.getLocal("reverse")),l.call(e+"_isOne",l.getLocal("mulFactor"))),l.ret([])),l.setLocal("n",l.i32_shl(l.i32_const(1),l.getLocal("bits"))),l.setLocal("mask",l.i32_sub(l.getLocal("n"),l.i32_const(1))),l.setLocal("i",l.i32_const(1)),l.setLocal("ndiv2",l.i32_shr_u(l.getLocal("n"),l.i32_const(1))),l.block(l.loop(l.br_if(1,l.i32_ge_u(l.getLocal("i"),l.getLocal("ndiv2"))),l.setLocal("idx1",l.i32_add(l.getLocal("px"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("px"),l.i32_mul(l.i32_sub(l.getLocal("n"),l.getLocal("i")),l.i32_const(g)))),l.if(l.getLocal("reverse"),l.if(l.call(e+"_isOne",l.getLocal("mulFactor")),[...l.call(o+"_copy",l.getLocal("idx1"),R),...l.call(o+"_copy",l.getLocal("idx2"),l.getLocal("idx1")),...l.call(o+"_copy",R,l.getLocal("idx2"))],[...l.call(o+"_copy",l.getLocal("idx1"),R),...l.call(c,l.getLocal("idx2"),l.getLocal("mulFactor"),l.getLocal("idx1")),...l.call(c,R,l.getLocal("mulFactor"),l.getLocal("idx2"))]),l.if(l.call(e+"_isOne",l.getLocal("mulFactor")),[],[...l.call(c,l.getLocal("idx1"),l.getLocal("mulFactor"),l.getLocal("idx1")),...l.call(c,l.getLocal("idx2"),l.getLocal("mulFactor"),l.getLocal("idx2"))])),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))),l.if(l.call(e+"_isOne",l.getLocal("mulFactor")),[],[...l.call(c,l.getLocal("px"),l.getLocal("mulFactor"),l.getLocal("px")),...l.setLocal("idx2",l.i32_add(l.getLocal("px"),l.i32_mul(l.getLocal("ndiv2"),l.i32_const(g)))),...l.call(c,l.getLocal("idx2"),l.getLocal("mulFactor"),l.getLocal("idx2"))]))}function ct(){const F=t.addFunction(n+"__reversePermutation");F.addParam("px","i32"),F.addParam("bits","i32"),F.addLocal("n","i32"),F.addLocal("i","i32"),F.addLocal("ri","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(g));F.addCode(l.setLocal("n",l.i32_shl(l.i32_const(1),l.getLocal("bits"))),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.setLocal("idx1",l.i32_add(l.getLocal("px"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("ri",l.call(n+"__rev",l.getLocal("i"),l.getLocal("bits"))),l.setLocal("idx2",l.i32_add(l.getLocal("px"),l.i32_mul(l.getLocal("ri"),l.i32_const(g)))),l.if(l.i32_lt_u(l.getLocal("i"),l.getLocal("ri")),[...l.call(o+"_copy",l.getLocal("idx1"),R),...l.call(o+"_copy",l.getLocal("idx2"),l.getLocal("idx1")),...l.call(o+"_copy",R,l.getLocal("idx2"))]),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function H(){const F=t.addFunction(n+"__rev");F.addParam("x","i32"),F.addParam("bits","i32"),F.setReturnType("i32");const l=F.getCodeBuilder();F.addCode(l.i32_rotl(l.i32_add(l.i32_add(l.i32_shl(l.i32_load8_u(l.i32_and(l.getLocal("x"),l.i32_const(255)),m,0),l.i32_const(24)),l.i32_shl(l.i32_load8_u(l.i32_and(l.i32_shr_u(l.getLocal("x"),l.i32_const(8)),l.i32_const(255)),m,0),l.i32_const(16))),l.i32_add(l.i32_shl(l.i32_load8_u(l.i32_and(l.i32_shr_u(l.getLocal("x"),l.i32_const(16)),l.i32_const(255)),m,0),l.i32_const(8)),l.i32_load8_u(l.i32_and(l.i32_shr_u(l.getLocal("x"),l.i32_const(24)),l.i32_const(255)),m,0))),l.getLocal("bits")))}function at(){const F=t.addFunction(n+"_fftJoin");F.addParam("pBuff1","i32"),F.addParam("pBuff2","i32"),F.addParam("n","i32"),F.addParam("first","i32"),F.addParam("inc","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g)),p=l.i32_const(t.alloc(g));F.addCode(l.call(e+"_copy",l.getLocal("first"),R),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff1"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("pBuff2"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.call(c,l.getLocal("idx2"),R,v),l.call(o+"_copy",l.getLocal("idx1"),p),l.call(o+"_add",p,v,l.getLocal("idx1")),l.call(o+"_sub",p,v,l.getLocal("idx2")),l.call(e+"_mul",R,l.getLocal("inc"),R),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function Pt(){const F=t.addFunction(n+"_fftJoinExt");F.addParam("pBuff1","i32"),F.addParam("pBuff2","i32"),F.addParam("n","i32"),F.addParam("first","i32"),F.addParam("inc","i32"),F.addParam("totalBits","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32"),F.addLocal("pShiftToM","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g));F.addCode(l.setLocal("pShiftToM",l.i32_add(l.i32_const($),l.i32_mul(l.getLocal("totalBits"),l.i32_const(d)))),l.call(e+"_copy",l.getLocal("first"),R),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff1"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("pBuff2"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.call(o+"_add",l.getLocal("idx1"),l.getLocal("idx2"),v),l.call(c,l.getLocal("idx2"),l.getLocal("pShiftToM"),l.getLocal("idx2")),l.call(o+"_add",l.getLocal("idx1"),l.getLocal("idx2"),l.getLocal("idx2")),l.call(c,l.getLocal("idx2"),R,l.getLocal("idx2")),l.call(o+"_copy",v,l.getLocal("idx1")),l.call(e+"_mul",R,l.getLocal("inc"),R),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function vt(){const F=t.addFunction(n+"_fftJoinExtInv");F.addParam("pBuff1","i32"),F.addParam("pBuff2","i32"),F.addParam("n","i32"),F.addParam("first","i32"),F.addParam("inc","i32"),F.addParam("totalBits","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32"),F.addLocal("pShiftToM","i32"),F.addLocal("pSConst","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g));F.addCode(l.setLocal("pShiftToM",l.i32_add(l.i32_const($),l.i32_mul(l.getLocal("totalBits"),l.i32_const(d)))),l.setLocal("pSConst",l.i32_add(l.i32_const(K),l.i32_mul(l.getLocal("totalBits"),l.i32_const(d)))),l.call(e+"_copy",l.getLocal("first"),R),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff1"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("pBuff2"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.call(c,l.getLocal("idx2"),R,v),l.call(o+"_sub",l.getLocal("idx1"),v,l.getLocal("idx2")),l.call(c,l.getLocal("idx2"),l.getLocal("pSConst"),l.getLocal("idx2")),l.call(c,l.getLocal("idx1"),l.getLocal("pShiftToM"),l.getLocal("idx1")),l.call(o+"_sub",v,l.getLocal("idx1"),l.getLocal("idx1")),l.call(c,l.getLocal("idx1"),l.getLocal("pSConst"),l.getLocal("idx1")),l.call(e+"_mul",R,l.getLocal("inc"),R),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function ht(){const F=t.addFunction(n+"_prepareLagrangeEvaluation");F.addParam("pBuff1","i32"),F.addParam("pBuff2","i32"),F.addParam("n","i32"),F.addParam("first","i32"),F.addParam("inc","i32"),F.addParam("totalBits","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32"),F.addLocal("pShiftToM","i32"),F.addLocal("pSConst","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g));F.addCode(l.setLocal("pShiftToM",l.i32_add(l.i32_const($),l.i32_mul(l.getLocal("totalBits"),l.i32_const(d)))),l.setLocal("pSConst",l.i32_add(l.i32_const(K),l.i32_mul(l.getLocal("totalBits"),l.i32_const(d)))),l.call(e+"_copy",l.getLocal("first"),R),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff1"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("pBuff2"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.call(c,l.getLocal("idx1"),l.getLocal("pShiftToM"),v),l.call(o+"_sub",l.getLocal("idx2"),v,v),l.call(o+"_sub",l.getLocal("idx1"),l.getLocal("idx2"),l.getLocal("idx2")),l.call(c,v,l.getLocal("pSConst"),l.getLocal("idx1")),l.call(c,l.getLocal("idx2"),R,l.getLocal("idx2")),l.call(e+"_mul",R,l.getLocal("inc"),R),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function A(){const F=t.addFunction(n+"_fftMix");F.addParam("pBuff","i32"),F.addParam("n","i32"),F.addParam("exp","i32"),F.addLocal("nGroups","i32"),F.addLocal("nPerGroup","i32"),F.addLocal("nPerGroupDiv2","i32"),F.addLocal("pairOffset","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32"),F.addLocal("j","i32"),F.addLocal("pwm","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(d)),v=l.i32_const(t.alloc(g)),p=l.i32_const(t.alloc(g));F.addCode(l.setLocal("nPerGroup",l.i32_shl(l.i32_const(1),l.getLocal("exp"))),l.setLocal("nPerGroupDiv2",l.i32_shr_u(l.getLocal("nPerGroup"),l.i32_const(1))),l.setLocal("nGroups",l.i32_shr_u(l.getLocal("n"),l.getLocal("exp"))),l.setLocal("pairOffset",l.i32_mul(l.getLocal("nPerGroupDiv2"),l.i32_const(g))),l.setLocal("pwm",l.i32_add(l.i32_const(B),l.i32_mul(l.getLocal("exp"),l.i32_const(d)))),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("nGroups"))),l.call(e+"_one",R),l.setLocal("j",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("j"),l.getLocal("nPerGroupDiv2"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff"),l.i32_mul(l.i32_add(l.i32_mul(l.getLocal("i"),l.getLocal("nPerGroup")),l.getLocal("j")),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("idx1"),l.getLocal("pairOffset"))),l.call(c,l.getLocal("idx2"),R,v),l.call(o+"_copy",l.getLocal("idx1"),p),l.call(o+"_add",p,v,l.getLocal("idx1")),l.call(o+"_sub",p,v,l.getLocal("idx2")),l.call(e+"_mul",R,l.getLocal("pwm"),R),l.setLocal("j",l.i32_add(l.getLocal("j"),l.i32_const(1))),l.br(0))),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}function a(){const F=t.addFunction(n+"_fftFinal");F.addParam("pBuff","i32"),F.addParam("n","i32"),F.addParam("factor","i32"),F.addLocal("idx1","i32"),F.addLocal("idx2","i32"),F.addLocal("i","i32"),F.addLocal("ndiv2","i32");const l=F.getCodeBuilder(),R=l.i32_const(t.alloc(g));F.addCode(l.setLocal("ndiv2",l.i32_shr_u(l.getLocal("n"),l.i32_const(1))),l.if(l.i32_and(l.getLocal("n"),l.i32_const(1)),l.call(c,l.i32_add(l.getLocal("pBuff"),l.i32_mul(l.getLocal("ndiv2"),l.i32_const(g))),l.getLocal("factor"),l.i32_add(l.getLocal("pBuff"),l.i32_mul(l.getLocal("ndiv2"),l.i32_const(g))))),l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_ge_u(l.getLocal("i"),l.getLocal("ndiv2"))),l.setLocal("idx1",l.i32_add(l.getLocal("pBuff"),l.i32_mul(l.getLocal("i"),l.i32_const(g)))),l.setLocal("idx2",l.i32_add(l.getLocal("pBuff"),l.i32_mul(l.i32_sub(l.i32_sub(l.getLocal("n"),l.i32_const(1)),l.getLocal("i")),l.i32_const(g)))),l.call(c,l.getLocal("idx2"),l.getLocal("factor"),R),l.call(c,l.getLocal("idx1"),l.getLocal("factor"),l.getLocal("idx2")),l.call(o+"_copy",R,l.getLocal("idx1")),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))))}H(),ct(),j(),Y(),I(),U(),et(),at(),Pt(),vt(),A(),a(),ht(),t.exportFunction(n+"_fft"),t.exportFunction(n+"_ifft"),t.exportFunction(n+"_rawfft"),t.exportFunction(n+"_fftJoin"),t.exportFunction(n+"_fftJoinExt"),t.exportFunction(n+"_fftJoinExtInv"),t.exportFunction(n+"_fftMix"),t.exportFunction(n+"_fftFinal"),t.exportFunction(n+"_prepareLagrangeEvaluation")},ia=function(t,n,o){const c=t.modules[o].n64*8;function f(){const b=t.addFunction(n+"_zero");b.addParam("px","i32"),b.addParam("n","i32"),b.addLocal("lastp","i32"),b.addLocal("p","i32");const g=b.getCodeBuilder();b.addCode(g.setLocal("p",g.getLocal("px")),g.setLocal("lastp",g.i32_add(g.getLocal("px"),g.i32_mul(g.getLocal("n"),g.i32_const(c)))),g.block(g.loop(g.br_if(1,g.i32_eq(g.getLocal("p"),g.getLocal("lastp"))),g.call(o+"_zero",g.getLocal("p")),g.setLocal("p",g.i32_add(g.getLocal("p"),g.i32_const(c))),g.br(0))))}function d(){const b=t.addFunction(n+"_constructLC");b.addParam("ppolynomials","i32"),b.addParam("psignals","i32"),b.addParam("nSignals","i32"),b.addParam("pres","i32"),b.addLocal("i","i32"),b.addLocal("j","i32"),b.addLocal("pp","i32"),b.addLocal("ps","i32"),b.addLocal("pd","i32"),b.addLocal("ncoefs","i32");const g=b.getCodeBuilder(),s=g.i32_const(t.alloc(c));b.addCode(g.setLocal("i",g.i32_const(0)),g.setLocal("pp",g.getLocal("ppolynomials")),g.setLocal("ps",g.getLocal("psignals")),g.block(g.loop(g.br_if(1,g.i32_eq(g.getLocal("i"),g.getLocal("nSignals"))),g.setLocal("ncoefs",g.i32_load(g.getLocal("pp"))),g.setLocal("pp",g.i32_add(g.getLocal("pp"),g.i32_const(4))),g.setLocal("j",g.i32_const(0)),g.block(g.loop(g.br_if(1,g.i32_eq(g.getLocal("j"),g.getLocal("ncoefs"))),g.setLocal("pd",g.i32_add(g.getLocal("pres"),g.i32_mul(g.i32_load(g.getLocal("pp")),g.i32_const(c)))),g.setLocal("pp",g.i32_add(g.getLocal("pp"),g.i32_const(4))),g.call(o+"_mul",g.getLocal("ps"),g.getLocal("pp"),s),g.call(o+"_add",s,g.getLocal("pd"),g.getLocal("pd")),g.setLocal("pp",g.i32_add(g.getLocal("pp"),g.i32_const(c))),g.setLocal("j",g.i32_add(g.getLocal("j"),g.i32_const(1))),g.br(0))),g.setLocal("ps",g.i32_add(g.getLocal("ps"),g.i32_const(c))),g.setLocal("i",g.i32_add(g.getLocal("i"),g.i32_const(1))),g.br(0))))}return f(),d(),t.exportFunction(n+"_zero"),t.exportFunction(n+"_constructLC"),n},ca=function(t,n,o){const c=t.modules[o].n64*8;function f(){const g=t.addFunction(n+"_buildABC");g.addParam("pCoefs","i32"),g.addParam("nCoefs","i32"),g.addParam("pWitness","i32"),g.addParam("pA","i32"),g.addParam("pB","i32"),g.addParam("pC","i32"),g.addParam("offsetOut","i32"),g.addParam("nOut","i32"),g.addParam("offsetWitness","i32"),g.addParam("nWitness","i32"),g.addLocal("it","i32"),g.addLocal("ita","i32"),g.addLocal("itb","i32"),g.addLocal("last","i32"),g.addLocal("m","i32"),g.addLocal("c","i32"),g.addLocal("s","i32"),g.addLocal("pOut","i32");const s=g.getCodeBuilder(),y=s.i32_const(t.alloc(c));g.addCode(s.setLocal("ita",s.getLocal("pA")),s.setLocal("itb",s.getLocal("pB")),s.setLocal("last",s.i32_add(s.getLocal("pA"),s.i32_mul(s.getLocal("nOut"),s.i32_const(c)))),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("ita"),s.getLocal("last"))),s.call(o+"_zero",s.getLocal("ita")),s.call(o+"_zero",s.getLocal("itb")),s.setLocal("ita",s.i32_add(s.getLocal("ita"),s.i32_const(c))),s.setLocal("itb",s.i32_add(s.getLocal("itb"),s.i32_const(c))),s.br(0))),s.setLocal("it",s.getLocal("pCoefs")),s.setLocal("last",s.i32_add(s.getLocal("pCoefs"),s.i32_mul(s.getLocal("nCoefs"),s.i32_const(c+12)))),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("it"),s.getLocal("last"))),s.setLocal("s",s.i32_load(s.getLocal("it"),8)),s.if(s.i32_or(s.i32_lt_u(s.getLocal("s"),s.getLocal("offsetWitness")),s.i32_ge_u(s.getLocal("s"),s.i32_add(s.getLocal("offsetWitness"),s.getLocal("nWitness")))),[...s.setLocal("it",s.i32_add(s.getLocal("it"),s.i32_const(c+12))),...s.br(1)]),s.setLocal("m",s.i32_load(s.getLocal("it"))),s.if(s.i32_eq(s.getLocal("m"),s.i32_const(0)),s.setLocal("pOut",s.getLocal("pA")),s.if(s.i32_eq(s.getLocal("m"),s.i32_const(1)),s.setLocal("pOut",s.getLocal("pB")),[...s.setLocal("it",s.i32_add(s.getLocal("it"),s.i32_const(c+12))),...s.br(1)])),s.setLocal("c",s.i32_load(s.getLocal("it"),4)),s.if(s.i32_or(s.i32_lt_u(s.getLocal("c"),s.getLocal("offsetOut")),s.i32_ge_u(s.getLocal("c"),s.i32_add(s.getLocal("offsetOut"),s.getLocal("nOut")))),[...s.setLocal("it",s.i32_add(s.getLocal("it"),s.i32_const(c+12))),...s.br(1)]),s.setLocal("pOut",s.i32_add(s.getLocal("pOut"),s.i32_mul(s.i32_sub(s.getLocal("c"),s.getLocal("offsetOut")),s.i32_const(c)))),s.call(o+"_mul",s.i32_add(s.getLocal("pWitness"),s.i32_mul(s.i32_sub(s.getLocal("s"),s.getLocal("offsetWitness")),s.i32_const(c))),s.i32_add(s.getLocal("it"),s.i32_const(12)),y),s.call(o+"_add",s.getLocal("pOut"),y,s.getLocal("pOut")),s.setLocal("it",s.i32_add(s.getLocal("it"),s.i32_const(c+12))),s.br(0))),s.setLocal("ita",s.getLocal("pA")),s.setLocal("itb",s.getLocal("pB")),s.setLocal("it",s.getLocal("pC")),s.setLocal("last",s.i32_add(s.getLocal("pA"),s.i32_mul(s.getLocal("nOut"),s.i32_const(c)))),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("ita"),s.getLocal("last"))),s.call(o+"_mul",s.getLocal("ita"),s.getLocal("itb"),s.getLocal("it")),s.setLocal("ita",s.i32_add(s.getLocal("ita"),s.i32_const(c))),s.setLocal("itb",s.i32_add(s.getLocal("itb"),s.i32_const(c))),s.setLocal("it",s.i32_add(s.getLocal("it"),s.i32_const(c))),s.br(0))))}function d(){const g=t.addFunction(n+"_joinABC");g.addParam("pA","i32"),g.addParam("pB","i32"),g.addParam("pC","i32"),g.addParam("n","i32"),g.addParam("pP","i32"),g.addLocal("ita","i32"),g.addLocal("itb","i32"),g.addLocal("itc","i32"),g.addLocal("itp","i32"),g.addLocal("last","i32");const s=g.getCodeBuilder(),y=s.i32_const(t.alloc(c));g.addCode(s.setLocal("ita",s.getLocal("pA")),s.setLocal("itb",s.getLocal("pB")),s.setLocal("itc",s.getLocal("pC")),s.setLocal("itp",s.getLocal("pP")),s.setLocal("last",s.i32_add(s.getLocal("pA"),s.i32_mul(s.getLocal("n"),s.i32_const(c)))),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("ita"),s.getLocal("last"))),s.call(o+"_mul",s.getLocal("ita"),s.getLocal("itb"),y),s.call(o+"_sub",y,s.getLocal("itc"),s.getLocal("itp")),s.setLocal("ita",s.i32_add(s.getLocal("ita"),s.i32_const(c))),s.setLocal("itb",s.i32_add(s.getLocal("itb"),s.i32_const(c))),s.setLocal("itc",s.i32_add(s.getLocal("itc"),s.i32_const(c))),s.setLocal("itp",s.i32_add(s.getLocal("itp"),s.i32_const(c))),s.br(0))))}function b(){const g=t.addFunction(n+"_batchAdd");g.addParam("pa","i32"),g.addParam("pb","i32"),g.addParam("n","i32"),g.addParam("pr","i32"),g.addLocal("ita","i32"),g.addLocal("itb","i32"),g.addLocal("itr","i32"),g.addLocal("last","i32");const s=g.getCodeBuilder();g.addCode(s.setLocal("ita",s.getLocal("pa")),s.setLocal("itb",s.getLocal("pb")),s.setLocal("itr",s.getLocal("pr")),s.setLocal("last",s.i32_add(s.getLocal("pa"),s.i32_mul(s.getLocal("n"),s.i32_const(c)))),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("ita"),s.getLocal("last"))),s.call(o+"_add",s.getLocal("ita"),s.getLocal("itb"),s.getLocal("itr")),s.setLocal("ita",s.i32_add(s.getLocal("ita"),s.i32_const(c))),s.setLocal("itb",s.i32_add(s.getLocal("itb"),s.i32_const(c))),s.setLocal("itr",s.i32_add(s.getLocal("itr"),s.i32_const(c))),s.br(0))))}return f(),d(),b(),t.exportFunction(n+"_buildABC"),t.exportFunction(n+"_joinABC"),t.exportFunction(n+"_batchAdd"),n},sa=function(t,n,o,e,c,f,d,b){const g=t.addFunction(n);g.addParam("pIn","i32"),g.addParam("n","i32"),g.addParam("pFirst","i32"),g.addParam("pInc","i32"),g.addParam("pOut","i32"),g.addLocal("pOldFree","i32"),g.addLocal("i","i32"),g.addLocal("pFrom","i32"),g.addLocal("pTo","i32");const s=g.getCodeBuilder(),y=s.i32_const(t.alloc(d));g.addCode(s.setLocal("pFrom",s.getLocal("pIn")),s.setLocal("pTo",s.getLocal("pOut"))),g.addCode(s.call(e+"_copy",s.getLocal("pFirst"),y)),g.addCode(s.setLocal("i",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("n"))),s.call(b,s.getLocal("pFrom"),y,s.getLocal("pTo")),s.setLocal("pFrom",s.i32_add(s.getLocal("pFrom"),s.i32_const(c))),s.setLocal("pTo",s.i32_add(s.getLocal("pTo"),s.i32_const(f))),s.call(e+"_mul",y,s.getLocal("pInc"),y),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0)))),t.exportFunction(n)};const At=gn,$i=$o,ji=ta,ie=na,Zi=oa,ce=ea,Lo=aa,Wi=ia,Di=ca,On=sa,{bitLength:Ki,modInv:Xi,isOdd:se,isNegative:Vi}=$t;var Hi=function(t,n){const o=n||"bn128";if(t.modules[o])return o;const e=21888242871839275222246405745257275088696311157297823662689037894645226208583n,c=21888242871839275222246405745257275088548364400416034343698204186575808495617n,f=Math.floor((Ki(e-1n)-1)/64)+1,d=f*8,b=d,g=d,s=g*2,y=g*12,w=t.alloc(At.bigInt2BytesLE(c,b)),h=$i(t,e,"f1m");ji(t,c,"fr","frm");const T=t.alloc(At.bigInt2BytesLE(E(3n),g)),k=ce(t,"g1m","f1m",T);Lo(t,"frm","frm","frm","frm_mul"),Wi(t,"pol","frm"),Di(t,"qap","frm");const x=ie(t,"f1m_neg","f2m","f1m"),O=t.alloc([...At.bigInt2BytesLE(E(19485874751759354771024239261021720505790618469301721065564631296452457478373n),g),...At.bigInt2BytesLE(E(266929791119991161246907387137283842545076965332900288569378510910307636690n),g)]),B=ce(t,"g2m","f2m",O);function Q(G,r){const _=t.addFunction(G);_.addParam("pG","i32"),_.addParam("pFr","i32"),_.addParam("pr","i32");const q=_.getCodeBuilder(),z=q.i32_const(t.alloc(d));_.addCode(q.call("frm_fromMontgomery",q.getLocal("pFr"),z),q.call(r,q.getLocal("pG"),z,q.i32_const(d),q.getLocal("pr"))),t.exportFunction(G)}Q("g1m_timesFr","g1m_timesScalar"),Lo(t,"g1m","g1m","frm","g1m_timesFr"),Q("g2m_timesFr","g2m_timesScalar"),Lo(t,"g2m","g2m","frm","g2m_timesFr"),Q("g1m_timesFrAffine","g1m_timesScalarAffine"),Q("g2m_timesFrAffine","g2m_timesScalarAffine"),On(t,"frm_batchApplyKey","fmr","frm",d,d,d,"frm_mul"),On(t,"g1m_batchApplyKey","g1m","frm",d*3,d*3,d,"g1m_timesFr"),On(t,"g1m_batchApplyKeyMixed","g1m","frm",d*2,d*3,d,"g1m_timesFrAffine"),On(t,"g2m_batchApplyKey","g2m","frm",d*2*3,d*3*2,d,"g2m_timesFr"),On(t,"g2m_batchApplyKeyMixed","g2m","frm",d*2*2,d*3*2,d,"g2m_timesFrAffine");function E(G){return BigInt(G)*(1n<<BigInt(g*8))%e}const nt=[1n,2n,1n],C=t.alloc([...At.bigInt2BytesLE(E(nt[0]),g),...At.bigInt2BytesLE(E(nt[1]),g),...At.bigInt2BytesLE(E(nt[2]),g)]),u=[0n,1n,0n],L=t.alloc([...At.bigInt2BytesLE(E(u[0]),g),...At.bigInt2BytesLE(E(u[1]),g),...At.bigInt2BytesLE(E(u[2]),g)]),$=[[10857046999023057135944570762232829481370756359578518086990519993285655852781n,11559732032986387107991004021392285783925812861821192530917403151452391805634n],[8495653923123431417604973247489272438418190587263600148770280649306958101930n,4082367875863433681332203403145435568316851327593401208105741076214120093531n],[1n,0n]],K=t.alloc([...At.bigInt2BytesLE(E($[0][0]),g),...At.bigInt2BytesLE(E($[0][1]),g),...At.bigInt2BytesLE(E($[1][0]),g),...At.bigInt2BytesLE(E($[1][1]),g),...At.bigInt2BytesLE(E($[2][0]),g),...At.bigInt2BytesLE(E($[2][1]),g)]),J=[[0n,0n],[1n,0n],[0n,0n]],P=t.alloc([...At.bigInt2BytesLE(E(J[0][0]),g),...At.bigInt2BytesLE(E(J[0][1]),g),...At.bigInt2BytesLE(E(J[1][0]),g),...At.bigInt2BytesLE(E(J[1][1]),g),...At.bigInt2BytesLE(E(J[2][0]),g),...At.bigInt2BytesLE(E(J[2][1]),g)]),m=t.alloc([...At.bigInt2BytesLE(E(1),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g),...At.bigInt2BytesLE(E(0),g)]),I=t.alloc([...At.bigInt2BytesLE(E(9),g),...At.bigInt2BytesLE(E(1),g)]),U=t.alloc([...At.bigInt2BytesLE(E(Xi(2n,e)),g),...At.bigInt2BytesLE(0n,g)]),et=I,Y=t.alloc([...At.bigInt2BytesLE(E(19485874751759354771024239261021720505790618469301721065564631296452457478373n),g),...At.bigInt2BytesLE(E(266929791119991161246907387137283842545076965332900288569378510910307636690n),g)]);function j(){const G=t.addFunction(o+"_mulNR6");G.addParam("x","i32"),G.addParam("pr","i32");const r=G.getCodeBuilder();G.addCode(r.call(x+"_mul",r.i32_const(I),r.getLocal("x"),r.getLocal("pr")))}j();const ct=Zi(t,o+"_mulNR6","f6m","f2m");function H(){const G=t.addFunction(o+"_mulNR12");G.addParam("x","i32"),G.addParam("pr","i32");const r=G.getCodeBuilder();G.addCode(r.call(x+"_mul",r.i32_const(I),r.i32_add(r.getLocal("x"),r.i32_const(d*4)),r.getLocal("pr")),r.call(x+"_copy",r.getLocal("x"),r.i32_add(r.getLocal("pr"),r.i32_const(d*2))),r.call(x+"_copy",r.i32_add(r.getLocal("x"),r.i32_const(d*2)),r.i32_add(r.getLocal("pr"),r.i32_const(d*4))))}H();const at=ie(t,o+"_mulNR12","ftm",ct),vt=ut(29793968203157093288n),ht=t.alloc(vt),A=3*s,a=vt.length-1,l=vt.reduce((G,r)=>G+(r!=0?1:0),0)+a+1,R=3*2*d,v=3*d*2+l*A;t.modules[o]={n64:f,pG1gen:C,pG1zero:L,pG1b:T,pG2gen:K,pG2zero:P,pG2b:O,pq:t.modules.f1m.pq,pr:w,pOneT:m,prePSize:R,preQSize:v,r:c.toString(),q:e.toString()};const p=4965661367192848881n;function D(G){let r=G;const _=[];for(;r>0n;){if(se(r)){const q=2-Number(r%4n);_.push(q),r=r-BigInt(q)}else _.push(0);r=r>>1n}return _}function ut(G){let r=G;const _=[];for(;r>0n;)se(r)?_.push(1):_.push(0),r=r>>1n;return _}function st(){const G=t.addFunction(o+"_prepareG1");G.addParam("pP","i32"),G.addParam("ppreP","i32");const r=G.getCodeBuilder();G.addCode(r.call(k+"_normalize",r.getLocal("pP"),r.getLocal("ppreP")))}function rt(){const G=t.addFunction(o+"_prepAddStep");G.addParam("pQ","i32"),G.addParam("pR","i32"),G.addParam("pCoef","i32");const r=G.getCodeBuilder(),_=r.getLocal("pQ"),q=r.i32_add(r.getLocal("pQ"),r.i32_const(s)),z=r.getLocal("pR"),S=r.i32_add(r.getLocal("pR"),r.i32_const(s)),N=r.i32_add(r.getLocal("pR"),r.i32_const(2*s)),M=r.getLocal("pCoef"),W=r.i32_add(r.getLocal("pCoef"),r.i32_const(s)),X=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*s)),V=W,Z=r.i32_const(t.alloc(s)),tt=r.i32_const(t.alloc(s)),ft=r.i32_const(t.alloc(s)),_t=r.i32_const(t.alloc(s)),it=r.i32_const(t.alloc(s)),mt=r.i32_const(t.alloc(s)),Bt=r.i32_const(t.alloc(s));G.addCode(r.call(x+"_mul",_,N,V),r.call(x+"_sub",z,V,V),r.call(x+"_mul",q,N,Z),r.call(x+"_sub",S,Z,Z),r.call(x+"_square",V,tt),r.call(x+"_square",Z,ft),r.call(x+"_mul",V,tt,_t),r.call(x+"_mul",z,tt,it),r.call(x+"_add",it,it,Bt),r.call(x+"_mul",N,ft,mt),r.call(x+"_add",_t,mt,mt),r.call(x+"_sub",mt,Bt,mt),r.call(x+"_mul",V,mt,z),r.call(x+"_mul",_t,S,S),r.call(x+"_sub",it,mt,Bt),r.call(x+"_mul",Z,Bt,Bt),r.call(x+"_sub",Bt,S,S),r.call(x+"_mul",N,_t,N),r.call(x+"_mul",V,q,Bt),r.call(x+"_mul",Z,_,M),r.call(x+"_sub",M,Bt,M),r.call(x+"_mul",M,r.i32_const(et),M),r.call(x+"_neg",Z,X))}function yt(){const G=t.addFunction(o+"_prepDblStep");G.addParam("pR","i32"),G.addParam("pCoef","i32");const r=G.getCodeBuilder(),_=r.getLocal("pR"),q=r.i32_add(r.getLocal("pR"),r.i32_const(s)),z=r.i32_add(r.getLocal("pR"),r.i32_const(2*s)),S=r.getLocal("pCoef"),N=r.i32_add(r.getLocal("pCoef"),r.i32_const(s)),M=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*s)),W=r.i32_const(t.alloc(s)),X=r.i32_const(t.alloc(s)),V=r.i32_const(t.alloc(s)),Z=r.i32_const(t.alloc(s)),tt=r.i32_const(t.alloc(s)),ft=r.i32_const(t.alloc(s)),_t=r.i32_const(t.alloc(s)),it=r.i32_const(t.alloc(s)),mt=r.i32_const(t.alloc(s)),Bt=r.i32_const(t.alloc(s)),St=r.i32_const(t.alloc(s)),wt=r.i32_const(t.alloc(s));G.addCode(r.call(x+"_mul",q,r.i32_const(U),W),r.call(x+"_mul",_,W,W),r.call(x+"_square",q,X),r.call(x+"_square",z,V),r.call(x+"_add",V,V,Z),r.call(x+"_add",Z,V,Z),r.call(x+"_mul",r.i32_const(Y),Z,tt),r.call(x+"_add",tt,tt,ft),r.call(x+"_add",tt,ft,ft),r.call(x+"_add",X,ft,_t),r.call(x+"_mul",_t,r.i32_const(U),_t),r.call(x+"_add",X,V,wt),r.call(x+"_add",q,z,it),r.call(x+"_square",it,it),r.call(x+"_sub",it,wt,it),r.call(x+"_sub",tt,X,mt),r.call(x+"_square",_,Bt),r.call(x+"_square",tt,St),r.call(x+"_sub",X,ft,wt),r.call(x+"_mul",W,wt,_),r.call(x+"_add",St,St,wt),r.call(x+"_add",St,wt,wt),r.call(x+"_square",_t,q),r.call(x+"_sub",q,wt,q),r.call(x+"_mul",X,it,z),r.call(x+"_mul",r.i32_const(et),mt,S),r.call(x+"_neg",it,N),r.call(x+"_add",Bt,Bt,M),r.call(x+"_add",Bt,M,M))}function dt(){const G=t.addFunction(o+"_mulByQ");G.addParam("p1","i32"),G.addParam("pr","i32");const r=G.getCodeBuilder(),_=r.getLocal("p1"),q=r.i32_add(r.getLocal("p1"),r.i32_const(s)),z=r.i32_add(r.getLocal("p1"),r.i32_const(s*2)),S=r.getLocal("pr"),N=r.i32_add(r.getLocal("pr"),r.i32_const(s)),M=r.i32_add(r.getLocal("pr"),r.i32_const(s*2)),W=r.i32_const(t.alloc([...At.bigInt2BytesLE(E("21575463638280843010398324269430826099269044274347216827212613867836435027261"),g),...At.bigInt2BytesLE(E("10307601595873709700152284273816112264069230130616436755625194854815875713954"),g)])),X=r.i32_const(t.alloc([...At.bigInt2BytesLE(E("2821565182194536844548159561693502659359617185244120367078079554186484126554"),g),...At.bigInt2BytesLE(E("3505843767911556378687030309984248845540243509899259641013678093033130930403"),g)]));G.addCode(r.call(x+"_conjugate",_,S),r.call(x+"_mul",W,S,S),r.call(x+"_conjugate",q,N),r.call(x+"_mul",X,N,N),r.call(x+"_conjugate",z,M))}function Lt(){dt();const G=t.addFunction(o+"_prepareG2");G.addParam("pQ","i32"),G.addParam("ppreQ","i32"),G.addLocal("pCoef","i32"),G.addLocal("i","i32");const r=G.getCodeBuilder(),_=r.getLocal("pQ"),q=t.alloc(s*3),z=r.i32_const(q),S=r.i32_const(q),N=r.i32_const(q+s),M=r.i32_const(q+2*s),W=r.i32_add(r.getLocal("ppreQ"),r.i32_const(0)),X=r.i32_add(r.getLocal("ppreQ"),r.i32_const(s)),V=t.alloc(s*3),Z=r.i32_const(V),tt=t.alloc(s*3),ft=r.i32_const(tt),_t=r.i32_const(tt+s);G.addCode(r.call(B+"_normalize",_,W),r.call(x+"_copy",W,S),r.call(x+"_copy",X,N),r.call(x+"_one",M)),G.addCode(r.setLocal("pCoef",r.i32_add(r.getLocal("ppreQ"),r.i32_const(s*3))),r.setLocal("i",r.i32_const(vt.length-2)),r.block(r.loop(r.call(o+"_prepDblStep",z,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))),r.if(r.i32_load8_s(r.getLocal("i"),ht),[...r.call(o+"_prepAddStep",W,z,r.getLocal("pCoef")),...r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A)))]),r.br_if(1,r.i32_eqz(r.getLocal("i"))),r.setLocal("i",r.i32_sub(r.getLocal("i"),r.i32_const(1))),r.br(0)))),G.addCode(r.call(o+"_mulByQ",W,Z),r.call(o+"_mulByQ",Z,ft)),G.addCode(r.call(x+"_neg",_t,_t),r.call(o+"_prepAddStep",Z,z,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))),r.call(o+"_prepAddStep",ft,z,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))))}function It(){const G=t.addFunction(o+"__mulBy024Old");G.addParam("pEll0","i32"),G.addParam("pEllVW","i32"),G.addParam("pEllVV","i32"),G.addParam("pR","i32");const r=G.getCodeBuilder(),_=r.getLocal("pEll0"),q=r.getLocal("pEllVV"),z=r.getLocal("pEllVW"),S=r.getLocal("pR"),N=t.alloc(y),M=r.i32_const(N),W=r.i32_const(N),X=r.i32_const(N+s),V=r.i32_const(N+s*2),Z=r.i32_const(N+s*3),tt=r.i32_const(N+s*4),ft=r.i32_const(N+s*5);G.addCode(r.call(x+"_copy",_,W),r.call(x+"_zero",X),r.call(x+"_copy",q,V),r.call(x+"_zero",Z),r.call(x+"_copy",z,tt),r.call(x+"_zero",ft),r.call(at+"_mul",M,S,S))}function gt(){const G=t.addFunction(o+"__mulBy024");G.addParam("pEll0","i32"),G.addParam("pEllVW","i32"),G.addParam("pEllVV","i32"),G.addParam("pR","i32");const r=G.getCodeBuilder(),_=r.getLocal("pEll0"),q=r.getLocal("pEllVV"),z=r.getLocal("pEllVW"),S=r.getLocal("pR"),N=r.i32_add(r.getLocal("pR"),r.i32_const(2*d)),M=r.i32_add(r.getLocal("pR"),r.i32_const(4*d)),W=r.i32_add(r.getLocal("pR"),r.i32_const(6*d)),X=r.i32_add(r.getLocal("pR"),r.i32_const(8*d)),V=r.i32_add(r.getLocal("pR"),r.i32_const(10*d)),Z=r.i32_const(t.alloc(s)),tt=r.i32_const(t.alloc(s)),ft=r.i32_const(t.alloc(s)),_t=r.i32_const(t.alloc(s)),it=r.i32_const(t.alloc(s)),mt=r.i32_const(t.alloc(s)),Bt=r.i32_const(t.alloc(s)),St=r.i32_const(t.alloc(s)),wt=r.i32_const(t.alloc(s)),Ct=r.i32_const(t.alloc(s)),pt=r.i32_const(t.alloc(s));G.addCode(r.call(x+"_mul",S,_,Bt),r.call(x+"_mul",M,q,St),r.call(x+"_mul",X,z,wt),r.call(x+"_add",S,X,ft),r.call(x+"_add",S,M,tt),r.call(x+"_add",N,W,_t),r.call(x+"_add",_t,V,_t),r.call(x+"_mul",N,q,Ct),r.call(x+"_add",Ct,wt,it),r.call(x+"_mul",r.i32_const(I),it,mt),r.call(x+"_add",mt,Bt,S),r.call(x+"_mul",V,z,it),r.call(x+"_add",Ct,it,Ct),r.call(x+"_add",it,St,it),r.call(x+"_mul",r.i32_const(I),it,mt),r.call(x+"_mul",N,_,it),r.call(x+"_add",Ct,it,Ct),r.call(x+"_add",mt,it,N),r.call(x+"_add",_,q,Z),r.call(x+"_mul",tt,Z,it),r.call(x+"_add",Bt,St,pt),r.call(x+"_sub",it,pt,it),r.call(x+"_mul",W,z,mt),r.call(x+"_add",Ct,mt,Ct),r.call(x+"_add",M,X,Z),r.call(x+"_add",it,mt,M),r.call(x+"_add",q,z,tt),r.call(x+"_mul",tt,Z,it),r.call(x+"_add",St,wt,pt),r.call(x+"_sub",it,pt,it),r.call(x+"_mul",r.i32_const(I),it,mt),r.call(x+"_mul",W,_,it),r.call(x+"_add",Ct,it,Ct),r.call(x+"_add",mt,it,W),r.call(x+"_mul",V,q,it),r.call(x+"_add",Ct,it,Ct),r.call(x+"_mul",r.i32_const(I),it,mt),r.call(x+"_add",_,z,Z),r.call(x+"_mul",ft,Z,it),r.call(x+"_add",Bt,wt,pt),r.call(x+"_sub",it,pt,it),r.call(x+"_add",mt,it,X),r.call(x+"_add",_,q,Z),r.call(x+"_add",Z,z,Z),r.call(x+"_mul",_t,Z,it),r.call(x+"_sub",it,Ct,V))}function lt(){const G=t.addFunction(o+"_millerLoop");G.addParam("ppreP","i32"),G.addParam("ppreQ","i32"),G.addParam("r","i32"),G.addLocal("pCoef","i32"),G.addLocal("i","i32");const r=G.getCodeBuilder(),_=r.getLocal("ppreP"),q=r.i32_add(r.getLocal("ppreP"),r.i32_const(g)),z=r.getLocal("pCoef"),S=r.i32_add(r.getLocal("pCoef"),r.i32_const(s)),N=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*s)),M=t.alloc(s),W=r.i32_const(M),X=t.alloc(s),V=r.i32_const(X),Z=r.getLocal("r");G.addCode(r.call(at+"_one",Z),r.setLocal("pCoef",r.i32_add(r.getLocal("ppreQ"),r.i32_const(s*3))),r.setLocal("i",r.i32_const(vt.length-2)),r.block(r.loop(r.call(at+"_square",Z,Z),r.call(x+"_mul1",S,q,W),r.call(x+"_mul1",N,_,V),r.call(o+"__mulBy024",z,W,V,Z),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))),r.if(r.i32_load8_s(r.getLocal("i"),ht),[...r.call(x+"_mul1",S,q,W),...r.call(x+"_mul1",N,_,V),...r.call(o+"__mulBy024",z,W,V,Z),...r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A)))]),r.br_if(1,r.i32_eqz(r.getLocal("i"))),r.setLocal("i",r.i32_sub(r.getLocal("i"),r.i32_const(1))),r.br(0)))),G.addCode(r.call(x+"_mul1",S,q,W),r.call(x+"_mul1",N,_,V),r.call(o+"__mulBy024",z,W,V,Z),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))),r.call(x+"_mul1",S,q,W),r.call(x+"_mul1",N,_,V),r.call(o+"__mulBy024",z,W,V,Z),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(A))))}function bt(G){const r=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[8376118865763821496583973867626364092589906065868298776909617916018768340080n,16469823323077808223889137241176536799009286646108169935659301613961712198316n],[21888242871839275220042445260109153167277707414472061641714758635765020556617n,0n],[11697423496358154304825782922584725312912383441159505038794027105778954184319n,303847389135065887422783454877609941456349188919719272345083954437860409601n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[3321304630594332808241809054958361220322477375291206261884409189760185844239n,5722266937896532885780051958958348231143373700109372999374820235121374419868n],[21888242871839275222246405745257275088696311157297823662689037894645226208582n,0n],[13512124006075453725662431877630910996106405091429524885779419978626457868503n,5418419548761466998357268504080738289687024511189653727029736280683514010267n],[2203960485148121921418603742825762020974279258880205651966n,0n],[10190819375481120917420622822672549775783927716138318623895010788866272024264n,21584395482704209334823622290379665147239961968378104390343953940207365798982n],[2203960485148121921418603742825762020974279258880205651967n,0n],[18566938241244942414004596690298913868373833782006617400804628704885040364344n,16165975933942742336466353786298926857552937457188450663314217659523851788715n]]],_=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[21575463638280843010398324269430826099269044274347216827212613867836435027261n,10307601595873709700152284273816112264069230130616436755625194854815875713954n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[3772000881919853776433695186713858239009073593817195771773381919316419345261n,2236595495967245188281701248203181795121068902605861227855261137820944008926n],[2203960485148121921418603742825762020974279258880205651966n,0n],[18429021223477853657660792034369865839114504446431234726392080002137598044644n,9344045779998320333812420223237981029506012124075525679208581902008406485703n]],[[1n,0n],[2581911344467009335267311115468803099551665605076196740867805258568234346338n,19937756971775647987995932169929341994314640652964949448313374472400716661030n],[2203960485148121921418603742825762020974279258880205651966n,0n],[5324479202449903542726783395506214481928257762400643279780343368557297135718n,16208900380737693084919495127334387981393726419856888799917914180988844123039n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[13981852324922362344252311234282257507216387789820983642040889267519694726527n,7629828391165209371577384193250820201684255241773809077146787135900891633097n]]],q=t.addFunction(o+"__frobeniusMap"+G);q.addParam("x","i32"),q.addParam("r","i32");const z=q.getCodeBuilder();for(let N=0;N<6;N++){const M=N==0?z.getLocal("x"):z.i32_add(z.getLocal("x"),z.i32_const(N*s)),W=M,X=z.i32_add(z.getLocal("x"),z.i32_const(N*s+g)),V=N==0?z.getLocal("r"):z.i32_add(z.getLocal("r"),z.i32_const(N*s)),Z=V,tt=z.i32_add(z.getLocal("r"),z.i32_const(N*s+g)),ft=S(r[Math.floor(N/3)][G%12],_[N%3][G%6]),_t=t.alloc([...At.bigInt2BytesLE(E(ft[0]),32),...At.bigInt2BytesLE(E(ft[1]),32)]);G%2==1?q.addCode(z.call(h+"_copy",W,Z),z.call(h+"_neg",X,tt),z.call(x+"_mul",V,z.i32_const(_t),V)):q.addCode(z.call(x+"_mul",M,z.i32_const(_t),V))}function S(N,M){const W=BigInt(N[0]),X=BigInt(N[1]),V=BigInt(M[0]),Z=BigInt(M[1]),tt=[(W*V-X*Z)%e,(W*Z+X*V)%e];return Vi(tt[0])&&(tt[0]=tt[0]+e),tt}}function Et(){const G=t.addFunction(o+"__finalExponentiationFirstChunk");G.addParam("x","i32"),G.addParam("r","i32");const r=G.getCodeBuilder(),_=r.getLocal("x"),q=_,z=r.i32_add(_,r.i32_const(d*6)),S=r.getLocal("r"),N=t.alloc(y),M=r.i32_const(N),W=M,X=r.i32_const(N+d*6),V=r.i32_const(t.alloc(y)),Z=r.i32_const(t.alloc(y)),tt=r.i32_const(t.alloc(y));G.addCode(r.call(ct+"_copy",q,W),r.call(ct+"_neg",z,X),r.call(at+"_inverse",_,V),r.call(at+"_mul",M,V,Z),r.call(o+"__frobeniusMap2",Z,tt),r.call(at+"_mul",Z,tt,S))}function Tt(){const G=t.addFunction(o+"__cyclotomicSquare");G.addParam("x","i32"),G.addParam("r","i32");const r=G.getCodeBuilder(),_=r.getLocal("x"),q=r.i32_add(r.getLocal("x"),r.i32_const(s)),z=r.i32_add(r.getLocal("x"),r.i32_const(2*s)),S=r.i32_add(r.getLocal("x"),r.i32_const(3*s)),N=r.i32_add(r.getLocal("x"),r.i32_const(4*s)),M=r.i32_add(r.getLocal("x"),r.i32_const(5*s)),W=r.getLocal("r"),X=r.i32_add(r.getLocal("r"),r.i32_const(s)),V=r.i32_add(r.getLocal("r"),r.i32_const(2*s)),Z=r.i32_add(r.getLocal("r"),r.i32_const(3*s)),tt=r.i32_add(r.getLocal("r"),r.i32_const(4*s)),ft=r.i32_add(r.getLocal("r"),r.i32_const(5*s)),_t=r.i32_const(t.alloc(s)),it=r.i32_const(t.alloc(s)),mt=r.i32_const(t.alloc(s)),Bt=r.i32_const(t.alloc(s)),St=r.i32_const(t.alloc(s)),wt=r.i32_const(t.alloc(s)),Ct=r.i32_const(t.alloc(s)),pt=r.i32_const(t.alloc(s));G.addCode(r.call(x+"_mul",_,N,Ct),r.call(x+"_mul",N,r.i32_const(I),_t),r.call(x+"_add",_,_t,_t),r.call(x+"_add",_,N,pt),r.call(x+"_mul",pt,_t,_t),r.call(x+"_mul",r.i32_const(I),Ct,pt),r.call(x+"_add",Ct,pt,pt),r.call(x+"_sub",_t,pt,_t),r.call(x+"_add",Ct,Ct,it),r.call(x+"_mul",S,z,Ct),r.call(x+"_mul",z,r.i32_const(I),mt),r.call(x+"_add",S,mt,mt),r.call(x+"_add",S,z,pt),r.call(x+"_mul",pt,mt,mt),r.call(x+"_mul",r.i32_const(I),Ct,pt),r.call(x+"_add",Ct,pt,pt),r.call(x+"_sub",mt,pt,mt),r.call(x+"_add",Ct,Ct,Bt),r.call(x+"_mul",q,M,Ct),r.call(x+"_mul",M,r.i32_const(I),St),r.call(x+"_add",q,St,St),r.call(x+"_add",q,M,pt),r.call(x+"_mul",pt,St,St),r.call(x+"_mul",r.i32_const(I),Ct,pt),r.call(x+"_add",Ct,pt,pt),r.call(x+"_sub",St,pt,St),r.call(x+"_add",Ct,Ct,wt),r.call(x+"_sub",_t,_,W),r.call(x+"_add",W,W,W),r.call(x+"_add",_t,W,W),r.call(x+"_add",it,N,tt),r.call(x+"_add",tt,tt,tt),r.call(x+"_add",it,tt,tt),r.call(x+"_mul",wt,r.i32_const(et),pt),r.call(x+"_add",pt,S,Z),r.call(x+"_add",Z,Z,Z),r.call(x+"_add",pt,Z,Z),r.call(x+"_sub",St,z,V),r.call(x+"_add",V,V,V),r.call(x+"_add",St,V,V),r.call(x+"_sub",mt,q,X),r.call(x+"_add",X,X,X),r.call(x+"_add",mt,X,X),r.call(x+"_add",Bt,M,ft),r.call(x+"_add",ft,ft,ft),r.call(x+"_add",Bt,ft,ft))}function Yt(G,r){const _=D(G).map(X=>X==-1?255:X),q=t.alloc(_),z=t.addFunction(o+"__cyclotomicExp_"+r);z.addParam("x","i32"),z.addParam("r","i32"),z.addLocal("bit","i32"),z.addLocal("i","i32");const S=z.getCodeBuilder(),N=S.getLocal("x"),M=S.getLocal("r"),W=S.i32_const(t.alloc(y));z.addCode(S.call(at+"_conjugate",N,W),S.call(at+"_one",M),S.if(S.teeLocal("bit",S.i32_load8_s(S.i32_const(_.length-1),q)),S.if(S.i32_eq(S.getLocal("bit"),S.i32_const(1)),S.call(at+"_mul",M,N,M),S.call(at+"_mul",M,W,M))),S.setLocal("i",S.i32_const(_.length-2)),S.block(S.loop(S.call(o+"__cyclotomicSquare",M,M),S.if(S.teeLocal("bit",S.i32_load8_s(S.getLocal("i"),q)),S.if(S.i32_eq(S.getLocal("bit"),S.i32_const(1)),S.call(at+"_mul",M,N,M),S.call(at+"_mul",M,W,M))),S.br_if(1,S.i32_eqz(S.getLocal("i"))),S.setLocal("i",S.i32_sub(S.getLocal("i"),S.i32_const(1))),S.br(0))))}function jt(){Tt(),Yt(p,"w0");const G=t.addFunction(o+"__finalExponentiationLastChunk");G.addParam("x","i32"),G.addParam("r","i32");const r=G.getCodeBuilder(),_=r.getLocal("x"),q=r.getLocal("r"),z=r.i32_const(t.alloc(y)),S=r.i32_const(t.alloc(y)),N=r.i32_const(t.alloc(y)),M=r.i32_const(t.alloc(y)),W=r.i32_const(t.alloc(y)),X=r.i32_const(t.alloc(y)),V=r.i32_const(t.alloc(y)),Z=r.i32_const(t.alloc(y)),tt=r.i32_const(t.alloc(y)),ft=r.i32_const(t.alloc(y)),_t=r.i32_const(t.alloc(y)),it=r.i32_const(t.alloc(y)),mt=r.i32_const(t.alloc(y)),Bt=r.i32_const(t.alloc(y)),St=r.i32_const(t.alloc(y)),wt=r.i32_const(t.alloc(y)),Ct=r.i32_const(t.alloc(y)),pt=r.i32_const(t.alloc(y)),qt=r.i32_const(t.alloc(y)),Vt=r.i32_const(t.alloc(y)),rn=r.i32_const(t.alloc(y));G.addCode(r.call(o+"__cyclotomicExp_w0",_,z),r.call(at+"_conjugate",z,z),r.call(o+"__cyclotomicSquare",z,S),r.call(o+"__cyclotomicSquare",S,N),r.call(at+"_mul",N,S,M),r.call(o+"__cyclotomicExp_w0",M,W),r.call(at+"_conjugate",W,W),r.call(o+"__cyclotomicSquare",W,X),r.call(o+"__cyclotomicExp_w0",X,V),r.call(at+"_conjugate",V,V),r.call(at+"_conjugate",M,Z),r.call(at+"_conjugate",V,tt),r.call(at+"_mul",tt,W,ft),r.call(at+"_mul",ft,Z,_t),r.call(at+"_mul",_t,S,it),r.call(at+"_mul",_t,W,mt),r.call(at+"_mul",mt,_,Bt),r.call(o+"__frobeniusMap1",it,St),r.call(at+"_mul",St,Bt,wt),r.call(o+"__frobeniusMap2",_t,Ct),r.call(at+"_mul",Ct,wt,pt),r.call(at+"_conjugate",_,qt),r.call(at+"_mul",qt,it,Vt),r.call(o+"__frobeniusMap3",Vt,rn),r.call(at+"_mul",rn,pt,q))}function tn(){Et(),jt();const G=t.addFunction(o+"_finalExponentiation");G.addParam("x","i32"),G.addParam("r","i32");const r=G.getCodeBuilder(),_=r.getLocal("x"),q=r.getLocal("r"),z=r.i32_const(t.alloc(y));G.addCode(r.call(o+"__finalExponentiationFirstChunk",_,z),r.call(o+"__finalExponentiationLastChunk",z,q))}function Rt(){const G=t.addFunction(o+"_finalExponentiationOld");G.addParam("x","i32"),G.addParam("r","i32");const _=t.alloc(At.bigInt2BytesLE(552484233613224096312617126783173147097382103762957654188882734314196910839907541213974502761540629817009608548654680343627701153829446747810907373256841551006201639677726139946029199968412598804882391702273019083653272047566316584365559776493027495458238373902875937659943504873220554161550525926302303331747463515644711876653177129578303191095900909191624817826566688241804408081892785725967931714097716709526092261278071952560171111444072049229123565057483750161460024353346284167282452756217662335528813519139808291170539072125381230815729071544861602750936964829313608137325426383735122175229541155376346436093930287402089517426973178917569713384748081827255472576937471496195752727188261435633271238710131736096299798168852925540549342330775279877006784354801422249722573783561685179618816480037695005515426162362431072245638324744480n,352)),q=G.getCodeBuilder();G.addCode(q.call(at+"_exp",q.getLocal("x"),q.i32_const(_),q.i32_const(352),q.getLocal("r")))}const Dt=t.alloc(R),Xt=t.alloc(v);function yn(G){const r=t.addFunction(o+"_pairingEq"+G);for(let S=0;S<G;S++)r.addParam("p_"+S,"i32"),r.addParam("q_"+S,"i32");r.addParam("c","i32"),r.setReturnType("i32");const _=r.getCodeBuilder(),q=_.i32_const(t.alloc(y)),z=_.i32_const(t.alloc(y));r.addCode(_.call(at+"_one",q));for(let S=0;S<G;S++)r.addCode(_.call(o+"_prepareG1",_.getLocal("p_"+S),_.i32_const(Dt))),r.addCode(_.call(o+"_prepareG2",_.getLocal("q_"+S),_.i32_const(Xt))),r.addCode(_.call(o+"_millerLoop",_.i32_const(Dt),_.i32_const(Xt),z)),r.addCode(_.call(at+"_mul",q,z,q));r.addCode(_.call(o+"_finalExponentiation",q,q)),r.addCode(_.call(at+"_eq",q,_.getLocal("c")))}function an(){const G=t.addFunction(o+"_pairing");G.addParam("p","i32"),G.addParam("q","i32"),G.addParam("r","i32");const r=G.getCodeBuilder(),_=r.i32_const(t.alloc(y));G.addCode(r.call(o+"_prepareG1",r.getLocal("p"),r.i32_const(Dt))),G.addCode(r.call(o+"_prepareG2",r.getLocal("q"),r.i32_const(Xt))),G.addCode(r.call(o+"_millerLoop",r.i32_const(Dt),r.i32_const(Xt),_)),G.addCode(r.call(o+"_finalExponentiation",_,r.getLocal("r")))}rt(),yt(),st(),Lt(),gt(),It(),lt();for(let G=0;G<10;G++)bt(G),t.exportFunction(o+"__frobeniusMap"+G);Rt(),tn();for(let G=1;G<=5;G++)yn(G),t.exportFunction(o+"_pairingEq"+G);an(),t.exportFunction(o+"_pairing"),t.exportFunction(o+"_prepareG1"),t.exportFunction(o+"_prepareG2"),t.exportFunction(o+"_millerLoop"),t.exportFunction(o+"_finalExponentiation"),t.exportFunction(o+"_finalExponentiationOld"),t.exportFunction(o+"__mulBy024"),t.exportFunction(o+"__mulBy024Old"),t.exportFunction(o+"__cyclotomicSquare"),t.exportFunction(o+"__cyclotomicExp_w0")};const xt=gn,Qi=$o,Ji=ta,le=na,Yi=oa,re=ea,ho=aa,tc=ia,nc=ca,qn=sa,{bitLength:de,isOdd:ue,isNegative:oc}=$t;var ec=function(t,n){const o=n||"bls12381";if(t.modules[o])return o;const e=0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaabn,c=0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001n,f=Math.floor((de(e-1n)-1)/64)+1,d=f*8,b=d,g=b*2,s=b*12,y=Math.floor((de(c-1n)-1)/64)+1,w=y*8,h=w,T=t.alloc(xt.bigInt2BytesLE(c,h)),k=Qi(t,e,"f1m","intq");Ji(t,c,"fr","frm","intr");const x=t.alloc(xt.bigInt2BytesLE(C(4n),b)),O=re(t,"g1m","f1m",x);ho(t,"frm","frm","frm","frm_mul"),tc(t,"pol","frm"),nc(t,"qap","frm");const B=le(t,"f1m_neg","f2m","f1m"),Q=t.alloc([...xt.bigInt2BytesLE(C(4n),b),...xt.bigInt2BytesLE(C(4n),b)]),E=re(t,"g2m","f2m",Q);function nt(r,_){const q=t.addFunction(r);q.addParam("pG","i32"),q.addParam("pFr","i32"),q.addParam("pr","i32");const z=q.getCodeBuilder(),S=z.i32_const(t.alloc(w));q.addCode(z.call("frm_fromMontgomery",z.getLocal("pFr"),S),z.call(_,z.getLocal("pG"),S,z.i32_const(w),z.getLocal("pr"))),t.exportFunction(r)}nt("g1m_timesFr","g1m_timesScalar"),ho(t,"g1m","g1m","frm","g1m_timesFr"),nt("g2m_timesFr","g2m_timesScalar"),ho(t,"g2m","g2m","frm","g2m_timesFr"),nt("g1m_timesFrAffine","g1m_timesScalarAffine"),nt("g2m_timesFrAffine","g2m_timesScalarAffine"),qn(t,"frm_batchApplyKey","fmr","frm",w,w,w,"frm_mul"),qn(t,"g1m_batchApplyKey","g1m","frm",d*3,d*3,w,"g1m_timesFr"),qn(t,"g1m_batchApplyKeyMixed","g1m","frm",d*2,d*3,w,"g1m_timesFrAffine"),qn(t,"g2m_batchApplyKey","g2m","frm",d*2*3,d*3*2,w,"g2m_timesFr"),qn(t,"g2m_batchApplyKeyMixed","g2m","frm",d*2*2,d*3*2,w,"g2m_timesFrAffine");function C(r){return BigInt(r)*(1n<<BigInt(b*8))%e}const u=[3685416753713387016781088315183077757961620795782546409894578378688607592378376318836054947676345821548104185464507n,1339506544944476473020471379941921221584933875938349620426543736416511423956333506472724655353366534992391756441569n,1n],L=t.alloc([...xt.bigInt2BytesLE(C(u[0]),b),...xt.bigInt2BytesLE(C(u[1]),b),...xt.bigInt2BytesLE(C(u[2]),b)]),$=[0n,1n,0n],K=t.alloc([...xt.bigInt2BytesLE(C($[0]),b),...xt.bigInt2BytesLE(C($[1]),b),...xt.bigInt2BytesLE(C($[2]),b)]),J=[[352701069587466618187139116011060144890029952792775240219908644239793785735715026873347600343865175952761926303160n,3059144344244213709971259814753781636986470325476647558659373206291635324768958432433509563104347017837885763365758n],[1985150602287291935568054521177171638300868978215655730859378665066344726373823718423869104263333984641494340347905n,927553665492332455747201965776037880757740193453592970025027978793976877002675564980949289727957565575433344219582n],[1n,0n]],P=t.alloc([...xt.bigInt2BytesLE(C(J[0][0]),b),...xt.bigInt2BytesLE(C(J[0][1]),b),...xt.bigInt2BytesLE(C(J[1][0]),b),...xt.bigInt2BytesLE(C(J[1][1]),b),...xt.bigInt2BytesLE(C(J[2][0]),b),...xt.bigInt2BytesLE(C(J[2][1]),b)]),m=[[0n,0n],[1n,0n],[0n,0n]],I=t.alloc([...xt.bigInt2BytesLE(C(m[0][0]),b),...xt.bigInt2BytesLE(C(m[0][1]),b),...xt.bigInt2BytesLE(C(m[1][0]),b),...xt.bigInt2BytesLE(C(m[1][1]),b),...xt.bigInt2BytesLE(C(m[2][0]),b),...xt.bigInt2BytesLE(C(m[2][1]),b)]),U=t.alloc([...xt.bigInt2BytesLE(C(1n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b),...xt.bigInt2BytesLE(C(0n),b)]),et=t.alloc([...xt.bigInt2BytesLE(C(1n),b),...xt.bigInt2BytesLE(C(1n),b)]);function Y(){const r=t.addFunction(B+"_mulNR");r.addParam("x","i32"),r.addParam("pr","i32");const _=r.getCodeBuilder(),q=_.i32_const(t.alloc(b)),z=_.getLocal("x"),S=_.i32_add(_.getLocal("x"),_.i32_const(b)),N=_.getLocal("pr"),M=_.i32_add(_.getLocal("pr"),_.i32_const(b));r.addCode(_.call(k+"_copy",z,q),_.call(k+"_sub",z,S,N),_.call(k+"_add",q,S,M))}Y();const j=Yi(t,B+"_mulNR","f6m","f2m");function ct(){const r=t.addFunction(j+"_mulNR");r.addParam("x","i32"),r.addParam("pr","i32");const _=r.getCodeBuilder(),q=_.i32_const(t.alloc(b*2));r.addCode(_.call(B+"_copy",_.getLocal("x"),q),_.call(B+"_mulNR",_.i32_add(_.getLocal("x"),_.i32_const(d*4)),_.getLocal("pr")),_.call(B+"_copy",_.i32_add(_.getLocal("x"),_.i32_const(d*2)),_.i32_add(_.getLocal("pr"),_.i32_const(d*4))),_.call(B+"_copy",q,_.i32_add(_.getLocal("pr"),_.i32_const(d*2))))}ct();const H=le(t,j+"_mulNR","ftm",j),Pt=ut(0xd201000000010000n),vt=t.alloc(Pt),ht=3*g,A=Pt.length-1,F=Pt.reduce((r,_)=>r+(_!=0?1:0),0)+A+1,l=3*2*d,R=3*d*2+F*ht,v=!0,p=15132376222941642752n;t.modules[o]={n64q:f,n64r:y,n8q:d,n8r:w,pG1gen:L,pG1zero:K,pG1b:x,pG2gen:P,pG2zero:I,pG2b:Q,pq:t.modules.f1m.pq,pr:T,pOneT:U,r:c,q:e,prePSize:l,preQSize:R};function D(r){let _=r;const q=[];for(;_>0n;){if(ue(_)){const z=2-Number(_%4n);q.push(z),_=_-BigInt(z)}else q.push(0);_=_>>1n}return q}function ut(r){let _=r;const q=[];for(;_>0n;)ue(_)?q.push(1):q.push(0),_=_>>1n;return q}function st(){const r=t.addFunction(o+"_prepareG1");r.addParam("pP","i32"),r.addParam("ppreP","i32");const _=r.getCodeBuilder();r.addCode(_.call(O+"_normalize",_.getLocal("pP"),_.getLocal("ppreP")))}function rt(){const r=t.addFunction(o+"_prepDblStep");r.addParam("R","i32"),r.addParam("r","i32");const _=r.getCodeBuilder(),q=_.getLocal("R"),z=_.i32_add(_.getLocal("R"),_.i32_const(2*d)),S=_.i32_add(_.getLocal("R"),_.i32_const(4*d)),N=_.getLocal("r"),M=_.i32_add(_.getLocal("r"),_.i32_const(2*d)),W=_.i32_add(_.getLocal("r"),_.i32_const(4*d)),X=_.i32_const(t.alloc(g)),V=_.i32_const(t.alloc(g)),Z=_.i32_const(t.alloc(g)),tt=_.i32_const(t.alloc(g)),ft=_.i32_const(t.alloc(g));r.addCode(_.call(B+"_square",q,N),_.call(B+"_square",z,V),_.call(B+"_square",V,Z),_.call(B+"_add",V,q,M),_.call(B+"_square",M,M),_.call(B+"_sub",M,N,M),_.call(B+"_sub",M,Z,M),_.call(B+"_add",M,M,M),_.call(B+"_add",N,N,tt),_.call(B+"_add",tt,N,tt),_.call(B+"_add",q,tt,W),_.call(B+"_square",tt,ft),_.call(B+"_square",S,X),_.call(B+"_sub",ft,M,q),_.call(B+"_sub",q,M,q),_.call(B+"_add",S,z,S),_.call(B+"_square",S,S),_.call(B+"_sub",S,V,S),_.call(B+"_sub",S,X,S),_.call(B+"_sub",M,q,z),_.call(B+"_mul",z,tt,z),_.call(B+"_add",Z,Z,Z),_.call(B+"_add",Z,Z,Z),_.call(B+"_add",Z,Z,Z),_.call(B+"_sub",z,Z,z),_.call(B+"_mul",tt,X,M),_.call(B+"_add",M,M,M),_.call(B+"_neg",M,M),_.call(B+"_square",W,W),_.call(B+"_sub",W,N,W),_.call(B+"_sub",W,ft,W),_.call(B+"_add",V,V,V),_.call(B+"_add",V,V,V),_.call(B+"_sub",W,V,W),_.call(B+"_mul",S,X,N),_.call(B+"_add",N,N,N))}function yt(){const r=t.addFunction(o+"_prepAddStep");r.addParam("R","i32"),r.addParam("Q","i32"),r.addParam("r","i32");const _=r.getCodeBuilder(),q=_.getLocal("R"),z=_.i32_add(_.getLocal("R"),_.i32_const(2*d)),S=_.i32_add(_.getLocal("R"),_.i32_const(4*d)),N=_.getLocal("Q"),M=_.i32_add(_.getLocal("Q"),_.i32_const(2*d)),W=_.getLocal("r"),X=_.i32_add(_.getLocal("r"),_.i32_const(2*d)),V=_.i32_add(_.getLocal("r"),_.i32_const(4*d)),Z=_.i32_const(t.alloc(g)),tt=_.i32_const(t.alloc(g)),ft=_.i32_const(t.alloc(g)),_t=_.i32_const(t.alloc(g)),it=_.i32_const(t.alloc(g)),mt=_.i32_const(t.alloc(g)),Bt=_.i32_const(t.alloc(g)),St=_.i32_const(t.alloc(g)),wt=_.i32_const(t.alloc(g)),Ct=_.i32_const(t.alloc(g)),pt=_.i32_const(t.alloc(g));r.addCode(_.call(B+"_square",S,Z),_.call(B+"_square",M,tt),_.call(B+"_mul",Z,N,_t),_.call(B+"_add",M,S,X),_.call(B+"_square",X,X),_.call(B+"_sub",X,tt,X),_.call(B+"_sub",X,Z,X),_.call(B+"_mul",X,Z,X),_.call(B+"_sub",_t,q,it),_.call(B+"_square",it,mt),_.call(B+"_add",mt,mt,Bt),_.call(B+"_add",Bt,Bt,Bt),_.call(B+"_mul",Bt,it,St),_.call(B+"_sub",X,z,wt),_.call(B+"_sub",wt,z,wt),_.call(B+"_mul",wt,N,V),_.call(B+"_mul",Bt,q,Ct),_.call(B+"_square",wt,q),_.call(B+"_sub",q,St,q),_.call(B+"_sub",q,Ct,q),_.call(B+"_sub",q,Ct,q),_.call(B+"_add",S,it,S),_.call(B+"_square",S,S),_.call(B+"_sub",S,Z,S),_.call(B+"_sub",S,mt,S),_.call(B+"_add",M,S,W),_.call(B+"_sub",Ct,q,pt),_.call(B+"_mul",pt,wt,pt),_.call(B+"_mul",z,St,_t),_.call(B+"_add",_t,_t,_t),_.call(B+"_sub",pt,_t,z),_.call(B+"_square",W,W),_.call(B+"_sub",W,tt,W),_.call(B+"_square",S,ft),_.call(B+"_sub",W,ft,W),_.call(B+"_add",V,V,V),_.call(B+"_sub",V,W,V),_.call(B+"_add",S,S,W),_.call(B+"_neg",wt,wt),_.call(B+"_add",wt,wt,X))}function dt(){const r=t.addFunction(o+"_prepareG2");r.addParam("pQ","i32"),r.addParam("ppreQ","i32"),r.addLocal("pCoef","i32"),r.addLocal("i","i32");const _=r.getCodeBuilder(),q=_.getLocal("pQ"),z=t.alloc(g*3),S=_.i32_const(z),N=_.getLocal("ppreQ");r.addCode(_.call(E+"_normalize",q,N),_.if(_.call(E+"_isZero",N),_.ret([])),_.call(E+"_copy",N,S),_.setLocal("pCoef",_.i32_add(_.getLocal("ppreQ"),_.i32_const(g*3)))),r.addCode(_.setLocal("i",_.i32_const(Pt.length-2)),_.block(_.loop(_.call(o+"_prepDblStep",S,_.getLocal("pCoef")),_.setLocal("pCoef",_.i32_add(_.getLocal("pCoef"),_.i32_const(ht))),_.if(_.i32_load8_s(_.getLocal("i"),vt),[..._.call(o+"_prepAddStep",S,N,_.getLocal("pCoef")),..._.setLocal("pCoef",_.i32_add(_.getLocal("pCoef"),_.i32_const(ht)))]),_.br_if(1,_.i32_eqz(_.getLocal("i"))),_.setLocal("i",_.i32_sub(_.getLocal("i"),_.i32_const(1))),_.br(0))))}function Lt(){const r=t.addFunction(j+"_mul1");r.addParam("pA","i32"),r.addParam("pC1","i32"),r.addParam("pR","i32");const _=r.getCodeBuilder(),q=_.getLocal("pA"),z=_.i32_add(_.getLocal("pA"),_.i32_const(b*2)),S=_.i32_add(_.getLocal("pA"),_.i32_const(b*4)),N=_.getLocal("pC1"),M=_.getLocal("pR"),W=_.i32_add(_.getLocal("pR"),_.i32_const(b*2)),X=_.i32_add(_.getLocal("pR"),_.i32_const(b*4)),V=_.i32_const(t.alloc(b*2)),Z=_.i32_const(t.alloc(b*2));r.addCode(_.call(B+"_add",q,z,V),_.call(B+"_add",z,S,Z),_.call(B+"_mul",z,N,X),_.call(B+"_mul",Z,N,M),_.call(B+"_sub",M,X,M),_.call(B+"_mulNR",M,M),_.call(B+"_mul",V,N,W),_.call(B+"_sub",W,X,W))}Lt();function It(){const r=t.addFunction(j+"_mul01");r.addParam("pA","i32"),r.addParam("pC0","i32"),r.addParam("pC1","i32"),r.addParam("pR","i32");const _=r.getCodeBuilder(),q=_.getLocal("pA"),z=_.i32_add(_.getLocal("pA"),_.i32_const(b*2)),S=_.i32_add(_.getLocal("pA"),_.i32_const(b*4)),N=_.getLocal("pC0"),M=_.getLocal("pC1"),W=_.getLocal("pR"),X=_.i32_add(_.getLocal("pR"),_.i32_const(b*2)),V=_.i32_add(_.getLocal("pR"),_.i32_const(b*4)),Z=_.i32_const(t.alloc(b*2)),tt=_.i32_const(t.alloc(b*2)),ft=_.i32_const(t.alloc(b*2)),_t=_.i32_const(t.alloc(b*2));r.addCode(_.call(B+"_mul",q,N,Z),_.call(B+"_mul",z,M,tt),_.call(B+"_add",q,z,ft),_.call(B+"_add",q,S,_t),_.call(B+"_add",z,S,W),_.call(B+"_mul",W,M,W),_.call(B+"_sub",W,tt,W),_.call(B+"_mulNR",W,W),_.call(B+"_add",W,Z,W),_.call(B+"_add",N,M,X),_.call(B+"_mul",X,ft,X),_.call(B+"_sub",X,Z,X),_.call(B+"_sub",X,tt,X),_.call(B+"_mul",_t,N,V),_.call(B+"_sub",V,Z,V),_.call(B+"_add",V,tt,V))}It();function gt(){const r=t.addFunction(H+"_mul014");r.addParam("pA","i32"),r.addParam("pC0","i32"),r.addParam("pC1","i32"),r.addParam("pC4","i32"),r.addParam("pR","i32");const _=r.getCodeBuilder(),q=_.getLocal("pA"),z=_.i32_add(_.getLocal("pA"),_.i32_const(b*6)),S=_.getLocal("pC0"),N=_.getLocal("pC1"),M=_.getLocal("pC4"),W=_.i32_const(t.alloc(b*6)),X=_.i32_const(t.alloc(b*6)),V=_.i32_const(t.alloc(b*2)),Z=_.getLocal("pR"),tt=_.i32_add(_.getLocal("pR"),_.i32_const(b*6));r.addCode(_.call(j+"_mul01",q,S,N,W),_.call(j+"_mul1",z,M,X),_.call(B+"_add",N,M,V),_.call(j+"_add",z,q,tt),_.call(j+"_mul01",tt,S,V,tt),_.call(j+"_sub",tt,W,tt),_.call(j+"_sub",tt,X,tt),_.call(j+"_copy",X,Z),_.call(j+"_mulNR",Z,Z),_.call(j+"_add",Z,W,Z))}gt();function lt(){const r=t.addFunction(o+"_ell");r.addParam("pP","i32"),r.addParam("pCoefs","i32"),r.addParam("pF","i32");const _=r.getCodeBuilder(),q=_.getLocal("pP"),z=_.i32_add(_.getLocal("pP"),_.i32_const(d)),S=_.getLocal("pF"),N=_.getLocal("pCoefs"),M=_.i32_add(_.getLocal("pCoefs"),_.i32_const(b)),W=_.i32_add(_.getLocal("pCoefs"),_.i32_const(b*2)),X=_.i32_add(_.getLocal("pCoefs"),_.i32_const(b*3)),V=_.i32_add(_.getLocal("pCoefs"),_.i32_const(b*4)),Z=t.alloc(b*2),tt=_.i32_const(Z),ft=_.i32_const(Z),_t=_.i32_const(Z+b),it=t.alloc(b*2),mt=_.i32_const(it),Bt=_.i32_const(it),St=_.i32_const(it+b);r.addCode(_.call(k+"_mul",N,z,ft),_.call(k+"_mul",M,z,_t),_.call(k+"_mul",W,q,Bt),_.call(k+"_mul",X,q,St),_.call(H+"_mul014",S,V,mt,tt,S))}lt();function bt(){const r=t.addFunction(o+"_millerLoop");r.addParam("ppreP","i32"),r.addParam("ppreQ","i32"),r.addParam("r","i32"),r.addLocal("pCoef","i32"),r.addLocal("i","i32");const _=r.getCodeBuilder(),q=_.getLocal("ppreP"),z=_.getLocal("pCoef"),S=_.getLocal("r");r.addCode(_.call(H+"_one",S),_.if(_.call(O+"_isZero",q),_.ret([])),_.if(_.call(O+"_isZero",_.getLocal("ppreQ")),_.ret([])),_.setLocal("pCoef",_.i32_add(_.getLocal("ppreQ"),_.i32_const(g*3))),_.setLocal("i",_.i32_const(Pt.length-2)),_.block(_.loop(_.call(o+"_ell",q,z,S),_.setLocal("pCoef",_.i32_add(_.getLocal("pCoef"),_.i32_const(ht))),_.if(_.i32_load8_s(_.getLocal("i"),vt),[..._.call(o+"_ell",q,z,S),..._.setLocal("pCoef",_.i32_add(_.getLocal("pCoef"),_.i32_const(ht)))]),_.call(H+"_square",S,S),_.br_if(1,_.i32_eq(_.getLocal("i"),_.i32_const(1))),_.setLocal("i",_.i32_sub(_.getLocal("i"),_.i32_const(1))),_.br(0))),_.call(o+"_ell",q,z,S)),r.addCode(_.call(H+"_conjugate",S,S))}function Et(r){const _=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[3850754370037169011952147076051364057158807420970682438676050522613628423219637725072182697113062777891589506424760n,151655185184498381465642749684540099398075398968325446656007613510403227271200139370504932015952886146304766135027n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620351n,0n],[2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n,1028732146235106349975324479215795277384839936929757896155643118032610843298655225875571310552543014690878354869257n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[3125332594171059424908108096204648978570118281977575435832422631601824034463382777937621250592425535493320683825557n,877076961050607968509681729531255177986764537961432449499635504522207616027455086505066378536590128544573588734230n],[4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559786n,0n],[151655185184498381465642749684540099398075398968325446656007613510403227271200139370504932015952886146304766135027n,3850754370037169011952147076051364057158807420970682438676050522613628423219637725072182697113062777891589506424760n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[1028732146235106349975324479215795277384839936929757896155643118032610843298655225875571310552543014690878354869257n,2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939437n,0n],[877076961050607968509681729531255177986764537961432449499635504522207616027455086505066378536590128544573588734230n,3125332594171059424908108096204648978570118281977575435832422631601824034463382777937621250592425535493320683825557n]]],q=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[0n,4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[0n,1n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[0n,793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n]],[[1n,0n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939437n,0n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559786n,0n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620351n,0n]]],z=t.addFunction(H+"_frobeniusMap"+r);z.addParam("x","i32"),z.addParam("r","i32");const S=z.getCodeBuilder();for(let M=0;M<6;M++){const W=M==0?S.getLocal("x"):S.i32_add(S.getLocal("x"),S.i32_const(M*g)),X=W,V=S.i32_add(S.getLocal("x"),S.i32_const(M*g+b)),Z=M==0?S.getLocal("r"):S.i32_add(S.getLocal("r"),S.i32_const(M*g)),tt=Z,ft=S.i32_add(S.getLocal("r"),S.i32_const(M*g+b)),_t=N(_[Math.floor(M/3)][r%12],q[M%3][r%6]),it=t.alloc([...xt.bigInt2BytesLE(C(_t[0]),d),...xt.bigInt2BytesLE(C(_t[1]),d)]);r%2==1?z.addCode(S.call(k+"_copy",X,tt),S.call(k+"_neg",V,ft),S.call(B+"_mul",Z,S.i32_const(it),Z)):z.addCode(S.call(B+"_mul",W,S.i32_const(it),Z))}function N(M,W){const X=M[0],V=M[1],Z=W[0],tt=W[1],ft=[(X*Z-V*tt)%e,(X*tt+V*Z)%e];return oc(ft[0])&&(ft[0]=ft[0]+e),ft}}function Tt(){const r=t.addFunction(o+"__cyclotomicSquare");r.addParam("x","i32"),r.addParam("r","i32");const _=r.getCodeBuilder(),q=_.getLocal("x"),z=_.i32_add(_.getLocal("x"),_.i32_const(g)),S=_.i32_add(_.getLocal("x"),_.i32_const(2*g)),N=_.i32_add(_.getLocal("x"),_.i32_const(3*g)),M=_.i32_add(_.getLocal("x"),_.i32_const(4*g)),W=_.i32_add(_.getLocal("x"),_.i32_const(5*g)),X=_.getLocal("r"),V=_.i32_add(_.getLocal("r"),_.i32_const(g)),Z=_.i32_add(_.getLocal("r"),_.i32_const(2*g)),tt=_.i32_add(_.getLocal("r"),_.i32_const(3*g)),ft=_.i32_add(_.getLocal("r"),_.i32_const(4*g)),_t=_.i32_add(_.getLocal("r"),_.i32_const(5*g)),it=_.i32_const(t.alloc(g)),mt=_.i32_const(t.alloc(g)),Bt=_.i32_const(t.alloc(g)),St=_.i32_const(t.alloc(g)),wt=_.i32_const(t.alloc(g)),Ct=_.i32_const(t.alloc(g)),pt=_.i32_const(t.alloc(g)),qt=_.i32_const(t.alloc(g));r.addCode(_.call(B+"_mul",q,M,pt),_.call(B+"_mulNR",M,it),_.call(B+"_add",q,it,it),_.call(B+"_add",q,M,qt),_.call(B+"_mul",qt,it,it),_.call(B+"_mulNR",pt,qt),_.call(B+"_add",pt,qt,qt),_.call(B+"_sub",it,qt,it),_.call(B+"_add",pt,pt,mt),_.call(B+"_mul",N,S,pt),_.call(B+"_mulNR",S,Bt),_.call(B+"_add",N,Bt,Bt),_.call(B+"_add",N,S,qt),_.call(B+"_mul",qt,Bt,Bt),_.call(B+"_mulNR",pt,qt),_.call(B+"_add",pt,qt,qt),_.call(B+"_sub",Bt,qt,Bt),_.call(B+"_add",pt,pt,St),_.call(B+"_mul",z,W,pt),_.call(B+"_mulNR",W,wt),_.call(B+"_add",z,wt,wt),_.call(B+"_add",z,W,qt),_.call(B+"_mul",qt,wt,wt),_.call(B+"_mulNR",pt,qt),_.call(B+"_add",pt,qt,qt),_.call(B+"_sub",wt,qt,wt),_.call(B+"_add",pt,pt,Ct),_.call(B+"_sub",it,q,X),_.call(B+"_add",X,X,X),_.call(B+"_add",it,X,X),_.call(B+"_add",mt,M,ft),_.call(B+"_add",ft,ft,ft),_.call(B+"_add",mt,ft,ft),_.call(B+"_mul",Ct,_.i32_const(et),qt),_.call(B+"_add",qt,N,tt),_.call(B+"_add",tt,tt,tt),_.call(B+"_add",qt,tt,tt),_.call(B+"_sub",wt,S,Z),_.call(B+"_add",Z,Z,Z),_.call(B+"_add",wt,Z,Z),_.call(B+"_sub",Bt,z,V),_.call(B+"_add",V,V,V),_.call(B+"_add",Bt,V,V),_.call(B+"_add",St,W,_t),_.call(B+"_add",_t,_t,_t),_.call(B+"_add",St,_t,_t))}function Yt(r,_,q){const z=D(r).map(Z=>Z==-1?255:Z),S=t.alloc(z),N=t.addFunction(o+"__cyclotomicExp_"+q);N.addParam("x","i32"),N.addParam("r","i32"),N.addLocal("bit","i32"),N.addLocal("i","i32");const M=N.getCodeBuilder(),W=M.getLocal("x"),X=M.getLocal("r"),V=M.i32_const(t.alloc(s));N.addCode(M.call(H+"_conjugate",W,V),M.call(H+"_one",X),M.if(M.teeLocal("bit",M.i32_load8_s(M.i32_const(z.length-1),S)),M.if(M.i32_eq(M.getLocal("bit"),M.i32_const(1)),M.call(H+"_mul",X,W,X),M.call(H+"_mul",X,V,X))),M.setLocal("i",M.i32_const(z.length-2)),M.block(M.loop(M.call(o+"__cyclotomicSquare",X,X),M.if(M.teeLocal("bit",M.i32_load8_s(M.getLocal("i"),S)),M.if(M.i32_eq(M.getLocal("bit"),M.i32_const(1)),M.call(H+"_mul",X,W,X),M.call(H+"_mul",X,V,X))),M.br_if(1,M.i32_eqz(M.getLocal("i"))),M.setLocal("i",M.i32_sub(M.getLocal("i"),M.i32_const(1))),M.br(0)))),N.addCode(M.call(H+"_conjugate",X,X))}function jt(){Tt(),Yt(p,v,"w0");const r=t.addFunction(o+"_finalExponentiation");r.addParam("x","i32"),r.addParam("r","i32");const _=r.getCodeBuilder(),q=_.getLocal("x"),z=_.getLocal("r"),S=_.i32_const(t.alloc(s)),N=_.i32_const(t.alloc(s)),M=_.i32_const(t.alloc(s)),W=_.i32_const(t.alloc(s)),X=_.i32_const(t.alloc(s)),V=_.i32_const(t.alloc(s)),Z=_.i32_const(t.alloc(s));r.addCode(_.call(H+"_frobeniusMap6",q,S),_.call(H+"_inverse",q,N),_.call(H+"_mul",S,N,M),_.call(H+"_copy",M,N),_.call(H+"_frobeniusMap2",M,M),_.call(H+"_mul",M,N,M),_.call(o+"__cyclotomicSquare",M,N),_.call(H+"_conjugate",N,N),_.call(o+"__cyclotomicExp_w0",M,W),_.call(o+"__cyclotomicSquare",W,X),_.call(H+"_mul",N,W,V),_.call(o+"__cyclotomicExp_w0",V,N),_.call(o+"__cyclotomicExp_w0",N,S),_.call(o+"__cyclotomicExp_w0",S,Z),_.call(H+"_mul",Z,X,Z),_.call(o+"__cyclotomicExp_w0",Z,X),_.call(H+"_conjugate",V,V),_.call(H+"_mul",X,V,X),_.call(H+"_mul",X,M,X),_.call(H+"_conjugate",M,V),_.call(H+"_mul",N,M,N),_.call(H+"_frobeniusMap3",N,N),_.call(H+"_mul",Z,V,Z),_.call(H+"_frobeniusMap1",Z,Z),_.call(H+"_mul",W,S,W),_.call(H+"_frobeniusMap2",W,W),_.call(H+"_mul",W,N,W),_.call(H+"_mul",W,Z,W),_.call(H+"_mul",W,X,z))}function tn(){const r=t.addFunction(o+"_finalExponentiationOld");r.addParam("x","i32"),r.addParam("r","i32");const q=t.alloc(xt.bigInt2BytesLE(322277361516934140462891564586510139908379969514828494218366688025288661041104682794998680497580008899973249814104447692778988208376779573819485263026159588510513834876303014016798809919343532899164848730280942609956670917565618115867287399623286813270357901731510188149934363360381614501334086825442271920079363289954510565375378443704372994881406797882676971082200626541916413184642520269678897559532260949334760604962086348898118982248842634379637598665468817769075878555493752214492790122785850202957575200176084204422751485957336465472324810982833638490904279282696134323072515220044451592646885410572234451732790590013479358343841220074174848221722017083597872017638514103174122784843925578370430843522959600095676285723737049438346544753168912974976791528535276317256904336520179281145394686565050419250614107803233314658825463117900250701199181529205942363159325765991819433914303908860460720581408201373164047773794825411011922305820065611121544561808414055302212057471395719432072209245600258134364584636810093520285711072578721435517884103526483832733289802426157301542744476740008494780363354305116978805620671467071400711358839553375340724899735460480144599782014906586543813292157922220645089192130209334926661588737007768565838519456601560804957985667880395221049249803753582637708560n,544)),z=r.getCodeBuilder();r.addCode(z.call(H+"_exp",z.getLocal("x"),z.i32_const(q),z.i32_const(544),z.getLocal("r")))}const Rt=t.alloc(l),Dt=t.alloc(R);function Xt(r){const _=t.addFunction(o+"_pairingEq"+r);for(let N=0;N<r;N++)_.addParam("p_"+N,"i32"),_.addParam("q_"+N,"i32");_.addParam("c","i32"),_.setReturnType("i32");const q=_.getCodeBuilder(),z=q.i32_const(t.alloc(s)),S=q.i32_const(t.alloc(s));_.addCode(q.call(H+"_one",z));for(let N=0;N<r;N++)_.addCode(q.call(o+"_prepareG1",q.getLocal("p_"+N),q.i32_const(Rt))),_.addCode(q.call(o+"_prepareG2",q.getLocal("q_"+N),q.i32_const(Dt))),_.addCode(q.if(q.i32_eqz(q.call(O+"_inGroupAffine",q.i32_const(Rt))),q.ret(q.i32_const(0))),q.if(q.i32_eqz(q.call(E+"_inGroupAffine",q.i32_const(Dt))),q.ret(q.i32_const(0)))),_.addCode(q.call(o+"_millerLoop",q.i32_const(Rt),q.i32_const(Dt),S)),_.addCode(q.call(H+"_mul",z,S,z));_.addCode(q.call(o+"_finalExponentiation",z,z)),_.addCode(q.call(H+"_eq",z,q.getLocal("c")))}function yn(){const r=t.addFunction(o+"_pairing");r.addParam("p","i32"),r.addParam("q","i32"),r.addParam("r","i32");const _=r.getCodeBuilder(),q=_.i32_const(t.alloc(s));r.addCode(_.call(o+"_prepareG1",_.getLocal("p"),_.i32_const(Rt))),r.addCode(_.call(o+"_prepareG2",_.getLocal("q"),_.i32_const(Dt))),r.addCode(_.call(o+"_millerLoop",_.i32_const(Rt),_.i32_const(Dt),q)),r.addCode(_.call(o+"_finalExponentiation",q,_.getLocal("r")))}function an(){const r=t.addFunction(E+"_inGroupAffine");r.addParam("p","i32"),r.setReturnType("i32");const _=r.getCodeBuilder(),q=[2001204777610833696708894912867952078278441409969503942666029068062015825245418932221343814564507832018947136279894n,2001204777610833696708894912867952078278441409969503942666029068062015825245418932221343814564507832018947136279893n],z=4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,S=[2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n,2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n],N=_.i32_const(t.alloc([...xt.bigInt2BytesLE(C(q[0]),d),...xt.bigInt2BytesLE(C(q[1]),d)])),M=_.i32_const(t.alloc(xt.bigInt2BytesLE(C(z),d))),W=_.i32_const(t.alloc([...xt.bigInt2BytesLE(C(S[0]),d),...xt.bigInt2BytesLE(C(S[1]),d)])),X=_.i32_const(t.alloc(xt.bigInt2BytesLE(p,8))),V=_.getLocal("p"),Z=_.i32_add(_.getLocal("p"),_.i32_const(g)),tt=_.i32_const(t.alloc(b)),ft=_.i32_const(t.alloc(g)),_t=_.i32_const(t.alloc(g)),it=t.alloc(g*2),mt=_.i32_const(it),Bt=_.i32_const(it),St=_.i32_const(it),wt=_.i32_const(it+b),Ct=_.i32_const(it+g),pt=_.i32_const(it+g),qt=_.i32_const(it+g+b),Vt=t.alloc(g*3),rn=_.i32_const(Vt),Ma=_.i32_const(Vt),so=_.i32_const(Vt),lo=_.i32_const(Vt+b),za=_.i32_const(Vt+g),ro=_.i32_const(Vt+g),uo=_.i32_const(Vt+g+b),ka=_.i32_const(Vt+g*2);r.addCode(_.if(_.call(E+"_isZeroAffine",_.getLocal("p")),_.ret(_.i32_const(1))),_.if(_.i32_eqz(_.call(E+"_inCurveAffine",_.getLocal("p"))),_.ret(_.i32_const(0))),_.call(B+"_mul",V,N,ft),_.call(B+"_mul",Z,N,_t),_.call(B+"_mul1",ft,M,Bt),_.call(B+"_neg",_t,Ct),_.call(B+"_neg",ft,Ma),_.call(B+"_mul",_t,W,za),_.call(k+"_sub",St,wt,tt),_.call(k+"_add",St,wt,wt),_.call(k+"_copy",tt,St),_.call(k+"_sub",pt,qt,tt),_.call(k+"_add",pt,qt,qt),_.call(k+"_copy",tt,pt),_.call(k+"_add",so,lo,tt),_.call(k+"_sub",so,lo,lo),_.call(k+"_copy",tt,so),_.call(k+"_sub",uo,ro,tt),_.call(k+"_add",ro,uo,uo),_.call(k+"_copy",tt,ro),_.call(B+"_one",ka),_.call(E+"_timesScalar",rn,X,_.i32_const(8),rn),_.call(E+"_addMixed",rn,mt,rn),_.ret(_.call(E+"_eqMixed",rn,_.getLocal("p"))));const Kn=t.addFunction(E+"_inGroup");Kn.addParam("pIn","i32"),Kn.setReturnType("i32");const Sn=Kn.getCodeBuilder(),Xo=Sn.i32_const(t.alloc(g*2));Kn.addCode(Sn.call(E+"_toAffine",Sn.getLocal("pIn"),Xo),Sn.ret(Sn.call(E+"_inGroupAffine",Xo)))}function G(){const r=t.addFunction(O+"_inGroupAffine");r.addParam("p","i32"),r.setReturnType("i32");const _=r.getCodeBuilder(),q=4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,z=793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,S=(p*p-1n)/3n,N=_.i32_const(t.alloc(xt.bigInt2BytesLE(C(q),d))),M=_.i32_const(t.alloc(xt.bigInt2BytesLE(C(z),d))),W=_.i32_const(t.alloc(xt.bigInt2BytesLE(S,16))),X=_.getLocal("p"),V=_.i32_add(_.getLocal("p"),_.i32_const(b)),Z=t.alloc(b*3),tt=_.i32_const(Z),ft=_.i32_const(Z),_t=_.i32_const(Z+b),it=t.alloc(b*2),mt=_.i32_const(it),Bt=_.i32_const(it),St=_.i32_const(it+b);r.addCode(_.if(_.call(O+"_isZeroAffine",_.getLocal("p")),_.ret(_.i32_const(1))),_.if(_.i32_eqz(_.call(O+"_inCurveAffine",_.getLocal("p"))),_.ret(_.i32_const(0))),_.call(k+"_mul",X,N,ft),_.call(k+"_copy",V,_t),_.call(k+"_mul",X,M,Bt),_.call(k+"_copy",V,St),_.call(O+"_doubleAffine",tt,tt),_.call(O+"_subMixed",tt,_.getLocal("p"),tt),_.call(O+"_subMixed",tt,mt,tt),_.call(O+"_timesScalar",tt,W,_.i32_const(16),tt),_.ret(_.call(O+"_eqMixed",tt,mt)));const wt=t.addFunction(O+"_inGroup");wt.addParam("pIn","i32"),wt.setReturnType("i32");const Ct=wt.getCodeBuilder(),pt=Ct.i32_const(t.alloc(b*2));wt.addCode(Ct.call(O+"_toAffine",Ct.getLocal("pIn"),pt),Ct.ret(Ct.call(O+"_inGroupAffine",pt)))}for(let r=0;r<10;r++)Et(r),t.exportFunction(H+"_frobeniusMap"+r);G(),an(),yt(),rt(),st(),dt(),bt(),tn(),jt();for(let r=1;r<=5;r++)Xt(r),t.exportFunction(o+"_pairingEq"+r);yn(),t.exportFunction(o+"_pairing"),t.exportFunction(o+"_prepareG1"),t.exportFunction(o+"_prepareG2"),t.exportFunction(o+"_millerLoop"),t.exportFunction(o+"_finalExponentiation"),t.exportFunction(o+"_finalExponentiationOld"),t.exportFunction(o+"__cyclotomicSquare"),t.exportFunction(o+"__cyclotomicExp_w0"),t.exportFunction(j+"_mul1"),t.exportFunction(j+"_mul01"),t.exportFunction(H+"_mul014"),t.exportFunction(O+"_inGroupAffine"),t.exportFunction(O+"_inGroup"),t.exportFunction(E+"_inGroupAffine"),t.exportFunction(E+"_inGroup")},ac=Hi,ic=ec;function Ao(i){if(typeof i=="bigint"||i.eq!==void 0)return i.toString(10);if(i instanceof Uint8Array)return Un(i,0);if(Array.isArray(i))return i.map(Ao);if(typeof i=="object"){const t={};return Object.keys(i).forEach(o=>{t[o]=Ao(i[o])}),t}else return i}function vo(i){if(typeof i=="string"&&/^[0-9]+$/.test(i))return BigInt(i);if(typeof i=="string"&&/^0x[0-9a-fA-F]+$/.test(i))return BigInt(i);if(Array.isArray(i))return i.map(vo);if(typeof i=="object"){if(i===null)return null;const t={};return Object.keys(i).forEach(o=>{t[o]=vo(i[o])}),t}else return i}function cc(i){let t=BigInt(0),n=i.length,o=0;const e=new DataView(i.buffer,i.byteOffset,i.byteLength);for(;n>0;)n>=4?(n-=4,t+=BigInt(e.getUint32(n))<<BigInt(o*8),o+=4):n>=2?(n-=2,t+=BigInt(e.getUint16(n))<<BigInt(o*8),o+=2):(n-=1,t+=BigInt(e.getUint8(n))<<BigInt(o*8),o+=1);return t}function sc(i,t){let n=i;const o=new Uint8Array(t),e=new DataView(o.buffer);let c=t;for(;c>0;)c-4>=0?(c-=4,e.setUint32(c,Number(n&BigInt(4294967295))),n=n>>BigInt(32)):c-2>=0?(c-=2,e.setUint16(c,Number(n&BigInt(65535))),n=n>>BigInt(16)):(c-=1,e.setUint8(c,Number(n&BigInt(255))),n=n>>BigInt(8));if(n)throw new Error("Number does not fit in this length");return o}function lc(i){let t=BigInt(0),n=0;const o=new DataView(i.buffer,i.byteOffset,i.byteLength);for(;n<i.length;)n+4<=i.length?(t+=BigInt(o.getUint32(n,!0))<<BigInt(n*8),n+=4):n+2<=i.length?(t+=BigInt(o.getUint16(n,!0))<<BigInt(n*8),n+=2):(t+=BigInt(o.getUint8(n,!0))<<BigInt(n*8),n+=1);return t}function la(i,t){let n=i;typeof t>"u"&&(t=Math.floor((Nn(i)-1)/8)+1,t==0&&(t=1));const o=new Uint8Array(t),e=new DataView(o.buffer);let c=0;for(;c<t;)c+4<=t?(e.setUint32(c,Number(n&BigInt(4294967295)),!0),c+=4,n=n>>BigInt(32)):c+2<=t?(e.setUint16(c,Number(n&BigInt(65535)),!0),c+=2,n=n>>BigInt(16)):(e.setUint8(c,Number(n&BigInt(255)),!0),c+=1,n=n>>BigInt(8));if(n)throw new Error("Number does not fit in this length");return o}function Io(i,t){if(typeof t=="bigint"||t.eq!==void 0)return t.toString(10);if(t instanceof Uint8Array)return i.toString(i.e(t));if(Array.isArray(t))return t.map(Io.bind(this,i));if(typeof t=="object"){const n={};return Object.keys(t).forEach(e=>{n[e]=Io(i,t[e])}),n}else return t}function So(i,t){if(typeof t=="string"&&/^[0-9]+$/.test(t))return i.e(t);if(typeof t=="string"&&/^0x[0-9a-fA-F]+$/.test(t))return i.e(t);if(Array.isArray(t))return t.map(So.bind(this,i));if(typeof t=="object"){if(t===null)return null;const n={};return Object.keys(t).forEach(e=>{n[e]=So(i,t[e])}),n}else return t}const zn=[];for(let i=0;i<256;i++)zn[i]=rc(i,8);function rc(i,t){let n=0,o=i;for(let e=0;e<t;e++)n<<=1,n=n|o&1,o>>=1;return n}function ra(i,t){return(zn[i>>>24]|zn[i>>>16&255]<<8|zn[i>>>8&255]<<16|zn[i&255]<<24)>>>32-t}function Zt(i){return(i&4294901760?(i&=4294901760,16):0)|(i&4278255360?(i&=4278255360,8):0)|(i&4042322160?(i&=4042322160,4):0)|(i&3435973836?(i&=3435973836,2):0)|(i&2863311530)!==0}function da(i,t){const n=i.byteLength/t,o=Zt(n);if(n!=1<<o)throw new Error("Invalid number of pointers");for(let e=0;e<n;e++){const c=ra(e,o);if(e>c){const f=i.slice(e*t,(e+1)*t);i.set(i.slice(c*t,(c+1)*t),e*t),i.set(f,c*t)}}}function jo(i,t){const n=new Uint8Array(t*i.length);for(let o=0;o<i.length;o++)n.set(i[o],o*t);return n}function to(i,t){const n=i.byteLength/t,o=new Array(n);for(let e=0;e<n;e++)o[e]=i.slice(e*t,e*t+t);return o}var dc=Object.freeze({__proto__:null,array2buffer:jo,beBuff2int:cc,beInt2Buff:sc,bitReverse:ra,buffReverseBits:da,buffer2array:to,leBuff2int:lc,leInt2Buff:la,log2:Zt,stringifyBigInts:Ao,stringifyFElements:Io,unstringifyBigInts:vo,unstringifyFElements:So});const Nt=1<<30;class Ot{constructor(t){this.buffers=[],this.byteLength=t;for(let n=0;n<t;n+=Nt){const o=Math.min(t-n,Nt);this.buffers.push(new Uint8Array(o))}}slice(t,n){n===void 0&&(n=this.byteLength),t===void 0&&(t=0);const o=n-t,e=Math.floor(t/Nt),c=Math.floor((t+o-1)/Nt);if(e==c||o==0)return this.buffers[e].slice(t%Nt,t%Nt+o);let f,d=e,b=t%Nt,g=o;for(;g>0;){const s=b+g>Nt?Nt-b:g,y=new Uint8Array(this.buffers[d].buffer,this.buffers[d].byteOffset+b,s);if(s==o)return y.slice();f||(o<=Nt?f=new Uint8Array(o):f=new Ot(o)),f.set(y,o-g),g=g-s,d++,b=0}return f}set(t,n){n===void 0&&(n=0);const o=t.byteLength;if(o==0)return;const e=Math.floor(n/Nt),c=Math.floor((n+o-1)/Nt);if(e==c)return t instanceof Ot&&t.buffers.length==1?this.buffers[e].set(t.buffers[0],n%Nt):this.buffers[e].set(t,n%Nt);let f=e,d=n%Nt,b=o;for(;b>0;){const g=d+b>Nt?Nt-d:b,s=t.slice(o-b,o-b+g);new Uint8Array(this.buffers[f].buffer,this.buffers[f].byteOffset+d,g).set(s),b=b-g,f++,d=0}}}function un(i,t,n,o){return async function(c){const f=Math.floor(c.byteLength/n);if(f*n!==c.byteLength)throw new Error("Invalid buffer size");const d=Math.floor(f/i.concurrency),b=[];for(let w=0;w<i.concurrency;w++){let h;if(w<i.concurrency-1?h=d:h=f-w*d,h==0)continue;const k=[{cmd:"ALLOCSET",var:0,buff:c.slice(w*d*n,w*d*n+h*n)},{cmd:"ALLOC",var:1,len:o*h},{cmd:"CALL",fnName:t,params:[{var:0},{val:h},{var:1}]},{cmd:"GET",out:0,var:1,len:o*h}];b.push(i.queueAction(k))}const g=await Promise.all(b);let s;c instanceof Ot?s=new Ot(f*o):s=new Uint8Array(f*o);let y=0;for(let w=0;w<g.length;w++)s.set(g[w][0],y),y+=g[w][0].byteLength;return s}}class _e{constructor(t,n,o,e){if(this.tm=t,this.prefix=n,this.p=e,this.n8=o,this.type="F1",this.m=1,this.half=wn(e,Ln),this.bitLength=Nn(e),this.mask=ln(Jn(Ln,this.bitLength),Ln),this.pOp1=t.alloc(o),this.pOp2=t.alloc(o),this.pOp3=t.alloc(o),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=this.tm.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=this.tm.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one),this.n64=Math.floor(o/8),this.n32=Math.floor(o/4),this.n64*8!=this.n8)throw new Error("n8 must be a multiple of 8");this.half=wn(this.p,Ln),this.nqr=this.two;let c=this.exp(this.nqr,this.half);for(;!this.eq(c,this.negone);)this.nqr=this.add(this.nqr,this.one),c=this.exp(this.nqr,this.half);this.shift=this.mul(this.nqr,this.nqr),this.shiftInv=this.inv(this.shift),this.s=0;let f=ln(this.p,Ln);for(;!Mo(f);)this.s=this.s+1,f=wn(f,Ln);this.w=[],this.w[this.s]=this.exp(this.nqr,f);for(let d=this.s-1;d>=0;d--)this.w[d]=this.square(this.w[d+1]);if(!this.eq(this.w[0],this.one))throw new Error("Error calculating roots of unity");this.batchToMontgomery=un(t,n+"_batchToMontgomery",this.n8,this.n8),this.batchFromMontgomery=un(t,n+"_batchFromMontgomery",this.n8,this.n8)}op2(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){return this.op2("_add",t,n)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=Cn(kt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}isNegative(t){return this.op1Bool("_isNegative",t)}e(t,n){if(t instanceof Uint8Array)return t;let o=kt(t,n);ke(o)?(o=Ne(o),Fo(o,this.p)&&(o=nn(o,this.p)),o=ln(this.p,o)):Fo(o,this.p)&&(o=nn(o,this.p));const e=la(o,this.n8);return this.toMontgomery(e)}toString(t,n){const o=this.fromMontgomery(t),e=Un(o,0);return We(e,n)}fromRng(t){let n;const o=new Uint8Array(this.n8);do{n=De;for(let e=0;e<this.n64;e++)n=zo(n,Jn(t.nextU64(),64*e));n=ko(n,this.mask)}while($e(n,this.p));return Tn(o,0,n,this.n8),o}random(){return this.fromRng(To())}toObject(t){const n=this.fromMontgomery(t);return Un(n,0)}fromObject(t){const n=new Uint8Array(this.n8);return Tn(n,0,t,this.n8),this.toMontgomery(n)}toRprLE(t,n,o){t.set(this.fromMontgomery(o),n)}toRprBE(t,n,o){const e=this.fromMontgomery(o);for(let c=0;c<this.n8/2;c++){const f=e[c];e[c]=e[this.n8-1-c],e[this.n8-1-c]=f}t.set(e,n)}fromRprLE(t,n){n=n||0;const o=t.slice(n,n+this.n8);return this.toMontgomery(o)}async batchInverse(t){let n=!1;const o=this.n8,e=this.n8;Array.isArray(t)?(t=jo(t,o),n=!0):t=t.slice(0,t.byteLength);const c=Math.floor(t.byteLength/o);if(c*o!==t.byteLength)throw new Error("Invalid buffer size");const f=Math.floor(c/this.tm.concurrency),d=[];for(let y=0;y<this.tm.concurrency;y++){let w;if(y<this.tm.concurrency-1?w=f:w=c-y*f,w==0)continue;const T=[{cmd:"ALLOCSET",var:0,buff:t.slice(y*f*o,y*f*o+w*o)},{cmd:"ALLOC",var:1,len:e*w},{cmd:"CALL",fnName:this.prefix+"_batchInverse",params:[{var:0},{val:o},{val:w},{var:1},{val:e}]},{cmd:"GET",out:0,var:1,len:e*w}];d.push(this.tm.queueAction(T))}const b=await Promise.all(d);let g;t instanceof Ot?g=new Ot(c*e):g=new Uint8Array(c*e);let s=0;for(let y=0;y<b.length;y++)g.set(b[y][0],s),s+=b[y][0].byteLength;return n?to(g,e):g}}class ge{constructor(t,n,o){this.tm=t,this.prefix=n,this.F=o,this.type="F2",this.m=o.m*2,this.n8=this.F.n8*2,this.n32=this.F.n32*2,this.n64=this.F.n64*2,this.pOp1=t.alloc(o.n8*2),this.pOp2=t.alloc(o.n8*2),this.pOp3=t.alloc(o.n8*2),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=t.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=t.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one)}op2(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){return this.op2("_add",t,n)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}isNegative(t){return this.op1Bool("_isNegative",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}mul1(t,n){return this.op2("_mul1",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=Cn(kt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}e(t,n){if(t instanceof Uint8Array)return t;if(Array.isArray(t)&&t.length==2){const o=this.F.e(t[0],n),e=this.F.e(t[1],n),c=new Uint8Array(this.F.n8*2);return c.set(o),c.set(e,this.F.n8*2),c}else throw new Error("invalid F2")}toString(t,n){const o=this.F.toString(t.slice(0,this.F.n8),n),e=this.F.toString(t.slice(this.F.n8),n);return`[${o}, ${e}]`}fromRng(t){const n=this.F.fromRng(t),o=this.F.fromRng(t),e=new Uint8Array(this.F.n8*2);return e.set(n),e.set(o,this.F.n8),e}random(){return this.fromRng(To())}toObject(t){const n=this.F.toObject(t.slice(0,this.F.n8)),o=this.F.toObject(t.slice(this.F.n8,this.F.n8*2));return[n,o]}fromObject(t){const n=new Uint8Array(this.F.n8*2),o=this.F.fromObject(t[0]),e=this.F.fromObject(t[1]);return n.set(o),n.set(e,this.F.n8),n}c1(t){return t.slice(0,this.F.n8)}c2(t){return t.slice(this.F.n8)}}class uc{constructor(t,n,o){this.tm=t,this.prefix=n,this.F=o,this.type="F3",this.m=o.m*3,this.n8=this.F.n8*3,this.n32=this.F.n32*3,this.n64=this.F.n64*3,this.pOp1=t.alloc(o.n8*3),this.pOp2=t.alloc(o.n8*3),this.pOp3=t.alloc(o.n8*3),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=t.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=t.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one)}op2(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}add(t,n){return this.op2("_add",t,n)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}isNegative(t){return this.op1Bool("_isNegative",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=Cn(kt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.getBuff(this.pOp3,this.n8)}e(t,n){if(t instanceof Uint8Array)return t;if(Array.isArray(t)&&t.length==3){const o=this.F.e(t[0],n),e=this.F.e(t[1],n),c=this.F.e(t[2],n),f=new Uint8Array(this.F.n8*3);return f.set(o),f.set(e,this.F.n8),f.set(c,this.F.n8*2),f}else throw new Error("invalid F3")}toString(t,n){const o=this.F.toString(t.slice(0,this.F.n8),n),e=this.F.toString(t.slice(this.F.n8,this.F.n8*2),n),c=this.F.toString(t.slice(this.F.n8*2),n);return`[${o}, ${e}, ${c}]`}fromRng(t){const n=this.F.fromRng(t),o=this.F.fromRng(t),e=this.F.fromRng(t),c=new Uint8Array(this.F.n8*3);return c.set(n),c.set(o,this.F.n8),c.set(e,this.F.n8*2),c}random(){return this.fromRng(To())}toObject(t){const n=this.F.toObject(t.slice(0,this.F.n8)),o=this.F.toObject(t.slice(this.F.n8,this.F.n8*2)),e=this.F.toObject(t.slice(this.F.n8*2,this.F.n8*3));return[n,o,e]}fromObject(t){const n=new Uint8Array(this.F.n8*3),o=this.F.fromObject(t[0]),e=this.F.fromObject(t[1]),c=this.F.fromObject(t[2]);return n.set(o),n.set(e,this.F.n8),n.set(c,this.F.n8*2),n}c1(t){return t.slice(0,this.F.n8)}c2(t){return t.slice(this.F.n8,this.F.n8*2)}c3(t){return t.slice(this.F.n8*2)}}class fe{constructor(t,n,o,e,c,f){this.tm=t,this.prefix=n,this.F=o,this.pOp1=t.alloc(o.n8*3),this.pOp2=t.alloc(o.n8*3),this.pOp3=t.alloc(o.n8*3),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=this.tm.getBuff(this.pOp1,o.n8*3),this.tm.instance.exports[n+"_zeroAffine"](this.pOp1),this.zeroAffine=this.tm.getBuff(this.pOp1,o.n8*2),this.one=this.tm.getBuff(e,o.n8*3),this.g=this.one,this.oneAffine=this.tm.getBuff(e,o.n8*2),this.gAffine=this.oneAffine,this.b=this.tm.getBuff(c,o.n8),f&&(this.cofactor=Cn(f)),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one),this.batchLEMtoC=un(t,n+"_batchLEMtoC",o.n8*2,o.n8),this.batchLEMtoU=un(t,n+"_batchLEMtoU",o.n8*2,o.n8*2),this.batchCtoLEM=un(t,n+"_batchCtoLEM",o.n8,o.n8*2),this.batchUtoLEM=un(t,n+"_batchUtoLEM",o.n8*2,o.n8*2),this.batchToJacobian=un(t,n+"_batchToJacobian",o.n8*2,o.n8*3),this.batchToAffine=un(t,n+"_batchToAffine",o.n8*3,o.n8*2)}op2(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}op2bool(t,n,o){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,o),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}op1Affine(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*2)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2("_add",t,n);if(n.byteLength==this.F.n8*2)return this.op2("_addMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2("_addMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2("_addAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}sub(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2("_sub",t,n);if(n.byteLength==this.F.n8*2)return this.op2("_subMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2("_subMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2("_subAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}neg(t){if(t.byteLength==this.F.n8*3)return this.op1("_neg",t);if(t.byteLength==this.F.n8*2)return this.op1Affine("_negAffine",t);throw new Error("invalid point size")}double(t){if(t.byteLength==this.F.n8*3)return this.op1("_double",t);if(t.byteLength==this.F.n8*2)return this.op1("_doubleAffine",t);throw new Error("invalid point size")}isZero(t){if(t.byteLength==this.F.n8*3)return this.op1Bool("_isZero",t);if(t.byteLength==this.F.n8*2)return this.op1Bool("_isZeroAffine",t);throw new Error("invalid point size")}timesScalar(t,n){n instanceof Uint8Array||(n=Cn(kt(n)));let o;if(t.byteLength==this.F.n8*3)o=this.prefix+"_timesScalar";else if(t.byteLength==this.F.n8*2)o=this.prefix+"_timesScalarAffine";else throw new Error("invalid point size");return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[o](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}timesFr(t,n){let o;if(t.byteLength==this.F.n8*3)o=this.prefix+"_timesFr";else if(t.byteLength==this.F.n8*2)o=this.prefix+"_timesFrAffine";else throw new Error("invalid point size");return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[o](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}eq(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2bool("_eq",t,n);if(n.byteLength==this.F.n8*2)return this.op2bool("_eqMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2bool("_eqMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2bool("_eqAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}toAffine(t){if(t.byteLength==this.F.n8*3)return this.op1Affine("_toAffine",t);if(t.byteLength==this.F.n8*2)return t;throw new Error("invalid point size")}toJacobian(t){if(t.byteLength==this.F.n8*3)return t;if(t.byteLength==this.F.n8*2)return this.op1("_toJacobian",t);throw new Error("invalid point size")}toRprUncompressed(t,n,o){if(this.tm.setBuff(this.pOp1,o),o.byteLength==this.F.n8*3)this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);else if(o.byteLength!=this.F.n8*2)throw new Error("invalid point size");this.tm.instance.exports[this.prefix+"_LEMtoU"](this.pOp1,this.pOp1);const e=this.tm.getBuff(this.pOp1,this.F.n8*2);t.set(e,n)}fromRprUncompressed(t,n){const o=t.slice(n,n+this.F.n8*2);return this.tm.setBuff(this.pOp1,o),this.tm.instance.exports[this.prefix+"_UtoLEM"](this.pOp1,this.pOp1),this.tm.getBuff(this.pOp1,this.F.n8*2)}toRprCompressed(t,n,o){if(this.tm.setBuff(this.pOp1,o),o.byteLength==this.F.n8*3)this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);else if(o.byteLength!=this.F.n8*2)throw new Error("invalid point size");this.tm.instance.exports[this.prefix+"_LEMtoC"](this.pOp1,this.pOp1);const e=this.tm.getBuff(this.pOp1,this.F.n8);t.set(e,n)}fromRprCompressed(t,n){const o=t.slice(n,n+this.F.n8);return this.tm.setBuff(this.pOp1,o),this.tm.instance.exports[this.prefix+"_CtoLEM"](this.pOp1,this.pOp2),this.tm.getBuff(this.pOp2,this.F.n8*2)}toUncompressed(t){const n=new Uint8Array(this.F.n8*2);return this.toRprUncompressed(n,0,t),n}toRprLEM(t,n,o){if(o.byteLength==this.F.n8*2){t.set(o,n);return}else if(o.byteLength==this.F.n8*3){this.tm.setBuff(this.pOp1,o),this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);const e=this.tm.getBuff(this.pOp1,this.F.n8*2);t.set(e,n)}else throw new Error("invalid point size")}fromRprLEM(t,n){return n=n||0,t.slice(n,n+this.F.n8*2)}toString(t,n){if(t.byteLength==this.F.n8*3){const o=this.F.toString(t.slice(0,this.F.n8),n),e=this.F.toString(t.slice(this.F.n8,this.F.n8*2),n),c=this.F.toString(t.slice(this.F.n8*2),n);return`[ ${o}, ${e}, ${c} ]`}else if(t.byteLength==this.F.n8*2){const o=this.F.toString(t.slice(0,this.F.n8),n),e=this.F.toString(t.slice(this.F.n8),n);return`[ ${o}, ${e} ]`}else throw new Error("invalid point size")}isValid(t){if(this.isZero(t))return!0;const n=this.F,o=this.toAffine(t),e=o.slice(0,this.F.n8),c=o.slice(this.F.n8,this.F.n8*2),f=n.add(n.mul(n.square(e),e),this.b),d=n.square(c);return n.eq(f,d)}fromRng(t){const n=this.F;let o=[],e,c;do o[0]=n.fromRng(t),e=t.nextBool(),c=n.add(n.mul(n.square(o[0]),o[0]),this.b);while(!n.isSquare(c));o[1]=n.sqrt(c);const f=n.isNegative(o[1]);e^f&&(o[1]=n.neg(o[1]));let d=new Uint8Array(this.F.n8*2);return d.set(o[0]),d.set(o[1],this.F.n8),this.cofactor&&(d=this.timesScalar(d,this.cofactor)),d}toObject(t){if(this.isZero(t))return[this.F.toObject(this.F.zero),this.F.toObject(this.F.one),this.F.toObject(this.F.zero)];const n=this.F.toObject(t.slice(0,this.F.n8)),o=this.F.toObject(t.slice(this.F.n8,this.F.n8*2));let e;return t.byteLength==this.F.n8*3?e=this.F.toObject(t.slice(this.F.n8*2,this.F.n8*3)):e=this.F.toObject(this.F.one),[n,o,e]}fromObject(t){const n=this.F.fromObject(t[0]),o=this.F.fromObject(t[1]);let e;if(t.length==3?e=this.F.fromObject(t[2]):e=this.F.one,this.F.isZero(e,this.F.one))return this.zeroAffine;if(this.F.eq(e,this.F.one)){const c=new Uint8Array(this.F.n8*2);return c.set(n),c.set(o,this.F.n8),c}else{const c=new Uint8Array(this.F.n8*3);return c.set(n),c.set(o,this.F.n8),c.set(e,this.F.n8*2),c}}e(t){return t instanceof Uint8Array?t:this.fromObject(t)}x(t){return this.toAffine(t).slice(0,this.F.n8)}y(t){return this.toAffine(t).slice(this.F.n8)}}function _c(i){let n,o;async function e(s){const y=new Uint8Array(s.code),w=await WebAssembly.compile(y);o=new WebAssembly.Memory({initial:s.init,maximum:32767}),n=await WebAssembly.instantiate(w,{env:{memory:o}})}function c(s){const y=new Uint32Array(o.buffer,0,1);for(;y[0]&3;)y[0]++;const w=y[0];if(y[0]+=s,y[0]+s>o.buffer.byteLength){const h=o.buffer.byteLength/65536;let T=Math.floor((y[0]+s)/65536)+1;T>32767&&(T=32767),o.grow(T-h)}return w}function f(s){const y=c(s.byteLength);return b(y,s),y}function d(s,y){const w=new Uint8Array(o.buffer);return new Uint8Array(w.buffer,w.byteOffset+s,y)}function b(s,y){new Uint8Array(o.buffer).set(new Uint8Array(y),s)}function g(s){if(s[0].cmd=="INIT")return e(s[0]);const y={vars:[],out:[]},h=new Uint32Array(o.buffer,0,1)[0];for(let k=0;k<s.length;k++)switch(s[k].cmd){case"ALLOCSET":y.vars[s[k].var]=f(s[k].buff);break;case"ALLOC":y.vars[s[k].var]=c(s[k].len);break;case"SET":b(y.vars[s[k].var],s[k].buff);break;case"CALL":{const x=[];for(let O=0;O<s[k].params.length;O++){const B=s[k].params[O];typeof B.var<"u"?x.push(y.vars[B.var]+(B.offset||0)):typeof B.val<"u"&&x.push(B.val)}n.exports[s[k].fnName](...x);break}case"GET":y.out[s[k].out]=d(y.vars[s[k].var],s[k].len).slice();break;default:throw new Error("Invalid cmd")}const T=new Uint32Array(o.buffer,0,1);return T[0]=h,y.out}return g}const mo=25;class pe{constructor(){this.promise=new Promise((t,n)=>{this.reject=n,this.resolve=t})}}function gc(i){return new Promise(t=>setTimeout(t,i))}let Eo;const Le=`(function thread(self) {
    const MAXMEM = 32767;
    let instance;
    let memory;

    if (self) {
        self.onmessage = function(e) {
            let data;
            if (e.data) {
                data = e.data;
            } else {
                data = e;
            }

            if (data[0].cmd == "INIT") {
                init(data[0]).then(function() {
                    self.postMessage(data.result);
                });
            } else if (data[0].cmd == "TERMINATE") {
                self.close();
            } else {
                const res = runTask(data);
                self.postMessage(res);
            }
        };
    }

    async function init(data) {
        const code = new Uint8Array(data.code);
        const wasmModule = await WebAssembly.compile(code);
        memory = new WebAssembly.Memory({initial:data.init, maximum: MAXMEM});

        instance = await WebAssembly.instantiate(wasmModule, {
            env: {
                "memory": memory
            }
        });
    }



    function alloc(length) {
        const u32 = new Uint32Array(memory.buffer, 0, 1);
        while (u32[0] & 3) u32[0]++;  // Return always aligned pointers
        const res = u32[0];
        u32[0] += length;
        if (u32[0] + length > memory.buffer.byteLength) {
            const currentPages = memory.buffer.byteLength / 0x10000;
            let requiredPages = Math.floor((u32[0] + length) / 0x10000)+1;
            if (requiredPages>MAXMEM) requiredPages=MAXMEM;
            memory.grow(requiredPages-currentPages);
        }
        return res;
    }

    function allocBuffer(buffer) {
        const p = alloc(buffer.byteLength);
        setBuffer(p, buffer);
        return p;
    }

    function getBuffer(pointer, length) {
        const u8 = new Uint8Array(memory.buffer);
        return new Uint8Array(u8.buffer, u8.byteOffset + pointer, length);
    }

    function setBuffer(pointer, buffer) {
        const u8 = new Uint8Array(memory.buffer);
        u8.set(new Uint8Array(buffer), pointer);
    }

    function runTask(task) {
        if (task[0].cmd == "INIT") {
            return init(task[0]);
        }
        const ctx = {
            vars: [],
            out: []
        };
        const u32a = new Uint32Array(memory.buffer, 0, 1);
        const oldAlloc = u32a[0];
        for (let i=0; i<task.length; i++) {
            switch (task[i].cmd) {
            case "ALLOCSET":
                ctx.vars[task[i].var] = allocBuffer(task[i].buff);
                break;
            case "ALLOC":
                ctx.vars[task[i].var] = alloc(task[i].len);
                break;
            case "SET":
                setBuffer(ctx.vars[task[i].var], task[i].buff);
                break;
            case "CALL": {
                const params = [];
                for (let j=0; j<task[i].params.length; j++) {
                    const p = task[i].params[j];
                    if (typeof p.var !== "undefined") {
                        params.push(ctx.vars[p.var] + (p.offset || 0));
                    } else if (typeof p.val != "undefined") {
                        params.push(p.val);
                    }
                }
                instance.exports[task[i].fnName](...params);
                break;
            }
            case "GET":
                ctx.out[task[i].out] = getBuffer(ctx.vars[task[i].var], task[i].len).slice();
                break;
            default:
                throw new Error("Invalid cmd");
            }
        }
        const u32b = new Uint32Array(memory.buffer, 0, 1);
        u32b[0] = oldAlloc;
        return ctx.out;
    }


    return runTask;
})(self)`;if(globalThis!=null&&globalThis.Blob){const i=new TextEncoder().encode(Le),t=new Blob([i],{type:"application/javascript"});Eo=URL.createObjectURL(t)}else Eo="data:application/javascript;base64,"+globalThis.btoa(Le);async function fc(i,t){const n=new pc;n.memory=new WebAssembly.Memory({initial:mo}),n.u8=new Uint8Array(n.memory.buffer),n.u32=new Uint32Array(n.memory.buffer);const o=await WebAssembly.compile(i.code);if(n.instance=await WebAssembly.instantiate(o,{env:{memory:n.memory}}),globalThis!=null&&globalThis.Worker||(t=!0),n.singleThread=t,n.initalPFree=n.u32[0],n.pq=i.pq,n.pr=i.pr,n.pG1gen=i.pG1gen,n.pG1zero=i.pG1zero,n.pG2gen=i.pG2gen,n.pG2zero=i.pG2zero,n.pOneT=i.pOneT,t)n.code=i.code,n.taskManager=_c(),await n.taskManager([{cmd:"INIT",init:mo,code:n.code.slice()}]),n.concurrency=1;else{n.workers=[],n.pendingDeferreds=[],n.working=[];let c=2;typeof navigator=="object"&&navigator.hardwareConcurrency&&(c=navigator.hardwareConcurrency),c==0&&(c=2),c>64&&(c=64),n.concurrency=c;for(let d=0;d<c;d++)n.workers[d]=new Worker(Eo),n.workers[d].addEventListener("message",e(d)),n.working[d]=!1;const f=[];for(let d=0;d<n.workers.length;d++){const b=i.code.slice();f.push(n.postAction(d,[{cmd:"INIT",init:mo,code:b}],[b.buffer]))}await Promise.all(f)}return n;function e(c){return function(f){let d;f&&f.data?d=f.data:d=f,n.working[c]=!1,n.pendingDeferreds[c].resolve(d),n.processWorks()}}}class pc{constructor(){this.actionQueue=[],this.oldPFree=0}startSyncOp(){if(this.oldPFree!=0)throw new Error("Sync operation in progress");this.oldPFree=this.u32[0]}endSyncOp(){if(this.oldPFree==0)throw new Error("No sync operation in progress");this.u32[0]=this.oldPFree,this.oldPFree=0}postAction(t,n,o,e){if(this.working[t])throw new Error("Posting a job t a working worker");return this.working[t]=!0,this.pendingDeferreds[t]=e||new pe,this.workers[t].postMessage(n,o),this.pendingDeferreds[t].promise}processWorks(){for(let t=0;t<this.workers.length&&this.actionQueue.length>0;t++)if(this.working[t]==!1){const n=this.actionQueue.shift();this.postAction(t,n.data,n.transfers,n.deferred)}}queueAction(t,n){const o=new pe;if(this.singleThread){const e=this.taskManager(t);o.resolve(e)}else this.actionQueue.push({data:t,transfers:n,deferred:o}),this.processWorks();return o.promise}resetMemory(){this.u32[0]=this.initalPFree}allocBuff(t){const n=this.alloc(t.byteLength);return this.setBuff(n,t),n}getBuff(t,n){return this.u8.slice(t,t+n)}setBuff(t,n){this.u8.set(new Uint8Array(n),t)}alloc(t){for(;this.u32[0]&3;)this.u32[0]++;const n=this.u32[0];return this.u32[0]+=t,n}async terminate(){for(let t=0;t<this.workers.length;t++)this.workers[t].postMessage([{cmd:"TERMINATE"}]);await gc(200)}}function bo(i,t){const n=i[t],o=i.Fr,e=i.tm;i[t].batchApplyKey=async function(c,f,d,b,g){b=b||"affine",g=g||"affine";let s,y,w,h,T;if(t=="G1")b=="jacobian"?(w=n.F.n8*3,s="g1m_batchApplyKey"):(w=n.F.n8*2,s="g1m_batchApplyKeyMixed"),h=n.F.n8*3,g=="jacobian"?T=n.F.n8*3:(y="g1m_batchToAffine",T=n.F.n8*2);else if(t=="G2")b=="jacobian"?(w=n.F.n8*3,s="g2m_batchApplyKey"):(w=n.F.n8*2,s="g2m_batchApplyKeyMixed"),h=n.F.n8*3,g=="jacobian"?T=n.F.n8*3:(y="g2m_batchToAffine",T=n.F.n8*2);else if(t=="Fr")s="frm_batchApplyKey",w=n.n8,h=n.n8,T=n.n8;else throw new Error("Invalid group: "+t);const k=Math.floor(c.byteLength/w),x=Math.floor(k/e.concurrency),O=[];d=o.e(d);let B=o.e(f);for(let C=0;C<e.concurrency;C++){let u;if(C<e.concurrency-1?u=x:u=k-C*x,u==0)continue;const L=[];L.push({cmd:"ALLOCSET",var:0,buff:c.slice(C*x*w,C*x*w+u*w)}),L.push({cmd:"ALLOCSET",var:1,buff:B}),L.push({cmd:"ALLOCSET",var:2,buff:d}),L.push({cmd:"ALLOC",var:3,len:u*Math.max(h,T)}),L.push({cmd:"CALL",fnName:s,params:[{var:0},{val:u},{var:1},{var:2},{var:3}]}),y&&L.push({cmd:"CALL",fnName:y,params:[{var:3},{val:u},{var:3}]}),L.push({cmd:"GET",out:0,var:3,len:u*T}),O.push(e.queueAction(L)),B=o.mul(B,o.exp(d,u))}const Q=await Promise.all(O);let E;c instanceof Ot?E=new Ot(k*T):E=new Uint8Array(k*T);let nt=0;for(let C=0;C<Q.length;C++)E.set(Q[C][0],nt),nt+=Q[C][0].byteLength;return E}}function Lc(i){const t=i.tm;i.pairing=function(o,e){t.startSyncOp();const c=t.allocBuff(i.G1.toJacobian(o)),f=t.allocBuff(i.G2.toJacobian(e)),d=t.alloc(i.Gt.n8);t.instance.exports[i.name+"_pairing"](c,f,d);const b=t.getBuff(d,i.Gt.n8);return t.endSyncOp(),b},i.pairingEq=async function(){let o,e;arguments.length%2==1?(o=arguments[arguments.length-1],e=(arguments.length-1)/2):(o=i.Gt.one,e=arguments.length/2);const c=[];for(let s=0;s<e;s++){const y=[],w=i.G1.toJacobian(arguments[s*2]);y.push({cmd:"ALLOCSET",var:0,buff:w}),y.push({cmd:"ALLOC",var:1,len:i.prePSize});const h=i.G2.toJacobian(arguments[s*2+1]);y.push({cmd:"ALLOCSET",var:2,buff:h}),y.push({cmd:"ALLOC",var:3,len:i.preQSize}),y.push({cmd:"ALLOC",var:4,len:i.Gt.n8}),y.push({cmd:"CALL",fnName:i.name+"_prepareG1",params:[{var:0},{var:1}]}),y.push({cmd:"CALL",fnName:i.name+"_prepareG2",params:[{var:2},{var:3}]}),y.push({cmd:"CALL",fnName:i.name+"_millerLoop",params:[{var:1},{var:3},{var:4}]}),y.push({cmd:"GET",out:0,var:4,len:i.Gt.n8}),c.push(t.queueAction(y))}const f=await Promise.all(c);t.startSyncOp();const d=t.alloc(i.Gt.n8);t.instance.exports.ftm_one(d);for(let s=0;s<f.length;s++){const y=t.allocBuff(f[s][0]);t.instance.exports.ftm_mul(d,y,d)}t.instance.exports[i.name+"_finalExponentiation"](d,d);const b=t.allocBuff(o),g=!!t.instance.exports.ftm_eq(d,b);return t.endSyncOp(),g},i.prepareG1=function(n){this.tm.startSyncOp();const o=this.tm.allocBuff(n),e=this.tm.alloc(this.prePSize);this.tm.instance.exports[this.name+"_prepareG1"](o,e);const c=this.tm.getBuff(e,this.prePSize);return this.tm.endSyncOp(),c},i.prepareG2=function(n){this.tm.startSyncOp();const o=this.tm.allocBuff(n),e=this.tm.alloc(this.preQSize);this.tm.instance.exports[this.name+"_prepareG2"](o,e);const c=this.tm.getBuff(e,this.preQSize);return this.tm.endSyncOp(),c},i.millerLoop=function(n,o){this.tm.startSyncOp();const e=this.tm.allocBuff(n),c=this.tm.allocBuff(o),f=this.tm.alloc(this.Gt.n8);this.tm.instance.exports[this.name+"_millerLoop"](e,c,f);const d=this.tm.getBuff(f,this.Gt.n8);return this.tm.endSyncOp(),d},i.finalExponentiation=function(n){this.tm.startSyncOp();const o=this.tm.allocBuff(n),e=this.tm.alloc(this.Gt.n8);this.tm.instance.exports[this.name+"_finalExponentiation"](o,e);const c=this.tm.getBuff(e,this.Gt.n8);return this.tm.endSyncOp(),c}}const he=[1,1,1,1,2,3,4,5,6,7,7,8,9,10,11,12,13,13,14,15,16,16,17,17,17,17,17,17,17,17,17,17];function me(i,t){const n=i[t],o=n.tm;async function e(f,d,b,g,s){if(!(f instanceof Uint8Array))throw g&&g.error(`${s} _multiExpChunk buffBases is not Uint8Array`),new Error(`${s} _multiExpChunk buffBases is not Uint8Array`);if(!(d instanceof Uint8Array))throw g&&g.error(`${s} _multiExpChunk buffScalars is not Uint8Array`),new Error(`${s} _multiExpChunk buffScalars is not Uint8Array`);b=b||"affine";let y,w;if(t=="G1")b=="affine"?(w="g1m_multiexpAffine_chunk",y=n.F.n8*2):(w="g1m_multiexp_chunk",y=n.F.n8*3);else if(t=="G2")b=="affine"?(w="g2m_multiexpAffine_chunk",y=n.F.n8*2):(w="g2m_multiexp_chunk",y=n.F.n8*3);else throw new Error("Invalid group");const h=Math.floor(f.byteLength/y);if(h==0)return n.zero;const T=Math.floor(d.byteLength/h);if(T*h!=d.byteLength)throw new Error("Scalar size does not match");const k=he[Zt(h)],x=Math.floor((T*8-1)/k)+1,O=[];for(let E=0;E<x;E++){const nt=[{cmd:"ALLOCSET",var:0,buff:f},{cmd:"ALLOCSET",var:1,buff:d},{cmd:"ALLOC",var:2,len:n.F.n8*3},{cmd:"CALL",fnName:w,params:[{var:0},{var:1},{val:T},{val:h},{val:E*k},{val:Math.min(T*8-E*k,k)},{var:2}]},{cmd:"GET",out:0,var:2,len:n.F.n8*3}];O.push(n.tm.queueAction(nt))}const B=await Promise.all(O);let Q=n.zero;for(let E=B.length-1;E>=0;E--){if(!n.isZero(Q))for(let nt=0;nt<k;nt++)Q=n.double(Q);Q=n.add(Q,B[E][0])}return Q}async function c(f,d,b,g,s){let h;if(t=="G1")b=="affine"?h=n.F.n8*2:h=n.F.n8*3;else if(t=="G2")b=="affine"?h=n.F.n8*2:h=n.F.n8*3;else throw new Error("Invalid group");const T=Math.floor(f.byteLength/h);if(T==0)return n.zero;const k=Math.floor(d.byteLength/T);if(k*T!=d.byteLength)throw new Error("Scalar size does not match");const x=he[Zt(T)],O=Math.floor((k*8-1)/x)+1;let B;B=Math.floor(T/(o.concurrency/O)),B>4194304&&(B=4194304),B<1024&&(B=1024);const Q=[];for(let C=0;C<T;C+=B){g&&g.debug(`Multiexp start: ${s}: ${C}/${T}`);const u=Math.min(T-C,B),L=f.slice(C*h,(C+u)*h),$=d.slice(C*k,(C+u)*k);Q.push(e(L,$,b,g,s).then(K=>(g&&g.debug(`Multiexp end: ${s}: ${C}/${T}`),K)))}const E=await Promise.all(Q);let nt=n.zero;for(let C=E.length-1;C>=0;C--)nt=n.add(nt,E[C]);return nt}n.multiExp=async function(d,b,g,s){return await c(d,b,"jacobian",g,s)},n.multiExpAffine=async function(d,b,g,s){return await c(d,b,"affine",g,s)}}function yo(i,t){const n=i[t],o=i.Fr,e=n.tm;async function c(g,s,y,w,h,T){y=y||"affine",w=w||"affine";const k=14;let x,O,B,Q,E,nt,C,u;t=="G1"?(y=="affine"?(x=n.F.n8*2,Q="g1m_batchToJacobian"):x=n.F.n8*3,O=n.F.n8*3,s&&(u="g1m_fftFinal"),C="g1m_fftJoin",nt="g1m_fftMix",w=="affine"?(B=n.F.n8*2,E="g1m_batchToAffine"):B=n.F.n8*3):t=="G2"?(y=="affine"?(x=n.F.n8*2,Q="g2m_batchToJacobian"):x=n.F.n8*3,O=n.F.n8*3,s&&(u="g2m_fftFinal"),C="g2m_fftJoin",nt="g2m_fftMix",w=="affine"?(B=n.F.n8*2,E="g2m_batchToAffine"):B=n.F.n8*3):t=="Fr"&&(x=n.n8,O=n.n8,B=n.n8,s&&(u="frm_fftFinal"),nt="frm_fftMix",C="frm_fftJoin");let L=!1;Array.isArray(g)?(g=jo(g,x),L=!0):g=g.slice(0,g.byteLength);const $=g.byteLength/x,K=Zt($);if(1<<K!=$)throw new Error("fft must be multiple of 2");if(K==o.s+1){let j;return s?j=await d(g,y,w,h,T):j=await f(g,y,w,h,T),L?to(j,B):j}let J;s&&(J=o.inv(o.e($)));let P;da(g,x);let m,I=Math.min(1<<k,$),U=$/I;for(;U<e.concurrency&&I>=16;)U*=2,I/=2;const et=Zt(I),Y=[];for(let j=0;j<U;j++){h&&h.debug(`${T}: fft ${K} mix start: ${j}/${U}`);const ct=[];ct.push({cmd:"ALLOC",var:0,len:O*I});const H=g.slice(I*j*x,I*(j+1)*x);ct.push({cmd:"SET",var:0,buff:H}),Q&&ct.push({cmd:"CALL",fnName:Q,params:[{var:0},{val:I},{var:0}]});for(let at=1;at<=et;at++)ct.push({cmd:"CALL",fnName:nt,params:[{var:0},{val:I},{val:at}]});et==K?(u&&(ct.push({cmd:"ALLOCSET",var:1,buff:J}),ct.push({cmd:"CALL",fnName:u,params:[{var:0},{val:I},{var:1}]})),E&&ct.push({cmd:"CALL",fnName:E,params:[{var:0},{val:I},{var:0}]}),ct.push({cmd:"GET",out:0,var:0,len:I*B})):ct.push({cmd:"GET",out:0,var:0,len:O*I}),Y.push(e.queueAction(ct).then(at=>(h&&h.debug(`${T}: fft ${K} mix end: ${j}/${U}`),at)))}m=await Promise.all(Y);for(let j=0;j<U;j++)m[j]=m[j][0];for(let j=et+1;j<=K;j++){h&&h.debug(`${T}: fft  ${K}  join: ${j}/${K}`);const ct=1<<K-j,H=U/ct,at=[];for(let vt=0;vt<ct;vt++)for(let ht=0;ht<H/2;ht++){const A=o.exp(o.w[j],ht*I),a=o.w[j],F=vt*H+ht,l=vt*H+ht+H/2,R=[];R.push({cmd:"ALLOCSET",var:0,buff:m[F]}),R.push({cmd:"ALLOCSET",var:1,buff:m[l]}),R.push({cmd:"ALLOCSET",var:2,buff:A}),R.push({cmd:"ALLOCSET",var:3,buff:a}),R.push({cmd:"CALL",fnName:C,params:[{var:0},{var:1},{val:I},{var:2},{var:3}]}),j==K?(u&&(R.push({cmd:"ALLOCSET",var:4,buff:J}),R.push({cmd:"CALL",fnName:u,params:[{var:0},{val:I},{var:4}]}),R.push({cmd:"CALL",fnName:u,params:[{var:1},{val:I},{var:4}]})),E&&(R.push({cmd:"CALL",fnName:E,params:[{var:0},{val:I},{var:0}]}),R.push({cmd:"CALL",fnName:E,params:[{var:1},{val:I},{var:1}]})),R.push({cmd:"GET",out:0,var:0,len:I*B}),R.push({cmd:"GET",out:1,var:1,len:I*B})):(R.push({cmd:"GET",out:0,var:0,len:I*O}),R.push({cmd:"GET",out:1,var:1,len:I*O})),at.push(e.queueAction(R).then(v=>(h&&h.debug(`${T}: fft ${K} join  ${j}/${K}  ${vt+1}/${ct} ${ht}/${H/2}`),v)))}const Pt=await Promise.all(at);for(let vt=0;vt<ct;vt++)for(let ht=0;ht<H/2;ht++){const A=vt*H+ht,a=vt*H+ht+H/2,F=Pt.shift();m[A]=F[0],m[a]=F[1]}}if(g instanceof Ot?P=new Ot($*B):P=new Uint8Array($*B),s){P.set(m[0].slice((I-1)*B));let j=B;for(let ct=U-1;ct>0;ct--)P.set(m[ct],j),j+=I*B,delete m[ct];P.set(m[0].slice(0,(I-1)*B),j),delete m[0]}else for(let j=0;j<U;j++)P.set(m[j],I*B*j),delete m[j];return L?to(P,B):P}async function f(g,s,y,w,h){let T,k;T=g.slice(0,g.byteLength/2),k=g.slice(g.byteLength/2,g.byteLength);const x=[];[T,k]=await b(T,k,"fftJoinExt",o.one,o.shift,s,"jacobian",w,h),x.push(c(T,!1,"jacobian",y,w,h)),x.push(c(k,!1,"jacobian",y,w,h));const O=await Promise.all(x);let B;return O[0].byteLength>1<<28?B=new Ot(O[0].byteLength*2):B=new Uint8Array(O[0].byteLength*2),B.set(O[0]),B.set(O[1],O[0].byteLength),B}async function d(g,s,y,w,h){let T,k;T=g.slice(0,g.byteLength/2),k=g.slice(g.byteLength/2,g.byteLength);const x=[];x.push(c(T,!0,s,"jacobian",w,h)),x.push(c(k,!0,s,"jacobian",w,h)),[T,k]=await Promise.all(x);const O=await b(T,k,"fftJoinExtInv",o.one,o.shiftInv,"jacobian",y,w,h);let B;return O[0].byteLength>1<<28?B=new Ot(O[0].byteLength*2):B=new Uint8Array(O[0].byteLength*2),B.set(O[0]),B.set(O[1],O[0].byteLength),B}async function b(g,s,y,w,h,T,k,x,O){let E,nt,C,u,L,$;if(t=="G1")T=="affine"?(L=n.F.n8*2,nt="g1m_batchToJacobian"):L=n.F.n8*3,$=n.F.n8*3,E="g1m_"+y,k=="affine"?(C="g1m_batchToAffine",u=n.F.n8*2):u=n.F.n8*3;else if(t=="G2")T=="affine"?(L=n.F.n8*2,nt="g2m_batchToJacobian"):L=n.F.n8*3,E="g2m_"+y,$=n.F.n8*3,k=="affine"?(C="g2m_batchToAffine",u=n.F.n8*2):u=n.F.n8*3;else if(t=="Fr")L=o.n8,u=o.n8,$=o.n8,E="frm_"+y;else throw new Error("Invalid group");if(g.byteLength!=s.byteLength)throw new Error("Invalid buffer size");const K=Math.floor(g.byteLength/L);if(K!=1<<Zt(K))throw new Error("Invalid number of points");let J=Math.floor(K/e.concurrency);J<16&&(J=16),J>65536&&(J=65536);const P=[];for(let Y=0;Y<K;Y+=J){x&&x.debug(`${O}: fftJoinExt Start: ${Y}/${K}`);const j=Math.min(K-Y,J),ct=o.mul(w,o.exp(h,Y)),H=[],at=g.slice(Y*L,(Y+j)*L),Pt=s.slice(Y*L,(Y+j)*L);H.push({cmd:"ALLOC",var:0,len:$*j}),H.push({cmd:"SET",var:0,buff:at}),H.push({cmd:"ALLOC",var:1,len:$*j}),H.push({cmd:"SET",var:1,buff:Pt}),H.push({cmd:"ALLOCSET",var:2,buff:ct}),H.push({cmd:"ALLOCSET",var:3,buff:h}),nt&&(H.push({cmd:"CALL",fnName:nt,params:[{var:0},{val:j},{var:0}]}),H.push({cmd:"CALL",fnName:nt,params:[{var:1},{val:j},{var:1}]})),H.push({cmd:"CALL",fnName:E,params:[{var:0},{var:1},{val:j},{var:2},{var:3},{val:o.s}]}),C&&(H.push({cmd:"CALL",fnName:C,params:[{var:0},{val:j},{var:0}]}),H.push({cmd:"CALL",fnName:C,params:[{var:1},{val:j},{var:1}]})),H.push({cmd:"GET",out:0,var:0,len:j*u}),H.push({cmd:"GET",out:1,var:1,len:j*u}),P.push(e.queueAction(H).then(vt=>(x&&x.debug(`${O}: fftJoinExt End: ${Y}/${K}`),vt)))}const m=await Promise.all(P);let I,U;K*u>1<<28?(I=new Ot(K*u),U=new Ot(K*u)):(I=new Uint8Array(K*u),U=new Uint8Array(K*u));let et=0;for(let Y=0;Y<m.length;Y++)I.set(m[Y][0],et),U.set(m[Y][1],et),et+=m[Y][0].byteLength;return[I,U]}n.fft=async function(g,s,y,w,h){return await c(g,!1,s,y,w,h)},n.ifft=async function(g,s,y,w,h){return await c(g,!0,s,y,w,h)},n.lagrangeEvaluations=async function(g,s,y,w,h){s=s||"affine",y=y||"affine";let T;if(t=="G1")s=="affine"?T=n.F.n8*2:T=n.F.n8*3;else if(t=="G2")s=="affine"?T=n.F.n8*2:T=n.F.n8*3;else if(t=="Fr")T=o.n8;else throw new Error("Invalid group");const k=g.byteLength/T,x=Zt(k);if(2**x*T!=g.byteLength)throw w&&w.error("lagrangeEvaluations iinvalid input size"),new Error("lagrangeEvaluations invalid Input size");if(x<=o.s)return await n.ifft(g,s,y,w,h);if(x>o.s+1)throw w&&w.error("lagrangeEvaluations input too big"),new Error("lagrangeEvaluations input too big");let O=g.slice(0,g.byteLength/2),B=g.slice(g.byteLength/2,g.byteLength);const Q=o.exp(o.shift,k/2),E=o.inv(o.sub(o.one,Q));[O,B]=await b(O,B,"prepareLagrangeEvaluation",E,o.shiftInv,s,"jacobian",w,h+" prep");const nt=[];nt.push(c(O,!0,"jacobian",y,w,h+" t0")),nt.push(c(B,!0,"jacobian",y,w,h+" t1")),[O,B]=await Promise.all(nt);let C;return O.byteLength>1<<28?C=new Ot(O.byteLength*2):C=new Uint8Array(O.byteLength*2),C.set(O),C.set(B,O.byteLength),C},n.fftMix=async function(s){const y=n.F.n8*3;let w,h;if(t=="G1")w="g1m_fftMix",h="g1m_fftJoin";else if(t=="G2")w="g2m_fftMix",h="g2m_fftJoin";else if(t=="Fr")w="frm_fftMix",h="frm_fftJoin";else throw new Error("Invalid group");const T=Math.floor(s.byteLength/y),k=Zt(T);let x=1<<Zt(e.concurrency);T<=x*2&&(x=1);const O=T/x,B=Zt(O),Q=[];for(let L=0;L<x;L++){const $=[],K=s.slice(L*O*y,(L+1)*O*y);$.push({cmd:"ALLOCSET",var:0,buff:K});for(let J=1;J<=B;J++)$.push({cmd:"CALL",fnName:w,params:[{var:0},{val:O},{val:J}]});$.push({cmd:"GET",out:0,var:0,len:O*y}),Q.push(e.queueAction($))}const E=await Promise.all(Q),nt=[];for(let L=0;L<E.length;L++)nt[L]=E[L][0];for(let L=B+1;L<=k;L++){const $=1<<k-L,K=x/$,J=[];for(let m=0;m<$;m++)for(let I=0;I<K/2;I++){const U=o.exp(o.w[L],I*O),et=o.w[L],Y=m*K+I,j=m*K+I+K/2,ct=[];ct.push({cmd:"ALLOCSET",var:0,buff:nt[Y]}),ct.push({cmd:"ALLOCSET",var:1,buff:nt[j]}),ct.push({cmd:"ALLOCSET",var:2,buff:U}),ct.push({cmd:"ALLOCSET",var:3,buff:et}),ct.push({cmd:"CALL",fnName:h,params:[{var:0},{var:1},{val:O},{var:2},{var:3}]}),ct.push({cmd:"GET",out:0,var:0,len:O*y}),ct.push({cmd:"GET",out:1,var:1,len:O*y}),J.push(e.queueAction(ct))}const P=await Promise.all(J);for(let m=0;m<$;m++)for(let I=0;I<K/2;I++){const U=m*K+I,et=m*K+I+K/2,Y=P.shift();nt[U]=Y[0],nt[et]=Y[1]}}let C;s instanceof Ot?C=new Ot(T*y):C=new Uint8Array(T*y);let u=0;for(let L=0;L<x;L++)C.set(nt[L],u),u+=nt[L].byteLength;return C},n.fftJoin=async function(s,y,w,h){const T=n.F.n8*3;let k;if(t=="G1")k="g1m_fftJoin";else if(t=="G2")k="g2m_fftJoin";else if(t=="Fr")k="frm_fftJoin";else throw new Error("Invalid group");if(s.byteLength!=y.byteLength)throw new Error("Invalid buffer size");const x=Math.floor(s.byteLength/T);if(x!=1<<Zt(x))throw new Error("Invalid number of points");let O=1<<Zt(e.concurrency);x<=O*2&&(O=1);const B=x/O,Q=[];for(let L=0;L<O;L++){const $=[],K=o.mul(w,o.exp(h,L*B)),J=s.slice(L*B*T,(L+1)*B*T),P=y.slice(L*B*T,(L+1)*B*T);$.push({cmd:"ALLOCSET",var:0,buff:J}),$.push({cmd:"ALLOCSET",var:1,buff:P}),$.push({cmd:"ALLOCSET",var:2,buff:K}),$.push({cmd:"ALLOCSET",var:3,buff:h}),$.push({cmd:"CALL",fnName:k,params:[{var:0},{var:1},{val:B},{var:2},{var:3}]}),$.push({cmd:"GET",out:0,var:0,len:B*T}),$.push({cmd:"GET",out:1,var:1,len:B*T}),Q.push(e.queueAction($))}const E=await Promise.all(Q);let nt,C;s instanceof Ot?(nt=new Ot(x*T),C=new Ot(x*T)):(nt=new Uint8Array(x*T),C=new Uint8Array(x*T));let u=0;for(let L=0;L<E.length;L++)nt.set(E[L][0],u),C.set(E[L][1],u),u+=E[L][0].byteLength;return[nt,C]},n.fftFinal=async function(s,y){const w=n.F.n8*3,h=n.F.n8*2;let T,k;if(t=="G1")T="g1m_fftFinal",k="g1m_batchToAffine";else if(t=="G2")T="g2m_fftFinal",k="g2m_batchToAffine";else throw new Error("Invalid group");const x=Math.floor(s.byteLength/w);if(x!=1<<Zt(x))throw new Error("Invalid number of points");const O=Math.floor(x/e.concurrency),B=[];for(let C=0;C<e.concurrency;C++){let u;if(C<e.concurrency-1?u=O:u=x-C*O,u==0)continue;const L=[],$=s.slice(C*O*w,(C*O+u)*w);L.push({cmd:"ALLOCSET",var:0,buff:$}),L.push({cmd:"ALLOCSET",var:1,buff:y}),L.push({cmd:"CALL",fnName:T,params:[{var:0},{val:u},{var:1}]}),L.push({cmd:"CALL",fnName:k,params:[{var:0},{val:u},{var:0}]}),L.push({cmd:"GET",out:0,var:0,len:u*h}),B.push(e.queueAction(L))}const Q=await Promise.all(B);let E;s instanceof Ot?E=new Ot(x*h):E=new Uint8Array(x*h);let nt=0;for(let C=Q.length-1;C>=0;C--)E.set(Q[C][0],nt),nt+=Q[C][0].byteLength;return E}}async function ua(i){const t=await fc(i.wasm,i.singleThread),n={};return n.q=kt(i.wasm.q.toString()),n.r=kt(i.wasm.r.toString()),n.name=i.name,n.tm=t,n.prePSize=i.wasm.prePSize,n.preQSize=i.wasm.preQSize,n.Fr=new _e(t,"frm",i.n8r,i.r),n.F1=new _e(t,"f1m",i.n8q,i.q),n.F2=new ge(t,"f2m",n.F1),n.G1=new fe(t,"g1m",n.F1,i.wasm.pG1gen,i.wasm.pG1b,i.cofactorG1),n.G2=new fe(t,"g2m",n.F2,i.wasm.pG2gen,i.wasm.pG2b,i.cofactorG2),n.F6=new uc(t,"f6m",n.F2),n.F12=new ge(t,"ftm",n.F6),n.Gt=n.F12,bo(n,"G1"),bo(n,"G2"),bo(n,"Fr"),me(n,"G1"),me(n,"G2"),yo(n,"G1"),yo(n,"G2"),yo(n,"Fr"),Lc(n),n.array2buffer=function(o,e){const c=new Uint8Array(e*o.length);for(let f=0;f<o.length;f++)c.set(o[f],f*e);return c},n.buffer2array=function(o,e){const c=o.byteLength/e,f=new Array(c);for(let d=0;d<c;d++)f[d]=o.slice(d*e,d*e+e);return f},n}function An(i){return BigInt(i)}function _a(i){return i<0n}function hc(i){return i===0n}function mc(i){return _a(i)?i.toString(2).length-1:i.toString(2).length}function wo(i){const t=[],n=An(i);return t.push(Number(n&0xFFn)),t.push(Number(n>>8n&0xFFn)),t.push(Number(n>>16n&0xFFn)),t.push(Number(n>>24n&0xFFn)),t}function bc(i){for(var t=[],n=0;n<i.length;n++){var o=i.charCodeAt(n);o<128?t.push(o):o<2048?t.push(192|o>>6,128|o&63):o<55296||o>=57344?t.push(224|o>>12,128|o>>6&63,128|o&63):(n++,o=65536+((o&1023)<<10|i.charCodeAt(n)&1023),t.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63))}return t}function Mn(i){const t=bc(i);return[...Ft(t.length),...t]}function ga(i){const t=[];let n=An(i);if(_a(n))throw new Error("Number cannot be negative");for(;!hc(n);)t.push(Number(n&0x7Fn)),n=n>>7n;t.length==0&&t.push(0);for(let o=0;o<t.length-1;o++)t[o]=t[o]|128;return t}function fa(i){let t,n;const o=mc(i);i<0?(n=!0,t=(1n<<BigInt(o))+i):(n=!1,t=An(i));const e=7-o%7,c=(1n<<BigInt(e))-1n<<BigInt(o),f=(1<<7-e)-1|128,d=ga(t+c);return n||(d[d.length-1]=d[d.length-1]&f),d}function Po(i){let t=An(i);if(t>0xFFFFFFFFn)throw new Error("Number too big");if(t>0x7FFFFFFFn&&(t=t-0x100000000n),t<-2147483648n)throw new Error("Number too small");return fa(t)}function yc(i){let t=An(i);if(t>0xFFFFFFFFFFFFFFFFn)throw new Error("Number too big");if(t>0x7FFFFFFFFFFFFFFFn&&(t=t-0x10000000000000000n),t<-9223372036854775808n)throw new Error("Number too small");return fa(t)}function Ft(i){let t=An(i);if(t>0xFFFFFFFFn)throw new Error("Number too big");return ga(t)}function be(i){return Array.from(i,function(t){return("0"+(t&255).toString(16)).slice(-2)}).join("")}class wc{constructor(t){this.func=t,this.functionName=t.functionName,this.module=t.module}setLocal(t,n){const o=this.func.localIdxByName[t];if(o===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[...n,33,...Ft(o)]}teeLocal(t,n){const o=this.func.localIdxByName[t];if(o===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[...n,34,...Ft(o)]}getLocal(t){const n=this.func.localIdxByName[t];if(n===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[32,...Ft(n)]}i64_load8_s(t,n,o){const e=n||0,c=o===void 0?0:o;return[...t,48,c,...Ft(e)]}i64_load8_u(t,n,o){const e=n||0,c=o===void 0?0:o;return[...t,49,c,...Ft(e)]}i64_load16_s(t,n,o){const e=n||0,c=o===void 0?1:o;return[...t,50,c,...Ft(e)]}i64_load16_u(t,n,o){const e=n||0,c=o===void 0?1:o;return[...t,51,c,...Ft(e)]}i64_load32_s(t,n,o){const e=n||0,c=o===void 0?2:o;return[...t,52,c,...Ft(e)]}i64_load32_u(t,n,o){const e=n||0,c=o===void 0?2:o;return[...t,53,c,...Ft(e)]}i64_load(t,n,o){const e=n||0,c=o===void 0?3:o;return[...t,41,c,...Ft(e)]}i64_store(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=3,d=n):Array.isArray(o)?(c=n,f=3,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,55,f,...Ft(c)]}i64_store32(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=2,d=n):Array.isArray(o)?(c=n,f=2,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,62,f,...Ft(c)]}i64_store16(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=1,d=n):Array.isArray(o)?(c=n,f=1,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,61,f,...Ft(c)]}i64_store8(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=0,d=n):Array.isArray(o)?(c=n,f=0,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,60,f,...Ft(c)]}i32_load8_s(t,n,o){const e=n||0,c=o===void 0?0:o;return[...t,44,c,...Ft(e)]}i32_load8_u(t,n,o){const e=n||0,c=o===void 0?0:o;return[...t,45,c,...Ft(e)]}i32_load16_s(t,n,o){const e=n||0,c=o===void 0?1:o;return[...t,46,c,...Ft(e)]}i32_load16_u(t,n,o){const e=n||0,c=o===void 0?1:o;return[...t,47,c,...Ft(e)]}i32_load(t,n,o){const e=n||0,c=o===void 0?2:o;return[...t,40,c,...Ft(e)]}i32_store(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=2,d=n):Array.isArray(o)?(c=n,f=2,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,54,f,...Ft(c)]}i32_store16(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=1,d=n):Array.isArray(o)?(c=n,f=1,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,59,f,...Ft(c)]}i32_store8(t,n,o,e){let c,f,d;return Array.isArray(n)?(c=0,f=0,d=n):Array.isArray(o)?(c=n,f=0,d=o):Array.isArray(e)&&(c=n,f=o,d=e),[...t,...d,58,f,...Ft(c)]}call(t,...n){const o=this.module.functionIdxByName[t];if(o===void 0)throw new Error(`Function not defined: Function: ${t}`);return[...[].concat(...n),16,...Ft(o)]}call_indirect(t,...n){return[...[].concat(...n),...t,17,0,0]}if(t,n,o){return o?[...t,4,64,...n,5,...o,11]:[...t,4,64,...n,11]}block(t){return[2,64,...t,11]}loop(...t){return[3,64,...[].concat(...t),11]}br_if(t,n){return[...n,13,...Ft(t)]}br(t){return[12,...Ft(t)]}ret(t){return[...t,15]}drop(t){return[...t,26]}i64_const(t){return[66,...yc(t)]}i32_const(t){return[65,...Po(t)]}i64_eqz(t){return[...t,80]}i64_eq(t,n){return[...t,...n,81]}i64_ne(t,n){return[...t,...n,82]}i64_lt_s(t,n){return[...t,...n,83]}i64_lt_u(t,n){return[...t,...n,84]}i64_gt_s(t,n){return[...t,...n,85]}i64_gt_u(t,n){return[...t,...n,86]}i64_le_s(t,n){return[...t,...n,87]}i64_le_u(t,n){return[...t,...n,88]}i64_ge_s(t,n){return[...t,...n,89]}i64_ge_u(t,n){return[...t,...n,90]}i64_add(t,n){return[...t,...n,124]}i64_sub(t,n){return[...t,...n,125]}i64_mul(t,n){return[...t,...n,126]}i64_div_s(t,n){return[...t,...n,127]}i64_div_u(t,n){return[...t,...n,128]}i64_rem_s(t,n){return[...t,...n,129]}i64_rem_u(t,n){return[...t,...n,130]}i64_and(t,n){return[...t,...n,131]}i64_or(t,n){return[...t,...n,132]}i64_xor(t,n){return[...t,...n,133]}i64_shl(t,n){return[...t,...n,134]}i64_shr_s(t,n){return[...t,...n,135]}i64_shr_u(t,n){return[...t,...n,136]}i64_extend_i32_s(t){return[...t,172]}i64_extend_i32_u(t){return[...t,173]}i64_clz(t){return[...t,121]}i64_ctz(t){return[...t,122]}i32_eqz(t){return[...t,69]}i32_eq(t,n){return[...t,...n,70]}i32_ne(t,n){return[...t,...n,71]}i32_lt_s(t,n){return[...t,...n,72]}i32_lt_u(t,n){return[...t,...n,73]}i32_gt_s(t,n){return[...t,...n,74]}i32_gt_u(t,n){return[...t,...n,75]}i32_le_s(t,n){return[...t,...n,76]}i32_le_u(t,n){return[...t,...n,77]}i32_ge_s(t,n){return[...t,...n,78]}i32_ge_u(t,n){return[...t,...n,79]}i32_add(t,n){return[...t,...n,106]}i32_sub(t,n){return[...t,...n,107]}i32_mul(t,n){return[...t,...n,108]}i32_div_s(t,n){return[...t,...n,109]}i32_div_u(t,n){return[...t,...n,110]}i32_rem_s(t,n){return[...t,...n,111]}i32_rem_u(t,n){return[...t,...n,112]}i32_and(t,n){return[...t,...n,113]}i32_or(t,n){return[...t,...n,114]}i32_xor(t,n){return[...t,...n,115]}i32_shl(t,n){return[...t,...n,116]}i32_shr_s(t,n){return[...t,...n,117]}i32_shr_u(t,n){return[...t,...n,118]}i32_rotl(t,n){return[...t,...n,119]}i32_rotr(t,n){return[...t,...n,120]}i32_wrap_i64(t){return[...t,167]}i32_clz(t){return[...t,103]}i32_ctz(t){return[...t,104]}unreachable(){return[0]}current_memory(){return[63,0]}comment(){return[]}}const Bo={i32:127,i64:126,f32:125,f64:124,anyfunc:112,func:96,emptyblock:64};class ye{constructor(t,n,o,e,c){if(o=="import")this.fnType="import",this.moduleName=e,this.fieldName=c;else if(o=="internal")this.fnType="internal";else throw new Error("Invalid function fnType: "+o);this.module=t,this.fnName=n,this.params=[],this.locals=[],this.localIdxByName={},this.code=[],this.returnType=null,this.nextLocal=0}addParam(t,n){if(this.localIdxByName[t])throw new Error(`param already exists. Function: ${this.fnName}, Param: ${t} `);const o=this.nextLocal++;this.localIdxByName[t]=o,this.params.push({type:n})}addLocal(t,n,o){const e=o||1;if(this.localIdxByName[t])throw new Error(`local already exists. Function: ${this.fnName}, Param: ${t} `);const c=this.nextLocal++;this.localIdxByName[t]=c,this.locals.push({type:n,length:e})}setReturnType(t){if(this.returnType)throw new Error(`returnType already defined. Function: ${this.fnName}`);this.returnType=t}getSignature(){const t=[...Ft(this.params.length),...this.params.map(o=>Bo[o.type])],n=this.returnType?[1,Bo[this.returnType]]:[0];return[96,...t,...n]}getBody(){const t=this.locals.map(o=>[...Ft(o.length),Bo[o.type]]),n=[...Ft(this.locals.length),...[].concat(...t),...this.code,11];return[...Ft(n.length),...n]}addCode(...t){this.code.push(...[].concat(...t))}getCodeBuilder(){return new wc(this)}}class pa{constructor(){this.functions=[],this.functionIdxByName={},this.nImportFunctions=0,this.nInternalFunctions=0,this.memory={pagesSize:1,moduleName:"env",fieldName:"memory"},this.free=8,this.datas=[],this.modules={},this.exports=[],this.functionsTable=[]}build(){return this._setSignatures(),new Uint8Array([...wo(1836278016),...wo(1),...this._buildType(),...this._buildImport(),...this._buildFunctionDeclarations(),...this._buildFunctionsTable(),...this._buildExports(),...this._buildElements(),...this._buildCode(),...this._buildData()])}addFunction(t){if(typeof this.functionIdxByName[t]<"u")throw new Error(`Function already defined: ${t}`);const n=this.functions.length;return this.functionIdxByName[t]=n,this.functions.push(new ye(this,t,"internal")),this.nInternalFunctions++,this.functions[n]}addIimportFunction(t,n,o){if(typeof this.functionIdxByName[t]<"u")throw new Error(`Function already defined: ${t}`);if(this.functions.length>0&&this.functions[this.functions.length-1].type=="internal")throw new Error(`Import functions must be declared before internal: ${t}`);let e=o||t;const c=this.functions.length;return this.functionIdxByName[t]=c,this.functions.push(new ye(this,t,"import",n,e)),this.nImportFunctions++,this.functions[c]}setMemory(t,n,o){this.memory={pagesSize:t,moduleName:n||"env",fieldName:o||"memory"}}exportFunction(t,n){const o=n||t;if(typeof this.functionIdxByName[t]>"u")throw new Error(`Function not defined: ${t}`);const e=this.functionIdxByName[t];o!=t&&(this.functionIdxByName[o]=e),this.exports.push({exportName:o,idx:e})}addFunctionToTable(t){const n=this.functionIdxByName[t];this.functionsTable.push(n)}addData(t,n){this.datas.push({offset:t,bytes:n})}alloc(t,n){let o,e;(Array.isArray(t)||ArrayBuffer.isView(t))&&typeof n>"u"?(o=t.length,e=t):(o=t,e=n),o=(o-1>>3)+1<<3;const c=this.free;return this.free+=o,e&&this.addData(c,e),c}allocString(t){const o=new globalThis.TextEncoder().encode(t);return this.alloc([...o,0])}_setSignatures(){this.signatures=[];const t={};if(this.functionsTable.length>0){const n=this.functions[this.functionsTable[0]].getSignature(),o="s_"+be(n);t[o]=0,this.signatures.push(n)}for(let n=0;n<this.functions.length;n++){const o=this.functions[n].getSignature(),e="s_"+be(o);typeof t[e]>"u"&&(t[e]=this.signatures.length,this.signatures.push(o)),this.functions[n].signatureIdx=t[e]}}_buildSection(t,n){return[t,...Ft(n.length),...n]}_buildType(){return this._buildSection(1,[...Ft(this.signatures.length),...[].concat(...this.signatures)])}_buildImport(){const t=[];t.push([...Mn(this.memory.moduleName),...Mn(this.memory.fieldName),2,0,...Ft(this.memory.pagesSize)]);for(let n=0;n<this.nImportFunctions;n++)t.push([...Mn(this.functions[n].moduleName),...Mn(this.functions[n].fieldName),0,...Ft(this.functions[n].signatureIdx)]);return this._buildSection(2,Ft(t.length).concat(...t))}_buildFunctionDeclarations(){const t=[];for(let n=this.nImportFunctions;n<this.nImportFunctions+this.nInternalFunctions;n++)t.push(...Ft(this.functions[n].signatureIdx));return this._buildSection(3,[...Ft(t.length),...t])}_buildFunctionsTable(){return this.functionsTable.length==0?[]:this._buildSection(4,[...Ft(1),112,0,...Ft(this.functionsTable.length)])}_buildElements(){if(this.functionsTable.length==0)return[];const t=[];for(let n=0;n<this.functionsTable.length;n++)t.push(...Ft(this.functionsTable[n]));return this._buildSection(9,[...Ft(1),...Ft(0),65,...Po(0),11,...Ft(this.functionsTable.length),...t])}_buildExports(){const t=[];for(let n=0;n<this.exports.length;n++)t.push([...Mn(this.exports[n].exportName),0,...Ft(this.exports[n].idx)]);return this._buildSection(7,Ft(t.length).concat(...t))}_buildCode(){const t=[];for(let n=this.nImportFunctions;n<this.nImportFunctions+this.nInternalFunctions;n++)t.push(this.functions[n].getBody());return this._buildSection(10,Ft(t.length).concat(...t))}_buildData(){const t=[];t.push([0,65,0,11,4,...wo(this.free)]);for(let n=0;n<this.datas.length;n++)t.push([0,65,...Po(this.datas[n].offset),11,...Ft(this.datas[n].bytes.length),...this.datas[n].bytes]);return this._buildSection(11,Ft(t.length).concat(...t))}}globalThis.curve_bn128=null;async function La(i,t){if(!i&&globalThis.curve_bn128)return globalThis.curve_bn128;const n=new pa;n.setMemory(25),ac(n);const o={};o.code=n.build(),o.pq=n.modules.f1m.pq,o.pr=n.modules.frm.pq,o.pG1gen=n.modules.bn128.pG1gen,o.pG1zero=n.modules.bn128.pG1zero,o.pG1b=n.modules.bn128.pG1b,o.pG2gen=n.modules.bn128.pG2gen,o.pG2zero=n.modules.bn128.pG2zero,o.pG2b=n.modules.bn128.pG2b,o.pOneT=n.modules.bn128.pOneT,o.prePSize=n.modules.bn128.prePSize,o.preQSize=n.modules.bn128.preQSize,o.n8q=32,o.n8r=32,o.q=n.modules.bn128.q,o.r=n.modules.bn128.r;const e={name:"bn128",wasm:o,q:kt("21888242871839275222246405745257275088696311157297823662689037894645226208583"),r:kt("21888242871839275222246405745257275088548364400416034343698204186575808495617"),n8q:32,n8r:32,cofactorG2:kt("30644e72e131a029b85045b68181585e06ceecda572a2489345f2299c0f9fa8d",16),singleThread:!!i},c=await ua(e);return c.terminate=async function(){e.singleThread||(globalThis.curve_bn128=null,await this.tm.terminate())},i||(globalThis.curve_bn128=c),c}globalThis.curve_bls12381=null;async function ha(i,t){if(!i&&globalThis.curve_bls12381)return globalThis.curve_bls12381;const n=new pa;n.setMemory(25),ic(n);const o={};o.code=n.build(),o.pq=n.modules.f1m.pq,o.pr=n.modules.frm.pq,o.pG1gen=n.modules.bls12381.pG1gen,o.pG1zero=n.modules.bls12381.pG1zero,o.pG1b=n.modules.bls12381.pG1b,o.pG2gen=n.modules.bls12381.pG2gen,o.pG2zero=n.modules.bls12381.pG2zero,o.pG2b=n.modules.bls12381.pG2b,o.pOneT=n.modules.bls12381.pOneT,o.prePSize=n.modules.bls12381.prePSize,o.preQSize=n.modules.bls12381.preQSize,o.n8q=48,o.n8r=32,o.q=n.modules.bls12381.q,o.r=n.modules.bls12381.r;const e={name:"bls12381",wasm:o,q:kt("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16),r:kt("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16),n8q:48,n8r:32,cofactorG1:kt("0x396c8c005555e1568c00aaab0000aaab",16),cofactorG2:kt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5",16),singleThread:!!i},c=await ua(e);return c.terminate=async function(){e.singleThread||(globalThis.curve_bls12381=null,await this.tm.terminate())},i||(globalThis.curve_bls12381=c),c}kt("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);kt("21888242871839275222246405745257275088548364400416034343698204186575808495617");kt("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16);kt("21888242871839275222246405745257275088696311157297823662689037894645226208583");const Mt=ei,Gt=dc;var ma={};async function ba(i,t,n,o){if(n=n||4096*64,typeof t!="number"&&["w+","wx+","r","ax+","a+"].indexOf(t)<0)throw new Error("Invalid open option");const e=await ma.promises.open(i,t),c=await e.stat();return new Bc(e,c,n,o,i)}class Bc{constructor(t,n,o,e,c){for(this.fileName=c,this.fd=t,this.pos=0,this.pageSize=e||256;this.pageSize<n.blksize;)this.pageSize*=2;this.totalSize=n.size,this.totalPages=Math.floor((n.size-1)/this.pageSize)+1,this.maxPagesLoaded=Math.floor(o/this.pageSize)+1,this.pages={},this.pendingLoads=[],this.writing=!1,this.reading=!1,this.avBuffs=[],this.history={}}_loadPage(t){const n=this,o=new Promise((e,c)=>{n.pendingLoads.push({page:t,resolve:e,reject:c})});return n.__statusPage("After Load request: ",t),o}__statusPage(t,n){const o=[],e=this;if(!e.logHistory)return;o.push("=="+t+" "+n);let c="";for(let f=0;f<e.pendingLoads.length;f++)e.pendingLoads[f].page==n&&(c=c+" "+f);if(c&&o.push("Pending loads:"+c),typeof e.pages[n]<"u"){const f=e.pages[n];o.push("Loaded"),o.push("pendingOps: "+f.pendingOps),f.loading&&o.push("loading: "+f.loading),f.writing&&o.push("writing"),f.dirty&&o.push("dirty")}o.push("=="),e.history[n]||(e.history[n]=[]),e.history[n].push(o)}__printHistory(t){const n=this;n.history[t]||console.log("Empty History ",t),console.log("History "+t);for(let o=0;o<n.history[t].length;o++)for(let e=0;e<n.history[t][o].length;e++)console.log("-> "+n.history[t][o][e])}_triggerLoad(){const t=this;if(t.reading||t.pendingLoads.length==0)return;const n=Object.keys(t.pages),o=[];for(let d=0;d<n.length;d++){const b=t.pages[parseInt(n[d])];b.dirty==!1&&b.pendingOps==0&&!b.writing&&!b.loading&&o.push(parseInt(n[d]))}let e=t.maxPagesLoaded-n.length;const c=[];for(;t.pendingLoads.length>0&&(typeof t.pages[t.pendingLoads[0].page]<"u"||e>0||o.length>0);){const d=t.pendingLoads.shift();if(typeof t.pages[d.page]<"u"){t.pages[d.page].pendingOps++;const b=o.indexOf(d.page);b>=0&&o.splice(b,1),t.pages[d.page].loading?t.pages[d.page].loading.push(d):d.resolve(),t.__statusPage("After Load (cached): ",d.page)}else{if(e)e--;else{const b=o.shift();t.__statusPage("Before Unload: ",b),t.avBuffs.unshift(t.pages[b]),delete t.pages[b],t.__statusPage("After Unload: ",b)}d.page>=t.totalPages?(t.pages[d.page]=f(),d.resolve(),t.__statusPage("After Load (new): ",d.page)):(t.reading=!0,t.pages[d.page]=f(),t.pages[d.page].loading=[d],c.push(t.fd.read(t.pages[d.page].buff,0,t.pageSize,d.page*t.pageSize).then(b=>{t.pages[d.page].size=b.bytesRead;const g=t.pages[d.page].loading;delete t.pages[d.page].loading;for(let s=0;s<g.length;s++)g[s].resolve();return t.__statusPage("After Load (loaded): ",d.page),b},b=>{d.reject(b)})),t.__statusPage("After Load (loading): ",d.page))}}Promise.all(c).then(()=>{t.reading=!1,t.pendingLoads.length>0&&setImmediate(t._triggerLoad.bind(t)),t._tryClose()});function f(){if(t.avBuffs.length>0){const d=t.avBuffs.shift();return d.dirty=!1,d.pendingOps=1,d.size=0,d}else return{dirty:!1,buff:new Uint8Array(t.pageSize),pendingOps:1,size:0}}}_triggerWrite(){const t=this;if(t.writing)return;const n=Object.keys(t.pages),o=[];for(let e=0;e<n.length;e++){const c=t.pages[parseInt(n[e])];c.dirty&&(c.dirty=!1,c.writing=!0,t.writing=!0,o.push(t.fd.write(c.buff,0,c.size,parseInt(n[e])*t.pageSize).then(()=>{c.writing=!1},f=>{console.log("ERROR Writing: "+f),t.error=f,t._tryClose()})))}t.writing&&Promise.all(o).then(()=>{t.writing=!1,setImmediate(t._triggerWrite.bind(t)),t._tryClose(),t.pendingLoads.length>0&&setImmediate(t._triggerLoad.bind(t))})}_getDirtyPage(){for(let t in this.pages)if(this.pages[t].dirty)return t;return-1}async write(t,n){if(t.byteLength==0)return;const o=this;if(typeof n>"u"&&(n=o.pos),o.pos=n+t.byteLength,o.totalSize<n+t.byteLength&&(o.totalSize=n+t.byteLength),o.pendingClose)throw new Error("Writing a closing file");const e=Math.floor(n/o.pageSize),c=Math.floor((n+t.byteLength-1)/o.pageSize),f=[];for(let s=e;s<=c;s++)f.push(o._loadPage(s));o._triggerLoad();let d=e,b=n%o.pageSize,g=t.byteLength;for(;g>0;){await f[d-e];const s=b+g>o.pageSize?o.pageSize-b:g,y=t.slice(t.byteLength-g,t.byteLength-g+s);new Uint8Array(o.pages[d].buff.buffer,b,s).set(y),o.pages[d].dirty=!0,o.pages[d].pendingOps--,o.pages[d].size=Math.max(b+s,o.pages[d].size),d>=o.totalPages&&(o.totalPages=d+1),g=g-s,d++,b=0,o.writing||setImmediate(o._triggerWrite.bind(o))}}async read(t,n){const o=this;let e=new Uint8Array(t);return await o.readToBuffer(e,0,t,n),e}async readToBuffer(t,n,o,e){if(o==0)return;const c=this;if(o>c.pageSize*c.maxPagesLoaded*.8){const w=Math.floor(o*1.1);this.maxPagesLoaded=Math.floor(w/c.pageSize)+1}if(typeof e>"u"&&(e=c.pos),c.pos=e+o,c.pendingClose)throw new Error("Reading a closing file");const f=Math.floor(e/c.pageSize),d=Math.floor((e+o-1)/c.pageSize),b=[];for(let w=f;w<=d;w++)b.push(c._loadPage(w));c._triggerLoad();let g=f,s=e%c.pageSize,y=e+o>c.totalSize?o-(e+o-c.totalSize):o;for(;y>0;){await b[g-f],c.__statusPage("After Await (read): ",g);const w=s+y>c.pageSize?c.pageSize-s:y,h=new Uint8Array(c.pages[g].buff.buffer,c.pages[g].buff.byteOffset+s,w);t.set(h,n+o-y),c.pages[g].pendingOps--,c.__statusPage("After Op done: ",g),y=y-w,g++,s=0,c.pendingLoads.length>0&&setImmediate(c._triggerLoad.bind(c))}this.pos=e+o}_tryClose(){const t=this;!t.pendingClose||(t.error&&t.pendingCloseReject(t.error),t._getDirtyPage()>=0||t.writing||t.reading||t.pendingLoads.length>0)||t.pendingClose()}close(){const t=this;if(t.pendingClose)throw new Error("Closing the file twice");return new Promise((n,o)=>{t.pendingClose=n,t.pendingCloseReject=o,t._tryClose()}).then(()=>{t.fd.close()},n=>{throw t.fd.close(),n})}async discard(){await this.close(),await ma.promises.unlink(this.fileName)}async writeULE32(t,n){const o=this,e=new Uint8Array(4);new DataView(e.buffer).setUint32(0,t,!0),await o.write(e,n)}async writeUBE32(t,n){const o=this,e=new Uint8Array(4);new DataView(e.buffer).setUint32(0,t,!1),await o.write(e,n)}async writeULE64(t,n){const o=this,e=new Uint8Array(8),c=new DataView(e.buffer);c.setUint32(0,t&4294967295,!0),c.setUint32(4,Math.floor(t/4294967296),!0),await o.write(e,n)}async readULE32(t){const o=await this.read(4,t);return new Uint32Array(o.buffer)[0]}async readUBE32(t){const o=await this.read(4,t);return new DataView(o.buffer).getUint32(0,!1)}async readULE64(t){const o=await this.read(8,t),e=new Uint32Array(o.buffer);return e[1]*4294967296+e[0]}async readString(t){const n=this;if(n.pendingClose)throw new Error("Reading a closing file");let o=typeof t>"u"?n.pos:t,e=Math.floor(o/n.pageSize),c=!1,f="";for(;!c;){let d=n._loadPage(e);n._triggerLoad(),await d,n.__statusPage("After Await (read): ",e);let b=o%n.pageSize;const g=new Uint8Array(n.pages[e].buff.buffer,n.pages[e].buff.byteOffset+b,n.pageSize-b);let s=g.findIndex(y=>y===0);c=s!==-1,c?(f+=new TextDecoder().decode(g.slice(0,s)),n.pos=e*this.pageSize+b+s+1):(f+=new TextDecoder().decode(g),n.pos=e*this.pageSize+b+g.length),n.pages[e].pendingOps--,n.__statusPage("After Op done: ",e),o=n.pos,e++,n.pendingLoads.length>0&&setImmediate(n._triggerLoad.bind(n))}return f}}function Cc(i){const t=i.initialSize||1048576,n=new wa;return n.o=i,n.o.data=new Uint8Array(t),n.allocSize=t,n.totalSize=0,n.readOnly=!1,n.pos=0,n}function xc(i){const t=new wa;return t.o=i,t.allocSize=i.data.byteLength,t.totalSize=i.data.byteLength,t.readOnly=!0,t.pos=0,t}const Oo=new Uint8Array(4),we=new DataView(Oo.buffer),ya=new Uint8Array(8),Be=new DataView(ya.buffer);class wa{constructor(){this.pageSize=16384}_resizeIfNeeded(t){if(t>this.allocSize){const n=Math.max(this.allocSize+1048576,Math.floor(this.allocSize*1.1),t),o=new Uint8Array(n);o.set(this.o.data),this.o.data=o,this.allocSize=n}}async write(t,n){if(typeof n>"u"&&(n=this.pos),this.readOnly)throw new Error("Writing a read only file");this._resizeIfNeeded(n+t.byteLength),this.o.data.set(t.slice(),n),n+t.byteLength>this.totalSize&&(this.totalSize=n+t.byteLength),this.pos=n+t.byteLength}async readToBuffer(t,n,o,e){if(typeof e>"u"&&(e=this.pos),this.readOnly&&e+o>this.totalSize)throw new Error("Reading out of bounds");this._resizeIfNeeded(e+o);const f=new Uint8Array(this.o.data.buffer,this.o.data.byteOffset+e,o);t.set(f,n),this.pos=e+o}async read(t,n){const o=this,e=new Uint8Array(t);return await o.readToBuffer(e,0,t,n),e}close(){this.o.data.byteLength!=this.totalSize&&(this.o.data=this.o.data.slice(0,this.totalSize))}async discard(){}async writeULE32(t,n){const o=this;we.setUint32(0,t,!0),await o.write(Oo,n)}async writeUBE32(t,n){const o=this;we.setUint32(0,t,!1),await o.write(Oo,n)}async writeULE64(t,n){const o=this;Be.setUint32(0,t&4294967295,!0),Be.setUint32(4,Math.floor(t/4294967296),!0),await o.write(ya,n)}async readULE32(t){const o=await this.read(4,t);return new Uint32Array(o.buffer)[0]}async readUBE32(t){const o=await this.read(4,t);return new DataView(o.buffer).getUint32(0,!1)}async readULE64(t){const o=await this.read(8,t),e=new Uint32Array(o.buffer);return e[1]*4294967296+e[0]}async readString(t){const n=this;let o=typeof t>"u"?n.pos:t;if(o>this.totalSize){if(this.readOnly)throw new Error("Reading out of bounds");this._resizeIfNeeded(t)}const e=new Uint8Array(n.o.data.buffer,o,this.totalSize-o);let c=e.findIndex(b=>b===0),f=c!==-1,d="";return f?(d=new TextDecoder().decode(e.slice(0,c)),n.pos=o+c+1):n.pos=o,d}}const Ut=1<<22;function Fc(i){const t=i.initialSize||0,n=new Ca;n.o=i;const o=t?Math.floor((t-1)/Ut)+1:0;n.o.data=[];for(let e=0;e<o-1;e++)n.o.data.push(new Uint8Array(Ut));return o&&n.o.data.push(new Uint8Array(t-Ut*(o-1))),n.totalSize=0,n.readOnly=!1,n.pos=0,n}function Ac(i){const t=new Ca;return t.o=i,t.totalSize=(i.data.length-1)*Ut+i.data[i.data.length-1].byteLength,t.readOnly=!0,t.pos=0,t}const qo=new Uint8Array(4),Ce=new DataView(qo.buffer),Ba=new Uint8Array(8),xe=new DataView(Ba.buffer);class Ca{constructor(){this.pageSize=16384}_resizeIfNeeded(t){if(t<=this.totalSize)return;if(this.readOnly)throw new Error("Reading out of file bounds");const n=Math.floor((t-1)/Ut)+1;for(let o=Math.max(this.o.data.length-1,0);o<n;o++){const e=o<n-1?Ut:t-(n-1)*Ut,c=new Uint8Array(e);o==this.o.data.length-1&&c.set(this.o.data[o]),this.o.data[o]=c}this.totalSize=t}async write(t,n){const o=this;if(typeof n>"u"&&(n=o.pos),this.readOnly)throw new Error("Writing a read only file");this._resizeIfNeeded(n+t.byteLength);let c=Math.floor(n/Ut),f=n%Ut,d=t.byteLength;for(;d>0;){const b=f+d>Ut?Ut-f:d,g=t.slice(t.byteLength-d,t.byteLength-d+b);new Uint8Array(o.o.data[c].buffer,f,b).set(g),d=d-b,c++,f=0}this.pos=n+t.byteLength}async readToBuffer(t,n,o,e){const c=this;if(typeof e>"u"&&(e=c.pos),this.readOnly&&e+o>this.totalSize)throw new Error("Reading out of bounds");this._resizeIfNeeded(e+o);let d=Math.floor(e/Ut),b=e%Ut,g=o;for(;g>0;){const s=b+g>Ut?Ut-b:g,y=new Uint8Array(c.o.data[d].buffer,b,s);t.set(y,n+o-g),g=g-s,d++,b=0}this.pos=e+o}async read(t,n){const o=this,e=new Uint8Array(t);return await o.readToBuffer(e,0,t,n),e}close(){}async discard(){}async writeULE32(t,n){const o=this;Ce.setUint32(0,t,!0),await o.write(qo,n)}async writeUBE32(t,n){const o=this;Ce.setUint32(0,t,!1),await o.write(qo,n)}async writeULE64(t,n){const o=this;xe.setUint32(0,t&4294967295,!0),xe.setUint32(4,Math.floor(t/4294967296),!0),await o.write(Ba,n)}async readULE32(t){const o=await this.read(4,t);return new Uint32Array(o.buffer)[0]}async readUBE32(t){const o=await this.read(4,t);return new DataView(o.buffer).getUint32(0,!1)}async readULE64(t){const o=await this.read(8,t),e=new Uint32Array(o.buffer);return e[1]*4294967296+e[0]}async readString(t){const n=this,o=2048;let e=typeof t>"u"?n.pos:t;if(e>this.totalSize){if(this.readOnly)throw new Error("Reading out of bounds");this._resizeIfNeeded(t)}let c=!1,f="";for(;!c;){let d=Math.floor(e/Ut),b=e%Ut;if(n.o.data[d]===void 0)throw new Error("ERROR");let g=Math.min(o,n.o.data[d].length-b);const s=new Uint8Array(n.o.data[d].buffer,b,g);let y=s.findIndex(w=>w===0);c=y!==-1,c?(f+=new TextDecoder().decode(s.slice(0,y)),n.pos=d*Ut+b+y+1):(f+=new TextDecoder().decode(s),n.pos=d*Ut+b+s.length),e=n.pos}return f}}const vc=1024,Ic=512,Sc=2,Ec=0,Pc=65536,Oc=8192;async function xa(i,t,n){if(typeof i=="string"&&(i={type:"file",fileName:i,cacheSize:Pc,pageSize:Oc}),i.type=="file")return await ba(i.fileName,vc|Ic|Sc,i.cacheSize,i.pageSize);if(i.type=="mem")return Cc(i);if(i.type=="bigMem")return Fc(i);throw new Error("Invalid FastFile type: "+i.type)}async function Fa(i,t,n){if(i instanceof Uint8Array&&(i={type:"mem",data:i}),typeof i=="string"&&(i={type:"mem",data:await fetch(i).then(function(e){return e.arrayBuffer()}).then(function(e){return new Uint8Array(e)})}),i.type=="file")return await ba(i.fileName,Ec,i.cacheSize,i.pageSize);if(i.type=="mem")return await xc(i);if(i.type=="bigMem")return await Ac(i);throw new Error("Invalid FastFile type: "+i.type)}async function Fe(i,t,n,o,e){const c=await Fa(i),f=await c.read(4);let d="";for(let y=0;y<4;y++)d+=String.fromCharCode(f[y]);if(d!=t)throw new Error(i+": Invalid File format");if(await c.readULE32()>n)throw new Error("Version not supported");const g=await c.readULE32();let s=[];for(let y=0;y<g;y++){let w=await c.readULE32(),h=await c.readULE64();typeof s[w]>"u"&&(s[w]=[]),s[w].push({p:c.pos,size:h}),c.pos+=h}return{fd:c,sections:s}}async function qc(i,t,n,o,e,c){const f=await xa(i),d=new Uint8Array(4);for(let b=0;b<4;b++)d[b]=t.charCodeAt(b);return await f.write(d,0),await f.writeULE32(n),await f.writeULE32(o),f}async function Ae(i,t){if(typeof i.writingSection<"u")throw new Error("Already writing a section");await i.writeULE32(t),i.writingSection={pSectionSize:i.pos},await i.writeULE64(0)}async function ve(i){if(typeof i.writingSection>"u")throw new Error("Not writing a section");const t=i.pos-i.writingSection.pSectionSize-8,n=i.pos;i.pos=i.writingSection.pSectionSize,await i.writeULE64(t),i.pos=n,delete i.writingSection}async function jn(i,t,n){if(typeof i.readingSection<"u")throw new Error("Already reading a section");if(!t[n])throw new Error(i.fileName+": Missing section "+n);if(t[n].length>1)throw new Error(i.fileName+": Section Duplicated "+n);i.pos=t[n][0].p,i.readingSection=t[n][0]}async function Zn(i,t){if(typeof i.readingSection>"u")throw new Error("Not reading a section");if(i.pos-i.readingSection.p!=i.readingSection.size)throw new Error("Invalid section size reading");delete i.readingSection}async function Mc(i,t,n,o){const e=new Uint8Array(n);Mt.toRprLE(e,0,t,n),await i.write(e,o)}async function hn(i,t,n){const o=await i.read(t,n);return Mt.fromRprLE(o,0,t)}async function fn(i,t,n,o,e){if(o=typeof o>"u"?0:o,e=typeof e>"u"?t[n][0].size-o:e,o+e>t[n][0].size)throw new Error("Reading out of the range of the section");let c;return e<1<<30?c=new Uint8Array(e):c=new Ot(e),await i.readToBuffer(c,0,e,t[n][0].p+o),c}Mt.e("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);Mt.e("21888242871839275222246405745257275088548364400416034343698204186575808495617");const zc=Mt.e("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16),kc=Mt.e("21888242871839275222246405745257275088696311157297823662689037894645226208583");async function Zo(i,t){let n,o=t&&t.singleThread;if(Mt.eq(i,kc))n=await La(o);else if(Mt.eq(i,zc))n=await ha(o);else throw new Error(`Curve not supported: ${Mt.toString(i)}`);return n}async function Tc(i,t){let n,o=t&&t.singleThread;const e=c(i);if(["BN128","BN254","ALTBN128"].indexOf(e)>=0)n=await La(o);else if(["BLS12381"].indexOf(e)>=0)n=await ha(o);else throw new Error(`Curve not supported: ${i}`);return n;function c(f){return f.toUpperCase().match(/[A-Za-z0-9]+/g).join("")}}new Uint8Array(new Uint32Array([287454020]).buffer)[0];function io(i){return(i&4294901760?(i&=4294901760,16):0)|(i&4278255360?(i&=4278255360,8):0)|(i&4042322160?(i&=4042322160,4):0)|(i&3435973836?(i&=3435973836,2):0)|(i&2863311530)!==0}const Uc=1,Rc=2,Aa=10,Nc=2;async function Kt(i,t,n){const o=await i.read(t.G1.F.n8*2),e=t.G1.fromRprLEM(o,0);return n?t.G1.toObject(e):e}async function kn(i,t,n){const o=await i.read(t.G2.F.n8*2),e=t.G2.fromRprLEM(o,0);return n?t.G2.toObject(e):e}async function Gc(i,t,n,o){await jn(i,t,1);const e=await i.readULE32();if(await Zn(i),e===Uc)return await $c(i,t,n,o);if(e===Rc)return await jc(i,t,n,o);if(e===Aa)return await Zc(i,t,n,o);throw new Error("Protocol not supported: ")}async function $c(i,t,n,o){const e={};e.protocol="groth16",await jn(i,t,2);const c=await i.readULE32();e.n8q=c,e.q=await hn(i,c);const f=await i.readULE32();return e.n8r=f,e.r=await hn(i,f),e.curve=await Zo(e.q,o),e.nVars=await i.readULE32(),e.nPublic=await i.readULE32(),e.domainSize=await i.readULE32(),e.power=io(e.domainSize),e.vk_alpha_1=await Kt(i,e.curve,n),e.vk_beta_1=await Kt(i,e.curve,n),e.vk_beta_2=await kn(i,e.curve,n),e.vk_gamma_2=await kn(i,e.curve,n),e.vk_delta_1=await Kt(i,e.curve,n),e.vk_delta_2=await kn(i,e.curve,n),await Zn(i),e}async function jc(i,t,n,o){const e={};e.protocol="plonk",await jn(i,t,2);const c=await i.readULE32();e.n8q=c,e.q=await hn(i,c);const f=await i.readULE32();return e.n8r=f,e.r=await hn(i,f),e.curve=await Zo(e.q,o),e.nVars=await i.readULE32(),e.nPublic=await i.readULE32(),e.domainSize=await i.readULE32(),e.power=io(e.domainSize),e.nAdditions=await i.readULE32(),e.nConstraints=await i.readULE32(),e.k1=await i.read(f),e.k2=await i.read(f),e.Qm=await Kt(i,e.curve,n),e.Ql=await Kt(i,e.curve,n),e.Qr=await Kt(i,e.curve,n),e.Qo=await Kt(i,e.curve,n),e.Qc=await Kt(i,e.curve,n),e.S1=await Kt(i,e.curve,n),e.S2=await Kt(i,e.curve,n),e.S3=await Kt(i,e.curve,n),e.X_2=await kn(i,e.curve,n),await Zn(i),e}async function Zc(i,t,n,o){const e={};e.protocol="fflonk",e.protocolId=Aa,await jn(i,t,Nc);const c=await i.readULE32();e.n8q=c,e.q=await hn(i,c),e.curve=await Zo(e.q,o);const f=await i.readULE32();return e.n8r=f,e.r=await hn(i,f),e.nVars=await i.readULE32(),e.nPublic=await i.readULE32(),e.domainSize=await i.readULE32(),e.power=io(e.domainSize),e.nAdditions=await i.readULE32(),e.nConstraints=await i.readULE32(),e.k1=await i.read(f),e.k2=await i.read(f),e.w3=await i.read(f),e.w4=await i.read(f),e.w8=await i.read(f),e.wr=await i.read(f),e.X_2=await kn(i,e.curve,n),e.C0=await Kt(i,e.curve,n),await Zn(i),e}async function Wc(i,t,n){await Ae(i,1);const o=(Math.floor((Mt.bitLength(n)-1)/64)+1)*8;if(await i.writeULE32(o),await Mc(i,n,o),t.byteLength%o!=0)throw new Error("Invalid witness length");await i.writeULE32(t.byteLength/o),await ve(i),await Ae(i,2),await i.write(t),await ve(i)}async function Dc(i,t){await jn(i,t,1);const n=await i.readULE32(),o=await hn(i,n),e=await i.readULE32();return await Zn(i),{n8:n,q:o,nWitness:e}}const{stringifyBigInts:Ie}=Gt;async function va(i,t,n,o){const{fd:e,sections:c}=await Fe(t,"wtns",2),f=await Dc(e,c),{fd:d,sections:b}=await Fe(i,"zkey",2),g=await Gc(d,b,void 0,o);if(g.protocol!="groth16")throw new Error("zkey file is not groth16");if(!Mt.eq(g.r,f.q))throw new Error("Curve of the witness does not match the curve of the proving key");if(f.nWitness!=g.nVars)throw new Error(`Invalid witness length. Circuit: ${g.nVars}, witness: ${f.nWitness}`);const s=g.curve,y=s.Fr,w=s.G1,h=s.G2,T=io(g.domainSize);n&&n.debug("Reading Wtns");const k=await fn(e,c,2);n&&n.debug("Reading Coeffs");const x=await fn(d,b,4);n&&n.debug("Building ABC");const[O,B,Q]=await Kc(s,g,k,x,n),E=T==y.s?s.Fr.shift:s.Fr.w[T+1],nt=await y.ifft(O,"","",n,"IFFT_A"),C=await y.batchApplyKey(nt,y.e(1),E),u=await y.fft(C,"","",n,"FFT_A"),L=await y.ifft(B,"","",n,"IFFT_B"),$=await y.batchApplyKey(L,y.e(1),E),K=await y.fft($,"","",n,"FFT_B"),J=await y.ifft(Q,"","",n,"IFFT_C"),P=await y.batchApplyKey(J,y.e(1),E),m=await y.fft(P,"","",n,"FFT_C");n&&n.debug("Join ABC");const I=await Xc(s,g,u,K,m,n);let U={};n&&n.debug("Reading A Points");const et=await fn(d,b,5);U.pi_a=await s.G1.multiExpAffine(et,k,n,"multiexp A"),n&&n.debug("Reading B1 Points");const Y=await fn(d,b,6);let j=await s.G1.multiExpAffine(Y,k,n,"multiexp B1");n&&n.debug("Reading B2 Points");const ct=await fn(d,b,7);U.pi_b=await s.G2.multiExpAffine(ct,k,n,"multiexp B2"),n&&n.debug("Reading C Points");const H=await fn(d,b,8);U.pi_c=await s.G1.multiExpAffine(H,k.slice((g.nPublic+1)*s.Fr.n8),n,"multiexp C"),n&&n.debug("Reading H Points");const at=await fn(d,b,9),Pt=await s.G1.multiExpAffine(at,I,n,"multiexp H"),vt=s.Fr.random(),ht=s.Fr.random();U.pi_a=w.add(U.pi_a,g.vk_alpha_1),U.pi_a=w.add(U.pi_a,w.timesFr(g.vk_delta_1,vt)),U.pi_b=h.add(U.pi_b,g.vk_beta_2),U.pi_b=h.add(U.pi_b,h.timesFr(g.vk_delta_2,ht)),j=w.add(j,g.vk_beta_1),j=w.add(j,w.timesFr(g.vk_delta_1,ht)),U.pi_c=w.add(U.pi_c,Pt),U.pi_c=w.add(U.pi_c,w.timesFr(U.pi_a,ht)),U.pi_c=w.add(U.pi_c,w.timesFr(j,vt)),U.pi_c=w.add(U.pi_c,w.timesFr(g.vk_delta_1,y.neg(y.mul(vt,ht))));let A=[];for(let a=1;a<=g.nPublic;a++){const F=k.slice(a*y.n8,a*y.n8+y.n8);A.push(Mt.fromRprLE(F))}return U.pi_a=w.toObject(w.toAffine(U.pi_a)),U.pi_b=h.toObject(h.toAffine(U.pi_b)),U.pi_c=w.toObject(w.toAffine(U.pi_c)),U.protocol="groth16",U.curve=s.name,await d.close(),await e.close(),U=Ie(U),A=Ie(A),{proof:U,publicSignals:A}}async function Kc(i,t,n,o,e){const c=i.Fr.n8,f=4*3+t.n8r,d=(o.byteLength-4)/f,b=new Ot(t.domainSize*c),g=new Ot(t.domainSize*c),s=new Ot(t.domainSize*c),y=[b,g];for(let w=0;w<d;w++){e&&w%1e6==0&&e.debug(`QAP AB: ${w}/${d}`);const h=o.slice(4+w*f,4+w*f+f),T=new DataView(h.buffer),k=T.getUint32(0,!0),x=T.getUint32(4,!0),O=T.getUint32(8,!0),B=h.slice(12,12+c);y[k].set(i.Fr.add(y[k].slice(x*c,x*c+c),i.Fr.mul(B,n.slice(O*c,O*c+c))),x*c)}for(let w=0;w<t.domainSize;w++)e&&w%1e6==0&&e.debug(`QAP C: ${w}/${t.domainSize}`),s.set(i.Fr.mul(b.slice(w*c,w*c+c),g.slice(w*c,w*c+c)),w*c);return[b,g,s]}async function Xc(i,t,n,o,e,c){const d=i.Fr.n8,b=Math.floor(n.byteLength/i.Fr.n8),g=[];for(let h=0;h<b;h+=4194304){c&&c.debug(`JoinABC: ${h}/${b}`);const T=Math.min(b-h,4194304),k=[],x=n.slice(h*d,(h+T)*d),O=o.slice(h*d,(h+T)*d),B=e.slice(h*d,(h+T)*d);k.push({cmd:"ALLOCSET",var:0,buff:x}),k.push({cmd:"ALLOCSET",var:1,buff:O}),k.push({cmd:"ALLOCSET",var:2,buff:B}),k.push({cmd:"ALLOC",var:3,len:T*d}),k.push({cmd:"CALL",fnName:"qap_joinABC",params:[{var:0},{var:1},{var:2},{val:T},{var:3}]}),k.push({cmd:"CALL",fnName:"frm_batchFromMontgomery",params:[{var:3},{val:T},{var:3}]}),k.push({cmd:"GET",out:0,var:3,len:T*d}),g.push(i.tm.queueAction(k))}const s=await Promise.all(g);let y;n instanceof Ot?y=new Ot(n.byteLength):y=new Uint8Array(n.byteLength);let w=0;for(let h=0;h<s.length;h++)y.set(s[h][0],w),w+=s[h][0].byteLength;return y}function Ia(i){let t=[];return n(t,i),t;function n(o,e){if(Array.isArray(e))for(let c=0;c<e.length;c++)n(o,e[c]);else o.push(e)}}function Vc(i,t){let n=BigInt(i)%t;return n<0&&(n+=t),n}function Sa(i){const t=BigInt(2)**BigInt(64);let n=BigInt("0xCBF29CE484222325");for(let c=0;c<i.length;c++)n^=BigInt(i[c].charCodeAt(0)),n*=BigInt(1099511628211),n%=t;let o=n.toString(16),e=16-o.length;return o="0".repeat(e).concat(o),o}function Hc(i,t){const n=[];let o=BigInt(i);const e=BigInt(4294967296);for(;o;)n.unshift(Number(o%e)),o=o/e;if(t){let c=t-n.length;for(;c>0;)n.unshift(0),c--}return n}async function Qc(i,t){let n,o,e;t=t||{};let c=1,f=0,d=0,b=!1;if(i instanceof WebAssembly.Instance)n=i,b=!0;else{let w=32767;if(t.memorySize&&(w=parseInt(t.memorySize),w<0))throw new Error("Invalid memory size");let h=!1;for(;!h;)try{e=new WebAssembly.Memory({initial:w}),h=!0}catch(O){if(w<=1)throw O;console.warn("Could not allocate "+w*1024*64+" bytes. This may cause severe instability. Trying with "+w*1024*64/2+" bytes"),w=Math.floor(w/2)}const T=await WebAssembly.compile(i);let k="",x="";n=await WebAssembly.instantiate(T,{env:{memory:e},runtime:{printDebug:function(O){console.log("printDebug:",O)},exceptionHandler:function(O){let B;throw O===1?B="Signal not found. ":O===2?B="Too many signals set. ":O===3?B="Signal already set. ":O===4?B="Assert Failed. ":O===5?B="Not enough memory. ":O===6?B="Input signal array access exceeds the size. ":B="Unknown error. ",console.error("ERROR: ",O,k),new Error(B+k)},printErrorMessage:function(){k+=s()+`
`},writeBufferMessage:function(){const O=s();O===`
`?(console.log(x),x=""):(x!==""&&(x+=" "),x+=O)},showSharedRWMemory:function(){const O=n.exports.getFieldNumLen32(),B=new Uint32Array(O);for(let Q=0;Q<O;Q++)B[O-1-Q]=n.exports.readSharedRWMemory(Q);if(c>=2&&(f>=1||d>=7)){x!==""&&(x+=" ");const Q=Mt.fromArray(B,4294967296).toString();x+=Q}else console.log(Mt.fromArray(B,4294967296))},error:function(O,B,Q,E,nt,C){let u;throw O===7?u=y(B)+" "+o.getFr(E).toString()+" != "+o.getFr(nt).toString()+" "+y(C):O===9?u=y(B)+" "+o.getFr(E).toString()+" "+y(nt):O===5&&t.sym?u=y(B)+" "+t.sym.labelIdx2Name[nt]:u=y(B)+" "+Q+" "+E+" "+nt+" "+C,console.log("ERROR: ",O,u),new Error(u)},log:function(O){console.log(o.getFr(O).toString())},logGetSignal:function(O,B){t.logGetSignal&&t.logGetSignal(O,o.getFr(B))},logSetSignal:function(O,B){t.logSetSignal&&t.logSetSignal(O,o.getFr(B))},logStartComponent:function(O){t.logStartComponent&&t.logStartComponent(O)},logFinishComponent:function(O){t.logFinishComponent&&t.logFinishComponent(O)}}})}typeof n.exports.getVersion=="function"&&(c=n.exports.getVersion()),typeof n.exports.getMinorVersion=="function"&&(f=n.exports.getMinorVersion()),typeof n.exports.getPatchVersion=="function"&&(d=n.exports.getPatchVersion());const g=t&&(t.sanityCheck||t.logGetSignal||t.logSetSignal||t.logStartComponent||t.logFinishComponent);if(c===2)o=new Yc(n,g);else if(c===1){if(b)throw new Error("Loading code from WebAssembly instance is not supported for circom version 1");o=new Jc(e,n,g)}else throw new Error(`Unsupported circom version: ${c}`);return o;function s(){let w="",h=n.exports.getMessageChar();for(;h!==0;)w+=String.fromCharCode(h),h=n.exports.getMessageChar();return w}function y(w){const h=new Uint8Array(e.buffer),T=[];for(let k=0;h[w+k]>0;k++)T.push(h[w+k]);return String.fromCharCode.apply(null,T)}}class Jc{constructor(t,n,o){this.memory=t,this.i32=new Uint32Array(t.buffer),this.instance=n,this.n32=(this.instance.exports.getFrLen()>>2)-2;const e=this.instance.exports.getPRawPrime(),c=new Array(this.n32);for(let f=0;f<this.n32;f++)c[this.n32-1-f]=this.i32[(e>>2)+f];this.prime=Mt.fromArray(c,4294967296),this.Fr=new Li(this.prime),this.mask32=Mt.fromString("FFFFFFFF",16),this.NVars=this.instance.exports.getNVars(),this.n64=Math.floor((this.Fr.bitLength-1)/64)+1,this.R=this.Fr.e(Mt.shiftLeft(1,this.n64*64)),this.RInv=this.Fr.inv(this.R),this.sanityCheck=o}circom_version(){return 1}async _doCalculateWitness(t,n){this.instance.exports.init(this.sanityCheck||n?1:0);const o=this.allocInt(),e=this.allocFr();Object.keys(t).forEach(f=>{const d=Sa(f),b=parseInt(d.slice(0,8),16),g=parseInt(d.slice(8,16),16);try{this.instance.exports.getSignalOffset32(o,0,b,g)}catch{throw new Error(`Signal ${f} is not an input of the circuit.`)}const s=this.getInt(o),y=Ia(t[f]);for(let w=0;w<y.length;w++)this.setFr(e,y[w]),this.instance.exports.setSignal(0,0,s+w,e)})}async calculateWitness(t,n){const o=this,e=o.i32[0],c=[];await o._doCalculateWitness(t,n);for(let f=0;f<o.NVars;f++){const d=o.instance.exports.getPWitness(f);c.push(o.getFr(d))}return o.i32[0]=e,c}async calculateBinWitness(t,n){const o=this,e=o.i32[0];await o._doCalculateWitness(t,n);const c=o.instance.exports.getWitnessBuffer();o.i32[0]=e;const f=o.memory.buffer.slice(c,c+o.NVars*o.n64*8);return new Uint8Array(f)}allocInt(){const t=this.i32[0];return this.i32[0]=t+8,t}allocFr(){const t=this.i32[0];return this.i32[0]=t+this.n32*4+8,t}getInt(t){return this.i32[t>>2]}setInt(t,n){this.i32[t>>2]=n}getFr(t){const n=this,o=t>>2;if(n.i32[o+1]&2147483648){const c=new Array(n.n32);for(let d=0;d<n.n32;d++)c[n.n32-1-d]=n.i32[o+2+d];const f=n.Fr.e(Mt.fromArray(c,4294967296));return n.i32[o+1]&1073741824?e(f):f}else return n.i32[o]&2147483648?n.Fr.e(n.i32[o]-4294967296):n.Fr.e(n.i32[o]);function e(c){return n.Fr.mul(n.RInv,c)}}setFr(t,n){const o=this;n=o.Fr.e(n);const e=o.Fr.neg(o.Fr.e("80000000",16)),c=o.Fr.e("7FFFFFFF",16);if(o.Fr.geq(n,e)&&o.Fr.leq(n,c)){let d;o.Fr.geq(n,o.Fr.zero)?d=Mt.toNumber(n):(d=Mt.toNumber(o.Fr.sub(n,e)),d=d-2147483648,d=4294967296+d),o.i32[t>>2]=d,o.i32[(t>>2)+1]=0;return}o.i32[t>>2]=0,o.i32[(t>>2)+1]=2147483648;const f=Mt.toArray(n,4294967296);for(let d=0;d<o.n32;d++){const b=f.length-1-d;b>=0?o.i32[(t>>2)+2+d]=f[b]:o.i32[(t>>2)+2+d]=0}}}class Yc{constructor(t,n){this.instance=t,this.version=this.instance.exports.getVersion(),this.n32=this.instance.exports.getFieldNumLen32(),this.instance.exports.getRawPrime();const o=new Uint32Array(this.n32);for(let e=0;e<this.n32;e++)o[this.n32-1-e]=this.instance.exports.readSharedRWMemory(e);this.prime=Mt.fromArray(o,4294967296),this.witnessSize=this.instance.exports.getWitnessSize(),this.sanityCheck=n}circom_version(){return this.instance.exports.getVersion()}async _doCalculateWitness(t,n){this.instance.exports.init(this.sanityCheck||n?1:0);const o=Object.keys(t);let e=0;if(o.forEach(c=>{const f=Sa(c),d=parseInt(f.slice(0,8),16),b=parseInt(f.slice(8,16),16),g=Ia(t[c]);if(typeof this.instance.exports.getInputSignalSize=="function"){let s=this.instance.exports.getInputSignalSize(d,b);if(s<0)throw new Error(`Signal ${c} not found
`);if(g.length<s)throw new Error(`Not enough values for input signal ${c}
`);if(g.length>s)throw new Error(`Too many values for input signal ${c}
`)}for(let s=0;s<g.length;s++){const y=Hc(Vc(g[s],this.prime),this.n32);for(let w=0;w<this.n32;w++)this.instance.exports.writeSharedRWMemory(w,y[this.n32-1-w]);try{this.instance.exports.setInputSignal(d,b,s),e++}catch(w){throw new Error(w)}}}),e<this.instance.exports.getInputSize())throw new Error(`Not all inputs have been set. Only ${e} out of ${this.instance.exports.getInputSize()}`)}async calculateWitness(t,n){const o=[];await this._doCalculateWitness(t,n);for(let e=0;e<this.witnessSize;e++){this.instance.exports.getWitness(e);const c=new Uint32Array(this.n32);for(let f=0;f<this.n32;f++)c[this.n32-1-f]=this.instance.exports.readSharedRWMemory(f);o.push(Mt.fromArray(c,4294967296))}return o}async calculateWTNSBin(t,n){const o=new Uint32Array(this.witnessSize*this.n32+this.n32+11),e=new Uint8Array(o.buffer);await this._doCalculateWitness(t,n),e[0]=119,e[1]=116,e[2]=110,e[3]=115,o[1]=2,o[2]=2,o[3]=1;const c=this.n32*4,d=(8+c).toString(16);o[4]=parseInt(d.slice(0,8),16),o[5]=parseInt(d.slice(8,16),16),o[6]=c,this.instance.exports.getRawPrime();let b=7;for(let y=0;y<this.n32;y++)o[b+y]=this.instance.exports.readSharedRWMemory(y);b+=this.n32,o[b]=this.witnessSize,b++,o[b]=2,b++;const s=(c*this.witnessSize).toString(16);o[b]=parseInt(s.slice(0,8),16),o[b+1]=parseInt(s.slice(8,16),16),b+=2;for(let y=0;y<this.witnessSize;y++){this.instance.exports.getWitness(y);for(let w=0;w<this.n32;w++)o[b+w]=this.instance.exports.readSharedRWMemory(w);b+=this.n32}return e}}const{unstringifyBigInts:ts}=Gt;async function ns(i,t,n,o){const e=ts(i),c=await Fa(t),f=await c.read(c.totalSize);await c.close();const d=await Qc(f,o);if(d.circom_version()===1){const b=await d.calculateBinWitness(e),g=await qc(n,"wtns",2,2);await Wc(g,b,d.prime),await g.close()}else{const b=await xa(n),g=await d.calculateWTNSBin(e);await b.write(g),await b.close()}}const{unstringifyBigInts:os}=Gt;async function es(i,t,n,o,e,c){const f=os(i),d={type:"mem"};return await ns(f,t,d,e),await va(n,d,o,c)}const{unstringifyBigInts:Co}=Gt;async function as(i,t,n,o){const e=Co(i),c=Co(n),f=Co(t),d=await Tc(e.curve),b=d.G1.fromObject(e.IC[0]),g=new Uint8Array(d.G1.F.n8*2*f.length),s=new Uint8Array(d.Fr.n8*f.length);if(!ss(d,f))return o&&o.error("Public inputs are not valid."),!1;for(let E=0;E<f.length;E++){const nt=d.G1.fromObject(e.IC[E+1]);g.set(nt,E*d.G1.F.n8*2),Mt.toRprLE(s,d.Fr.n8*E,f[E],d.Fr.n8)}let y=await d.G1.multiExpAffine(g,s);y=d.G1.add(y,b);const w=d.G1.fromObject(c.pi_a),h=d.G2.fromObject(c.pi_b),T=d.G1.fromObject(c.pi_c);if(!is(d,{pi_a:w,pi_b:h,pi_c:T}))return o&&o.error("Proof commitments are not valid."),!1;const k=d.G2.fromObject(e.vk_gamma_2),x=d.G2.fromObject(e.vk_delta_2),O=d.G1.fromObject(e.vk_alpha_1),B=d.G2.fromObject(e.vk_beta_2);return await d.pairingEq(d.G1.neg(w),h,y,k,T,x,O,B)?(o&&o.info("OK!"),!0):(o&&o.error("Invalid proof"),!1)}function is(i,t){const n=i.G1,o=i.G2;return n.isValid(t.pi_a)&&o.isValid(t.pi_b)&&n.isValid(t.pi_c)}function cs(i,t){return Mt.geq(t,0)&&Mt.lt(t,i.r)}function ss(i,t){for(let n=0;n<t.length;n++)if(!cs(i,t[n]))return!1;return!0}const{unstringifyBigInts:Se}=Gt;function sn(i){let t=i.toString(16);for(;t.length<64;)t="0"+t;return t=`"0x${t}"`,t}async function ls(i,t){const n=Se(i),o=Se(t);let e="";for(let f=0;f<o.length;f++)e!=""&&(e=e+","),e=e+sn(o[f]);let c;return c=`[${sn(n.pi_a[0])}, ${sn(n.pi_a[1])}],[[${sn(n.pi_b[0][1])}, ${sn(n.pi_b[0][0])}],[${sn(n.pi_b[1][1])}, ${sn(n.pi_b[1][0])}]],[${sn(n.pi_c[0])}, ${sn(n.pi_c[1])}],[${e}]`,c}var Wo=Object.freeze({__proto__:null,fullProve:es,prove:va,verify:as,exportSolidityCallData:ls});Mt.e("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);Mt.e("21888242871839275222246405745257275088548364400416034343698204186575808495617");const{unstringifyBigInts:js}=Gt,{stringifyBigInts:Zs}=Gt,{unstringifyBigInts:Ws,stringifyBigInts:Ds}=Gt,{stringifyBigInts:Ks}=Gt,{unstringifyBigInts:Xs}=Gt,{unstringifyBigInts:Vs}=Gt,{unstringifyBigInts:Hs}=Gt,{stringifyBigInts:Qs}=Gt,{unstringifyBigInts:Js}=Gt,{unstringifyBigInts:Ys}=Gt,{unstringifyBigInts:tl}=Gt,rs={swap:{wasm:"/circuits/private_swap.wasm",zkey:"/circuits/private_swap.zkey"},addLiquidity:{wasm:"/circuits/private_add_liquidity.wasm",zkey:"/circuits/private_add_liquidity.zkey"},removeLiquidity:{wasm:"/circuits/private_remove_liquidity.wasm",zkey:"/circuits/private_remove_liquidity.zkey"}};let Hn=null,xo=null;async function vn(){return Hn||(xo||(xo=(async()=>{const{buildPoseidon:i}=await Ra(async()=>{const{buildPoseidon:t}=await import("./main-DKb5Difr.js");return{buildPoseidon:t}},[]);return Hn=await i(),Hn})()),xo)}async function on(i){const t=await vn(),n=t(i.map(o=>BigInt(o)));return t.F.toString(n)}async function _n(i,t,n,o){return on([i,t,n,o])}async function co(i,t,n){return on([i,t,n])}async function Fn(i,t,n,o){return on([i,t,n,o])}async function no(i,t,n){return on([i,t,n])}async function Rn(i){return on([i])}function zt(){const i=new Uint8Array(31);crypto.getRandomValues(i);let t=BigInt(0);for(let n=0;n<31;n++)t=t*256n+BigInt(i[n]);return t.toString()}async function Do(i){const t=rs[i];if(!t)throw new Error(`Unknown circuit type: ${i}`);const o=await(await fetch(t.wasm)).arrayBuffer(),c=await(await fetch(t.zkey)).arrayBuffer();return{wasm:new Uint8Array(o),zkey:new Uint8Array(c)}}async function ds(i){const{root:t,inputUtxos:n,outputUtxos:o,poolState:e,newPoolState:c,swapParams:f,extDataHash:d}=i;await vn();const b=[];for(let O=0;O<2;O++){const B=n[O],Q=await Rn(B.privateKey),E=await _n(B.amount,B.assetId,Q,B.blinding),nt=await co(E,B.privateKey,B.pathIndices[0]);b.push(nt)}const g=[];for(let O=0;O<2;O++){const B=o[O],Q=await _n(B.amount,B.assetId,B.pubkey,B.blinding);g.push(Q)}const s=await Fn(e.reserveA,e.reserveB,e.poolPubkey,e.poolBlinding),y=await Fn(c.reserveA,c.reserveB,e.poolPubkey,c.poolBlinding),w={root:t,inputNullifier:b,outputCommitment:g,poolStateHash:s,newPoolStateHash:y,extDataHash:d,inAmount:n.map(O=>O.amount),inAssetId:n.map(O=>O.assetId),inPrivateKey:n.map(O=>O.privateKey),inBlinding:n.map(O=>O.blinding),inPathElements:n.map(O=>O.pathElements),inPathIndices:n.map(O=>O.pathIndices),outAmount:o.map(O=>O.amount),outAssetId:o.map(O=>O.assetId),outPubkey:o.map(O=>O.pubkey),outBlinding:o.map(O=>O.blinding),reserveA:e.reserveA,reserveB:e.reserveB,poolPubkey:e.poolPubkey,poolBlinding:e.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,swapAmountIn:f.amountIn,swapAssetIn:f.assetIn,swapAmountOut:f.amountOut,minAmountOut:f.minAmountOut},{wasm:h,zkey:T}=await Do("swap"),{proof:k,publicSignals:x}=await Wo.fullProve(w,h,T);return{proof:k,publicSignals:x,inputNullifiers:b,outputCommitments:g,poolStateHash:s,newPoolStateHash:y}}async function us(i){const{root:t,inputUtxos:n,outputUtxo:o,poolState:e,newPoolState:c,lpState:f,newLpState:d,extDataHash:b}=i;await vn();const g=[];for(let E=0;E<2;E++){const nt=n[E],C=await Rn(nt.privateKey),u=E,L=await _n(nt.amount,u,C,nt.blinding),$=await co(L,nt.privateKey,nt.pathIndices[0]);g.push($)}const s=await _n(o.lpAmount,"2",o.pubkey,o.blinding),y=await Fn(e.reserveA,e.reserveB,e.poolPubkey,e.poolBlinding),w=await Fn(c.reserveA,c.reserveB,e.poolPubkey,c.poolBlinding),h=await no(f.totalLpSupply,f.lpPoolPubkey,f.lpBlinding),T=await no(d.totalLpSupply,f.lpPoolPubkey,d.lpBlinding),k={root:t,inputNullifier:g,outputCommitment:s,poolStateHash:y,newPoolStateHash:w,lpStateHash:h,newLpStateHash:T,extDataHash:b,inAmountA:n[0].amount,inAmountB:n[1].amount,inPrivateKey:n.map(E=>E.privateKey),inBlinding:n.map(E=>E.blinding),inPathElements:n.map(E=>E.pathElements),inPathIndices:n.map(E=>E.pathIndices),outLpAmount:o.lpAmount,outPubkey:o.pubkey,outBlinding:o.blinding,reserveA:e.reserveA,reserveB:e.reserveB,poolPubkey:e.poolPubkey,poolBlinding:e.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,totalLpSupply:f.totalLpSupply,lpPoolPubkey:f.lpPoolPubkey,lpBlinding:f.lpBlinding,newTotalLpSupply:d.totalLpSupply,newLpBlinding:d.lpBlinding},{wasm:x,zkey:O}=await Do("addLiquidity"),{proof:B,publicSignals:Q}=await Wo.fullProve(k,x,O);return{proof:B,publicSignals:Q,inputNullifiers:g,outputCommitment:s,poolStateHash:y,newPoolStateHash:w,lpStateHash:h,newLpStateHash:T}}async function _s(i){const{root:t,inputUtxo:n,outputUtxos:o,poolState:e,newPoolState:c,lpState:f,newLpState:d,extDataHash:b}=i;await vn();const g=await Rn(n.privateKey),s=await _n(n.lpAmount,"2",g,n.blinding),y=await co(s,n.privateKey,n.pathIndices[0]),w=[];for(let C=0;C<2;C++){const u=o[C],L=await _n(u.amount,C,u.pubkey,u.blinding);w.push(L)}const h=await Fn(e.reserveA,e.reserveB,e.poolPubkey,e.poolBlinding),T=await Fn(c.reserveA,c.reserveB,e.poolPubkey,c.poolBlinding),k=await no(f.totalLpSupply,f.lpPoolPubkey,f.lpBlinding),x=await no(d.totalLpSupply,f.lpPoolPubkey,d.lpBlinding),O={root:t,inputNullifier:y,outputCommitment:w,poolStateHash:h,newPoolStateHash:T,lpStateHash:k,newLpStateHash:x,extDataHash:b,inLpAmount:n.lpAmount,inPrivateKey:n.privateKey,inBlinding:n.blinding,inPathElements:n.pathElements,inPathIndices:n.pathIndices,outAmountA:o[0].amount,outPubkeyA:o[0].pubkey,outBlindingA:o[0].blinding,outAmountB:o[1].amount,outPubkeyB:o[1].pubkey,outBlindingB:o[1].blinding,reserveA:e.reserveA,reserveB:e.reserveB,poolPubkey:e.poolPubkey,poolBlinding:e.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,totalLpSupply:f.totalLpSupply,lpPoolPubkey:f.lpPoolPubkey,lpBlinding:f.lpBlinding,newTotalLpSupply:d.totalLpSupply,newLpBlinding:d.lpBlinding},{wasm:B,zkey:Q}=await Do("removeLiquidity"),{proof:E,publicSignals:nt}=await Wo.fullProve(O,B,Q);return{proof:E,publicSignals:nt,inputNullifier:y,outputCommitments:w,poolStateHash:h,newPoolStateHash:T,lpStateHash:k,newLpStateHash:x}}const Ht=20,gs=2**Ht;let Qt=null;async function fs(){if(Qt)return Qt;await vn(),Qt=new Array(Ht+1),Qt[0]="0";for(let i=1;i<=Ht;i++)Qt[i]=await on([Qt[i-1],Qt[i-1]]);return Qt}class ps{constructor(){this.leaves=[],this.layers=[],this.nextIndex=0}async init(){await fs(),this.layers=new Array(Ht+1);for(let t=0;t<=Ht;t++)this.layers[t]=new Map}async insert(t){if(this.nextIndex>=gs)throw new Error("Merkle tree is full");const n=this.nextIndex;this.leaves.push(t);let o=n,e=t;for(let c=0;c<Ht;c++){this.layers[c].set(o,e);const f=o^1,d=this.layers[c].get(f)||Qt[c];o%2===0?e=await on([e,d]):e=await on([d,e]),o=Math.floor(o/2)}return this.layers[Ht].set(0,e),this.nextIndex++,n}getRoot(){return this.nextIndex===0?Qt[Ht]:this.layers[Ht].get(0)}getProof(t){if(t>=this.nextIndex)throw new Error("Leaf index out of bounds");const n=[],o=[];let e=t;for(let c=0;c<Ht;c++){const f=e^1,d=this.layers[c].get(f)||Qt[c];n.push(d),o.push(e%2),e=Math.floor(e/2)}return{pathElements:n,pathIndices:o}}async verifyProof(t,n,o){let e=t;for(let c=0;c<Ht;c++)o[c]===0?e=await on([e,n[c]]):e=await on([n[c],e]);return e===this.getRoot()}getLeafCount(){return this.nextIndex}serialize(){return JSON.stringify({leaves:this.leaves,nextIndex:this.nextIndex})}async deserialize(t){const{leaves:n,nextIndex:o}=JSON.parse(t);await this.init();for(const e of n)await this.insert(e);return this}}async function Qn(){const i=new ps;return await i.init(),i}async function Ls(i,t){try{const o=await(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getAccountInfo",params:[t,{encoding:"base64"}]})})).json();if(!o.result||!o.result.value)return console.warn("Merkle account not found, using empty tree"),Qn();const e=Buffer.from(o.result.value.data[0],"base64"),c=e.readUInt32LE(0),f=await Qn(),d=32,b=4;for(let g=0;g<c;g++){const s=b+g*d,y=e.slice(s,s+d);let w=BigInt(0);for(let h=31;h>=0;h--)w=w*256n+BigInt(y[h]);await f.insert(w.toString())}return console.log(`Synced ${c} leaves from on-chain Merkle tree`),f}catch(n){return console.error("Failed to sync Merkle tree:",n),Qn()}}const Ee="privacy-amm-utxos-encrypted",Pe="privacy-amm-salt";async function hs(i,t){const n=new TextEncoder,o=await crypto.subtle.importKey("raw",n.encode(i),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}function ms(){let i=localStorage.getItem(Pe);if(!i){const t=new Uint8Array(16);crypto.getRandomValues(t),i=Array.from(t).map(n=>n.toString(16).padStart(2,"0")).join(""),localStorage.setItem(Pe,i)}return new Uint8Array(i.match(/.{2}/g).map(t=>parseInt(t,16)))}async function Oe(i,t){const n=new TextEncoder,o=crypto.getRandomValues(new Uint8Array(12)),e=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},t,n.encode(JSON.stringify(i))),c=new Uint8Array(o.length+e.byteLength);return c.set(o),c.set(new Uint8Array(e),o.length),btoa(String.fromCharCode(...c))}async function qe(i,t){const n=Uint8Array.from(atob(i),d=>d.charCodeAt(0)),o=n.slice(0,12),e=n.slice(12),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},t,e),f=new TextDecoder;return JSON.parse(f.decode(c))}class bs{constructor(){this.key=null,this.utxos=[],this.initialized=!1}async init(t,n){try{const o=`Privacy AMM UTXO Storage
Public Key: ${n}
Purpose: Derive encryption key`,e=new TextEncoder().encode(o),c=await t.signMessage(e,"utf8"),f=Array.from(c.signature).map(b=>b.toString(16).padStart(2,"0")).join(""),d=ms();return this.key=await hs(f,d),await this.load(),this.initialized=!0,!0}catch(o){return console.error("Failed to initialize UTXO storage:",o),this.key=null,this.loadUnencrypted(),this.initialized=!0,!1}}async load(){try{const t=localStorage.getItem(Ee);t&&this.key?this.utxos=await qe(t,this.key):this.utxos=[]}catch(t){console.error("Failed to load UTXOs:",t),this.utxos=[]}}loadUnencrypted(){try{const t=localStorage.getItem("privacy-amm-utxos");this.utxos=t?JSON.parse(t):[]}catch{this.utxos=[]}}async save(){try{if(this.key){const t=await Oe(this.utxos,this.key);localStorage.setItem(Ee,t)}else localStorage.setItem("privacy-amm-utxos",JSON.stringify(this.utxos))}catch(t){console.error("Failed to save UTXOs:",t)}}async addUtxo(t){this.utxos.push({...t,createdAt:Date.now()}),await this.save()}async removeUtxo(t){this.utxos=this.utxos.filter(n=>n.commitment!==t),await this.save()}async markSpent(t,n){const o=this.utxos.find(e=>e.commitment===t);o&&(o.spent=!0,o.nullifier=n,o.spentAt=Date.now(),await this.save())}getUnspent(){return this.utxos.filter(t=>!t.spent)}getByAsset(t){return this.getUnspent().filter(n=>n.assetId===t)}getBalance(t){return this.getByAsset(t).reduce((n,o)=>n+BigInt(o.amount),0n)}selectUtxos(t,n){const o=this.getByAsset(t).sort((d,b)=>BigInt(b.amount)-BigInt(d.amount)),e=[];let c=0n;const f=BigInt(n);for(const d of o){if(c>=f)break;e.push(d),c+=BigInt(d.amount)}if(c<f)throw new Error("Insufficient balance");return{utxos:e,total:c.toString(),change:(c-f).toString()}}getAll(){return[...this.utxos]}async clear(){this.utxos=[],await this.save()}async export(){return this.key?await Oe(this.utxos,this.key):JSON.stringify(this.utxos)}async import(t){try{this.key?this.utxos=await qe(t,this.key):this.utxos=JSON.parse(t),await this.save()}catch(n){throw console.error("Failed to import UTXOs:",n),n}}}function ys(){return new bs}const Wt={relayerUrl:"https://privacy-amm-relayer.workers.dev",rpcUrl:"https://api.testnet.solana.com",wsUrl:"wss://api.testnet.solana.com",network:"testnet",programId:"GZfqgHqekzR4D8TAq165XB8U2boVdK5ehEEH4n7u4Xts",poolAccounts:{poolAccount:"DEMitabV4NqSZQUqiK8PQNiPJ3DYbHYJotgA9MgMQkpS",merkleAccount:"DEt4dARcaRZasHWusbMtUPtqYdTaUL72rza5T9z1dw68",nullifierAccount:"8tqoDduwnZvCHLm5UEHZk9f74FrTdCbr8hnvp1dTU7Bm"}},mn=0,bn=1,Ko=2,ot={wallet:null,publicKey:null,privateKey:null,zkPubkey:null,utxoStorage:null,merkleTree:null,poolState:null,initialized:!1};document.addEventListener("DOMContentLoaded",async()=>{console.log("Privacy AMM initializing..."),await vn(),console.log("Poseidon initialized"),ws(),Bs(),As(),Ps(),zs(),Us(),await Gs(),ot.merkleTree=await Qn(),console.log("Merkle tree initialized");try{ot.merkleTree=await Ls(Wt.rpcUrl,Wt.poolAccounts.merkleAccount),console.log("Merkle tree synced from chain")}catch(i){console.warn("Failed to sync Merkle tree:",i)}ot.initialized=!0,console.log("Privacy AMM ready")});function ws(){const i=document.querySelectorAll(".nav-link");i.forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const o=t.dataset.tab;i.forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(`${o}-tab`).classList.add("active")})})}function Bs(){const i=document.getElementById("connect-wallet"),t=document.getElementById("disconnect-wallet");i.addEventListener("click",Ea),t.addEventListener("click",xs),Fs()}async function Ea(){try{if(!window.solana||!window.solana.isPhantom){alert(`Please install Phantom wallet to use this app.
https://phantom.app/`);return}const i=await window.solana.connect();ot.publicKey=i.publicKey.toString(),ot.wallet=window.solana,ot.utxoStorage=ys();const t=await ot.utxoStorage.init(window.solana,ot.publicKey);console.log(t?"UTXO storage initialized with encryption":"UTXO storage initialized without encryption"),await Cs(),Pa(!0),Oa(!0),In(),console.log("Connected:",ot.publicKey)}catch(i){console.error("Wallet connection failed:",i),alert("Failed to connect wallet: "+i.message)}}async function Cs(){try{const i=`Privacy AMM ZK Keypair
Public Key: ${ot.publicKey}
Network: ${Wt.network}`,t=new TextEncoder().encode(i),o=(await ot.wallet.signMessage(t,"utf8")).signature.slice(0,31);let e=BigInt(0);for(let c=0;c<31;c++)e=e*256n+BigInt(o[c]);ot.privateKey=e.toString(),ot.zkPubkey=await Rn(ot.privateKey),console.log("ZK keypair derived")}catch(i){console.error("Failed to derive ZK keypair:",i),ot.privateKey=zt(),ot.zkPubkey=await Rn(ot.privateKey)}}function xs(){ot.wallet&&ot.wallet.disconnect(),ot.wallet=null,ot.publicKey=null,ot.privateKey=null,ot.zkPubkey=null,ot.utxoStorage=null,Pa(!1),Oa(!1)}function Fs(){var i;window.solana&&window.solana.isPhantom&&window.solana.isConnected&&(ot.wallet=window.solana,ot.publicKey=(i=window.solana.publicKey)==null?void 0:i.toString(),ot.publicKey&&Ea())}function Pa(i){const t=document.getElementById("connect-wallet"),n=document.getElementById("wallet-info"),o=document.getElementById("wallet-address");i?(t.classList.add("hidden"),n.classList.remove("hidden"),o.textContent=$s(ot.publicKey)):(t.classList.remove("hidden"),n.classList.add("hidden"))}function Oa(i){document.getElementById("swap-btn").disabled=!i,document.getElementById("add-liquidity-btn").disabled=!i,document.getElementById("remove-liquidity-btn").disabled=!i,document.getElementById("deposit-btn").disabled=!i,document.getElementById("withdraw-btn").disabled=!i,i?document.getElementById("swap-btn").textContent="Swap":document.getElementById("swap-btn").textContent="Connect Wallet to Swap"}function As(){const i=document.getElementById("swap-from-amount"),t=document.getElementById("swap-direction"),n=document.getElementById("swap-btn");i.addEventListener("input",qa),t.addEventListener("click",Is),n.addEventListener("click",Ss)}function qa(){const i=parseFloat(document.getElementById("swap-from-amount").value)||0,t=document.getElementById("swap-from-token").value;if(document.getElementById("swap-to-token").value,!ot.poolState||i===0){document.getElementById("swap-to-amount").value="";return}const{reserveA:n,reserveB:o}=ot.poolState;let e;if(t==="SOL"){const f=i*1e9;e=Me(f,n,o),e=e/1e6}else{const f=i*1e6;e=Me(f,o,n),e=e/1e9}document.getElementById("swap-to-amount").value=e.toFixed(6);const c=vs(i,t);document.getElementById("price-impact").textContent=c.toFixed(2)+"%"}function Me(i,t,n){const o=i*997,e=o*n,c=t*1e3+o;return Math.floor(e/c)}function vs(i,t){if(!ot.poolState||i===0)return 0;const{reserveA:n}=ot.poolState;return(t==="SOL"?i*1e9:i*1e6)/n*100}function Is(){const i=document.getElementById("swap-from-token"),t=document.getElementById("swap-to-token"),n=i.value;i.value=t.value,t.value=n,qa()}async function Ss(){const i=parseFloat(document.getElementById("swap-from-amount").value),t=parseFloat(document.getElementById("swap-to-amount").value),n=document.getElementById("swap-from-token").value;if(!i||!t){alert("Please enter an amount");return}if(!ot.utxoStorage){alert("Please connect wallet first");return}Wn("Selecting UTXOs...");try{const o=n==="SOL"?mn:bn,e=n==="SOL"?bn:mn,c=Math.floor(n==="SOL"?i*1e9:i*1e6),f=Math.floor(n==="SOL"?t*1e6:t*1e9),d=ot.utxoStorage.selectUtxos(o,c);if(d.utxos.length===0)throw new Error("Insufficient private balance");Jt("Building input UTXOs...");const b=[];for(let Q=0;Q<2;Q++){const E=d.utxos[Q]||Es(o),nt=ot.merkleTree.getProof(E.leafIndex||0);b.push({amount:E.amount||"0",assetId:o.toString(),privateKey:ot.privateKey,blinding:E.blinding||zt(),pathElements:nt.pathElements,pathIndices:nt.pathIndices})}const g=[{amount:f.toString(),assetId:e.toString(),pubkey:ot.zkPubkey,blinding:zt()},{amount:d.change,assetId:o.toString(),pubkey:ot.zkPubkey,blinding:zt()}],{reserveA:s,reserveB:y}=ot.poolState,w=zt(),h=zt();let T,k;n==="SOL"?(T=(BigInt(s)+BigInt(c)).toString(),k=(BigInt(y)-BigInt(f)).toString()):(T=(BigInt(s)-BigInt(f)).toString(),k=(BigInt(y)+BigInt(c)).toString()),Jt("Generating ZK proof... (this may take 30-60 seconds)");const x=await ds({root:ot.merkleTree.getRoot(),inputUtxos:b,outputUtxos:g,poolState:{reserveA:s.toString(),reserveB:y.toString(),poolPubkey:Wt.poolAccounts.poolAccount,poolBlinding:w},newPoolState:{reserveA:T,reserveB:k,poolBlinding:h},swapParams:{amountIn:c.toString(),assetIn:o.toString(),amountOut:f.toString(),minAmountOut:Math.floor(f*.99).toString()},extDataHash:"0"});Jt("Submitting to relayer...");const B=await(await fetch(`${Wt.relayerUrl}/swap`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:x.proof,publicSignals:x.publicSignals,nullifiers:x.inputNullifiers,outputCommitments:x.outputCommitments,newPoolStateHash:x.newPoolStateHash,newPoolBlinding:h})})).json();if(B.success){for(const Q of d.utxos)await ot.utxoStorage.markSpent(Q.commitment,x.inputNullifiers[0]);for(let Q=0;Q<g.length;Q++)BigInt(g[Q].amount)>0n&&await ot.utxoStorage.addUtxo({commitment:x.outputCommitments[Q],amount:g[Q].amount,assetId:parseInt(g[Q].assetId),blinding:g[Q].blinding,leafIndex:ot.merkleTree.getLeafCount()+Q});In(),Dn(B.signature,B.explorer)}else en(B.error||"Swap failed")}catch(o){console.error("Swap failed:",o),en(o.message)}}function Es(i){return{amount:"0",assetId:i,blinding:zt(),leafIndex:0}}function Ps(){const i=document.querySelectorAll(".tabs-inner .tab-btn"),t=document.getElementById("add-liquidity-btn"),n=document.getElementById("remove-liquidity-btn");i.forEach(o=>{o.addEventListener("click",()=>{i.forEach(c=>c.classList.remove("active")),o.classList.add("active");const e=o.dataset.action;document.getElementById("add-liquidity").classList.toggle("hidden",e!=="add"),document.getElementById("remove-liquidity").classList.toggle("hidden",e!=="remove")})}),t.addEventListener("click",qs),n.addEventListener("click",Ms),document.getElementById("add-token-a").addEventListener("input",ze),document.getElementById("add-token-b").addEventListener("input",ze),document.getElementById("remove-lp").addEventListener("input",Os)}function ze(){const i=parseFloat(document.getElementById("add-token-a").value)||0,t=parseFloat(document.getElementById("add-token-b").value)||0;if(!ot.poolState||i===0||t===0){document.getElementById("lp-receive").textContent="0.00",document.getElementById("pool-share").textContent="0.00%";return}const{reserveA:n,reserveB:o,totalLpSupply:e}=ot.poolState,c=i*1e9/n,f=t*1e6/o,d=Math.min(c,f)*e/1e6;document.getElementById("lp-receive").textContent=d.toFixed(2);const b=parseFloat(e)/1e6+d,g=d/b*100;document.getElementById("pool-share").textContent=g.toFixed(2)+"%"}function Os(){const i=parseFloat(document.getElementById("remove-lp").value)||0;if(!ot.poolState||i===0){document.getElementById("receive-sol").textContent="0.00",document.getElementById("receive-usdc").textContent="0.00";return}const{reserveA:t,reserveB:n,totalLpSupply:o}=ot.poolState,e=i*1e6/o,c=e*t/1e9,f=e*n/1e6;document.getElementById("receive-sol").textContent=c.toFixed(4),document.getElementById("receive-usdc").textContent=f.toFixed(2)}async function qs(){var n,o,e,c,f,d,b,g;const i=parseFloat(document.getElementById("add-token-a").value),t=parseFloat(document.getElementById("add-token-b").value);if(!i||!t){alert("Please enter amounts for both tokens");return}if(!ot.utxoStorage){alert("Please connect wallet first");return}Wn("Selecting UTXOs...");try{const s=Math.floor(i*1e9),y=Math.floor(t*1e6),w=ot.utxoStorage.selectUtxos(mn,s),h=ot.utxoStorage.selectUtxos(bn,y);Jt("Building input UTXOs...");const T=[{amount:((n=w.utxos[0])==null?void 0:n.amount)||"0",privateKey:ot.privateKey,blinding:((o=w.utxos[0])==null?void 0:o.blinding)||zt(),pathElements:ot.merkleTree.getProof(((e=w.utxos[0])==null?void 0:e.leafIndex)||0).pathElements,pathIndices:ot.merkleTree.getProof(((c=w.utxos[0])==null?void 0:c.leafIndex)||0).pathIndices},{amount:((f=h.utxos[0])==null?void 0:f.amount)||"0",privateKey:ot.privateKey,blinding:((d=h.utxos[0])==null?void 0:d.blinding)||zt(),pathElements:ot.merkleTree.getProof(((b=h.utxos[0])==null?void 0:b.leafIndex)||0).pathElements,pathIndices:ot.merkleTree.getProof(((g=h.utxos[0])==null?void 0:g.leafIndex)||0).pathIndices}],{reserveA:k,reserveB:x,totalLpSupply:O}=ot.poolState,B=Math.floor(Math.sqrt(s*y)),Q={lpAmount:B.toString(),pubkey:ot.zkPubkey,blinding:zt()};Jt("Generating ZK proof... (this may take 30-60 seconds)");const E=await us({root:ot.merkleTree.getRoot(),inputUtxos:T,outputUtxo:Q,poolState:{reserveA:k.toString(),reserveB:x.toString(),poolPubkey:Wt.poolAccounts.poolAccount,poolBlinding:zt()},newPoolState:{reserveA:(BigInt(k)+BigInt(s)).toString(),reserveB:(BigInt(x)+BigInt(y)).toString(),poolBlinding:zt()},lpState:{totalLpSupply:O.toString(),lpPoolPubkey:Wt.poolAccounts.poolAccount,lpBlinding:zt()},newLpState:{totalLpSupply:(BigInt(O)+BigInt(B)).toString(),lpBlinding:zt()},extDataHash:"0"});Jt("Submitting to relayer...");const C=await(await fetch(`${Wt.relayerUrl}/add-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:E.proof,publicSignals:E.publicSignals,nullifiers:E.inputNullifiers,outputCommitment:E.outputCommitment,newPoolStateHash:E.newPoolStateHash,newLpStateHash:E.newLpStateHash})})).json();if(C.success){for(const u of w.utxos)await ot.utxoStorage.markSpent(u.commitment,E.inputNullifiers[0]);for(const u of h.utxos)await ot.utxoStorage.markSpent(u.commitment,E.inputNullifiers[1]);await ot.utxoStorage.addUtxo({commitment:E.outputCommitment,amount:B.toString(),assetId:Ko,blinding:Q.blinding,leafIndex:ot.merkleTree.getLeafCount()}),In(),Dn(C.signature,C.explorer)}else en(C.error)}catch(s){console.error("Add liquidity failed:",s),en(s.message)}}async function Ms(){const i=parseFloat(document.getElementById("remove-lp").value);if(!i){alert("Please enter LP amount");return}if(!ot.utxoStorage){alert("Please connect wallet first");return}Wn("Selecting LP UTXOs...");try{const t=Math.floor(i*1e6),n=ot.utxoStorage.selectUtxos(Ko,t);if(n.utxos.length===0)throw new Error("Insufficient LP balance");Jt("Calculating withdrawal amounts...");const{reserveA:o,reserveB:e,totalLpSupply:c}=ot.poolState,f=BigInt(t)*BigInt(1e18)/BigInt(c),d=(BigInt(o)*f/BigInt(1e18)).toString(),b=(BigInt(e)*f/BigInt(1e18)).toString(),g={lpAmount:n.utxos[0].amount,privateKey:ot.privateKey,blinding:n.utxos[0].blinding,pathElements:ot.merkleTree.getProof(n.utxos[0].leafIndex).pathElements,pathIndices:ot.merkleTree.getProof(n.utxos[0].leafIndex).pathIndices},s=[{amount:d,pubkey:ot.zkPubkey,blinding:zt()},{amount:b,pubkey:ot.zkPubkey,blinding:zt()}];Jt("Generating ZK proof... (this may take 20-40 seconds)");const y=await _s({root:ot.merkleTree.getRoot(),inputUtxo:g,outputUtxos:s,poolState:{reserveA:o.toString(),reserveB:e.toString(),poolPubkey:Wt.poolAccounts.poolAccount,poolBlinding:zt()},newPoolState:{reserveA:(BigInt(o)-BigInt(d)).toString(),reserveB:(BigInt(e)-BigInt(b)).toString(),poolBlinding:zt()},lpState:{totalLpSupply:c.toString(),lpPoolPubkey:Wt.poolAccounts.poolAccount,lpBlinding:zt()},newLpState:{totalLpSupply:(BigInt(c)-BigInt(t)).toString(),lpBlinding:zt()},extDataHash:"0"});Jt("Submitting to relayer...");const h=await(await fetch(`${Wt.relayerUrl}/remove-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:y.proof,publicSignals:y.publicSignals,nullifier:y.inputNullifier,outputCommitments:y.outputCommitments,newPoolStateHash:y.newPoolStateHash,newLpStateHash:y.newLpStateHash})})).json();h.success?(await ot.utxoStorage.markSpent(n.utxos[0].commitment,y.inputNullifier),await ot.utxoStorage.addUtxo({commitment:y.outputCommitments[0],amount:d,assetId:mn,blinding:s[0].blinding,leafIndex:ot.merkleTree.getLeafCount()}),await ot.utxoStorage.addUtxo({commitment:y.outputCommitments[1],amount:b,assetId:bn,blinding:s[1].blinding,leafIndex:ot.merkleTree.getLeafCount()+1}),In(),Dn(h.signature,h.explorer)):en(h.error)}catch(t){console.error("Remove liquidity failed:",t),en(t.message)}}function zs(){document.getElementById("deposit-btn").addEventListener("click",Rs),document.getElementById("withdraw-btn").addEventListener("click",Ns),document.getElementById("confirm-deposit").addEventListener("click",ks),document.getElementById("confirm-withdraw").addEventListener("click",Ts)}function In(){if(!ot.utxoStorage){document.getElementById("total-value").textContent="$0.00",document.getElementById("utxo-count").textContent="0";return}const i=ot.utxoStorage.getUnspent();let t=0n,n=0n,o=0n;i.forEach(d=>{const b=BigInt(d.amount);d.assetId===mn&&(t+=b),d.assetId===bn&&(n+=b),d.assetId===Ko&&(o+=b)});const c=Number(t)/1e9*150+Number(n)/1e6;document.getElementById("total-value").textContent="$"+c.toFixed(2),document.getElementById("utxo-count").textContent=i.length.toString();const f=document.getElementById("asset-list-content");i.length===0?f.innerHTML='<p class="empty-state">No private assets. Deposit to get started!</p>':f.innerHTML=`
            <div class="asset-item">SOL: ${(Number(t)/1e9).toFixed(4)}</div>
            <div class="asset-item">USDC: ${(Number(n)/1e6).toFixed(2)}</div>
            ${o>0n?`<div class="asset-item">LP: ${(Number(o)/1e6).toFixed(2)}</div>`:""}
        `,document.getElementById("from-balance").textContent=(Number(t)/1e9).toFixed(4),document.getElementById("lp-balance").textContent=(Number(o)/1e6).toFixed(2)}async function ks(){const i=parseFloat(document.getElementById("deposit-amount").value),t=document.getElementById("deposit-token").value;if(!i){alert("Please enter an amount");return}if(!ot.utxoStorage){alert("Please connect wallet first");return}oo(),Wn("Computing commitment...");try{const n=t==="SOL"?mn:bn,o=Math.floor(t==="SOL"?i*1e9:i*1e6),e=zt(),c=await _n(o.toString(),n.toString(),ot.zkPubkey,e);Jt("Submitting deposit...");const d=await(await fetch(`${Wt.relayerUrl}/deposit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commitment:c,amount:o,assetType:n})})).json();d.success?(await ot.utxoStorage.addUtxo({commitment:c,amount:o.toString(),assetId:n,blinding:e,leafIndex:ot.merkleTree.getLeafCount()}),await ot.merkleTree.insert(c),In(),Dn(d.signature,d.explorer)):en(d.error||"Deposit failed")}catch(n){console.error("Deposit failed:",n),en(n.message)}}async function Ts(){var o;const i=parseFloat(document.getElementById("withdraw-amount").value),t=document.getElementById("withdraw-recipient").value,n=((o=document.getElementById("withdraw-token"))==null?void 0:o.value)||"SOL";if(!i||!t){alert("Please enter amount and recipient");return}if(!ot.utxoStorage){alert("Please connect wallet first");return}oo(),Wn("Selecting UTXOs...");try{const e=n==="SOL"?mn:bn,c=Math.floor(n==="SOL"?i*1e9:i*1e6),f=ot.utxoStorage.selectUtxos(e,c);if(f.utxos.length===0)throw new Error("Insufficient private balance");const d=f.utxos[0],b=ot.merkleTree.getProof(d.leafIndex),g=await _n(d.amount,e.toString(),ot.zkPubkey,d.blinding),s=await co(g,ot.privateKey,d.leafIndex.toString());Jt("Submitting withdrawal...");const w=await(await fetch(`${Wt.relayerUrl}/withdraw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifier:s,recipient:t,amount:c})})).json();w.success?(await ot.utxoStorage.markSpent(d.commitment,s),In(),Dn(w.signature,w.explorer)):en(w.error||"Withdrawal failed")}catch(e){console.error("Withdraw failed:",e),en(e.message)}}function Us(){document.getElementById("modal-overlay").addEventListener("click",i=>{i.target.id==="modal-overlay"&&oo()}),document.querySelectorAll(".modal-close").forEach(i=>{i.addEventListener("click",oo)})}function Wn(i){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("tx-modal").classList.remove("hidden"),document.getElementById("tx-status-text").textContent=i,document.getElementById("tx-spinner").style.display="block",document.getElementById("tx-success").classList.add("hidden"),document.getElementById("tx-error").classList.add("hidden"),document.querySelector(".tx-status").classList.remove("hidden")}function Jt(i){document.getElementById("tx-status-text").textContent=i}function Dn(i,t){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-success").classList.remove("hidden"),document.getElementById("tx-explorer-link").href=t||`https://explorer.solana.com/tx/${i}?cluster=testnet`}function en(i){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-error").classList.remove("hidden"),document.getElementById("tx-error-text").textContent=i}function Rs(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("deposit-modal").classList.remove("hidden")}function Ns(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("withdraw-modal").classList.remove("hidden")}function oo(){document.getElementById("modal-overlay").classList.add("hidden"),document.querySelectorAll(".modal").forEach(i=>i.classList.add("hidden"))}async function Gs(){try{const t=await(await fetch(`${Wt.relayerUrl}/pool`)).json();ot.poolState={reserveA:parseFloat(t.reserveA),reserveB:parseFloat(t.reserveB),totalLpSupply:parseFloat(t.totalLpSupply)};const n=ot.poolState.reserveB/ot.poolState.reserveA*1e3;document.getElementById("swap-rate").textContent=`1 SOL = ${n.toFixed(2)} USDC`}catch(i){console.error("Failed to load pool state:",i),ot.poolState={reserveA:1e13,reserveB:15e11,totalLpSupply:12247448713e3}}}function $s(i){return i?i.slice(0,4)+"..."+i.slice(-4):""}
