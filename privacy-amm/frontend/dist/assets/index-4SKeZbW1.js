(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&e(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function e(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();var wn={},fe={};fe.byteLength=ni;fe.toByteArray=oi;fe.fromByteArray=ci;var dn=[],tn=[],Ya=typeof Uint8Array<"u"?Uint8Array:Array,Fe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Pn=0,ti=Fe.length;Pn<ti;++Pn)dn[Pn]=Fe[Pn],tn[Fe.charCodeAt(Pn)]=Pn;tn[45]=62;tn[95]=63;function Ko(a){var t=a.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=a.indexOf("=");n===-1&&(n=t);var e=n===t?0:4-n%4;return[n,e]}function ni(a){var t=Ko(a),n=t[0],e=t[1];return(n+e)*3/4-e}function ei(a,t,n){return(t+n)*3/4-n}function oi(a){var t,n=Ko(a),e=n[0],o=n[1],c=new Ya(ei(a,e,o)),f=0,s=o>0?e-4:e,b;for(b=0;b<s;b+=4)t=tn[a.charCodeAt(b)]<<18|tn[a.charCodeAt(b+1)]<<12|tn[a.charCodeAt(b+2)]<<6|tn[a.charCodeAt(b+3)],c[f++]=t>>16&255,c[f++]=t>>8&255,c[f++]=t&255;return o===2&&(t=tn[a.charCodeAt(b)]<<2|tn[a.charCodeAt(b+1)]>>4,c[f++]=t&255),o===1&&(t=tn[a.charCodeAt(b)]<<10|tn[a.charCodeAt(b+1)]<<4|tn[a.charCodeAt(b+2)]>>2,c[f++]=t>>8&255,c[f++]=t&255),c}function ai(a){return dn[a>>18&63]+dn[a>>12&63]+dn[a>>6&63]+dn[a&63]}function ii(a,t,n){for(var e,o=[],c=t;c<n;c+=3)e=(a[c]<<16&16711680)+(a[c+1]<<8&65280)+(a[c+2]&255),o.push(ai(e));return o.join("")}function ci(a){for(var t,n=a.length,e=n%3,o=[],c=16383,f=0,s=n-e;f<s;f+=c)o.push(ii(a,f,f+c>s?s:f+c));return e===1?(t=a[n-1],o.push(dn[t>>2]+dn[t<<4&63]+"==")):e===2&&(t=(a[n-2]<<8)+a[n-1],o.push(dn[t>>10]+dn[t>>4&63]+dn[t<<2&63]+"=")),o.join("")}var Ke={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ke.read=function(a,t,n,e,o){var c,f,s=o*8-e-1,b=(1<<s)-1,u=b>>1,l=-7,B=n?o-1:0,x=n?-1:1,y=a[t+B];for(B+=x,c=y&(1<<-l)-1,y>>=-l,l+=s;l>0;c=c*256+a[t+B],B+=x,l-=8);for(f=c&(1<<-l)-1,c>>=-l,l+=e;l>0;f=f*256+a[t+B],B+=x,l-=8);if(c===0)c=1-u;else{if(c===b)return f?NaN:(y?-1:1)*(1/0);f=f+Math.pow(2,e),c=c-u}return(y?-1:1)*f*Math.pow(2,c-e)};Ke.write=function(a,t,n,e,o,c){var f,s,b,u=c*8-o-1,l=(1<<u)-1,B=l>>1,x=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=e?0:c-1,$=e?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,f=l):(f=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-f))<1&&(f--,b*=2),f+B>=1?t+=x/b:t+=x*Math.pow(2,1-B),t*b>=2&&(f++,b/=2),f+B>=l?(s=0,f=l):f+B>=1?(s=(t*b-1)*Math.pow(2,o),f=f+B):(s=t*Math.pow(2,B-1)*Math.pow(2,o),f=0));o>=8;a[n+y]=s&255,y+=$,s/=256,o-=8);for(f=f<<o|s,u+=o;u>0;a[n+y]=f&255,y+=$,f/=256,u-=8);a[n+y-$]|=R*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(a){const t=fe,n=Ke,e=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;a.Buffer=s,a.SlowBuffer=A,a.INSPECT_MAX_BYTES=50;const o=2147483647;a.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=c(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const F=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(F,p),F.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function f(F){if(F>o)throw new RangeError('The value "'+F+'" is invalid for option "size"');const p=new Uint8Array(F);return Object.setPrototypeOf(p,s.prototype),p}function s(F,p,m){if(typeof F=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return B(F)}return b(F,p,m)}s.poolSize=8192;function b(F,p,m){if(typeof F=="string")return x(F,p);if(ArrayBuffer.isView(F))return $(F);if(F==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof F);if(bt(F,ArrayBuffer)||F&&bt(F.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(bt(F,SharedArrayBuffer)||F&&bt(F.buffer,SharedArrayBuffer)))return R(F,p,m);if(typeof F=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=F.valueOf&&F.valueOf();if(S!=null&&S!==F)return s.from(S,p,m);const z=I(F);if(z)return z;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof F[Symbol.toPrimitive]=="function")return s.from(F[Symbol.toPrimitive]("string"),p,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof F)}s.from=function(F,p,m){return b(F,p,m)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function u(F){if(typeof F!="number")throw new TypeError('"size" argument must be of type number');if(F<0)throw new RangeError('The value "'+F+'" is invalid for option "size"')}function l(F,p,m){return u(F),F<=0?f(F):p!==void 0?typeof m=="string"?f(F).fill(p,m):f(F).fill(p):f(F)}s.alloc=function(F,p,m){return l(F,p,m)};function B(F){return u(F),f(F<0?0:G(F)|0)}s.allocUnsafe=function(F){return B(F)},s.allocUnsafeSlow=function(F){return B(F)};function x(F,p){if((typeof p!="string"||p==="")&&(p="utf8"),!s.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const m=Q(F,p)|0;let S=f(m);const z=S.write(F,p);return z!==m&&(S=S.slice(0,z)),S}function y(F){const p=F.length<0?0:G(F.length)|0,m=f(p);for(let S=0;S<p;S+=1)m[S]=F[S]&255;return m}function $(F){if(bt(F,Uint8Array)){const p=new Uint8Array(F);return R(p.buffer,p.byteOffset,p.byteLength)}return y(F)}function R(F,p,m){if(p<0||F.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(F.byteLength<p+(m||0))throw new RangeError('"length" is outside of buffer bounds');let S;return p===void 0&&m===void 0?S=new Uint8Array(F):m===void 0?S=new Uint8Array(F,p):S=new Uint8Array(F,p,m),Object.setPrototypeOf(S,s.prototype),S}function I(F){if(s.isBuffer(F)){const p=G(F.length)|0,m=f(p);return m.length===0||F.copy(m,0,0,p),m}if(F.length!==void 0)return typeof F.length!="number"||Mt(F.length)?f(0):y(F);if(F.type==="Buffer"&&Array.isArray(F.data))return y(F.data)}function G(F){if(F>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return F|0}function A(F){return+F!=F&&(F=0),s.alloc(+F)}s.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==s.prototype},s.compare=function(p,m){if(bt(p,Uint8Array)&&(p=s.from(p,p.offset,p.byteLength)),bt(m,Uint8Array)&&(m=s.from(m,m.offset,m.byteLength)),!s.isBuffer(p)||!s.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===m)return 0;let S=p.length,z=m.length;for(let Z=0,P=Math.min(S,z);Z<P;++Z)if(p[Z]!==m[Z]){S=p[Z],z=m[Z];break}return S<z?-1:z<S?1:0},s.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(p,m){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return s.alloc(0);let S;if(m===void 0)for(m=0,S=0;S<p.length;++S)m+=p[S].length;const z=s.allocUnsafe(m);let Z=0;for(S=0;S<p.length;++S){let P=p[S];if(bt(P,Uint8Array))Z+P.length>z.length?(s.isBuffer(P)||(P=s.from(P)),P.copy(z,Z)):Uint8Array.prototype.set.call(z,P,Z);else if(s.isBuffer(P))P.copy(z,Z);else throw new TypeError('"list" argument must be an Array of Buffers');Z+=P.length}return z};function Q(F,p){if(s.isBuffer(F))return F.length;if(ArrayBuffer.isView(F)||bt(F,ArrayBuffer))return F.byteLength;if(typeof F!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof F);const m=F.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&m===0)return 0;let z=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return Lt(F).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return mt(F).length;default:if(z)return S?-1:Lt(F).length;p=(""+p).toLowerCase(),z=!0}}s.byteLength=Q;function M(F,p,m){let S=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,p>>>=0,m<=p))return"";for(F||(F="utf8");;)switch(F){case"hex":return ut(this,p,m);case"utf8":case"utf-8":return U(this,p,m);case"ascii":return st(this,p,m);case"latin1":case"binary":return H(this,p,m);case"base64":return w(this,p,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ot(this,p,m);default:if(S)throw new TypeError("Unknown encoding: "+F);F=(F+"").toLowerCase(),S=!0}}s.prototype._isBuffer=!0;function ct(F,p,m){const S=F[p];F[p]=F[m],F[m]=S}s.prototype.swap16=function(){const p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<p;m+=2)ct(this,m,m+1);return this},s.prototype.swap32=function(){const p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<p;m+=4)ct(this,m,m+3),ct(this,m+1,m+2);return this},s.prototype.swap64=function(){const p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<p;m+=8)ct(this,m,m+7),ct(this,m+1,m+6),ct(this,m+2,m+5),ct(this,m+3,m+4);return this},s.prototype.toString=function(){const p=this.length;return p===0?"":arguments.length===0?U(this,0,p):M.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(p){if(!s.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:s.compare(this,p)===0},s.prototype.inspect=function(){let p="";const m=a.INSPECT_MAX_BYTES;return p=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(p+=" ... "),"<Buffer "+p+">"},e&&(s.prototype[e]=s.prototype.inspect),s.prototype.compare=function(p,m,S,z,Z){if(bt(p,Uint8Array)&&(p=s.from(p,p.offset,p.byteLength)),!s.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(m===void 0&&(m=0),S===void 0&&(S=p?p.length:0),z===void 0&&(z=0),Z===void 0&&(Z=this.length),m<0||S>p.length||z<0||Z>this.length)throw new RangeError("out of range index");if(z>=Z&&m>=S)return 0;if(z>=Z)return-1;if(m>=S)return 1;if(m>>>=0,S>>>=0,z>>>=0,Z>>>=0,this===p)return 0;let P=Z-z,r=S-m;const g=Math.min(P,r),T=this.slice(z,Z),N=p.slice(m,S);for(let q=0;q<g;++q)if(T[q]!==N[q]){P=T[q],r=N[q];break}return P<r?-1:r<P?1:0};function C(F,p,m,S,z){if(F.length===0)return-1;if(typeof m=="string"?(S=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,Mt(m)&&(m=z?0:F.length-1),m<0&&(m=F.length+m),m>=F.length){if(z)return-1;m=F.length-1}else if(m<0)if(z)m=0;else return-1;if(typeof p=="string"&&(p=s.from(p,S)),s.isBuffer(p))return p.length===0?-1:_(F,p,m,S,z);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?z?Uint8Array.prototype.indexOf.call(F,p,m):Uint8Array.prototype.lastIndexOf.call(F,p,m):_(F,[p],m,S,z);throw new TypeError("val must be string, number or Buffer")}function _(F,p,m,S,z){let Z=1,P=F.length,r=p.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(F.length<2||p.length<2)return-1;Z=2,P/=2,r/=2,m/=2}function g(N,q){return Z===1?N[q]:N.readUInt16BE(q*Z)}let T;if(z){let N=-1;for(T=m;T<P;T++)if(g(F,T)===g(p,N===-1?0:T-N)){if(N===-1&&(N=T),T-N+1===r)return N*Z}else N!==-1&&(T-=T-N),N=-1}else for(m+r>P&&(m=P-r),T=m;T>=0;T--){let N=!0;for(let q=0;q<r;q++)if(g(F,T+q)!==g(p,q)){N=!1;break}if(N)return T}return-1}s.prototype.includes=function(p,m,S){return this.indexOf(p,m,S)!==-1},s.prototype.indexOf=function(p,m,S){return C(this,p,m,S,!0)},s.prototype.lastIndexOf=function(p,m,S){return C(this,p,m,S,!1)};function h(F,p,m,S){m=Number(m)||0;const z=F.length-m;S?(S=Number(S),S>z&&(S=z)):S=z;const Z=p.length;S>Z/2&&(S=Z/2);let P;for(P=0;P<S;++P){const r=parseInt(p.substr(P*2,2),16);if(Mt(r))return P;F[m+P]=r}return P}function X(F,p,m,S){return ft(Lt(p,F.length-m),F,m,S)}function J(F,p,m,S){return ft(xt(p),F,m,S)}function nt(F,p,m,S){return ft(mt(p),F,m,S)}function O(F,p,m,S){return ft(Ut(p,F.length-m),F,m,S)}s.prototype.write=function(p,m,S,z){if(m===void 0)z="utf8",S=this.length,m=0;else if(S===void 0&&typeof m=="string")z=m,S=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(S)?(S=S>>>0,z===void 0&&(z="utf8")):(z=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Z=this.length-m;if((S===void 0||S>Z)&&(S=Z),p.length>0&&(S<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");z||(z="utf8");let P=!1;for(;;)switch(z){case"hex":return h(this,p,m,S);case"utf8":case"utf-8":return X(this,p,m,S);case"ascii":case"latin1":case"binary":return J(this,p,m,S);case"base64":return nt(this,p,m,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,p,m,S);default:if(P)throw new TypeError("Unknown encoding: "+z);z=(""+z).toLowerCase(),P=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function w(F,p,m){return p===0&&m===F.length?t.fromByteArray(F):t.fromByteArray(F.slice(p,m))}function U(F,p,m){m=Math.min(F.length,m);const S=[];let z=p;for(;z<m;){const Z=F[z];let P=null,r=Z>239?4:Z>223?3:Z>191?2:1;if(z+r<=m){let g,T,N,q;switch(r){case 1:Z<128&&(P=Z);break;case 2:g=F[z+1],(g&192)===128&&(q=(Z&31)<<6|g&63,q>127&&(P=q));break;case 3:g=F[z+1],T=F[z+2],(g&192)===128&&(T&192)===128&&(q=(Z&15)<<12|(g&63)<<6|T&63,q>2047&&(q<55296||q>57343)&&(P=q));break;case 4:g=F[z+1],T=F[z+2],N=F[z+3],(g&192)===128&&(T&192)===128&&(N&192)===128&&(q=(Z&15)<<18|(g&63)<<12|(T&63)<<6|N&63,q>65535&&q<1114112&&(P=q))}}P===null?(P=65533,r=1):P>65535&&(P-=65536,S.push(P>>>10&1023|55296),P=56320|P&1023),S.push(P),z+=r}return dt(S)}const W=4096;function dt(F){const p=F.length;if(p<=W)return String.fromCharCode.apply(String,F);let m="",S=0;for(;S<p;)m+=String.fromCharCode.apply(String,F.slice(S,S+=W));return m}function st(F,p,m){let S="";m=Math.min(F.length,m);for(let z=p;z<m;++z)S+=String.fromCharCode(F[z]&127);return S}function H(F,p,m){let S="";m=Math.min(F.length,m);for(let z=p;z<m;++z)S+=String.fromCharCode(F[z]);return S}function ut(F,p,m){const S=F.length;(!p||p<0)&&(p=0),(!m||m<0||m>S)&&(m=S);let z="";for(let Z=p;Z<m;++Z)z+=Wt[F[Z]];return z}function ot(F,p,m){const S=F.slice(p,m);let z="";for(let Z=0;Z<S.length-1;Z+=2)z+=String.fromCharCode(S[Z]+S[Z+1]*256);return z}s.prototype.slice=function(p,m){const S=this.length;p=~~p,m=m===void 0?S:~~m,p<0?(p+=S,p<0&&(p=0)):p>S&&(p=S),m<0?(m+=S,m<0&&(m=0)):m>S&&(m=S),m<p&&(m=p);const z=this.subarray(p,m);return Object.setPrototypeOf(z,s.prototype),z};function lt(F,p,m){if(F%1!==0||F<0)throw new RangeError("offset is not uint");if(F+p>m)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(p,m,S){p=p>>>0,m=m>>>0,S||lt(p,m,this.length);let z=this[p],Z=1,P=0;for(;++P<m&&(Z*=256);)z+=this[p+P]*Z;return z},s.prototype.readUintBE=s.prototype.readUIntBE=function(p,m,S){p=p>>>0,m=m>>>0,S||lt(p,m,this.length);let z=this[p+--m],Z=1;for(;m>0&&(Z*=256);)z+=this[p+--m]*Z;return z},s.prototype.readUint8=s.prototype.readUInt8=function(p,m){return p=p>>>0,m||lt(p,1,this.length),this[p]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(p,m){return p=p>>>0,m||lt(p,2,this.length),this[p]|this[p+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(p,m){return p=p>>>0,m||lt(p,2,this.length),this[p]<<8|this[p+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},s.prototype.readBigUInt64LE=Dt(function(p){p=p>>>0,pt(p,"offset");const m=this[p],S=this[p+7];(m===void 0||S===void 0)&&gt(p,this.length-8);const z=m+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,Z=this[++p]+this[++p]*2**8+this[++p]*2**16+S*2**24;return BigInt(z)+(BigInt(Z)<<BigInt(32))}),s.prototype.readBigUInt64BE=Dt(function(p){p=p>>>0,pt(p,"offset");const m=this[p],S=this[p+7];(m===void 0||S===void 0)&&gt(p,this.length-8);const z=m*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],Z=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+S;return(BigInt(z)<<BigInt(32))+BigInt(Z)}),s.prototype.readIntLE=function(p,m,S){p=p>>>0,m=m>>>0,S||lt(p,m,this.length);let z=this[p],Z=1,P=0;for(;++P<m&&(Z*=256);)z+=this[p+P]*Z;return Z*=128,z>=Z&&(z-=Math.pow(2,8*m)),z},s.prototype.readIntBE=function(p,m,S){p=p>>>0,m=m>>>0,S||lt(p,m,this.length);let z=m,Z=1,P=this[p+--z];for(;z>0&&(Z*=256);)P+=this[p+--z]*Z;return Z*=128,P>=Z&&(P-=Math.pow(2,8*m)),P},s.prototype.readInt8=function(p,m){return p=p>>>0,m||lt(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},s.prototype.readInt16LE=function(p,m){p=p>>>0,m||lt(p,2,this.length);const S=this[p]|this[p+1]<<8;return S&32768?S|4294901760:S},s.prototype.readInt16BE=function(p,m){p=p>>>0,m||lt(p,2,this.length);const S=this[p+1]|this[p]<<8;return S&32768?S|4294901760:S},s.prototype.readInt32LE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},s.prototype.readInt32BE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},s.prototype.readBigInt64LE=Dt(function(p){p=p>>>0,pt(p,"offset");const m=this[p],S=this[p+7];(m===void 0||S===void 0)&&gt(p,this.length-8);const z=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(S<<24);return(BigInt(z)<<BigInt(32))+BigInt(m+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),s.prototype.readBigInt64BE=Dt(function(p){p=p>>>0,pt(p,"offset");const m=this[p],S=this[p+7];(m===void 0||S===void 0)&&gt(p,this.length-8);const z=(m<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(z)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+S)}),s.prototype.readFloatLE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),n.read(this,p,!0,23,4)},s.prototype.readFloatBE=function(p,m){return p=p>>>0,m||lt(p,4,this.length),n.read(this,p,!1,23,4)},s.prototype.readDoubleLE=function(p,m){return p=p>>>0,m||lt(p,8,this.length),n.read(this,p,!0,52,8)},s.prototype.readDoubleBE=function(p,m){return p=p>>>0,m||lt(p,8,this.length),n.read(this,p,!1,52,8)};function Et(F,p,m,S,z,Z){if(!s.isBuffer(F))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>z||p<Z)throw new RangeError('"value" argument is out of bounds');if(m+S>F.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(p,m,S,z){if(p=+p,m=m>>>0,S=S>>>0,!z){const r=Math.pow(2,8*S)-1;Et(this,p,m,S,r,0)}let Z=1,P=0;for(this[m]=p&255;++P<S&&(Z*=256);)this[m+P]=p/Z&255;return m+S},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(p,m,S,z){if(p=+p,m=m>>>0,S=S>>>0,!z){const r=Math.pow(2,8*S)-1;Et(this,p,m,S,r,0)}let Z=S-1,P=1;for(this[m+Z]=p&255;--Z>=0&&(P*=256);)this[m+Z]=p/P&255;return m+S},s.prototype.writeUint8=s.prototype.writeUInt8=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,1,255,0),this[m]=p&255,m+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,2,65535,0),this[m]=p&255,this[m+1]=p>>>8,m+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,2,65535,0),this[m]=p>>>8,this[m+1]=p&255,m+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,4,4294967295,0),this[m+3]=p>>>24,this[m+2]=p>>>16,this[m+1]=p>>>8,this[m]=p&255,m+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,4,4294967295,0),this[m]=p>>>24,this[m+1]=p>>>16,this[m+2]=p>>>8,this[m+3]=p&255,m+4};function Tt(F,p,m,S,z){et(p,S,z,F,m,7);let Z=Number(p&BigInt(4294967295));F[m++]=Z,Z=Z>>8,F[m++]=Z,Z=Z>>8,F[m++]=Z,Z=Z>>8,F[m++]=Z;let P=Number(p>>BigInt(32)&BigInt(4294967295));return F[m++]=P,P=P>>8,F[m++]=P,P=P>>8,F[m++]=P,P=P>>8,F[m++]=P,m}function Ft(F,p,m,S,z){et(p,S,z,F,m,7);let Z=Number(p&BigInt(4294967295));F[m+7]=Z,Z=Z>>8,F[m+6]=Z,Z=Z>>8,F[m+5]=Z,Z=Z>>8,F[m+4]=Z;let P=Number(p>>BigInt(32)&BigInt(4294967295));return F[m+3]=P,P=P>>8,F[m+2]=P,P=P>>8,F[m+1]=P,P=P>>8,F[m]=P,m+8}s.prototype.writeBigUInt64LE=Dt(function(p,m=0){return Tt(this,p,m,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=Dt(function(p,m=0){return Ft(this,p,m,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(p,m,S,z){if(p=+p,m=m>>>0,!z){const g=Math.pow(2,8*S-1);Et(this,p,m,S,g-1,-g)}let Z=0,P=1,r=0;for(this[m]=p&255;++Z<S&&(P*=256);)p<0&&r===0&&this[m+Z-1]!==0&&(r=1),this[m+Z]=(p/P>>0)-r&255;return m+S},s.prototype.writeIntBE=function(p,m,S,z){if(p=+p,m=m>>>0,!z){const g=Math.pow(2,8*S-1);Et(this,p,m,S,g-1,-g)}let Z=S-1,P=1,r=0;for(this[m+Z]=p&255;--Z>=0&&(P*=256);)p<0&&r===0&&this[m+Z+1]!==0&&(r=1),this[m+Z]=(p/P>>0)-r&255;return m+S},s.prototype.writeInt8=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,1,127,-128),p<0&&(p=255+p+1),this[m]=p&255,m+1},s.prototype.writeInt16LE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,2,32767,-32768),this[m]=p&255,this[m+1]=p>>>8,m+2},s.prototype.writeInt16BE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,2,32767,-32768),this[m]=p>>>8,this[m+1]=p&255,m+2},s.prototype.writeInt32LE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,4,2147483647,-2147483648),this[m]=p&255,this[m+1]=p>>>8,this[m+2]=p>>>16,this[m+3]=p>>>24,m+4},s.prototype.writeInt32BE=function(p,m,S){return p=+p,m=m>>>0,S||Et(this,p,m,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[m]=p>>>24,this[m+1]=p>>>16,this[m+2]=p>>>8,this[m+3]=p&255,m+4},s.prototype.writeBigInt64LE=Dt(function(p,m=0){return Tt(this,p,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=Dt(function(p,m=0){return Ft(this,p,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function v(F,p,m,S,z,Z){if(m+S>F.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function i(F,p,m,S,z){return p=+p,m=m>>>0,z||v(F,p,m,4),n.write(F,p,m,S,23,4),m+4}s.prototype.writeFloatLE=function(p,m,S){return i(this,p,m,!0,S)},s.prototype.writeFloatBE=function(p,m,S){return i(this,p,m,!1,S)};function E(F,p,m,S,z){return p=+p,m=m>>>0,z||v(F,p,m,8),n.write(F,p,m,S,52,8),m+8}s.prototype.writeDoubleLE=function(p,m,S){return E(this,p,m,!0,S)},s.prototype.writeDoubleBE=function(p,m,S){return E(this,p,m,!1,S)},s.prototype.copy=function(p,m,S,z){if(!s.isBuffer(p))throw new TypeError("argument should be a Buffer");if(S||(S=0),!z&&z!==0&&(z=this.length),m>=p.length&&(m=p.length),m||(m=0),z>0&&z<S&&(z=S),z===S||p.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(z<0)throw new RangeError("sourceEnd out of bounds");z>this.length&&(z=this.length),p.length-m<z-S&&(z=p.length-m+S);const Z=z-S;return this===p&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(m,S,z):Uint8Array.prototype.set.call(p,this.subarray(S,z),m),Z},s.prototype.fill=function(p,m,S,z){if(typeof p=="string"){if(typeof m=="string"?(z=m,m=0,S=this.length):typeof S=="string"&&(z=S,S=this.length),z!==void 0&&typeof z!="string")throw new TypeError("encoding must be a string");if(typeof z=="string"&&!s.isEncoding(z))throw new TypeError("Unknown encoding: "+z);if(p.length===1){const P=p.charCodeAt(0);(z==="utf8"&&P<128||z==="latin1")&&(p=P)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(m<0||this.length<m||this.length<S)throw new RangeError("Out of range index");if(S<=m)return this;m=m>>>0,S=S===void 0?this.length:S>>>0,p||(p=0);let Z;if(typeof p=="number")for(Z=m;Z<S;++Z)this[Z]=p;else{const P=s.isBuffer(p)?p:s.from(p,z),r=P.length;if(r===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(Z=0;Z<S-m;++Z)this[Z+m]=P[Z%r]}return this};const d={};function K(F,p,m){d[F]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${F}]`,this.stack,delete this.name}get code(){return F}set code(z){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:z,writable:!0})}toString(){return`${this.name} [${F}]: ${this.message}`}}}K("ERR_BUFFER_OUT_OF_BOUNDS",function(F){return F?`${F} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),K("ERR_INVALID_ARG_TYPE",function(F,p){return`The "${F}" argument must be of type number. Received type ${typeof p}`},TypeError),K("ERR_OUT_OF_RANGE",function(F,p,m){let S=`The value of "${F}" is out of range.`,z=m;return Number.isInteger(m)&&Math.abs(m)>2**32?z=k(String(m)):typeof m=="bigint"&&(z=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(z=k(z)),z+="n"),S+=` It must be ${p}. Received ${z}`,S},RangeError);function k(F){let p="",m=F.length;const S=F[0]==="-"?1:0;for(;m>=S+4;m-=3)p=`_${F.slice(m-3,m)}${p}`;return`${F.slice(0,m)}${p}`}function L(F,p,m){pt(p,"offset"),(F[p]===void 0||F[p+m]===void 0)&&gt(p,F.length-(m+1))}function et(F,p,m,S,z,Z){if(F>m||F<p){const P=typeof p=="bigint"?"n":"";let r;throw p===0||p===BigInt(0)?r=`>= 0${P} and < 2${P} ** ${(Z+1)*8}${P}`:r=`>= -(2${P} ** ${(Z+1)*8-1}${P}) and < 2 ** ${(Z+1)*8-1}${P}`,new d.ERR_OUT_OF_RANGE("value",r,F)}L(S,z,Z)}function pt(F,p){if(typeof F!="number")throw new d.ERR_INVALID_ARG_TYPE(p,"number",F)}function gt(F,p,m){throw Math.floor(F)!==F?(pt(F,m),new d.ERR_OUT_OF_RANGE("offset","an integer",F)):p<0?new d.ERR_BUFFER_OUT_OF_BOUNDS:new d.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,F)}const ht=/[^+/0-9A-Za-z-_]/g;function Ct(F){if(F=F.split("=")[0],F=F.trim().replace(ht,""),F.length<2)return"";for(;F.length%4!==0;)F=F+"=";return F}function Lt(F,p){p=p||1/0;let m;const S=F.length;let z=null;const Z=[];for(let P=0;P<S;++P){if(m=F.charCodeAt(P),m>55295&&m<57344){if(!z){if(m>56319){(p-=3)>-1&&Z.push(239,191,189);continue}else if(P+1===S){(p-=3)>-1&&Z.push(239,191,189);continue}z=m;continue}if(m<56320){(p-=3)>-1&&Z.push(239,191,189),z=m;continue}m=(z-55296<<10|m-56320)+65536}else z&&(p-=3)>-1&&Z.push(239,191,189);if(z=null,m<128){if((p-=1)<0)break;Z.push(m)}else if(m<2048){if((p-=2)<0)break;Z.push(m>>6|192,m&63|128)}else if(m<65536){if((p-=3)<0)break;Z.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((p-=4)<0)break;Z.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return Z}function xt(F){const p=[];for(let m=0;m<F.length;++m)p.push(F.charCodeAt(m)&255);return p}function Ut(F,p){let m,S,z;const Z=[];for(let P=0;P<F.length&&!((p-=2)<0);++P)m=F.charCodeAt(P),S=m>>8,z=m%256,Z.push(z),Z.push(S);return Z}function mt(F){return t.toByteArray(Ct(F))}function ft(F,p,m,S){let z;for(z=0;z<S&&!(z+m>=p.length||z>=F.length);++z)p[z+m]=F[z];return z}function bt(F,p){return F instanceof p||F!=null&&F.constructor!=null&&F.constructor.name!=null&&F.constructor.name===p.name}function Mt(F){return F!==F}const Wt=function(){const F="0123456789abcdef",p=new Array(256);for(let m=0;m<16;++m){const S=m*16;for(let z=0;z<16;++z)p[S+z]=F[m]+F[z]}return p}();function Dt(F){return typeof BigInt>"u"?Qt:F}function Qt(){throw new Error("BigInt not supported")}})(wn);const si="modulepreload",li=function(a){return"/"+a},uo={},ri=function(t,n,e){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),s=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=Promise.allSettled(n.map(b=>{if(b=li(b),b in uo)return;uo[b]=!0;const u=b.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${l}`))return;const B=document.createElement("link");if(B.rel=u?"stylesheet":si,u||(B.as="script"),B.crossOrigin="",B.href=b,s&&B.setAttribute("nonce",s),document.head.appendChild(B),u)return new Promise((x,y)=>{B.addEventListener("load",x),B.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${b}`)))})}))}function c(f){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=f,window.dispatchEvent(s),!s.defaultPrevented)throw f}return o.then(f=>{for(const s of f||[])s.status==="rejected"&&c(s.reason);return t().catch(c)})},di=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];function pe(a,t){if(!t||t==10)return BigInt(a);if(t==16)return a.slice(0,2)=="0x"?BigInt(a):BigInt("0x"+a)}const jt=pe;function ui(a,t){let n=BigInt(0);t=BigInt(t);for(let e=0;e<a.length;e++)n=n*t+BigInt(a[e]);return n}function Hn(a){const t=a.toString(16);return(t.length-1)*4+di[parseInt(t[0],16)]}function Vo(a){return BigInt(a)<BigInt(0)}function Qo(a){return!a}function re(a,t){return BigInt(a)<<BigInt(t)}function On(a,t){return BigInt(a)>>BigInt(t)}const _i=re,gi=On;function Ve(a){return(BigInt(a)&BigInt(1))==BigInt(1)}function fi(a){let t=BigInt(a);const n=[];for(;t;){if(t&BigInt(1)){const e=2-Number(t%BigInt(4));n.push(e),t=t-BigInt(e)}else n.push(0);t=t>>BigInt(1)}return n}function Ho(a){let t=BigInt(a);const n=[];for(;t;)t&BigInt(1)?n.push(1):n.push(0),t=t>>BigInt(1);return n}function Jo(a){if(a>BigInt(Number.MAX_SAFE_INTEGER))throw new Error("Number too big");return Number(a)}function pi(a,t){const n=[];let e=BigInt(a);for(t=BigInt(t);e;)n.unshift(Number(e%t)),e=e/t;return n}function Qe(a,t){return BigInt(a)+BigInt(t)}function pn(a,t){return BigInt(a)-BigInt(t)}function Yo(a){return-BigInt(a)}function ta(a,t){return BigInt(a)*BigInt(t)}function hi(a){return BigInt(a)*BigInt(a)}function Jn(a,t){return BigInt(a)**BigInt(t)}function Li(a,t){return BigInt(a)**BigInt(t)}function mi(a){return BigInt(a)>=0?BigInt(a):-BigInt(a)}function kn(a,t){return BigInt(a)/BigInt(t)}function rn(a,t){return BigInt(a)%BigInt(t)}function An(a,t){return BigInt(a)==BigInt(t)}function yi(a,t){return BigInt(a)!=BigInt(t)}function bi(a,t){return BigInt(a)<BigInt(t)}function ze(a,t){return BigInt(a)>BigInt(t)}function wi(a,t){return BigInt(a)<=BigInt(t)}function na(a,t){return BigInt(a)>=BigInt(t)}function He(a,t){return BigInt(a)&BigInt(t)}function Bi(a,t){return BigInt(a)|BigInt(t)}function xi(a,t){return BigInt(a)^BigInt(t)}function Fi(a,t){return BigInt(a)&&BigInt(t)}function Ci(a,t){return BigInt(a)||BigInt(t)}function Ai(a){return!BigInt(a)}function Xn(a,t,n,e){const o="0000000"+n.toString(16),c=new Uint32Array(a.buffer,a.byteOffset+t,e/4),f=((o.length-7)*4-1>>5)+1;for(let s=0;s<f;s++)c[s]=parseInt(o.substring(o.length-8*s-8,o.length-8*s),16);for(let s=f;s<c.length;s++)c[s]=0;for(let s=c.length*4;s<e;s++)a[s]=Jo(He(On(n,s*8),255))}function ea(a,t,n,e){const o="0000000"+n.toString(16),c=new DataView(a.buffer,a.byteOffset+t,e),f=((o.length-7)*4-1>>5)+1;for(let s=0;s<f;s++)c.setUint32(e-s*4-4,parseInt(o.substring(o.length-8*s-8,o.length-8*s),16),!1);for(let s=0;s<e/4-f;s++)c[s]=0}function Kn(a,t,n){n=n||a.byteLength,t=t||0;const e=new Uint32Array(a.buffer,a.byteOffset+t,n/4),o=new Array(n/4);return e.forEach((c,f)=>o[o.length-f-1]=c.toString(16).padStart(8,"0")),pe(o.join(""),16)}function oa(a,t,n){n=n||a.byteLength,t=t||0;const e=new DataView(a.buffer,a.byteOffset+t,n),o=new Array(n/4);for(let c=0;c<n/4;c++)o[c]=e.getUint32(c*4,!1).toString(16).padStart(8,"0");return pe(o.join(""),16)}function aa(a,t){return a.toString(t)}function qn(a){const t=new Uint8Array(Math.floor((Hn(a)-1)/8)+1);return Xn(t,0,a,t.byteLength),t}const ia=jt(0),In=jt(1);var Ii=Object.freeze({__proto__:null,abs:mi,add:Qe,band:He,bitLength:Hn,bits:Ho,bor:Bi,bxor:xi,div:kn,e:jt,eq:An,exp:Li,fromArray:ui,fromRprBE:oa,fromRprLE:Kn,fromString:pe,geq:na,gt:ze,isNegative:Vo,isOdd:Ve,isZero:Qo,land:Fi,leq:wi,lnot:Ai,lor:Ci,lt:bi,mod:rn,mul:ta,naf:fi,neg:Yo,neq:yi,one:In,pow:Jn,shiftLeft:re,shiftRight:On,shl:_i,shr:gi,square:hi,sub:pn,toArray:pi,toLEBuff:qn,toNumber:Jo,toRprBE:ea,toRprLE:Xn,toString:aa,zero:ia});function _o(a,t,n){if(Qo(n))return a.one;const e=Ho(n);if(e.length==0)return a.one;let o=t;for(let c=e.length-2;c>=0;c--)o=a.square(o),e[c]&&(o=a.mul(o,t));return o}function Ei(a){if(a.m%2==1)if(An(rn(a.p,4),1))if(An(rn(a.p,8),1))if(An(rn(a.p,16),1))Si(a);else if(An(rn(a.p,16),9))vi(a);else throw new Error("Field withot sqrt");else if(An(rn(a.p,8),5))Pi(a);else throw new Error("Field withot sqrt");else An(rn(a.p,4),3)&&Oi(a);else{const t=rn(Jn(a.p,a.m/2),4);t==1?ki(a):t==3?qi(a):Ti(a)}}function Si(a){for(a.sqrt_q=Jn(a.p,a.m),a.sqrt_s=0,a.sqrt_t=pn(a.sqrt_q,1);!Ve(a.sqrt_t);)a.sqrt_s=a.sqrt_s+1,a.sqrt_t=kn(a.sqrt_t,2);let t=a.one;for(;a.eq(t,a.one);){const n=a.random();a.sqrt_z=a.pow(n,a.sqrt_t),t=a.pow(a.sqrt_z,2**(a.sqrt_s-1))}a.sqrt_tm1d2=kn(pn(a.sqrt_t,1),2),a.sqrt=function(n){const e=this;if(e.isZero(n))return e.zero;let o=e.pow(n,e.sqrt_tm1d2);const c=e.pow(e.mul(e.square(o),n),2**(e.sqrt_s-1));if(e.eq(c,e.negone))return null;let f=e.sqrt_s,s=e.mul(n,o),b=e.mul(s,o),u=e.sqrt_z;for(;!e.eq(b,e.one);){let l=e.square(b),B=1;for(;!e.eq(l,e.one);)l=e.square(l),B++;o=u;for(let x=0;x<f-B-1;x++)o=e.square(o);u=e.square(o),b=e.mul(b,u),s=e.mul(s,o),f=B}return e.geq(s,e.zero)?s:e.neg(s)}}function vi(a){a.sqrt=function(){throw new Error("Sqrt alg 4 not implemented")}}function Pi(a){a.sqrt=function(){throw new Error("Sqrt alg 3 not implemented")}}function Oi(a){a.sqrt_q=Jn(a.p,a.m),a.sqrt_e1=kn(pn(a.sqrt_q,3),4),a.sqrt=function(t){if(this.isZero(t))return this.zero;const n=this.pow(t,this.sqrt_e1),e=this.mul(this.square(n),t);if(this.eq(e,this.negone))return null;const o=this.mul(n,t);return a.geq(o,a.zero)?o:a.neg(o)}}function ki(a){a.sqrt=function(){throw new Error("Sqrt alg 10 not implemented")}}function qi(a){a.sqrt_q=Jn(a.p,a.m/2),a.sqrt_e34=kn(pn(a.sqrt_q,3),4),a.sqrt_e12=kn(pn(a.sqrt_q,1),2),a.frobenius=function(t,n){return t%2==1?a.conjugate(n):n},a.sqrt=function(t){const n=this,e=n.pow(t,n.sqrt_e34),o=n.mul(n.square(e),t),c=n.mul(n.frobenius(1,o),o);if(n.eq(c,n.negone))return null;const f=n.mul(e,t);let s;if(n.eq(o,n.negone))s=n.mul(f,[n.F.zero,n.F.one]);else{const b=n.pow(n.add(n.one,o),n.sqrt_e12);s=n.mul(b,f)}return n.geq(s,n.zero)?s:n.neg(s)}}function Ti(a){a.sqrt=function(){throw new Error("Sqrt alg 8 not implemented")}}function yn(a,t,n,e,o){a[t]=a[t]+a[n]>>>0,a[o]=(a[o]^a[t])>>>0,a[o]=(a[o]<<16|a[o]>>>16&65535)>>>0,a[e]=a[e]+a[o]>>>0,a[n]=(a[n]^a[e])>>>0,a[n]=(a[n]<<12|a[n]>>>20&4095)>>>0,a[t]=a[t]+a[n]>>>0,a[o]=(a[o]^a[t])>>>0,a[o]=(a[o]<<8|a[o]>>>24&255)>>>0,a[e]=a[e]+a[o]>>>0,a[n]=(a[n]^a[e])>>>0,a[n]=(a[n]<<7|a[n]>>>25&127)>>>0}function Ui(a){yn(a,0,4,8,12),yn(a,1,5,9,13),yn(a,2,6,10,14),yn(a,3,7,11,15),yn(a,0,5,10,15),yn(a,1,6,11,12),yn(a,2,7,8,13),yn(a,3,4,9,14)}class Mi{constructor(t){t=t||[0,0,0,0,0,0,0,0],this.state=[1634760805,857760878,2036477234,1797285236,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],0,0,0,0],this.idx=16,this.buff=new Array(16)}nextU32(){return this.idx==16&&this.update(),this.buff[this.idx++]}nextU64(){return Qe(ta(this.nextU32(),4294967296),this.nextU32())}nextBool(){return(this.nextU32()&1)==1}update(){for(let t=0;t<16;t++)this.buff[t]=this.state[t];for(let t=0;t<10;t++)Ui(this.buff);for(let t=0;t<16;t++)this.buff[t]=this.buff[t]+this.state[t]>>>0;this.idx=0,this.state[12]=this.state[12]+1>>>0,this.state[12]==0&&(this.state[13]=this.state[13]+1>>>0,this.state[13]==0&&(this.state[14]=this.state[14]+1>>>0,this.state[14]==0&&(this.state[15]=this.state[15]+1>>>0)))}}function ca(a){let t=new Uint8Array(a);if(typeof globalThis.crypto<"u")globalThis.crypto.getRandomValues(t);else for(let n=0;n<a;n++)t[n]=Math.random()*4294967296>>>0;return t}function zi(){const a=ca(32),t=new Uint32Array(a.buffer),n=[];for(let e=0;e<8;e++)n.push(t[e]);return n}let ae=null;function Je(){return ae||(ae=new Mi(zi()),ae)}class Ri{constructor(t,n,e){this.F=n,this.G=t,this.opMulGF=e;let o=n.sqrt_t||n.t,c=n.sqrt_s||n.s,f=n.one;for(;n.eq(n.pow(f,n.half),n.one);)f=n.add(f,n.one);this.w=new Array(c+1),this.wi=new Array(c+1),this.w[c]=this.F.pow(f,o),this.wi[c]=this.F.inv(this.w[c]);let s=c-1;for(;s>=0;)this.w[s]=this.F.square(this.w[s+1]),this.wi[s]=this.F.square(this.wi[s+1]),s--;this.roots=[],this._setRoots(Math.min(c,15))}_setRoots(t){for(let n=t;n>=0&&!this.roots[n];n--){let e=this.F.one;const o=1<<n,c=new Array(o);for(let f=0;f<o;f++)c[f]=e,e=this.F.mul(e,this.w[n]);this.roots[n]=c}}fft(t){if(t.length<=1)return t;const n=go(t.length-1)+1;this._setRoots(n);const e=1<<n;if(t.length!=e)throw new Error("Size must be multiple of 2");return de(this,t,n,0,1)}ifft(t){if(t.length<=1)return t;const n=go(t.length-1)+1;this._setRoots(n);const e=1<<n;if(t.length!=e)throw new Error("Size must be multiple of 2");const o=de(this,t,n,0,1),c=this.F.inv(this.F.mulScalar(this.F.one,e)),f=new Array(e);for(let s=0;s<e;s++)f[s]=this.opMulGF(o[(e-s)%e],c);return f}}function go(a){return(a&4294901760?(a&=4294901760,16):0)|(a&4278255360?(a&=4278255360,8):0)|(a&4042322160?(a&=4042322160,4):0)|(a&3435973836?(a&=3435973836,2):0)|(a&2863311530)!==0}function de(a,t,n,e,o){const c=1<<n;if(c==1)return[t[e]];if(c==2)return[a.G.add(t[e],t[e+o]),a.G.sub(t[e],t[e+o])];const f=c>>1,s=de(a,t,n-1,e,o*2),b=de(a,t,n-1,e+o,o*2),u=new Array(c);for(let l=0;l<f;l++)u[l]=a.G.add(s[l],a.opMulGF(b[l],a.roots[n][l])),u[l+f]=a.G.sub(s[l],a.opMulGF(b[l],a.roots[n][l]));return u}class Ni{constructor(t){this.type="F1",this.one=BigInt(1),this.zero=BigInt(0),this.p=BigInt(t),this.m=1,this.negone=this.p-this.one,this.two=BigInt(2),this.half=this.p>>this.one,this.bitLength=Hn(this.p),this.mask=(this.one<<BigInt(this.bitLength))-this.one,this.n64=Math.floor((this.bitLength-1)/64)+1,this.n32=this.n64*2,this.n8=this.n64*8,this.R=this.e(this.one<<BigInt(this.n64*64)),this.Ri=this.inv(this.R);const n=this.negone>>this.one;this.nqr=this.two;let e=this.pow(this.nqr,n);for(;!this.eq(e,this.negone);)this.nqr=this.nqr+this.one,e=this.pow(this.nqr,n);for(this.s=0,this.t=this.negone;(this.t&this.one)==this.zero;)this.s=this.s+1,this.t=this.t>>this.one;this.nqr_to_t=this.pow(this.nqr,this.t),Ei(this),this.FFT=new Ri(this,this,this.mul.bind(this)),this.fft=this.FFT.fft.bind(this.FFT),this.ifft=this.FFT.ifft.bind(this.FFT),this.w=this.FFT.w,this.wi=this.FFT.wi,this.shift=this.square(this.nqr),this.k=this.exp(this.nqr,2**this.s)}e(t,n){let e;if(n?n==16&&(e=BigInt("0x"+t)):e=BigInt(t),e<0){let o=-e;return o>=this.p&&(o=o%this.p),this.p-o}else return e>=this.p?e%this.p:e}add(t,n){const e=t+n;return e>=this.p?e-this.p:e}sub(t,n){return t>=n?t-n:this.p-n+t}neg(t){return t&&this.p-t}mul(t,n){return t*n%this.p}mulScalar(t,n){return t*this.e(n)%this.p}square(t){return t*t%this.p}eq(t,n){return t==n}neq(t,n){return t!=n}lt(t,n){const e=t>this.half?t-this.p:t,o=n>this.half?n-this.p:n;return e<o}gt(t,n){const e=t>this.half?t-this.p:t,o=n>this.half?n-this.p:n;return e>o}leq(t,n){const e=t>this.half?t-this.p:t,o=n>this.half?n-this.p:n;return e<=o}geq(t,n){const e=t>this.half?t-this.p:t,o=n>this.half?n-this.p:n;return e>=o}div(t,n){return this.mul(t,this.inv(n))}idiv(t,n){if(!n)throw new Error("Division by zero");return t/n}inv(t){if(!t)throw new Error("Division by zero");let n=this.zero,e=this.p,o=this.one,c=t%this.p;for(;c;){let f=e/c;[n,o]=[o,n-f*o],[e,c]=[c,e-f*c]}return n<this.zero&&(n+=this.p),n}mod(t,n){return t%n}pow(t,n){return _o(this,t,n)}exp(t,n){return _o(this,t,n)}band(t,n){const e=t&n&this.mask;return e>=this.p?e-this.p:e}bor(t,n){const e=(t|n)&this.mask;return e>=this.p?e-this.p:e}bxor(t,n){const e=(t^n)&this.mask;return e>=this.p?e-this.p:e}bnot(t){const n=t^this.mask;return n>=this.p?n-this.p:n}shl(t,n){if(Number(n)<this.bitLength){const e=t<<n&this.mask;return e>=this.p?e-this.p:e}else{const e=this.p-n;return Number(e)<this.bitLength?t>>e:this.zero}}shr(t,n){if(Number(n)<this.bitLength)return t>>n;{const e=this.p-n;if(Number(e)<this.bitLength){const o=t<<e&this.mask;return o>=this.p?o-this.p:o}else return 0}}land(t,n){return t&&n?this.one:this.zero}lor(t,n){return t||n?this.one:this.zero}lnot(t){return t?this.zero:this.one}sqrt_old(t){if(t==this.zero)return this.zero;if(this.pow(t,this.negone>>this.one)!=this.one)return null;let e=this.s,o=this.nqr_to_t,c=this.pow(t,this.t),f=this.pow(t,this.add(this.t,this.one)>>this.one);for(;c!=this.one;){let s=this.square(c),b=1;for(;s!=this.one;)b++,s=this.square(s);let u=o;for(let l=0;l<e-b-1;l++)u=this.square(u);e=b,o=this.square(u),c=this.mul(c,o),f=this.mul(f,u)}return f>this.p>>this.one&&(f=this.neg(f)),f}normalize(t,n){if(t=BigInt(t,n),t<0){let e=-t;return e>=this.p&&(e=e%this.p),this.p-e}else return t>=this.p?t%this.p:t}random(){const t=this.bitLength*2/8;let n=this.zero;for(let e=0;e<t;e++)n=(n<<BigInt(8))+BigInt(ca(1)[0]);return n%this.p}toString(t,n){n=n||10;let e;return t>this.half&&n==10?e="-"+(this.p-t).toString(n):e=t.toString(n),e}isZero(t){return t==this.zero}fromRng(t){let n;do{n=this.zero;for(let e=0;e<this.n64;e++)n+=t.nextU64()<<BigInt(64*e);n&=this.mask}while(n>=this.p);return n=n*this.Ri%this.p,n}fft(t){return this.FFT.fft(t)}ifft(t){return this.FFT.ifft(t)}toRprLE(t,n,e){Xn(t,n,e,this.n64*8)}toRprBE(t,n,e){ea(t,n,e,this.n64*8)}toRprBEM(t,n,e){return this.toRprBE(t,n,this.mul(this.R,e))}toRprLEM(t,n,e){return this.toRprLE(t,n,this.mul(this.R,e))}fromRprLE(t,n){return Kn(t,n,this.n8)}fromRprBE(t,n){return oa(t,n,this.n8)}fromRprLEM(t,n){return this.mul(this.fromRprLE(t,n),this.Ri)}fromRprBEM(t,n){return this.mul(this.fromRprBE(t,n),this.Ri)}toObject(t){return t}}var xn={};xn.bigInt2BytesLE=function(t,n){const e=Array(n);let o=BigInt(t);for(let c=0;c<n;c++)e[c]=Number(o&0xFFn),o=o>>8n;return e};xn.bigInt2U32LE=function(t,n){const e=Array(n);let o=BigInt(t);for(let c=0;c<n;c++)e[c]=Number(o&0xFFFFFFFFn),o=o>>32n;return e};xn.isOcamNum=function(a){return!(!Array.isArray(a)||a.length!=3||typeof a[0]!="number"||typeof a[1]!="number"||!Array.isArray(a[2]))};var $i=function(t,n,e){const o=e||"int";if(t.modules[o])return o;t.modules[o]={};const c=n*2,f=n*8;function s(){const C=t.addFunction(o+"_copy");C.addParam("px","i32"),C.addParam("pr","i32");const _=C.getCodeBuilder();for(let h=0;h<n;h++)C.addCode(_.i64_store(_.getLocal("pr"),h*8,_.i64_load(_.getLocal("px"),h*8)))}function b(){const C=t.addFunction(o+"_zero");C.addParam("pr","i32");const _=C.getCodeBuilder();for(let h=0;h<n;h++)C.addCode(_.i64_store(_.getLocal("pr"),h*8,_.i64_const(0)))}function u(){const C=t.addFunction(o+"_one");C.addParam("pr","i32");const _=C.getCodeBuilder();C.addCode(_.i64_store(_.getLocal("pr"),0,_.i64_const(1)));for(let h=1;h<n;h++)C.addCode(_.i64_store(_.getLocal("pr"),h*8,_.i64_const(0)))}function l(){const C=t.addFunction(o+"_isZero");C.addParam("px","i32"),C.setReturnType("i32");const _=C.getCodeBuilder();function h(X){return X==0?_.ret(_.i64_eqz(_.i64_load(_.getLocal("px")))):_.if(_.i64_eqz(_.i64_load(_.getLocal("px"),X*8)),h(X-1),_.ret(_.i32_const(0)))}C.addCode(h(n-1)),C.addCode(_.ret(_.i32_const(0)))}function B(){const C=t.addFunction(o+"_eq");C.addParam("px","i32"),C.addParam("py","i32"),C.setReturnType("i32");const _=C.getCodeBuilder();function h(X){return X==0?_.ret(_.i64_eq(_.i64_load(_.getLocal("px")),_.i64_load(_.getLocal("py")))):_.if(_.i64_eq(_.i64_load(_.getLocal("px"),X*8),_.i64_load(_.getLocal("py"),X*8)),h(X-1),_.ret(_.i32_const(0)))}C.addCode(h(n-1)),C.addCode(_.ret(_.i32_const(0)))}function x(){const C=t.addFunction(o+"_gte");C.addParam("px","i32"),C.addParam("py","i32"),C.setReturnType("i32");const _=C.getCodeBuilder();function h(X){return X==0?_.ret(_.i64_ge_u(_.i64_load(_.getLocal("px")),_.i64_load(_.getLocal("py")))):_.if(_.i64_lt_u(_.i64_load(_.getLocal("px"),X*8),_.i64_load(_.getLocal("py"),X*8)),_.ret(_.i32_const(0)),_.if(_.i64_gt_u(_.i64_load(_.getLocal("px"),X*8),_.i64_load(_.getLocal("py"),X*8)),_.ret(_.i32_const(1)),h(X-1)))}C.addCode(h(n-1)),C.addCode(_.ret(_.i32_const(0)))}function y(){const C=t.addFunction(o+"_add");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.setReturnType("i32"),C.addLocal("c","i64");const _=C.getCodeBuilder();C.addCode(_.setLocal("c",_.i64_add(_.i64_load32_u(_.getLocal("x")),_.i64_load32_u(_.getLocal("y"))))),C.addCode(_.i64_store32(_.getLocal("r"),_.getLocal("c")));for(let h=1;h<c;h++)C.addCode(_.setLocal("c",_.i64_add(_.i64_add(_.i64_load32_u(_.getLocal("x"),4*h),_.i64_load32_u(_.getLocal("y"),4*h)),_.i64_shr_u(_.getLocal("c"),_.i64_const(32))))),C.addCode(_.i64_store32(_.getLocal("r"),h*4,_.getLocal("c")));C.addCode(_.i32_wrap_i64(_.i64_shr_u(_.getLocal("c"),_.i64_const(32))))}function $(){const C=t.addFunction(o+"_sub");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.setReturnType("i32"),C.addLocal("c","i64");const _=C.getCodeBuilder();C.addCode(_.setLocal("c",_.i64_sub(_.i64_load32_u(_.getLocal("x")),_.i64_load32_u(_.getLocal("y"))))),C.addCode(_.i64_store32(_.getLocal("r"),_.i64_and(_.getLocal("c"),_.i64_const("0xFFFFFFFF"))));for(let h=1;h<c;h++)C.addCode(_.setLocal("c",_.i64_add(_.i64_sub(_.i64_load32_u(_.getLocal("x"),4*h),_.i64_load32_u(_.getLocal("y"),4*h)),_.i64_shr_s(_.getLocal("c"),_.i64_const(32))))),C.addCode(_.i64_store32(_.getLocal("r"),h*4,_.i64_and(_.getLocal("c"),_.i64_const("0xFFFFFFFF"))));C.addCode(_.i32_wrap_i64(_.i64_shr_s(_.getLocal("c"),_.i64_const(32))))}function R(){const C=t.addFunction(o+"_mul");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("r","i32"),C.addLocal("c0","i64"),C.addLocal("c1","i64");for(let w=0;w<c;w++)C.addLocal("x"+w,"i64"),C.addLocal("y"+w,"i64");const _=C.getCodeBuilder(),h=[],X=[];function J(w,U){let W,dt;return h[w]?W=_.getLocal("x"+w):(W=_.teeLocal("x"+w,_.i64_load32_u(_.getLocal("x"),w*4)),h[w]=!0),X[U]?dt=_.getLocal("y"+U):(dt=_.teeLocal("y"+U,_.i64_load32_u(_.getLocal("y"),U*4)),X[U]=!0),_.i64_mul(W,dt)}let nt="c0",O="c1";for(let w=0;w<c*2-1;w++){for(let U=Math.max(0,w-c+1);U<=w&&U<c;U++){const W=w-U;C.addCode(_.setLocal(nt,_.i64_add(_.i64_and(_.getLocal(nt),_.i64_const(4294967295)),J(U,W)))),C.addCode(_.setLocal(O,_.i64_add(_.getLocal(O),_.i64_shr_u(_.getLocal(nt),_.i64_const(32)))))}C.addCode(_.i64_store32(_.getLocal("r"),w*4,_.getLocal(nt))),[nt,O]=[O,nt],C.addCode(_.setLocal(O,_.i64_shr_u(_.getLocal(nt),_.i64_const(32))))}C.addCode(_.i64_store32(_.getLocal("r"),c*4*2-4,_.getLocal(nt)))}function I(){const C=t.addFunction(o+"_square");C.addParam("x","i32"),C.addParam("r","i32"),C.addLocal("c0","i64"),C.addLocal("c1","i64"),C.addLocal("c0_old","i64"),C.addLocal("c1_old","i64");for(let U=0;U<c;U++)C.addLocal("x"+U,"i64");const _=C.getCodeBuilder(),h=[];function X(U,W){let dt,st;return h[U]?dt=_.getLocal("x"+U):(dt=_.teeLocal("x"+U,_.i64_load32_u(_.getLocal("x"),U*4)),h[U]=!0),h[W]?st=_.getLocal("x"+W):(st=_.teeLocal("x"+W,_.i64_load32_u(_.getLocal("x"),W*4)),h[W]=!0),_.i64_mul(dt,st)}let J="c0",nt="c1",O="c0_old",w="c1_old";for(let U=0;U<c*2-1;U++){C.addCode(_.setLocal(J,_.i64_const(0)),_.setLocal(nt,_.i64_const(0)));for(let W=Math.max(0,U-c+1);W<U+1>>1&&W<c;W++){const dt=U-W;C.addCode(_.setLocal(J,_.i64_add(_.i64_and(_.getLocal(J),_.i64_const(4294967295)),X(W,dt)))),C.addCode(_.setLocal(nt,_.i64_add(_.getLocal(nt),_.i64_shr_u(_.getLocal(J),_.i64_const(32)))))}C.addCode(_.setLocal(J,_.i64_shl(_.i64_and(_.getLocal(J),_.i64_const(4294967295)),_.i64_const(1)))),C.addCode(_.setLocal(nt,_.i64_add(_.i64_shl(_.getLocal(nt),_.i64_const(1)),_.i64_shr_u(_.getLocal(J),_.i64_const(32))))),U%2==0&&(C.addCode(_.setLocal(J,_.i64_add(_.i64_and(_.getLocal(J),_.i64_const(4294967295)),X(U>>1,U>>1)))),C.addCode(_.setLocal(nt,_.i64_add(_.getLocal(nt),_.i64_shr_u(_.getLocal(J),_.i64_const(32)))))),U>0&&(C.addCode(_.setLocal(J,_.i64_add(_.i64_and(_.getLocal(J),_.i64_const(4294967295)),_.i64_and(_.getLocal(O),_.i64_const(4294967295))))),C.addCode(_.setLocal(nt,_.i64_add(_.i64_add(_.getLocal(nt),_.i64_shr_u(_.getLocal(J),_.i64_const(32))),_.getLocal(w))))),C.addCode(_.i64_store32(_.getLocal("r"),U*4,_.getLocal(J))),C.addCode(_.setLocal(O,_.getLocal(nt)),_.setLocal(w,_.i64_shr_u(_.getLocal(O),_.i64_const(32))))}C.addCode(_.i64_store32(_.getLocal("r"),c*4*2-4,_.getLocal(O)))}function G(){const C=t.addFunction(o+"_squareOld");C.addParam("x","i32"),C.addParam("r","i32");const _=C.getCodeBuilder();C.addCode(_.call(o+"_mul",_.getLocal("x"),_.getLocal("x"),_.getLocal("r")))}function A(){const C=t.addFunction(o+"__mul1");C.addParam("px","i32"),C.addParam("y","i64"),C.addParam("pr","i32"),C.addLocal("c","i64");const _=C.getCodeBuilder();C.addCode(_.setLocal("c",_.i64_mul(_.i64_load32_u(_.getLocal("px"),0,0),_.getLocal("y")))),C.addCode(_.i64_store32(_.getLocal("pr"),0,0,_.getLocal("c")));for(let h=1;h<c;h++)C.addCode(_.setLocal("c",_.i64_add(_.i64_mul(_.i64_load32_u(_.getLocal("px"),4*h,0),_.getLocal("y")),_.i64_shr_u(_.getLocal("c"),_.i64_const(32))))),C.addCode(_.i64_store32(_.getLocal("pr"),h*4,0,_.getLocal("c")))}function Q(){const C=t.addFunction(o+"__add1");C.addParam("x","i32"),C.addParam("y","i64"),C.addLocal("c","i64"),C.addLocal("px","i32");const _=C.getCodeBuilder();C.addCode(_.setLocal("px",_.getLocal("x"))),C.addCode(_.setLocal("c",_.i64_add(_.i64_load32_u(_.getLocal("px"),0,0),_.getLocal("y")))),C.addCode(_.i64_store32(_.getLocal("px"),0,0,_.getLocal("c"))),C.addCode(_.setLocal("c",_.i64_shr_u(_.getLocal("c"),_.i64_const(32)))),C.addCode(_.block(_.loop(_.br_if(1,_.i64_eqz(_.getLocal("c"))),_.setLocal("px",_.i32_add(_.getLocal("px"),_.i32_const(4))),_.setLocal("c",_.i64_add(_.i64_load32_u(_.getLocal("px"),0,0),_.getLocal("c"))),_.i64_store32(_.getLocal("px"),0,0,_.getLocal("c")),_.setLocal("c",_.i64_shr_u(_.getLocal("c"),_.i64_const(32))),_.br(0))))}function M(){A(),Q();const C=t.addFunction(o+"_div");C.addParam("x","i32"),C.addParam("y","i32"),C.addParam("c","i32"),C.addParam("r","i32"),C.addLocal("rr","i32"),C.addLocal("cc","i32"),C.addLocal("eX","i32"),C.addLocal("eY","i32"),C.addLocal("sy","i64"),C.addLocal("sx","i64"),C.addLocal("ec","i32");const _=C.getCodeBuilder(),h=_.i32_const(t.alloc(f)),X=_.i32_const(t.alloc(f)),J=_.i32_const(t.alloc(f)),nt=_.getLocal("cc"),O=_.getLocal("rr"),w=t.alloc(f*2),U=_.i32_const(w),W=_.i32_const(w+f);C.addCode(_.if(_.getLocal("c"),_.setLocal("cc",_.getLocal("c")),_.setLocal("cc",X))),C.addCode(_.if(_.getLocal("r"),_.setLocal("rr",_.getLocal("r")),_.setLocal("rr",J))),C.addCode(_.call(o+"_copy",_.getLocal("x"),O)),C.addCode(_.call(o+"_copy",_.getLocal("y"),h)),C.addCode(_.call(o+"_zero",nt)),C.addCode(_.call(o+"_zero",U)),C.addCode(_.setLocal("eX",_.i32_const(f-1))),C.addCode(_.setLocal("eY",_.i32_const(f-1))),C.addCode(_.block(_.loop(_.br_if(1,_.i32_or(_.i32_load8_u(_.i32_add(h,_.getLocal("eY")),0,0),_.i32_eq(_.getLocal("eY"),_.i32_const(3)))),_.setLocal("eY",_.i32_sub(_.getLocal("eY"),_.i32_const(1))),_.br(0)))),C.addCode(_.setLocal("sy",_.i64_add(_.i64_load32_u(_.i32_sub(_.i32_add(h,_.getLocal("eY")),_.i32_const(3)),0,0),_.i64_const(1)))),C.addCode(_.if(_.i64_eq(_.getLocal("sy"),_.i64_const(1)),_.drop(_.i64_div_u(_.i64_const(0),_.i64_const(0))))),C.addCode(_.block(_.loop(_.block(_.loop(_.br_if(1,_.i32_or(_.i32_load8_u(_.i32_add(O,_.getLocal("eX")),0,0),_.i32_eq(_.getLocal("eX"),_.i32_const(7)))),_.setLocal("eX",_.i32_sub(_.getLocal("eX"),_.i32_const(1))),_.br(0))),_.setLocal("sx",_.i64_load(_.i32_sub(_.i32_add(O,_.getLocal("eX")),_.i32_const(7)),0,0)),_.setLocal("sx",_.i64_div_u(_.getLocal("sx"),_.getLocal("sy"))),_.setLocal("ec",_.i32_sub(_.i32_sub(_.getLocal("eX"),_.getLocal("eY")),_.i32_const(4))),_.block(_.loop(_.br_if(1,_.i32_and(_.i64_eqz(_.i64_and(_.getLocal("sx"),_.i64_const("0xFFFFFFFF00000000"))),_.i32_ge_s(_.getLocal("ec"),_.i32_const(0)))),_.setLocal("sx",_.i64_shr_u(_.getLocal("sx"),_.i64_const(8))),_.setLocal("ec",_.i32_add(_.getLocal("ec"),_.i32_const(1))),_.br(0))),_.if(_.i64_eqz(_.getLocal("sx")),[..._.br_if(2,_.i32_eqz(_.call(o+"_gte",O,h))),..._.setLocal("sx",_.i64_const(1)),..._.setLocal("ec",_.i32_const(0))]),_.call(o+"__mul1",h,_.getLocal("sx"),W),_.drop(_.call(o+"_sub",O,_.i32_sub(W,_.getLocal("ec")),O)),_.call(o+"__add1",_.i32_add(nt,_.getLocal("ec")),_.getLocal("sx")),_.br(0))))}function ct(){const C=t.addFunction(o+"_inverseMod");C.addParam("px","i32"),C.addParam("pm","i32"),C.addParam("pr","i32"),C.addLocal("t","i32"),C.addLocal("newt","i32"),C.addLocal("r","i32"),C.addLocal("qq","i32"),C.addLocal("qr","i32"),C.addLocal("newr","i32"),C.addLocal("swp","i32"),C.addLocal("x","i32"),C.addLocal("signt","i32"),C.addLocal("signnewt","i32"),C.addLocal("signx","i32");const _=C.getCodeBuilder(),h=_.i32_const(t.alloc(f)),X=_.i32_const(t.alloc(f)),J=_.i32_const(t.alloc(f)),nt=_.i32_const(t.alloc(f)),O=_.i32_const(t.alloc(f)),w=_.i32_const(t.alloc(f)),U=_.i32_const(t.alloc(f*2)),W=_.i32_const(t.alloc(f));C.addCode(_.setLocal("t",h),_.call(o+"_zero",h),_.setLocal("signt",_.i32_const(0))),C.addCode(_.setLocal("r",X),_.call(o+"_copy",_.getLocal("pm"),X)),C.addCode(_.setLocal("newt",J),_.call(o+"_one",J),_.setLocal("signnewt",_.i32_const(0))),C.addCode(_.setLocal("newr",nt),_.call(o+"_copy",_.getLocal("px"),nt)),C.addCode(_.setLocal("qq",O)),C.addCode(_.setLocal("qr",w)),C.addCode(_.setLocal("x",W)),C.addCode(_.block(_.loop(_.br_if(1,_.call(o+"_isZero",_.getLocal("newr"))),_.call(o+"_div",_.getLocal("r"),_.getLocal("newr"),_.getLocal("qq"),_.getLocal("qr")),_.call(o+"_mul",_.getLocal("qq"),_.getLocal("newt"),U),_.if(_.getLocal("signt"),_.if(_.getLocal("signnewt"),_.if(_.call(o+"_gte",U,_.getLocal("t")),[..._.drop(_.call(o+"_sub",U,_.getLocal("t"),_.getLocal("x"))),..._.setLocal("signx",_.i32_const(0))],[..._.drop(_.call(o+"_sub",_.getLocal("t"),U,_.getLocal("x"))),..._.setLocal("signx",_.i32_const(1))]),[..._.drop(_.call(o+"_add",U,_.getLocal("t"),_.getLocal("x"))),..._.setLocal("signx",_.i32_const(1))]),_.if(_.getLocal("signnewt"),[..._.drop(_.call(o+"_add",U,_.getLocal("t"),_.getLocal("x"))),..._.setLocal("signx",_.i32_const(0))],_.if(_.call(o+"_gte",_.getLocal("t"),U),[..._.drop(_.call(o+"_sub",_.getLocal("t"),U,_.getLocal("x"))),..._.setLocal("signx",_.i32_const(0))],[..._.drop(_.call(o+"_sub",U,_.getLocal("t"),_.getLocal("x"))),..._.setLocal("signx",_.i32_const(1))]))),_.setLocal("swp",_.getLocal("t")),_.setLocal("t",_.getLocal("newt")),_.setLocal("newt",_.getLocal("x")),_.setLocal("x",_.getLocal("swp")),_.setLocal("signt",_.getLocal("signnewt")),_.setLocal("signnewt",_.getLocal("signx")),_.setLocal("swp",_.getLocal("r")),_.setLocal("r",_.getLocal("newr")),_.setLocal("newr",_.getLocal("qr")),_.setLocal("qr",_.getLocal("swp")),_.br(0)))),C.addCode(_.if(_.getLocal("signt"),_.drop(_.call(o+"_sub",_.getLocal("pm"),_.getLocal("t"),_.getLocal("pr"))),_.call(o+"_copy",_.getLocal("t"),_.getLocal("pr"))))}return s(),b(),l(),u(),B(),x(),y(),$(),R(),I(),G(),M(),ct(),t.exportFunction(o+"_copy"),t.exportFunction(o+"_zero"),t.exportFunction(o+"_one"),t.exportFunction(o+"_isZero"),t.exportFunction(o+"_eq"),t.exportFunction(o+"_gte"),t.exportFunction(o+"_add"),t.exportFunction(o+"_sub"),t.exportFunction(o+"_mul"),t.exportFunction(o+"_square"),t.exportFunction(o+"_squareOld"),t.exportFunction(o+"_div"),t.exportFunction(o+"_inverseMod"),o},Ye=function(t,n,e,o,c,f,s){const b=t.addFunction(n);b.addParam("base","i32"),b.addParam("scalar","i32"),b.addParam("scalarLength","i32"),b.addParam("r","i32"),b.addLocal("i","i32"),b.addLocal("b","i32");const u=b.getCodeBuilder(),l=u.i32_const(t.alloc(e));b.addCode(u.if(u.i32_eqz(u.getLocal("scalarLength")),[...u.call(s,u.getLocal("r")),...u.ret([])])),b.addCode(u.call(f,u.getLocal("base"),l)),b.addCode(u.call(s,u.getLocal("r"))),b.addCode(u.setLocal("i",u.getLocal("scalarLength"))),b.addCode(u.block(u.loop(u.setLocal("i",u.i32_sub(u.getLocal("i"),u.i32_const(1))),u.setLocal("b",u.i32_load8_u(u.i32_add(u.getLocal("scalar"),u.getLocal("i")))),...B(),u.br_if(1,u.i32_eqz(u.getLocal("i"))),u.br(0))));function B(){const x=[];for(let y=0;y<8;y++)x.push(...u.call(c,u.getLocal("r"),u.getLocal("r")),...u.if(u.i32_ge_u(u.getLocal("b"),u.i32_const(128>>y)),[...u.setLocal("b",u.i32_sub(u.getLocal("b"),u.i32_const(128>>y))),...u.call(o,u.getLocal("r"),l,u.getLocal("r"))]));return x}},to=Gi;function Gi(a,t){const n=a.modules[t].n64*8,e=a.addFunction(t+"_batchInverse");e.addParam("pIn","i32"),e.addParam("inStep","i32"),e.addParam("n","i32"),e.addParam("pOut","i32"),e.addParam("outStep","i32"),e.addLocal("itAux","i32"),e.addLocal("itIn","i32"),e.addLocal("itOut","i32"),e.addLocal("i","i32");const o=e.getCodeBuilder(),c=o.i32_const(a.alloc(n));e.addCode(o.setLocal("itAux",o.i32_load(o.i32_const(0))),o.i32_store(o.i32_const(0),o.i32_add(o.getLocal("itAux"),o.i32_mul(o.i32_add(o.getLocal("n"),o.i32_const(1)),o.i32_const(n))))),e.addCode(o.call(t+"_one",o.getLocal("itAux")),o.setLocal("itIn",o.getLocal("pIn")),o.setLocal("itAux",o.i32_add(o.getLocal("itAux"),o.i32_const(n))),o.setLocal("i",o.i32_const(0)),o.block(o.loop(o.br_if(1,o.i32_eq(o.getLocal("i"),o.getLocal("n"))),o.if(o.call(t+"_isZero",o.getLocal("itIn")),o.call(t+"_copy",o.i32_sub(o.getLocal("itAux"),o.i32_const(n)),o.getLocal("itAux")),o.call(t+"_mul",o.getLocal("itIn"),o.i32_sub(o.getLocal("itAux"),o.i32_const(n)),o.getLocal("itAux"))),o.setLocal("itIn",o.i32_add(o.getLocal("itIn"),o.getLocal("inStep"))),o.setLocal("itAux",o.i32_add(o.getLocal("itAux"),o.i32_const(n))),o.setLocal("i",o.i32_add(o.getLocal("i"),o.i32_const(1))),o.br(0))),o.setLocal("itIn",o.i32_sub(o.getLocal("itIn"),o.getLocal("inStep"))),o.setLocal("itAux",o.i32_sub(o.getLocal("itAux"),o.i32_const(n))),o.setLocal("itOut",o.i32_add(o.getLocal("pOut"),o.i32_mul(o.i32_sub(o.getLocal("n"),o.i32_const(1)),o.getLocal("outStep")))),o.call(t+"_inverse",o.getLocal("itAux"),o.getLocal("itAux")),o.block(o.loop(o.br_if(1,o.i32_eqz(o.getLocal("i"))),o.if(o.call(t+"_isZero",o.getLocal("itIn")),[...o.call(t+"_copy",o.getLocal("itAux"),o.i32_sub(o.getLocal("itAux"),o.i32_const(n))),...o.call(t+"_zero",o.getLocal("itOut"))],[...o.call(t+"_copy",o.i32_sub(o.getLocal("itAux"),o.i32_const(n)),c),...o.call(t+"_mul",o.getLocal("itAux"),o.getLocal("itIn"),o.i32_sub(o.getLocal("itAux"),o.i32_const(n))),...o.call(t+"_mul",o.getLocal("itAux"),c,o.getLocal("itOut"))]),o.setLocal("itIn",o.i32_sub(o.getLocal("itIn"),o.getLocal("inStep"))),o.setLocal("itOut",o.i32_sub(o.getLocal("itOut"),o.getLocal("outStep"))),o.setLocal("itAux",o.i32_sub(o.getLocal("itAux"),o.i32_const(n))),o.setLocal("i",o.i32_sub(o.getLocal("i"),o.i32_const(1))),o.br(0)))),e.addCode(o.i32_store(o.i32_const(0),o.getLocal("itAux")))}var sa=Wi;function Wi(a,t,n,e,o,c){typeof c>"u"&&(e<o?c=!0:c=!1);const f=a.addFunction(t);f.addParam("pIn","i32"),f.addParam("n","i32"),f.addParam("pOut","i32"),f.addLocal("i","i32"),f.addLocal("itIn","i32"),f.addLocal("itOut","i32");const s=f.getCodeBuilder();c?f.addCode(s.setLocal("itIn",s.i32_add(s.getLocal("pIn"),s.i32_mul(s.i32_sub(s.getLocal("n"),s.i32_const(1)),s.i32_const(e)))),s.setLocal("itOut",s.i32_add(s.getLocal("pOut"),s.i32_mul(s.i32_sub(s.getLocal("n"),s.i32_const(1)),s.i32_const(o)))),s.setLocal("i",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("n"))),s.call(n,s.getLocal("itIn"),s.getLocal("itOut")),s.setLocal("itIn",s.i32_sub(s.getLocal("itIn"),s.i32_const(e))),s.setLocal("itOut",s.i32_sub(s.getLocal("itOut"),s.i32_const(o))),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0)))):f.addCode(s.setLocal("itIn",s.getLocal("pIn")),s.setLocal("itOut",s.getLocal("pOut")),s.setLocal("i",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("n"))),s.call(n,s.getLocal("itIn"),s.getLocal("itOut")),s.setLocal("itIn",s.i32_add(s.getLocal("itIn"),s.i32_const(e))),s.setLocal("itOut",s.i32_add(s.getLocal("itOut"),s.i32_const(o))),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0))))}var ji=Di;function Di(a,t,n,e,o,c){typeof c>"u"&&(e<o?c=!0:c=!1);const f=a.addFunction(t);f.addParam("pIn1","i32"),f.addParam("pIn2","i32"),f.addParam("n","i32"),f.addParam("pOut","i32"),f.addLocal("i","i32"),f.addLocal("itIn1","i32"),f.addLocal("itIn2","i32"),f.addLocal("itOut","i32");const s=f.getCodeBuilder();c?f.addCode(s.setLocal("itIn1",s.i32_add(s.getLocal("pIn1"),s.i32_mul(s.i32_sub(s.getLocal("n"),s.i32_const(1)),s.i32_const(e)))),s.setLocal("itIn2",s.i32_add(s.getLocal("pIn2"),s.i32_mul(s.i32_sub(s.getLocal("n"),s.i32_const(1)),s.i32_const(e)))),s.setLocal("itOut",s.i32_add(s.getLocal("pOut"),s.i32_mul(s.i32_sub(s.getLocal("n"),s.i32_const(1)),s.i32_const(o)))),s.setLocal("i",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("n"))),s.call(n,s.getLocal("itIn1"),s.getLocal("itIn2"),s.getLocal("itOut")),s.setLocal("itIn1",s.i32_sub(s.getLocal("itIn1"),s.i32_const(e))),s.setLocal("itIn2",s.i32_sub(s.getLocal("itIn2"),s.i32_const(e))),s.setLocal("itOut",s.i32_sub(s.getLocal("itOut"),s.i32_const(o))),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0)))):f.addCode(s.setLocal("itIn1",s.getLocal("pIn1")),s.setLocal("itIn2",s.getLocal("pIn2")),s.setLocal("itOut",s.getLocal("pOut")),s.setLocal("i",s.i32_const(0)),s.block(s.loop(s.br_if(1,s.i32_eq(s.getLocal("i"),s.getLocal("n"))),s.call(n,s.getLocal("itIn1"),s.getLocal("itIn2"),s.getLocal("itOut")),s.setLocal("itIn1",s.i32_add(s.getLocal("itIn1"),s.i32_const(e))),s.setLocal("itIn2",s.i32_add(s.getLocal("itIn2"),s.i32_const(e))),s.setLocal("itOut",s.i32_add(s.getLocal("itOut"),s.i32_const(o))),s.setLocal("i",s.i32_add(s.getLocal("i"),s.i32_const(1))),s.br(0))))}var Jt={};function la(a,t){return a===t?0:a>t?1:-1}function no(a){return a*a}function ra(a){return a%2n!==0n}function eo(a){return a%2n===0n}function he(a){return a<0n}function Zi(a){return a>0n}function da(a){return he(a)?a.toString(2).length-1:a.toString(2).length}function Yn(a){return a<0n?-a:a}function Tn(a){return Yn(a)===1n}function ua(a,t){for(var n=0n,e=1n,o=t,c=Yn(a),f,s,b;c!==0n;)f=o/c,s=n,b=o,n=e,o=c,e=s-f*e,c=b-f*c;if(!Tn(o))throw new Error(a.toString()+" and "+t.toString()+" are not co-prime");return la(n,0n)===-1&&(n=n+t),he(a)?-n:n}function _a(a,t,n){if(n===0n)throw new Error("Cannot take modPow with modulus 0");var e=1n,o=a%n;for(he(t)&&(t=t*-1n,o=ua(o,n));Zi(t);){if(o===0n)return 0n;ra(t)&&(e=e*o%n),t=t/2n,o=no(o)%n}return e}function Xi(a,t){return a=a>=0n?a:-a,t=t>=0n?t:-t,a===t?0:a>t?1:-1}function fo(a,t){return t===0n?!1:Tn(t)?!0:Xi(t,2n)===0?eo(a):a%t===0n}function Ki(a){var t=Yn(a);if(Tn(t))return!1;if(t===2n||t===3n||t===5n)return!0;if(eo(t)||fo(t,3n)||fo(t,5n))return!1;if(t<49n)return!0}function Vi(a){return a-1n}function po(a,t){for(var n=Vi(a),e=n,o=0,c,f,s;eo(e);)e=e/2n,o++;t:for(f=0;f<t.length;f++)if(!(a<t[f])&&(s=_a(BigInt(t[f]),e,a),!(Tn(s)||s===n))){for(c=o-1;c!=0;c--){if(s=no(s)%a,Tn(s))return!1;if(s===n)continue t}return!1}return!0}function Qi(a){var t=Ki(a);if(t!==void 0)return t;var n=Yn(a),e=da(n);if(e<=64)return po(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var o=Math.log(2)*Number(e),c=Math.ceil(o),f=[],s=0;s<c;s++)f.push(BigInt(s+2));return po(n,f)}Jt.bitLength=da;Jt.isOdd=ra;Jt.isNegative=he;Jt.abs=Yn;Jt.isUnit=Tn;Jt.compare=la;Jt.modInv=ua;Jt.modPow=_a;Jt.isPrime=Qi;Jt.square=no;const Hi=$i,gn=xn,Ji=Ye,Yi=to,Ce=sa,Ae=ji,{bitLength:tc,modInv:Ie,modPow:ho,isPrime:Lo,isOdd:nc,square:ec}=Jt;var oo=function(t,n,e,o){const c=BigInt(n),f=Math.floor((tc(c-1n)-1)/64)+1,s=f*2,b=f*8,u=e||"f1m";if(t.modules[u])return u;const l=Hi(t,f,o),B=t.alloc(b,gn.bigInt2BytesLE(c,b)),x=t.alloc(gn.bigInt2BytesLE(ec(1n<<BigInt(f*64))%c,b)),y=t.alloc(gn.bigInt2BytesLE((1n<<BigInt(f*64))%c,b)),$=t.alloc(gn.bigInt2BytesLE(0n,b)),R=c-1n,I=R>>1n,G=t.alloc(b,gn.bigInt2BytesLE(I,b)),A=I+1n,Q=t.alloc(b,gn.bigInt2BytesLE(A,b));t.modules[u]={pq:B,pR2:x,n64:f,q:c,pOne:y,pZero:$,pePlusOne:Q};function M(){const k=t.addFunction(u+"_one");k.addParam("pr","i32");const L=k.getCodeBuilder();k.addCode(L.call(l+"_copy",L.i32_const(y),L.getLocal("pr")))}function ct(){const k=t.addFunction(u+"_add");k.addParam("x","i32"),k.addParam("y","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.if(L.call(l+"_add",L.getLocal("x"),L.getLocal("y"),L.getLocal("r")),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))),L.if(L.call(l+"_gte",L.getLocal("r"),L.i32_const(B)),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))))))}function C(){const k=t.addFunction(u+"_sub");k.addParam("x","i32"),k.addParam("y","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.if(L.call(l+"_sub",L.getLocal("x"),L.getLocal("y"),L.getLocal("r")),L.drop(L.call(l+"_add",L.getLocal("r"),L.i32_const(B),L.getLocal("r")))))}function _(){const k=t.addFunction(u+"_neg");k.addParam("x","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.call(u+"_sub",L.i32_const($),L.getLocal("x"),L.getLocal("r")))}function h(){const k=t.addFunction(u+"_isNegative");k.addParam("x","i32"),k.setReturnType("i32");const L=k.getCodeBuilder(),et=L.i32_const(t.alloc(b));k.addCode(L.call(u+"_fromMontgomery",L.getLocal("x"),et),L.call(l+"_gte",et,L.i32_const(Q)))}function X(){const k=t.addFunction(u+"_sign");k.addParam("x","i32"),k.setReturnType("i32");const L=k.getCodeBuilder(),et=L.i32_const(t.alloc(b));k.addCode(L.if(L.call(l+"_isZero",L.getLocal("x")),L.ret(L.i32_const(0))),L.call(u+"_fromMontgomery",L.getLocal("x"),et),L.if(L.call(l+"_gte",et,L.i32_const(Q)),L.ret(L.i32_const(-1))),L.ret(L.i32_const(1)))}function J(){const k=t.alloc(s*s*8),L=t.addFunction(u+"_mReduct");L.addParam("t","i32"),L.addParam("r","i32"),L.addLocal("np32","i64"),L.addLocal("c","i64"),L.addLocal("m","i64");const et=L.getCodeBuilder(),pt=Number(0x100000000n-Ie(c,0x100000000n));L.addCode(et.setLocal("np32",et.i64_const(pt)));for(let gt=0;gt<s;gt++){L.addCode(et.setLocal("c",et.i64_const(0))),L.addCode(et.setLocal("m",et.i64_and(et.i64_mul(et.i64_load32_u(et.getLocal("t"),gt*4),et.getLocal("np32")),et.i64_const("0xFFFFFFFF"))));for(let ht=0;ht<s;ht++)L.addCode(et.setLocal("c",et.i64_add(et.i64_add(et.i64_load32_u(et.getLocal("t"),(gt+ht)*4),et.i64_shr_u(et.getLocal("c"),et.i64_const(32))),et.i64_mul(et.i64_load32_u(et.i32_const(B),ht*4),et.getLocal("m"))))),L.addCode(et.i64_store32(et.getLocal("t"),(gt+ht)*4,et.getLocal("c")));L.addCode(et.i64_store32(et.i32_const(k),gt*4,et.i64_shr_u(et.getLocal("c"),et.i64_const(32))))}L.addCode(et.call(u+"_add",et.i32_const(k),et.i32_add(et.getLocal("t"),et.i32_const(s*4)),et.getLocal("r")))}function nt(){const k=t.addFunction(u+"_mul");k.addParam("x","i32"),k.addParam("y","i32"),k.addParam("r","i32"),k.addLocal("c0","i64"),k.addLocal("c1","i64"),k.addLocal("np32","i64");for(let mt=0;mt<s;mt++)k.addLocal("x"+mt,"i64"),k.addLocal("y"+mt,"i64"),k.addLocal("m"+mt,"i64"),k.addLocal("q"+mt,"i64");const L=k.getCodeBuilder(),et=Number(0x100000000n-Ie(c,0x100000000n));k.addCode(L.setLocal("np32",L.i64_const(et)));const pt=[],gt=[],ht=[];function Ct(mt,ft){let bt,Mt;return pt[mt]?bt=L.getLocal("x"+mt):(bt=L.teeLocal("x"+mt,L.i64_load32_u(L.getLocal("x"),mt*4)),pt[mt]=!0),gt[ft]?Mt=L.getLocal("y"+ft):(Mt=L.teeLocal("y"+ft,L.i64_load32_u(L.getLocal("y"),ft*4)),gt[ft]=!0),L.i64_mul(bt,Mt)}function Lt(mt,ft){let bt,Mt;return ht[mt]?bt=L.getLocal("q"+mt):(bt=L.teeLocal("q"+mt,L.i64_load32_u(L.i32_const(0),B+mt*4)),ht[mt]=!0),Mt=L.getLocal("m"+ft),L.i64_mul(bt,Mt)}let xt="c0",Ut="c1";for(let mt=0;mt<s*2-1;mt++){for(let ft=Math.max(0,mt-s+1);ft<=mt&&ft<s;ft++){const bt=mt-ft;k.addCode(L.setLocal(xt,L.i64_add(L.i64_and(L.getLocal(xt),L.i64_const(4294967295)),Ct(ft,bt)))),k.addCode(L.setLocal(Ut,L.i64_add(L.getLocal(Ut),L.i64_shr_u(L.getLocal(xt),L.i64_const(32)))))}for(let ft=Math.max(1,mt-s+1);ft<=mt&&ft<s;ft++){const bt=mt-ft;k.addCode(L.setLocal(xt,L.i64_add(L.i64_and(L.getLocal(xt),L.i64_const(4294967295)),Lt(ft,bt)))),k.addCode(L.setLocal(Ut,L.i64_add(L.getLocal(Ut),L.i64_shr_u(L.getLocal(xt),L.i64_const(32)))))}mt<s&&(k.addCode(L.setLocal("m"+mt,L.i64_and(L.i64_mul(L.i64_and(L.getLocal(xt),L.i64_const(4294967295)),L.getLocal("np32")),L.i64_const("0xFFFFFFFF")))),k.addCode(L.setLocal(xt,L.i64_add(L.i64_and(L.getLocal(xt),L.i64_const(4294967295)),Lt(0,mt)))),k.addCode(L.setLocal(Ut,L.i64_add(L.getLocal(Ut),L.i64_shr_u(L.getLocal(xt),L.i64_const(32)))))),mt>=s&&k.addCode(L.i64_store32(L.getLocal("r"),(mt-s)*4,L.getLocal(xt))),[xt,Ut]=[Ut,xt],k.addCode(L.setLocal(Ut,L.i64_shr_u(L.getLocal(xt),L.i64_const(32))))}k.addCode(L.i64_store32(L.getLocal("r"),s*4-4,L.getLocal(xt))),k.addCode(L.if(L.i32_wrap_i64(L.getLocal(Ut)),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))),L.if(L.call(l+"_gte",L.getLocal("r"),L.i32_const(B)),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))))))}function O(){const k=t.addFunction(u+"_square");k.addParam("x","i32"),k.addParam("r","i32"),k.addLocal("c0","i64"),k.addLocal("c1","i64"),k.addLocal("c0_old","i64"),k.addLocal("c1_old","i64"),k.addLocal("np32","i64");for(let ft=0;ft<s;ft++)k.addLocal("x"+ft,"i64"),k.addLocal("m"+ft,"i64"),k.addLocal("q"+ft,"i64");const L=k.getCodeBuilder(),et=Number(0x100000000n-Ie(c,0x100000000n));k.addCode(L.setLocal("np32",L.i64_const(et)));const pt=[],gt=[];function ht(ft,bt){let Mt,Wt;return pt[ft]?Mt=L.getLocal("x"+ft):(Mt=L.teeLocal("x"+ft,L.i64_load32_u(L.getLocal("x"),ft*4)),pt[ft]=!0),pt[bt]?Wt=L.getLocal("x"+bt):(Wt=L.teeLocal("x"+bt,L.i64_load32_u(L.getLocal("x"),bt*4)),pt[bt]=!0),L.i64_mul(Mt,Wt)}function Ct(ft,bt){let Mt,Wt;return gt[ft]?Mt=L.getLocal("q"+ft):(Mt=L.teeLocal("q"+ft,L.i64_load32_u(L.i32_const(0),B+ft*4)),gt[ft]=!0),Wt=L.getLocal("m"+bt),L.i64_mul(Mt,Wt)}let Lt="c0",xt="c1",Ut="c0_old",mt="c1_old";for(let ft=0;ft<s*2-1;ft++){k.addCode(L.setLocal(Lt,L.i64_const(0)),L.setLocal(xt,L.i64_const(0)));for(let bt=Math.max(0,ft-s+1);bt<ft+1>>1&&bt<s;bt++){const Mt=ft-bt;k.addCode(L.setLocal(Lt,L.i64_add(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),ht(bt,Mt)))),k.addCode(L.setLocal(xt,L.i64_add(L.getLocal(xt),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32)))))}k.addCode(L.setLocal(Lt,L.i64_shl(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),L.i64_const(1)))),k.addCode(L.setLocal(xt,L.i64_add(L.i64_shl(L.getLocal(xt),L.i64_const(1)),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32))))),ft%2==0&&(k.addCode(L.setLocal(Lt,L.i64_add(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),ht(ft>>1,ft>>1)))),k.addCode(L.setLocal(xt,L.i64_add(L.getLocal(xt),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32)))))),ft>0&&(k.addCode(L.setLocal(Lt,L.i64_add(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),L.i64_and(L.getLocal(Ut),L.i64_const(4294967295))))),k.addCode(L.setLocal(xt,L.i64_add(L.i64_add(L.getLocal(xt),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32))),L.getLocal(mt)))));for(let bt=Math.max(1,ft-s+1);bt<=ft&&bt<s;bt++){const Mt=ft-bt;k.addCode(L.setLocal(Lt,L.i64_add(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),Ct(bt,Mt)))),k.addCode(L.setLocal(xt,L.i64_add(L.getLocal(xt),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32)))))}ft<s&&(k.addCode(L.setLocal("m"+ft,L.i64_and(L.i64_mul(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),L.getLocal("np32")),L.i64_const("0xFFFFFFFF")))),k.addCode(L.setLocal(Lt,L.i64_add(L.i64_and(L.getLocal(Lt),L.i64_const(4294967295)),Ct(0,ft)))),k.addCode(L.setLocal(xt,L.i64_add(L.getLocal(xt),L.i64_shr_u(L.getLocal(Lt),L.i64_const(32)))))),ft>=s&&k.addCode(L.i64_store32(L.getLocal("r"),(ft-s)*4,L.getLocal(Lt))),k.addCode(L.setLocal(Ut,L.getLocal(xt)),L.setLocal(mt,L.i64_shr_u(L.getLocal(Ut),L.i64_const(32))))}k.addCode(L.i64_store32(L.getLocal("r"),s*4-4,L.getLocal(Ut))),k.addCode(L.if(L.i32_wrap_i64(L.getLocal(mt)),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))),L.if(L.call(l+"_gte",L.getLocal("r"),L.i32_const(B)),L.drop(L.call(l+"_sub",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))))))}function w(){const k=t.addFunction(u+"_squareOld");k.addParam("x","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.call(u+"_mul",L.getLocal("x"),L.getLocal("x"),L.getLocal("r")))}function U(){const k=t.addFunction(u+"_toMontgomery");k.addParam("x","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.call(u+"_mul",L.getLocal("x"),L.i32_const(x),L.getLocal("r")))}function W(){const k=t.alloc(b*2),L=t.addFunction(u+"_fromMontgomery");L.addParam("x","i32"),L.addParam("r","i32");const et=L.getCodeBuilder();L.addCode(et.call(l+"_copy",et.getLocal("x"),et.i32_const(k))),L.addCode(et.call(l+"_zero",et.i32_const(k+b))),L.addCode(et.call(u+"_mReduct",et.i32_const(k),et.getLocal("r")))}function dt(){const k=t.addFunction(u+"_inverse");k.addParam("x","i32"),k.addParam("r","i32");const L=k.getCodeBuilder();k.addCode(L.call(u+"_fromMontgomery",L.getLocal("x"),L.getLocal("r"))),k.addCode(L.call(l+"_inverseMod",L.getLocal("r"),L.i32_const(B),L.getLocal("r"))),k.addCode(L.call(u+"_toMontgomery",L.getLocal("r"),L.getLocal("r")))}let st=2n;if(Lo(c))for(;ho(st,I,c)!==R;)st=st+1n;let H=0,ut=R;for(;!nc(ut)&&ut!==0n;)H++,ut=ut>>1n;const ot=t.alloc(b,gn.bigInt2BytesLE(ut,b)),lt=ho(st,ut,c),Et=t.alloc(gn.bigInt2BytesLE((lt<<BigInt(f*64))%c,b)),Tt=ut+1n>>1n,Ft=t.alloc(b,gn.bigInt2BytesLE(Tt,b));function v(){const k=t.addFunction(u+"_sqrt");k.addParam("n","i32"),k.addParam("r","i32"),k.addLocal("m","i32"),k.addLocal("i","i32"),k.addLocal("j","i32");const L=k.getCodeBuilder(),et=L.i32_const(y),pt=L.i32_const(t.alloc(b)),gt=L.i32_const(t.alloc(b)),ht=L.i32_const(t.alloc(b)),Ct=L.i32_const(t.alloc(b)),Lt=L.i32_const(t.alloc(b));k.addCode(L.if(L.call(u+"_isZero",L.getLocal("n")),L.ret(L.call(u+"_zero",L.getLocal("r")))),L.setLocal("m",L.i32_const(H)),L.call(u+"_copy",L.i32_const(Et),pt),L.call(u+"_exp",L.getLocal("n"),L.i32_const(ot),L.i32_const(b),gt),L.call(u+"_exp",L.getLocal("n"),L.i32_const(Ft),L.i32_const(b),ht),L.block(L.loop(L.br_if(1,L.call(u+"_eq",gt,et)),L.call(u+"_square",gt,Ct),L.setLocal("i",L.i32_const(1)),L.block(L.loop(L.br_if(1,L.call(u+"_eq",Ct,et)),L.call(u+"_square",Ct,Ct),L.setLocal("i",L.i32_add(L.getLocal("i"),L.i32_const(1))),L.br(0))),L.call(u+"_copy",pt,Lt),L.setLocal("j",L.i32_sub(L.i32_sub(L.getLocal("m"),L.getLocal("i")),L.i32_const(1))),L.block(L.loop(L.br_if(1,L.i32_eqz(L.getLocal("j"))),L.call(u+"_square",Lt,Lt),L.setLocal("j",L.i32_sub(L.getLocal("j"),L.i32_const(1))),L.br(0))),L.setLocal("m",L.getLocal("i")),L.call(u+"_square",Lt,pt),L.call(u+"_mul",gt,pt,gt),L.call(u+"_mul",ht,Lt,ht),L.br(0))),L.if(L.call(u+"_isNegative",ht),L.call(u+"_neg",ht,L.getLocal("r")),L.call(u+"_copy",ht,L.getLocal("r"))))}function i(){const k=t.addFunction(u+"_isSquare");k.addParam("n","i32"),k.setReturnType("i32");const L=k.getCodeBuilder(),et=L.i32_const(y),pt=L.i32_const(t.alloc(b));k.addCode(L.if(L.call(u+"_isZero",L.getLocal("n")),L.ret(L.i32_const(1))),L.call(u+"_exp",L.getLocal("n"),L.i32_const(G),L.i32_const(b),pt),L.call(u+"_eq",pt,et))}function E(){const k=t.addFunction(u+"_load");k.addParam("scalar","i32"),k.addParam("scalarLen","i32"),k.addParam("r","i32"),k.addLocal("p","i32"),k.addLocal("l","i32"),k.addLocal("i","i32"),k.addLocal("j","i32");const L=k.getCodeBuilder(),et=L.i32_const(t.alloc(b)),pt=t.alloc(b),gt=L.i32_const(pt);k.addCode(L.call(l+"_zero",L.getLocal("r")),L.setLocal("i",L.i32_const(b)),L.setLocal("p",L.getLocal("scalar")),L.block(L.loop(L.br_if(1,L.i32_gt_u(L.getLocal("i"),L.getLocal("scalarLen"))),L.if(L.i32_eq(L.getLocal("i"),L.i32_const(b)),L.call(u+"_one",et),L.call(u+"_mul",et,L.i32_const(x),et)),L.call(u+"_mul",L.getLocal("p"),et,gt),L.call(u+"_add",L.getLocal("r"),gt,L.getLocal("r")),L.setLocal("p",L.i32_add(L.getLocal("p"),L.i32_const(b))),L.setLocal("i",L.i32_add(L.getLocal("i"),L.i32_const(b))),L.br(0))),L.setLocal("l",L.i32_rem_u(L.getLocal("scalarLen"),L.i32_const(b))),L.if(L.i32_eqz(L.getLocal("l")),L.ret([])),L.call(l+"_zero",gt),L.setLocal("j",L.i32_const(0)),L.block(L.loop(L.br_if(1,L.i32_eq(L.getLocal("j"),L.getLocal("l"))),L.i32_store8(L.getLocal("j"),pt,L.i32_load8_u(L.getLocal("p"))),L.setLocal("p",L.i32_add(L.getLocal("p"),L.i32_const(1))),L.setLocal("j",L.i32_add(L.getLocal("j"),L.i32_const(1))),L.br(0))),L.if(L.i32_eq(L.getLocal("i"),L.i32_const(b)),L.call(u+"_one",et),L.call(u+"_mul",et,L.i32_const(x),et)),L.call(u+"_mul",gt,et,gt),L.call(u+"_add",L.getLocal("r"),gt,L.getLocal("r")))}function d(){const k=t.addFunction(u+"_timesScalar");k.addParam("x","i32"),k.addParam("scalar","i32"),k.addParam("scalarLen","i32"),k.addParam("r","i32");const L=k.getCodeBuilder(),et=L.i32_const(t.alloc(b));k.addCode(L.call(u+"_load",L.getLocal("scalar"),L.getLocal("scalarLen"),et),L.call(u+"_toMontgomery",et,et),L.call(u+"_mul",L.getLocal("x"),et,L.getLocal("r")))}function K(){const k=t.addFunction(u+"_isOne");k.addParam("x","i32"),k.setReturnType("i32");const L=k.getCodeBuilder();k.addCode(L.ret(L.call(l+"_eq",L.getLocal("x"),L.i32_const(y))))}return t.exportFunction(l+"_copy",u+"_copy"),t.exportFunction(l+"_zero",u+"_zero"),t.exportFunction(l+"_isZero",u+"_isZero"),t.exportFunction(l+"_eq",u+"_eq"),K(),ct(),C(),_(),J(),nt(),O(),w(),U(),W(),h(),X(),dt(),M(),E(),d(),Yi(t,u),Ce(t,u+"_batchToMontgomery",u+"_toMontgomery",b,b),Ce(t,u+"_batchFromMontgomery",u+"_fromMontgomery",b,b),Ce(t,u+"_batchNeg",u+"_neg",b,b),Ae(t,u+"_batchAdd",u+"_add",b,b),Ae(t,u+"_batchSub",u+"_sub",b,b),Ae(t,u+"_batchMul",u+"_mul",b,b),t.exportFunction(u+"_add"),t.exportFunction(u+"_sub"),t.exportFunction(u+"_neg"),t.exportFunction(u+"_isNegative"),t.exportFunction(u+"_isOne"),t.exportFunction(u+"_sign"),t.exportFunction(u+"_mReduct"),t.exportFunction(u+"_mul"),t.exportFunction(u+"_square"),t.exportFunction(u+"_squareOld"),t.exportFunction(u+"_fromMontgomery"),t.exportFunction(u+"_toMontgomery"),t.exportFunction(u+"_inverse"),t.exportFunction(u+"_one"),t.exportFunction(u+"_load"),t.exportFunction(u+"_timesScalar"),Ji(t,u+"_exp",b,u+"_mul",u+"_square",l+"_copy",u+"_one"),t.exportFunction(u+"_exp"),t.exportFunction(u+"_batchInverse"),Lo(c)&&(v(),i(),t.exportFunction(u+"_sqrt"),t.exportFunction(u+"_isSquare")),t.exportFunction(u+"_batchToMontgomery"),t.exportFunction(u+"_batchFromMontgomery"),u};const oc=oo,{bitLength:ac}=Jt;var ga=function(t,n,e,o,c){const f=BigInt(n),s=Math.floor((ac(f-1n)-1)/64)+1,b=s*8,u=e||"f1";if(t.modules[u])return u;t.modules[u]={n64:s};const l=c||"int",B=oc(t,f,o,l),x=t.modules[B].pR2,y=t.modules[B].pq,$=t.modules[B].pePlusOne;function R(){const Q=t.alloc(b),M=t.addFunction(u+"_mul");M.addParam("x","i32"),M.addParam("y","i32"),M.addParam("r","i32");const ct=M.getCodeBuilder();M.addCode(ct.call(B+"_mul",ct.getLocal("x"),ct.getLocal("y"),ct.i32_const(Q))),M.addCode(ct.call(B+"_mul",ct.i32_const(Q),ct.i32_const(x),ct.getLocal("r")))}function I(){const Q=t.addFunction(u+"_square");Q.addParam("x","i32"),Q.addParam("r","i32");const M=Q.getCodeBuilder();Q.addCode(M.call(u+"_mul",M.getLocal("x"),M.getLocal("x"),M.getLocal("r")))}function G(){const Q=t.addFunction(u+"_inverse");Q.addParam("x","i32"),Q.addParam("r","i32");const M=Q.getCodeBuilder();Q.addCode(M.call(l+"_inverseMod",M.getLocal("x"),M.i32_const(y),M.getLocal("r")))}function A(){const Q=t.addFunction(u+"_isNegative");Q.addParam("x","i32"),Q.setReturnType("i32");const M=Q.getCodeBuilder();Q.addCode(M.call(l+"_gte",M.getLocal("x"),M.i32_const($)))}return R(),I(),G(),A(),t.exportFunction(B+"_add",u+"_add"),t.exportFunction(B+"_sub",u+"_sub"),t.exportFunction(B+"_neg",u+"_neg"),t.exportFunction(u+"_mul"),t.exportFunction(u+"_square"),t.exportFunction(u+"_inverse"),t.exportFunction(u+"_isNegative"),t.exportFunction(B+"_copy",u+"_copy"),t.exportFunction(B+"_zero",u+"_zero"),t.exportFunction(B+"_one",u+"_one"),t.exportFunction(B+"_isZero",u+"_isZero"),t.exportFunction(B+"_eq",u+"_eq"),u};const ic=Ye,cc=to,Ee=xn;var fa=function(t,n,e,o){if(t.modules[e])return e;const c=t.modules[o].n64*8,f=t.modules[o].q;t.modules[e]={n64:t.modules[o].n64*2};function s(){const O=t.addFunction(e+"_add");O.addParam("x","i32"),O.addParam("y","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("y"),st=w.i32_add(w.getLocal("y"),w.i32_const(c)),H=w.getLocal("r"),ut=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_add",U,dt,H),w.call(o+"_add",W,st,ut))}function b(){const O=t.addFunction(e+"_timesScalar");O.addParam("x","i32"),O.addParam("scalar","i32"),O.addParam("scalarLen","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_timesScalar",U,w.getLocal("scalar"),w.getLocal("scalarLen"),dt),w.call(o+"_timesScalar",W,w.getLocal("scalar"),w.getLocal("scalarLen"),st))}function u(){const O=t.addFunction(e+"_sub");O.addParam("x","i32"),O.addParam("y","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("y"),st=w.i32_add(w.getLocal("y"),w.i32_const(c)),H=w.getLocal("r"),ut=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_sub",U,dt,H),w.call(o+"_sub",W,st,ut))}function l(){const O=t.addFunction(e+"_neg");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_neg",U,dt),w.call(o+"_neg",W,st))}function B(){const O=t.addFunction(e+"_conjugate");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_copy",U,dt),w.call(o+"_neg",W,st))}function x(){const O=t.addFunction(e+"_isNegative");O.addParam("x","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.if(w.call(o+"_isZero",W),w.ret(w.call(o+"_isNegative",U))),w.ret(w.call(o+"_isNegative",W)))}function y(){const O=t.addFunction(e+"_mul");O.addParam("x","i32"),O.addParam("y","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("y"),st=w.i32_add(w.getLocal("y"),w.i32_const(c)),H=w.getLocal("r"),ut=w.i32_add(w.getLocal("r"),w.i32_const(c)),ot=w.i32_const(t.alloc(c)),lt=w.i32_const(t.alloc(c)),Et=w.i32_const(t.alloc(c)),Tt=w.i32_const(t.alloc(c));O.addCode(w.call(o+"_mul",U,dt,ot),w.call(o+"_mul",W,st,lt),w.call(o+"_add",U,W,Et),w.call(o+"_add",dt,st,Tt),w.call(o+"_mul",Et,Tt,Et),w.call(n,lt,H),w.call(o+"_add",ot,H,H),w.call(o+"_add",ot,lt,ut),w.call(o+"_sub",Et,ut,ut))}function $(){const O=t.addFunction(e+"_mul1");O.addParam("x","i32"),O.addParam("y","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("y"),st=w.getLocal("r"),H=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_mul",U,dt,st),w.call(o+"_mul",W,dt,H))}function R(){const O=t.addFunction(e+"_square");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c)),H=w.i32_const(t.alloc(c)),ut=w.i32_const(t.alloc(c)),ot=w.i32_const(t.alloc(c)),lt=w.i32_const(t.alloc(c));O.addCode(w.call(o+"_mul",U,W,H),w.call(o+"_add",U,W,ut),w.call(n,W,ot),w.call(o+"_add",U,ot,ot),w.call(n,H,lt),w.call(o+"_add",lt,H,lt),w.call(o+"_mul",ut,ot,dt),w.call(o+"_sub",dt,lt,dt),w.call(o+"_add",H,H,st))}function I(){const O=t.addFunction(e+"_toMontgomery");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_toMontgomery",U,dt),w.call(o+"_toMontgomery",W,st))}function G(){const O=t.addFunction(e+"_fromMontgomery");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_fromMontgomery",U,dt),w.call(o+"_fromMontgomery",W,st))}function A(){const O=t.addFunction(e+"_copy");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c));O.addCode(w.call(o+"_copy",U,dt),w.call(o+"_copy",W,st))}function Q(){const O=t.addFunction(e+"_zero");O.addParam("x","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.call(o+"_zero",U),w.call(o+"_zero",W))}function M(){const O=t.addFunction(e+"_one");O.addParam("x","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.call(o+"_one",U),w.call(o+"_zero",W))}function ct(){const O=t.addFunction(e+"_eq");O.addParam("x","i32"),O.addParam("y","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("y"),st=w.i32_add(w.getLocal("y"),w.i32_const(c));O.addCode(w.i32_and(w.call(o+"_eq",U,dt),w.call(o+"_eq",W,st)))}function C(){const O=t.addFunction(e+"_isZero");O.addParam("x","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.i32_and(w.call(o+"_isZero",U),w.call(o+"_isZero",W)))}function _(){const O=t.addFunction(e+"_inverse");O.addParam("x","i32"),O.addParam("r","i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c)),dt=w.getLocal("r"),st=w.i32_add(w.getLocal("r"),w.i32_const(c)),H=w.i32_const(t.alloc(c)),ut=w.i32_const(t.alloc(c)),ot=w.i32_const(t.alloc(c)),lt=w.i32_const(t.alloc(c));O.addCode(w.call(o+"_square",U,H),w.call(o+"_square",W,ut),w.call(n,ut,ot),w.call(o+"_sub",H,ot,ot),w.call(o+"_inverse",ot,lt),w.call(o+"_mul",U,lt,dt),w.call(o+"_mul",W,lt,st),w.call(o+"_neg",st,st))}function h(){const O=t.addFunction(e+"_sign");O.addParam("x","i32"),O.addLocal("s","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.setLocal("s",w.call(o+"_sign",W)),w.if(w.getLocal("s"),w.ret(w.getLocal("s"))),w.ret(w.call(o+"_sign",U)))}function X(){const O=t.addFunction(e+"_isOne");O.addParam("x","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.getLocal("x"),W=w.i32_add(w.getLocal("x"),w.i32_const(c));O.addCode(w.ret(w.i32_and(w.call(o+"_isOne",U),w.call(o+"_isZero",W))))}function J(){const O=t.addFunction(e+"_sqrt");O.addParam("a","i32"),O.addParam("pr","i32");const w=O.getCodeBuilder(),U=w.i32_const(t.alloc(Ee.bigInt2BytesLE((BigInt(f||0)-3n)/4n,c))),W=w.i32_const(t.alloc(Ee.bigInt2BytesLE((BigInt(f||0)-1n)/2n,c))),dt=w.getLocal("a"),st=w.i32_const(t.alloc(c*2)),H=w.i32_const(t.alloc(c*2)),ut=w.i32_const(t.alloc(c*2)),ot=t.alloc(c*2),lt=w.i32_const(ot),Et=w.i32_const(ot),Tt=w.i32_const(ot+c),Ft=w.i32_const(t.alloc(c*2)),v=w.i32_const(t.alloc(c*2));O.addCode(w.call(e+"_one",lt),w.call(e+"_neg",lt,lt),w.call(e+"_exp",dt,U,w.i32_const(c),st),w.call(e+"_square",st,H),w.call(e+"_mul",dt,H,H),w.call(e+"_conjugate",H,ut),w.call(e+"_mul",ut,H,ut),w.if(w.call(e+"_eq",ut,lt),w.unreachable()),w.call(e+"_mul",st,dt,Ft),w.if(w.call(e+"_eq",H,lt),[...w.call(o+"_zero",Et),...w.call(o+"_one",Tt),...w.call(e+"_mul",lt,Ft,w.getLocal("pr"))],[...w.call(e+"_one",v),...w.call(e+"_add",v,H,v),...w.call(e+"_exp",v,W,w.i32_const(c),v),...w.call(e+"_mul",v,Ft,w.getLocal("pr"))]))}function nt(){const O=t.addFunction(e+"_isSquare");O.addParam("a","i32"),O.setReturnType("i32");const w=O.getCodeBuilder(),U=w.i32_const(t.alloc(Ee.bigInt2BytesLE((BigInt(f||0)-3n)/4n,c))),W=w.getLocal("a"),dt=w.i32_const(t.alloc(c*2)),st=w.i32_const(t.alloc(c*2)),H=w.i32_const(t.alloc(c*2)),ut=t.alloc(c*2),ot=w.i32_const(ut);O.addCode(w.call(e+"_one",ot),w.call(e+"_neg",ot,ot),w.call(e+"_exp",W,U,w.i32_const(c),dt),w.call(e+"_square",dt,st),w.call(e+"_mul",W,st,st),w.call(e+"_conjugate",st,H),w.call(e+"_mul",H,st,H),w.if(w.call(e+"_eq",H,ot),w.ret(w.i32_const(0))),w.ret(w.i32_const(1)))}return C(),X(),Q(),M(),A(),y(),$(),R(),s(),u(),l(),B(),I(),G(),ct(),_(),b(),h(),x(),t.exportFunction(e+"_isZero"),t.exportFunction(e+"_isOne"),t.exportFunction(e+"_zero"),t.exportFunction(e+"_one"),t.exportFunction(e+"_copy"),t.exportFunction(e+"_mul"),t.exportFunction(e+"_mul1"),t.exportFunction(e+"_square"),t.exportFunction(e+"_add"),t.exportFunction(e+"_sub"),t.exportFunction(e+"_neg"),t.exportFunction(e+"_sign"),t.exportFunction(e+"_conjugate"),t.exportFunction(e+"_fromMontgomery"),t.exportFunction(e+"_toMontgomery"),t.exportFunction(e+"_eq"),t.exportFunction(e+"_inverse"),cc(t,e),ic(t,e+"_exp",c*2,e+"_mul",e+"_square",e+"_copy",e+"_one"),J(),nt(),t.exportFunction(e+"_exp"),t.exportFunction(e+"_timesScalar"),t.exportFunction(e+"_batchInverse"),t.exportFunction(e+"_sqrt"),t.exportFunction(e+"_isSquare"),t.exportFunction(e+"_isNegative"),e};const sc=Ye,lc=to;var pa=function(t,n,e,o){if(t.modules[e])return e;const c=t.modules[o].n64*8;t.modules[e]={n64:t.modules[o].n64*3};function f(){const _=t.addFunction(e+"_add");_.addParam("x","i32"),_.addParam("y","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("y"),w=h.i32_add(h.getLocal("y"),h.i32_const(c)),U=h.i32_add(h.getLocal("y"),h.i32_const(2*c)),W=h.getLocal("r"),dt=h.i32_add(h.getLocal("r"),h.i32_const(c)),st=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_add",X,O,W),h.call(o+"_add",J,w,dt),h.call(o+"_add",nt,U,st))}function s(){const _=t.addFunction(e+"_timesScalar");_.addParam("x","i32"),_.addParam("scalar","i32"),_.addParam("scalarLen","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_timesScalar",X,h.getLocal("scalar"),h.getLocal("scalarLen"),O),h.call(o+"_timesScalar",J,h.getLocal("scalar"),h.getLocal("scalarLen"),w),h.call(o+"_timesScalar",nt,h.getLocal("scalar"),h.getLocal("scalarLen"),U))}function b(){const _=t.addFunction(e+"_sub");_.addParam("x","i32"),_.addParam("y","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("y"),w=h.i32_add(h.getLocal("y"),h.i32_const(c)),U=h.i32_add(h.getLocal("y"),h.i32_const(2*c)),W=h.getLocal("r"),dt=h.i32_add(h.getLocal("r"),h.i32_const(c)),st=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_sub",X,O,W),h.call(o+"_sub",J,w,dt),h.call(o+"_sub",nt,U,st))}function u(){const _=t.addFunction(e+"_neg");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_neg",X,O),h.call(o+"_neg",J,w),h.call(o+"_neg",nt,U))}function l(){const _=t.addFunction(e+"_isNegative");_.addParam("x","i32"),_.setReturnType("i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c));_.addCode(h.if(h.call(o+"_isZero",nt),h.if(h.call(o+"_isZero",J),h.ret(h.call(o+"_isNegative",X)),h.ret(h.call(o+"_isNegative",J)))),h.ret(h.call(o+"_isNegative",nt)))}function B(){const _=t.addFunction(e+"_mul");_.addParam("x","i32"),_.addParam("y","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("y"),w=h.i32_add(h.getLocal("y"),h.i32_const(c)),U=h.i32_add(h.getLocal("y"),h.i32_const(2*c)),W=h.getLocal("r"),dt=h.i32_add(h.getLocal("r"),h.i32_const(c)),st=h.i32_add(h.getLocal("r"),h.i32_const(2*c)),H=h.i32_const(t.alloc(c)),ut=h.i32_const(t.alloc(c)),ot=h.i32_const(t.alloc(c)),lt=h.i32_const(t.alloc(c)),Et=h.i32_const(t.alloc(c)),Tt=h.i32_const(t.alloc(c)),Ft=h.i32_const(t.alloc(c)),v=h.i32_const(t.alloc(c)),i=h.i32_const(t.alloc(c)),E=h.i32_const(t.alloc(c)),d=h.i32_const(t.alloc(c)),K=h.i32_const(t.alloc(c)),k=h.i32_const(t.alloc(c));_.addCode(h.call(o+"_mul",X,O,H),h.call(o+"_mul",J,w,ut),h.call(o+"_mul",nt,U,ot),h.call(o+"_add",X,J,lt),h.call(o+"_add",O,w,Et),h.call(o+"_add",X,nt,Tt),h.call(o+"_add",O,U,Ft),h.call(o+"_add",J,nt,v),h.call(o+"_add",w,U,i),h.call(o+"_add",H,ut,E),h.call(o+"_add",H,ot,d),h.call(o+"_add",ut,ot,K),h.call(o+"_mul",v,i,W),h.call(o+"_sub",W,K,W),h.call(n,W,W),h.call(o+"_add",H,W,W),h.call(o+"_mul",lt,Et,dt),h.call(o+"_sub",dt,E,dt),h.call(n,ot,k),h.call(o+"_add",dt,k,dt),h.call(o+"_mul",Tt,Ft,st),h.call(o+"_sub",st,d,st),h.call(o+"_add",st,ut,st))}function x(){const _=t.addFunction(e+"_square");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c)),W=h.i32_const(t.alloc(c)),dt=h.i32_const(t.alloc(c)),st=h.i32_const(t.alloc(c)),H=h.i32_const(t.alloc(c)),ut=h.i32_const(t.alloc(c)),ot=h.i32_const(t.alloc(c)),lt=h.i32_const(t.alloc(c));_.addCode(h.call(o+"_square",X,W),h.call(o+"_mul",X,J,dt),h.call(o+"_add",dt,dt,st),h.call(o+"_sub",X,J,H),h.call(o+"_add",H,nt,H),h.call(o+"_square",H,H),h.call(o+"_mul",J,nt,ut),h.call(o+"_add",ut,ut,ot),h.call(o+"_square",nt,lt),h.call(n,ot,O),h.call(o+"_add",W,O,O),h.call(n,lt,w),h.call(o+"_add",st,w,w),h.call(o+"_add",W,lt,U),h.call(o+"_sub",ot,U,U),h.call(o+"_add",H,U,U),h.call(o+"_add",st,U,U))}function y(){const _=t.addFunction(e+"_toMontgomery");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_toMontgomery",X,O),h.call(o+"_toMontgomery",J,w),h.call(o+"_toMontgomery",nt,U))}function $(){const _=t.addFunction(e+"_fromMontgomery");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_fromMontgomery",X,O),h.call(o+"_fromMontgomery",J,w),h.call(o+"_fromMontgomery",nt,U))}function R(){const _=t.addFunction(e+"_copy");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c));_.addCode(h.call(o+"_copy",X,O),h.call(o+"_copy",J,w),h.call(o+"_copy",nt,U))}function I(){const _=t.addFunction(e+"_zero");_.addParam("x","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c));_.addCode(h.call(o+"_zero",X),h.call(o+"_zero",J),h.call(o+"_zero",nt))}function G(){const _=t.addFunction(e+"_one");_.addParam("x","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c));_.addCode(h.call(o+"_one",X),h.call(o+"_zero",J),h.call(o+"_zero",nt))}function A(){const _=t.addFunction(e+"_eq");_.addParam("x","i32"),_.addParam("y","i32"),_.setReturnType("i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("y"),w=h.i32_add(h.getLocal("y"),h.i32_const(c)),U=h.i32_add(h.getLocal("y"),h.i32_const(2*c));_.addCode(h.i32_and(h.i32_and(h.call(o+"_eq",X,O),h.call(o+"_eq",J,w)),h.call(o+"_eq",nt,U)))}function Q(){const _=t.addFunction(e+"_isZero");_.addParam("x","i32"),_.setReturnType("i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c));_.addCode(h.i32_and(h.i32_and(h.call(o+"_isZero",X),h.call(o+"_isZero",J)),h.call(o+"_isZero",nt)))}function M(){const _=t.addFunction(e+"_inverse");_.addParam("x","i32"),_.addParam("r","i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c)),O=h.getLocal("r"),w=h.i32_add(h.getLocal("r"),h.i32_const(c)),U=h.i32_add(h.getLocal("r"),h.i32_const(2*c)),W=h.i32_const(t.alloc(c)),dt=h.i32_const(t.alloc(c)),st=h.i32_const(t.alloc(c)),H=h.i32_const(t.alloc(c)),ut=h.i32_const(t.alloc(c)),ot=h.i32_const(t.alloc(c)),lt=h.i32_const(t.alloc(c)),Et=h.i32_const(t.alloc(c)),Tt=h.i32_const(t.alloc(c)),Ft=h.i32_const(t.alloc(c)),v=h.i32_const(t.alloc(c));_.addCode(h.call(o+"_square",X,W),h.call(o+"_square",J,dt),h.call(o+"_square",nt,st),h.call(o+"_mul",X,J,H),h.call(o+"_mul",X,nt,ut),h.call(o+"_mul",J,nt,ot),h.call(n,ot,lt),h.call(o+"_sub",W,lt,lt),h.call(n,st,Et),h.call(o+"_sub",Et,H,Et),h.call(o+"_sub",dt,ut,Tt),h.call(o+"_mul",nt,Et,Ft),h.call(o+"_mul",J,Tt,v),h.call(o+"_add",Ft,v,Ft),h.call(n,Ft,Ft),h.call(o+"_mul",X,lt,v),h.call(o+"_add",v,Ft,Ft),h.call(o+"_inverse",Ft,Ft),h.call(o+"_mul",Ft,lt,O),h.call(o+"_mul",Ft,Et,w),h.call(o+"_mul",Ft,Tt,U))}function ct(){const _=t.addFunction(e+"_sign");_.addParam("x","i32"),_.addLocal("s","i32"),_.setReturnType("i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(2*c));_.addCode(h.setLocal("s",h.call(o+"_sign",nt)),h.if(h.getLocal("s"),h.ret(h.getLocal("s"))),h.setLocal("s",h.call(o+"_sign",J)),h.if(h.getLocal("s"),h.ret(h.getLocal("s"))),h.ret(h.call(o+"_sign",X)))}function C(){const _=t.addFunction(e+"_isOne");_.addParam("x","i32"),_.setReturnType("i32");const h=_.getCodeBuilder(),X=h.getLocal("x"),J=h.i32_add(h.getLocal("x"),h.i32_const(c)),nt=h.i32_add(h.getLocal("x"),h.i32_const(c*2));_.addCode(h.ret(h.i32_and(h.i32_and(h.call(o+"_isOne",X),h.call(o+"_isZero",J)),h.call(o+"_isZero",nt))))}return Q(),C(),I(),G(),R(),B(),x(),f(),b(),u(),ct(),y(),$(),A(),M(),s(),l(),t.exportFunction(e+"_isZero"),t.exportFunction(e+"_isOne"),t.exportFunction(e+"_zero"),t.exportFunction(e+"_one"),t.exportFunction(e+"_copy"),t.exportFunction(e+"_mul"),t.exportFunction(e+"_square"),t.exportFunction(e+"_add"),t.exportFunction(e+"_sub"),t.exportFunction(e+"_neg"),t.exportFunction(e+"_sign"),t.exportFunction(e+"_fromMontgomery"),t.exportFunction(e+"_toMontgomery"),t.exportFunction(e+"_eq"),t.exportFunction(e+"_inverse"),lc(t,e),sc(t,e+"_exp",c*3,e+"_mul",e+"_square",e+"_copy",e+"_one"),t.exportFunction(e+"_exp"),t.exportFunction(e+"_timesScalar"),t.exportFunction(e+"_batchInverse"),t.exportFunction(e+"_isNegative"),e},rc=function(t,n,e,o,c,f,s,b){const u=t.addFunction(n);u.addParam("base","i32"),u.addParam("scalar","i32"),u.addParam("scalarLength","i32"),u.addParam("r","i32"),u.addLocal("old0","i32"),u.addLocal("nbits","i32"),u.addLocal("i","i32"),u.addLocal("last","i32"),u.addLocal("cur","i32"),u.addLocal("carry","i32"),u.addLocal("p","i32");const l=u.getCodeBuilder(),B=l.i32_const(t.alloc(e));function x($){return l.i32_and(l.i32_shr_u(l.i32_load(l.i32_add(l.getLocal("scalar"),l.i32_and(l.i32_shr_u($,l.i32_const(3)),l.i32_const(4294967292)))),l.i32_and($,l.i32_const(31))),l.i32_const(1))}function y($){return[...l.i32_store8(l.getLocal("p"),l.i32_const($)),...l.setLocal("p",l.i32_add(l.getLocal("p"),l.i32_const(1)))]}u.addCode(l.if(l.i32_eqz(l.getLocal("scalarLength")),[...l.call(b,l.getLocal("r")),...l.ret([])]),l.setLocal("nbits",l.i32_shl(l.getLocal("scalarLength"),l.i32_const(3))),l.setLocal("old0",l.i32_load(l.i32_const(0))),l.setLocal("p",l.getLocal("old0")),l.i32_store(l.i32_const(0),l.i32_and(l.i32_add(l.i32_add(l.getLocal("old0"),l.i32_const(32)),l.getLocal("nbits")),l.i32_const(4294967288))),l.setLocal("i",l.i32_const(1)),l.setLocal("last",x(l.i32_const(0))),l.setLocal("carry",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("nbits"))),l.setLocal("cur",x(l.getLocal("i"))),l.if(l.getLocal("last"),l.if(l.getLocal("cur"),l.if(l.getLocal("carry"),[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(1)),...y(1)],[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(1)),...y(255)]),l.if(l.getLocal("carry"),[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(1)),...y(255)],[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(0)),...y(1)])),l.if(l.getLocal("cur"),l.if(l.getLocal("carry"),[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(1)),...y(0)],[...l.setLocal("last",l.i32_const(1)),...l.setLocal("carry",l.i32_const(0)),...y(0)]),l.if(l.getLocal("carry"),[...l.setLocal("last",l.i32_const(1)),...l.setLocal("carry",l.i32_const(0)),...y(0)],[...l.setLocal("last",l.i32_const(0)),...l.setLocal("carry",l.i32_const(0)),...y(0)]))),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0))),l.if(l.getLocal("last"),l.if(l.getLocal("carry"),[...y(255),...y(0),...y(1)],[...y(1)]),l.if(l.getLocal("carry"),[...y(0),...y(1)])),l.setLocal("p",l.i32_sub(l.getLocal("p"),l.i32_const(1))),l.call(s,l.getLocal("base"),B),l.call(b,l.getLocal("r")),l.block(l.loop(l.call(c,l.getLocal("r"),l.getLocal("r")),l.setLocal("cur",l.i32_load8_u(l.getLocal("p"))),l.if(l.getLocal("cur"),l.if(l.i32_eq(l.getLocal("cur"),l.i32_const(1)),l.call(o,l.getLocal("r"),B,l.getLocal("r")),l.call(f,l.getLocal("r"),B,l.getLocal("r")))),l.br_if(1,l.i32_eq(l.getLocal("old0"),l.getLocal("p"))),l.setLocal("p",l.i32_sub(l.getLocal("p"),l.i32_const(1))),l.br(0))),l.i32_store(l.i32_const(0),l.getLocal("old0")))},dc=function(t,n,e,o,c){const s=t.modules[n].n64*8;function b(){const x=t.addFunction(e+"_getChunk");x.addParam("pScalar","i32"),x.addParam("scalarSize","i32"),x.addParam("startBit","i32"),x.addParam("chunkSize","i32"),x.addLocal("bitsToEnd","i32"),x.addLocal("mask","i32"),x.setReturnType("i32");const y=x.getCodeBuilder();x.addCode(y.setLocal("bitsToEnd",y.i32_sub(y.i32_mul(y.getLocal("scalarSize"),y.i32_const(8)),y.getLocal("startBit"))),y.if(y.i32_gt_s(y.getLocal("chunkSize"),y.getLocal("bitsToEnd")),y.setLocal("mask",y.i32_sub(y.i32_shl(y.i32_const(1),y.getLocal("bitsToEnd")),y.i32_const(1))),y.setLocal("mask",y.i32_sub(y.i32_shl(y.i32_const(1),y.getLocal("chunkSize")),y.i32_const(1)))),y.i32_and(y.i32_shr_u(y.i32_load(y.i32_add(y.getLocal("pScalar"),y.i32_shr_u(y.getLocal("startBit"),y.i32_const(3))),0,0),y.i32_and(y.getLocal("startBit"),y.i32_const(7))),y.getLocal("mask")))}function u(){const x=t.addFunction(e+"_chunk");x.addParam("pBases","i32"),x.addParam("pScalars","i32"),x.addParam("scalarSize","i32"),x.addParam("n","i32"),x.addParam("startBit","i32"),x.addParam("chunkSize","i32"),x.addParam("pr","i32"),x.addLocal("nChunks","i32"),x.addLocal("itScalar","i32"),x.addLocal("endScalar","i32"),x.addLocal("itBase","i32"),x.addLocal("i","i32"),x.addLocal("j","i32"),x.addLocal("nTable","i32"),x.addLocal("pTable","i32"),x.addLocal("idx","i32"),x.addLocal("pIdxTable","i32");const y=x.getCodeBuilder();x.addCode(y.if(y.i32_eqz(y.getLocal("n")),[...y.call(n+"_zero",y.getLocal("pr")),...y.ret([])]),y.setLocal("nTable",y.i32_shl(y.i32_const(1),y.getLocal("chunkSize"))),y.setLocal("pTable",y.i32_load(y.i32_const(0))),y.i32_store(y.i32_const(0),y.i32_add(y.getLocal("pTable"),y.i32_mul(y.getLocal("nTable"),y.i32_const(s)))),y.setLocal("j",y.i32_const(0)),y.block(y.loop(y.br_if(1,y.i32_eq(y.getLocal("j"),y.getLocal("nTable"))),y.call(n+"_zero",y.i32_add(y.getLocal("pTable"),y.i32_mul(y.getLocal("j"),y.i32_const(s)))),y.setLocal("j",y.i32_add(y.getLocal("j"),y.i32_const(1))),y.br(0))),y.setLocal("itBase",y.getLocal("pBases")),y.setLocal("itScalar",y.getLocal("pScalars")),y.setLocal("endScalar",y.i32_add(y.getLocal("pScalars"),y.i32_mul(y.getLocal("n"),y.getLocal("scalarSize")))),y.block(y.loop(y.br_if(1,y.i32_eq(y.getLocal("itScalar"),y.getLocal("endScalar"))),y.setLocal("idx",y.call(e+"_getChunk",y.getLocal("itScalar"),y.getLocal("scalarSize"),y.getLocal("startBit"),y.getLocal("chunkSize"))),y.if(y.getLocal("idx"),[...y.setLocal("pIdxTable",y.i32_add(y.getLocal("pTable"),y.i32_mul(y.i32_sub(y.getLocal("idx"),y.i32_const(1)),y.i32_const(s)))),...y.call(o,y.getLocal("pIdxTable"),y.getLocal("itBase"),y.getLocal("pIdxTable"))]),y.setLocal("itScalar",y.i32_add(y.getLocal("itScalar"),y.getLocal("scalarSize"))),y.setLocal("itBase",y.i32_add(y.getLocal("itBase"),y.i32_const(c))),y.br(0))),y.call(e+"_reduceTable",y.getLocal("pTable"),y.getLocal("chunkSize")),y.call(n+"_copy",y.getLocal("pTable"),y.getLocal("pr")),y.i32_store(y.i32_const(0),y.getLocal("pTable")))}function l(){const x=t.addFunction(e);x.addParam("pBases","i32"),x.addParam("pScalars","i32"),x.addParam("scalarSize","i32"),x.addParam("n","i32"),x.addParam("pr","i32"),x.addLocal("chunkSize","i32"),x.addLocal("nChunks","i32"),x.addLocal("itScalar","i32"),x.addLocal("endScalar","i32"),x.addLocal("itBase","i32"),x.addLocal("itBit","i32"),x.addLocal("i","i32"),x.addLocal("j","i32"),x.addLocal("nTable","i32"),x.addLocal("pTable","i32"),x.addLocal("idx","i32"),x.addLocal("pIdxTable","i32");const y=x.getCodeBuilder(),$=y.i32_const(t.alloc(s)),R=t.alloc([17,17,17,17,17,17,17,17,17,17,16,16,15,14,13,13,12,11,10,9,8,7,7,6,5,4,3,2,1,1,1,1]);x.addCode(y.call(n+"_zero",y.getLocal("pr")),y.if(y.i32_eqz(y.getLocal("n")),y.ret([])),y.setLocal("chunkSize",y.i32_load8_u(y.i32_clz(y.getLocal("n")),R)),y.setLocal("nChunks",y.i32_add(y.i32_div_u(y.i32_sub(y.i32_shl(y.getLocal("scalarSize"),y.i32_const(3)),y.i32_const(1)),y.getLocal("chunkSize")),y.i32_const(1))),y.setLocal("itBit",y.i32_mul(y.i32_sub(y.getLocal("nChunks"),y.i32_const(1)),y.getLocal("chunkSize"))),y.block(y.loop(y.br_if(1,y.i32_lt_s(y.getLocal("itBit"),y.i32_const(0))),y.if(y.i32_eqz(y.call(n+"_isZero",y.getLocal("pr"))),[...y.setLocal("j",y.i32_const(0)),...y.block(y.loop(y.br_if(1,y.i32_eq(y.getLocal("j"),y.getLocal("chunkSize"))),y.call(n+"_double",y.getLocal("pr"),y.getLocal("pr")),y.setLocal("j",y.i32_add(y.getLocal("j"),y.i32_const(1))),y.br(0)))]),y.call(e+"_chunk",y.getLocal("pBases"),y.getLocal("pScalars"),y.getLocal("scalarSize"),y.getLocal("n"),y.getLocal("itBit"),y.getLocal("chunkSize"),$),y.call(n+"_add",y.getLocal("pr"),$,y.getLocal("pr")),y.setLocal("itBit",y.i32_sub(y.getLocal("itBit"),y.getLocal("chunkSize"))),y.br(0))))}function B(){const x=t.addFunction(e+"_reduceTable");x.addParam("pTable","i32"),x.addParam("p","i32"),x.addLocal("half","i32"),x.addLocal("it1","i32"),x.addLocal("it2","i32"),x.addLocal("pAcc","i32");const y=x.getCodeBuilder();x.addCode(y.if(y.i32_eq(y.getLocal("p"),y.i32_const(1)),y.ret([])),y.setLocal("half",y.i32_shl(y.i32_const(1),y.i32_sub(y.getLocal("p"),y.i32_const(1)))),y.setLocal("it1",y.getLocal("pTable")),y.setLocal("it2",y.i32_add(y.getLocal("pTable"),y.i32_mul(y.getLocal("half"),y.i32_const(s)))),y.setLocal("pAcc",y.i32_sub(y.getLocal("it2"),y.i32_const(s))),y.block(y.loop(y.br_if(1,y.i32_eq(y.getLocal("it1"),y.getLocal("pAcc"))),y.call(n+"_add",y.getLocal("it1"),y.getLocal("it2"),y.getLocal("it1")),y.call(n+"_add",y.getLocal("pAcc"),y.getLocal("it2"),y.getLocal("pAcc")),y.setLocal("it1",y.i32_add(y.getLocal("it1"),y.i32_const(s))),y.setLocal("it2",y.i32_add(y.getLocal("it2"),y.i32_const(s))),y.br(0))),y.call(e+"_reduceTable",y.getLocal("pTable"),y.i32_sub(y.getLocal("p"),y.i32_const(1))),y.setLocal("p",y.i32_sub(y.getLocal("p"),y.i32_const(1))),y.block(y.loop(y.br_if(1,y.i32_eqz(y.getLocal("p"))),y.call(n+"_double",y.getLocal("pAcc"),y.getLocal("pAcc")),y.setLocal("p",y.i32_sub(y.getLocal("p"),y.i32_const(1))),y.br(0))),y.call(n+"_add",y.getLocal("pTable"),y.getLocal("pAcc"),y.getLocal("pTable")))}b(),B(),u(),l(),t.exportFunction(e),t.exportFunction(e+"_chunk")};const mo=rc,Nn=sa,yo=dc;var ha=function(t,n,e,o){const c=t.modules[e].n64,f=c*8;if(t.modules[n])return n;t.modules[n]={n64:c*3};function s(){const v=t.addFunction(n+"_isZero");v.addParam("p1","i32"),v.setReturnType("i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_isZero",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))))}function b(){const v=t.addFunction(n+"_isZeroAffine");v.addParam("p1","i32"),v.setReturnType("i32");const i=v.getCodeBuilder();v.addCode(i.i32_and(i.call(e+"_isZero",i.getLocal("p1")),i.call(e+"_isZero",i.i32_add(i.getLocal("p1"),i.i32_const(f)))))}function u(){const v=t.addFunction(n+"_copy");v.addParam("ps","i32"),v.addParam("pd","i32");const i=v.getCodeBuilder();for(let E=0;E<c*3;E++)v.addCode(i.i64_store(i.getLocal("pd"),E*8,i.i64_load(i.getLocal("ps"),E*8)))}function l(){const v=t.addFunction(n+"_copyAffine");v.addParam("ps","i32"),v.addParam("pd","i32");const i=v.getCodeBuilder();for(let E=0;E<c*2;E++)v.addCode(i.i64_store(i.getLocal("pd"),E*8,i.i64_load(i.getLocal("ps"),E*8)))}function B(){const v=t.addFunction(n+"_zero");v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_zero",i.getLocal("pr"))),v.addCode(i.call(e+"_one",i.i32_add(i.getLocal("pr"),i.i32_const(f)))),v.addCode(i.call(e+"_zero",i.i32_add(i.getLocal("pr"),i.i32_const(f*2))))}function x(){const v=t.addFunction(n+"_zeroAffine");v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_zero",i.getLocal("pr"))),v.addCode(i.call(e+"_zero",i.i32_add(i.getLocal("pr"),i.i32_const(f))))}function y(){const v=t.addFunction(n+"_eq");v.addParam("p1","i32"),v.addParam("p2","i32"),v.setReturnType("i32"),v.addLocal("z1","i32"),v.addLocal("z2","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f));v.addCode(i.setLocal("z1",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))));const K=i.getLocal("z1"),k=i.getLocal("p2"),L=i.i32_add(i.getLocal("p2"),i.i32_const(f));v.addCode(i.setLocal("z2",i.i32_add(i.getLocal("p2"),i.i32_const(f*2))));const et=i.getLocal("z2"),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f)),xt=i.i32_const(t.alloc(f)),Ut=i.i32_const(t.alloc(f)),mt=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),i.ret(i.call(n+"_isZero",i.getLocal("p2")))),i.if(i.call(n+"_isZero",i.getLocal("p2")),i.ret(i.i32_const(0))),i.if(i.call(e+"_isOne",K),i.ret(i.call(n+"_eqMixed",i.getLocal("p2"),i.getLocal("p1")))),i.if(i.call(e+"_isOne",et),i.ret(i.call(n+"_eqMixed",i.getLocal("p1"),i.getLocal("p2")))),i.call(e+"_square",K,pt),i.call(e+"_square",et,gt),i.call(e+"_mul",E,gt,ht),i.call(e+"_mul",k,pt,Ct),i.call(e+"_mul",K,pt,Lt),i.call(e+"_mul",et,gt,xt),i.call(e+"_mul",d,xt,Ut),i.call(e+"_mul",L,Lt,mt),i.if(i.call(e+"_eq",ht,Ct),i.if(i.call(e+"_eq",Ut,mt),i.ret(i.i32_const(1)))),i.ret(i.i32_const(0)))}function $(){const v=t.addFunction(n+"_eqMixed");v.addParam("p1","i32"),v.addParam("p2","i32"),v.setReturnType("i32"),v.addLocal("z1","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f));v.addCode(i.setLocal("z1",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))));const K=i.getLocal("z1"),k=i.getLocal("p2"),L=i.i32_add(i.getLocal("p2"),i.i32_const(f)),et=i.i32_const(t.alloc(f)),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),i.ret(i.call(n+"_isZeroAffine",i.getLocal("p2")))),i.if(i.call(n+"_isZeroAffine",i.getLocal("p2")),i.ret(i.i32_const(0))),i.if(i.call(e+"_isOne",K),i.ret(i.call(n+"_eqAffine",i.getLocal("p1"),i.getLocal("p2")))),i.call(e+"_square",K,et),i.call(e+"_mul",k,et,pt),i.call(e+"_mul",K,et,gt),i.call(e+"_mul",L,gt,ht),i.if(i.call(e+"_eq",E,pt),i.if(i.call(e+"_eq",d,ht),i.ret(i.i32_const(1)))),i.ret(i.i32_const(0)))}function R(){const v=t.addFunction(n+"_double");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.i32_add(i.getLocal("p1"),i.i32_const(f*2)),k=i.getLocal("pr"),L=i.i32_add(i.getLocal("pr"),i.i32_const(f)),et=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f)),xt=i.i32_const(t.alloc(f)),Ut=i.i32_const(t.alloc(f)),mt=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),[...i.call(n+"_copy",i.getLocal("p1"),i.getLocal("pr")),...i.ret([])]),i.if(i.call(e+"_isOne",K),[...i.ret(i.call(n+"_doubleAffine",i.getLocal("p1"),i.getLocal("pr"))),...i.ret([])]),i.call(e+"_square",E,pt),i.call(e+"_square",d,gt),i.call(e+"_square",gt,ht),i.call(e+"_add",E,gt,Ct),i.call(e+"_square",Ct,Ct),i.call(e+"_sub",Ct,pt,Ct),i.call(e+"_sub",Ct,ht,Ct),i.call(e+"_add",Ct,Ct,Ct),i.call(e+"_add",pt,pt,Lt),i.call(e+"_add",Lt,pt,Lt),i.call(e+"_square",Lt,xt),i.call(e+"_mul",d,K,Ut),i.call(e+"_add",Ct,Ct,k),i.call(e+"_sub",xt,k,k),i.call(e+"_add",ht,ht,mt),i.call(e+"_add",mt,mt,mt),i.call(e+"_add",mt,mt,mt),i.call(e+"_sub",Ct,k,L),i.call(e+"_mul",L,Lt,L),i.call(e+"_sub",L,mt,L),i.call(e+"_add",Ut,Ut,et))}function I(){const v=t.addFunction(n+"_doubleAffine");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.getLocal("pr"),k=i.i32_add(i.getLocal("pr"),i.i32_const(f)),L=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),et=i.i32_const(t.alloc(f)),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZeroAffine",i.getLocal("p1")),[...i.call(n+"_toJacobian",i.getLocal("p1"),i.getLocal("pr")),...i.ret([])]),i.call(e+"_square",E,et),i.call(e+"_square",d,pt),i.call(e+"_square",pt,gt),i.call(e+"_add",E,pt,ht),i.call(e+"_square",ht,ht),i.call(e+"_sub",ht,et,ht),i.call(e+"_sub",ht,gt,ht),i.call(e+"_add",ht,ht,ht),i.call(e+"_add",et,et,Ct),i.call(e+"_add",Ct,et,Ct),i.call(e+"_add",d,d,L),i.call(e+"_square",Ct,K),i.call(e+"_sub",K,ht,K),i.call(e+"_sub",K,ht,K),i.call(e+"_add",gt,gt,Lt),i.call(e+"_add",Lt,Lt,Lt),i.call(e+"_add",Lt,Lt,Lt),i.call(e+"_sub",ht,K,k),i.call(e+"_mul",k,Ct,k),i.call(e+"_sub",k,Lt,k))}function G(){const v=t.addFunction(n+"_eqAffine");v.addParam("p1","i32"),v.addParam("p2","i32"),v.setReturnType("i32"),v.addLocal("z1","i32");const i=v.getCodeBuilder();v.addCode(i.ret(i.i32_and(i.call(e+"_eq",i.getLocal("p1"),i.getLocal("p2")),i.call(e+"_eq",i.i32_add(i.getLocal("p1"),i.i32_const(f)),i.i32_add(i.getLocal("p2"),i.i32_const(f))))))}function A(){const v=t.addFunction(n+"_toMontgomery");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_toMontgomery",i.getLocal("p1"),i.getLocal("pr")));for(let E=1;E<3;E++)v.addCode(i.call(e+"_toMontgomery",i.i32_add(i.getLocal("p1"),i.i32_const(E*f)),i.i32_add(i.getLocal("pr"),i.i32_const(E*f))))}function Q(){const v=t.addFunction(n+"_toMontgomeryAffine");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_toMontgomery",i.getLocal("p1"),i.getLocal("pr")));for(let E=1;E<2;E++)v.addCode(i.call(e+"_toMontgomery",i.i32_add(i.getLocal("p1"),i.i32_const(E*f)),i.i32_add(i.getLocal("pr"),i.i32_const(E*f))))}function M(){const v=t.addFunction(n+"_fromMontgomery");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_fromMontgomery",i.getLocal("p1"),i.getLocal("pr")));for(let E=1;E<3;E++)v.addCode(i.call(e+"_fromMontgomery",i.i32_add(i.getLocal("p1"),i.i32_const(E*f)),i.i32_add(i.getLocal("pr"),i.i32_const(E*f))))}function ct(){const v=t.addFunction(n+"_fromMontgomeryAffine");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder();v.addCode(i.call(e+"_fromMontgomery",i.getLocal("p1"),i.getLocal("pr")));for(let E=1;E<2;E++)v.addCode(i.call(e+"_fromMontgomery",i.i32_add(i.getLocal("p1"),i.i32_const(E*f)),i.i32_add(i.getLocal("pr"),i.i32_const(E*f))))}function C(){const v=t.addFunction(n+"_add");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32"),v.addLocal("z1","i32"),v.addLocal("z2","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f));v.addCode(i.setLocal("z1",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))));const K=i.getLocal("z1"),k=i.getLocal("p2"),L=i.i32_add(i.getLocal("p2"),i.i32_const(f));v.addCode(i.setLocal("z2",i.i32_add(i.getLocal("p2"),i.i32_const(f*2))));const et=i.getLocal("z2"),pt=i.getLocal("pr"),gt=i.i32_add(i.getLocal("pr"),i.i32_const(f)),ht=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f)),xt=i.i32_const(t.alloc(f)),Ut=i.i32_const(t.alloc(f)),mt=i.i32_const(t.alloc(f)),ft=i.i32_const(t.alloc(f)),bt=i.i32_const(t.alloc(f)),Mt=i.i32_const(t.alloc(f)),Wt=i.i32_const(t.alloc(f)),Dt=i.i32_const(t.alloc(f)),Qt=i.i32_const(t.alloc(f)),F=i.i32_const(t.alloc(f)),p=i.i32_const(t.alloc(f)),m=i.i32_const(t.alloc(f)),S=i.i32_const(t.alloc(f)),z=i.i32_const(t.alloc(f)),Z=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),[...i.call(n+"_copy",i.getLocal("p2"),i.getLocal("pr")),...i.ret([])]),i.if(i.call(n+"_isZero",i.getLocal("p2")),[...i.call(n+"_copy",i.getLocal("p1"),i.getLocal("pr")),...i.ret([])]),i.if(i.call(e+"_isOne",K),[...i.call(n+"_addMixed",k,E,pt),...i.ret([])]),i.if(i.call(e+"_isOne",et),[...i.call(n+"_addMixed",E,k,pt),...i.ret([])]),i.call(e+"_square",K,Ct),i.call(e+"_square",et,Lt),i.call(e+"_mul",E,Lt,xt),i.call(e+"_mul",k,Ct,Ut),i.call(e+"_mul",K,Ct,mt),i.call(e+"_mul",et,Lt,ft),i.call(e+"_mul",d,ft,bt),i.call(e+"_mul",L,mt,Mt),i.if(i.call(e+"_eq",xt,Ut),i.if(i.call(e+"_eq",bt,Mt),[...i.call(n+"_double",i.getLocal("p1"),i.getLocal("pr")),...i.ret([])])),i.call(e+"_sub",Ut,xt,Wt),i.call(e+"_sub",Mt,bt,Dt),i.call(e+"_add",Wt,Wt,Qt),i.call(e+"_square",Qt,Qt),i.call(e+"_mul",Wt,Qt,F),i.call(e+"_add",Dt,Dt,p),i.call(e+"_mul",xt,Qt,S),i.call(e+"_square",p,m),i.call(e+"_add",S,S,z),i.call(e+"_sub",m,F,pt),i.call(e+"_sub",pt,z,pt),i.call(e+"_mul",bt,F,Z),i.call(e+"_add",Z,Z,Z),i.call(e+"_sub",S,pt,gt),i.call(e+"_mul",gt,p,gt),i.call(e+"_sub",gt,Z,gt),i.call(e+"_add",K,et,ht),i.call(e+"_square",ht,ht),i.call(e+"_sub",ht,Ct,ht),i.call(e+"_sub",ht,Lt,ht),i.call(e+"_mul",ht,Wt,ht))}function _(){const v=t.addFunction(n+"_addMixed");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32"),v.addLocal("z1","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f));v.addCode(i.setLocal("z1",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))));const K=i.getLocal("z1"),k=i.getLocal("p2"),L=i.i32_add(i.getLocal("p2"),i.i32_const(f)),et=i.getLocal("pr"),pt=i.i32_add(i.getLocal("pr"),i.i32_const(f)),gt=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),ht=i.i32_const(t.alloc(f)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f)),xt=i.i32_const(t.alloc(f)),Ut=i.i32_const(t.alloc(f)),mt=i.i32_const(t.alloc(f)),ft=i.i32_const(t.alloc(f)),bt=i.i32_const(t.alloc(f)),Mt=i.i32_const(t.alloc(f)),Wt=i.i32_const(t.alloc(f)),Dt=i.i32_const(t.alloc(f)),Qt=i.i32_const(t.alloc(f)),F=i.i32_const(t.alloc(f)),p=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),[...i.call(n+"_copyAffine",i.getLocal("p2"),i.getLocal("pr")),...i.call(e+"_one",i.i32_add(i.getLocal("pr"),i.i32_const(f*2))),...i.ret([])]),i.if(i.call(n+"_isZeroAffine",i.getLocal("p2")),[...i.call(n+"_copy",i.getLocal("p1"),i.getLocal("pr")),...i.ret([])]),i.if(i.call(e+"_isOne",K),[...i.call(n+"_addAffine",E,k,et),...i.ret([])]),i.call(e+"_square",K,ht),i.call(e+"_mul",k,ht,Ct),i.call(e+"_mul",K,ht,Lt),i.call(e+"_mul",L,Lt,xt),i.if(i.call(e+"_eq",E,Ct),i.if(i.call(e+"_eq",d,xt),[...i.call(n+"_doubleAffine",i.getLocal("p2"),i.getLocal("pr")),...i.ret([])])),i.call(e+"_sub",Ct,E,Ut),i.call(e+"_sub",xt,d,ft),i.call(e+"_square",Ut,mt),i.call(e+"_add",mt,mt,bt),i.call(e+"_add",bt,bt,bt),i.call(e+"_mul",Ut,bt,Mt),i.call(e+"_add",ft,ft,Wt),i.call(e+"_mul",E,bt,Qt),i.call(e+"_square",Wt,Dt),i.call(e+"_add",Qt,Qt,F),i.call(e+"_sub",Dt,Mt,et),i.call(e+"_sub",et,F,et),i.call(e+"_mul",d,Mt,p),i.call(e+"_add",p,p,p),i.call(e+"_sub",Qt,et,pt),i.call(e+"_mul",pt,Wt,pt),i.call(e+"_sub",pt,p,pt),i.call(e+"_add",K,Ut,gt),i.call(e+"_square",gt,gt),i.call(e+"_sub",gt,ht,gt),i.call(e+"_sub",gt,mt,gt))}function h(){const v=t.addFunction(n+"_addAffine");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32"),v.addLocal("z1","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f));v.addCode(i.setLocal("z1",i.i32_add(i.getLocal("p1"),i.i32_const(f*2))));const K=i.getLocal("p2"),k=i.i32_add(i.getLocal("p2"),i.i32_const(f)),L=i.getLocal("pr"),et=i.i32_add(i.getLocal("pr"),i.i32_const(f)),pt=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f)),Ct=i.i32_const(t.alloc(f)),Lt=i.i32_const(t.alloc(f)),xt=i.i32_const(t.alloc(f)),Ut=i.i32_const(t.alloc(f)),mt=i.i32_const(t.alloc(f)),ft=i.i32_const(t.alloc(f)),bt=i.i32_const(t.alloc(f)),Mt=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZeroAffine",i.getLocal("p1")),[...i.call(n+"_copyAffine",i.getLocal("p2"),i.getLocal("pr")),...i.call(e+"_one",i.i32_add(i.getLocal("pr"),i.i32_const(f*2))),...i.ret([])]),i.if(i.call(n+"_isZeroAffine",i.getLocal("p2")),[...i.call(n+"_copyAffine",i.getLocal("p1"),i.getLocal("pr")),...i.call(e+"_one",i.i32_add(i.getLocal("pr"),i.i32_const(f*2))),...i.ret([])]),i.if(i.call(e+"_eq",E,K),i.if(i.call(e+"_eq",d,k),[...i.call(n+"_doubleAffine",i.getLocal("p2"),i.getLocal("pr")),...i.ret([])])),i.call(e+"_sub",K,E,gt),i.call(e+"_sub",k,d,Ct),i.call(e+"_square",gt,ht),i.call(e+"_add",ht,ht,Lt),i.call(e+"_add",Lt,Lt,Lt),i.call(e+"_mul",gt,Lt,xt),i.call(e+"_add",Ct,Ct,Ut),i.call(e+"_mul",E,Lt,ft),i.call(e+"_square",Ut,mt),i.call(e+"_add",ft,ft,bt),i.call(e+"_sub",mt,xt,L),i.call(e+"_sub",L,bt,L),i.call(e+"_mul",d,xt,Mt),i.call(e+"_add",Mt,Mt,Mt),i.call(e+"_sub",ft,L,et),i.call(e+"_mul",et,Ut,et),i.call(e+"_sub",et,Mt,et),i.call(e+"_add",gt,gt,pt))}function X(){const v=t.addFunction(n+"_neg");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.i32_add(i.getLocal("p1"),i.i32_const(f*2)),k=i.getLocal("pr"),L=i.i32_add(i.getLocal("pr"),i.i32_const(f)),et=i.i32_add(i.getLocal("pr"),i.i32_const(f*2));v.addCode(i.call(e+"_copy",E,k),i.call(e+"_neg",d,L),i.call(e+"_copy",K,et))}function J(){const v=t.addFunction(n+"_negAffine");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.getLocal("pr"),k=i.i32_add(i.getLocal("pr"),i.i32_const(f));v.addCode(i.call(e+"_copy",E,K),i.call(e+"_neg",d,k))}function nt(){const v=t.addFunction(n+"_sub");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f*3));v.addCode(i.call(n+"_neg",i.getLocal("p2"),E),i.call(n+"_add",i.getLocal("p1"),E,i.getLocal("pr")))}function O(){const v=t.addFunction(n+"_subMixed");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f*3));v.addCode(i.call(n+"_negAffine",i.getLocal("p2"),E),i.call(n+"_addMixed",i.getLocal("p1"),E,i.getLocal("pr")))}function w(){const v=t.addFunction(n+"_subAffine");v.addParam("p1","i32"),v.addParam("p2","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f*3));v.addCode(i.call(n+"_negAffine",i.getLocal("p2"),E),i.call(n+"_addAffine",i.getLocal("p1"),E,i.getLocal("pr")))}function U(){const v=t.addFunction(n+"_normalize");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.i32_add(i.getLocal("p1"),i.i32_const(f*2)),k=i.getLocal("pr"),L=i.i32_add(i.getLocal("pr"),i.i32_const(f)),et=i.i32_add(i.getLocal("pr"),i.i32_const(f*2)),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f)),ht=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),i.call(n+"_zero",i.getLocal("pr")),[...i.call(e+"_inverse",K,pt),...i.call(e+"_square",pt,gt),...i.call(e+"_mul",pt,gt,ht),...i.call(e+"_mul",E,gt,k),...i.call(e+"_mul",d,ht,L),...i.call(e+"_one",et)]))}function W(){const v=t.addFunction(n+"_toAffine");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.i32_add(i.getLocal("p1"),i.i32_const(f*2)),k=i.getLocal("pr"),L=i.i32_add(i.getLocal("pr"),i.i32_const(f)),et=i.i32_const(t.alloc(f)),pt=i.i32_const(t.alloc(f)),gt=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZero",i.getLocal("p1")),[...i.call(e+"_zero",k),...i.call(e+"_zero",L)],[...i.call(e+"_inverse",K,et),...i.call(e+"_square",et,pt),...i.call(e+"_mul",et,pt,gt),...i.call(e+"_mul",E,pt,k),...i.call(e+"_mul",d,gt,L)]))}function dt(){const v=t.addFunction(n+"_toJacobian");v.addParam("p1","i32"),v.addParam("pr","i32");const i=v.getCodeBuilder(),E=i.getLocal("p1"),d=i.i32_add(i.getLocal("p1"),i.i32_const(f)),K=i.getLocal("pr"),k=i.i32_add(i.getLocal("pr"),i.i32_const(f)),L=i.i32_add(i.getLocal("pr"),i.i32_const(f*2));v.addCode(i.if(i.call(n+"_isZeroAffine",i.getLocal("p1")),i.call(n+"_zero",i.getLocal("pr")),[...i.call(e+"_one",L),...i.call(e+"_copy",d,k),...i.call(e+"_copy",E,K)]))}function st(){const v=t.addFunction(n+"_batchToAffine");v.addParam("pIn","i32"),v.addParam("n","i32"),v.addParam("pOut","i32"),v.addLocal("pAux","i32"),v.addLocal("itIn","i32"),v.addLocal("itAux","i32"),v.addLocal("itOut","i32"),v.addLocal("i","i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f));v.addCode(i.setLocal("pAux",i.i32_load(i.i32_const(0))),i.i32_store(i.i32_const(0),i.i32_add(i.getLocal("pAux"),i.i32_mul(i.getLocal("n"),i.i32_const(f)))),i.call(e+"_batchInverse",i.i32_add(i.getLocal("pIn"),i.i32_const(f*2)),i.i32_const(f*3),i.getLocal("n"),i.getLocal("pAux"),i.i32_const(f)),i.setLocal("itIn",i.getLocal("pIn")),i.setLocal("itAux",i.getLocal("pAux")),i.setLocal("itOut",i.getLocal("pOut")),i.setLocal("i",i.i32_const(0)),i.block(i.loop(i.br_if(1,i.i32_eq(i.getLocal("i"),i.getLocal("n"))),i.if(i.call(e+"_isZero",i.getLocal("itAux")),[...i.call(e+"_zero",i.getLocal("itOut")),...i.call(e+"_zero",i.i32_add(i.getLocal("itOut"),i.i32_const(f)))],[...i.call(e+"_mul",i.getLocal("itAux"),i.i32_add(i.getLocal("itIn"),i.i32_const(f)),E),...i.call(e+"_square",i.getLocal("itAux"),i.getLocal("itAux")),...i.call(e+"_mul",i.getLocal("itAux"),i.getLocal("itIn"),i.getLocal("itOut")),...i.call(e+"_mul",i.getLocal("itAux"),E,i.i32_add(i.getLocal("itOut"),i.i32_const(f)))]),i.setLocal("itIn",i.i32_add(i.getLocal("itIn"),i.i32_const(f*3))),i.setLocal("itOut",i.i32_add(i.getLocal("itOut"),i.i32_const(f*2))),i.setLocal("itAux",i.i32_add(i.getLocal("itAux"),i.i32_const(f))),i.setLocal("i",i.i32_add(i.getLocal("i"),i.i32_const(1))),i.br(0))),i.i32_store(i.i32_const(0),i.getLocal("pAux")))}function H(){const v=t.addFunction(n+"__reverseBytes");v.addParam("pIn","i32"),v.addParam("n","i32"),v.addParam("pOut","i32"),v.addLocal("itOut","i32"),v.addLocal("itIn","i32");const i=v.getCodeBuilder();v.addCode(i.setLocal("itOut",i.i32_sub(i.i32_add(i.getLocal("pOut"),i.getLocal("n")),i.i32_const(1))),i.setLocal("itIn",i.getLocal("pIn")),i.block(i.loop(i.br_if(1,i.i32_lt_s(i.getLocal("itOut"),i.getLocal("pOut"))),i.i32_store8(i.getLocal("itOut"),i.i32_load8_u(i.getLocal("itIn"))),i.setLocal("itOut",i.i32_sub(i.getLocal("itOut"),i.i32_const(1))),i.setLocal("itIn",i.i32_add(i.getLocal("itIn"),i.i32_const(1))),i.br(0))))}function ut(){const v=t.addFunction(n+"_LEMtoC");v.addParam("pIn","i32"),v.addParam("pOut","i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f));v.addCode(i.if(i.call(n+"_isZeroAffine",i.getLocal("pIn")),[...i.call(e+"_zero",i.getLocal("pOut")),...i.i32_store8(i.getLocal("pOut"),i.i32_const(64)),...i.ret([])]),i.call(e+"_fromMontgomery",i.getLocal("pIn"),E),i.call(n+"__reverseBytes",E,i.i32_const(f),i.getLocal("pOut")),i.if(i.i32_eq(i.call(e+"_sign",i.i32_add(i.getLocal("pIn"),i.i32_const(f))),i.i32_const(-1)),i.i32_store8(i.getLocal("pOut"),i.i32_or(i.i32_load8_u(i.getLocal("pOut")),i.i32_const(128)))))}function ot(){const v=t.addFunction(n+"_LEMtoU");v.addParam("pIn","i32"),v.addParam("pOut","i32");const i=v.getCodeBuilder(),E=t.alloc(f*2),d=i.i32_const(E),K=i.i32_const(E),k=i.i32_const(E+f);v.addCode(i.if(i.call(n+"_isZeroAffine",i.getLocal("pIn")),[...i.call(n+"_zeroAffine",i.getLocal("pOut")),...i.ret([])]),i.call(n+"_fromMontgomeryAffine",i.getLocal("pIn"),d),i.call(n+"__reverseBytes",K,i.i32_const(f),i.getLocal("pOut")),i.call(n+"__reverseBytes",k,i.i32_const(f),i.i32_add(i.getLocal("pOut"),i.i32_const(f))))}function lt(){const v=t.addFunction(n+"_UtoLEM");v.addParam("pIn","i32"),v.addParam("pOut","i32");const i=v.getCodeBuilder(),E=t.alloc(f*2),d=i.i32_const(E),K=i.i32_const(E),k=i.i32_const(E+f);v.addCode(i.if(i.i32_and(i.i32_load8_u(i.getLocal("pIn")),i.i32_const(64)),[...i.call(n+"_zeroAffine",i.getLocal("pOut")),...i.ret([])]),i.call(n+"__reverseBytes",i.getLocal("pIn"),i.i32_const(f),K),i.call(n+"__reverseBytes",i.i32_add(i.getLocal("pIn"),i.i32_const(f)),i.i32_const(f),k),i.call(n+"_toMontgomeryAffine",d,i.getLocal("pOut")))}function Et(){const v=t.addFunction(n+"_CtoLEM");v.addParam("pIn","i32"),v.addParam("pOut","i32"),v.addLocal("firstByte","i32"),v.addLocal("greatest","i32");const i=v.getCodeBuilder(),E=t.alloc(f*2),d=i.i32_const(E),K=i.i32_const(E+f);v.addCode(i.setLocal("firstByte",i.i32_load8_u(i.getLocal("pIn"))),i.if(i.i32_and(i.getLocal("firstByte"),i.i32_const(64)),[...i.call(n+"_zeroAffine",i.getLocal("pOut")),...i.ret([])]),i.setLocal("greatest",i.i32_and(i.getLocal("firstByte"),i.i32_const(128))),i.call(e+"_copy",i.getLocal("pIn"),K),i.i32_store8(K,i.i32_and(i.getLocal("firstByte"),i.i32_const(63))),i.call(n+"__reverseBytes",K,i.i32_const(f),d),i.call(e+"_toMontgomery",d,i.getLocal("pOut")),i.call(e+"_square",i.getLocal("pOut"),K),i.call(e+"_mul",i.getLocal("pOut"),K,K),i.call(e+"_add",K,i.i32_const(o),K),i.call(e+"_sqrt",K,K),i.call(e+"_neg",K,d),i.if(i.i32_eq(i.call(e+"_sign",K),i.i32_const(-1)),i.if(i.getLocal("greatest"),i.call(e+"_copy",K,i.i32_add(i.getLocal("pOut"),i.i32_const(f))),i.call(e+"_neg",K,i.i32_add(i.getLocal("pOut"),i.i32_const(f)))),i.if(i.getLocal("greatest"),i.call(e+"_neg",K,i.i32_add(i.getLocal("pOut"),i.i32_const(f))),i.call(e+"_copy",K,i.i32_add(i.getLocal("pOut"),i.i32_const(f))))))}function Tt(){const v=t.addFunction(n+"_inCurveAffine");v.addParam("pIn","i32"),v.setReturnType("i32");const i=v.getCodeBuilder(),E=i.getLocal("pIn"),d=i.i32_add(i.getLocal("pIn"),i.i32_const(f)),K=i.i32_const(t.alloc(f)),k=i.i32_const(t.alloc(f));v.addCode(i.call(e+"_square",d,K),i.call(e+"_square",E,k),i.call(e+"_mul",E,k,k),i.call(e+"_add",k,i.i32_const(o),k),i.ret(i.call(e+"_eq",K,k)))}function Ft(){const v=t.addFunction(n+"_inCurve");v.addParam("pIn","i32"),v.setReturnType("i32");const i=v.getCodeBuilder(),E=i.i32_const(t.alloc(f*2));v.addCode(i.call(n+"_toAffine",i.getLocal("pIn"),E),i.ret(i.call(n+"_inCurveAffine",E)))}return b(),s(),x(),B(),l(),u(),dt(),G(),$(),y(),I(),R(),h(),_(),C(),J(),X(),w(),O(),nt(),ct(),M(),Q(),A(),W(),Tt(),Ft(),st(),U(),H(),ot(),ut(),lt(),Et(),Nn(t,n+"_batchLEMtoU",n+"_LEMtoU",f*2,f*2),Nn(t,n+"_batchLEMtoC",n+"_LEMtoC",f*2,f),Nn(t,n+"_batchUtoLEM",n+"_UtoLEM",f*2,f*2),Nn(t,n+"_batchCtoLEM",n+"_CtoLEM",f,f*2,!0),Nn(t,n+"_batchToJacobian",n+"_toJacobian",f*2,f*3,!0),yo(t,n,n+"_multiexp",n+"_add",f*3),yo(t,n,n+"_multiexpAffine",n+"_addMixed",f*2),mo(t,n+"_timesScalar",f*3,n+"_add",n+"_double",n+"_sub",n+"_copy",n+"_zero"),mo(t,n+"_timesScalarAffine",f*2,n+"_addMixed",n+"_double",n+"_subMixed",n+"_copyAffine",n+"_zero"),t.exportFunction(n+"_isZero"),t.exportFunction(n+"_isZeroAffine"),t.exportFunction(n+"_eq"),t.exportFunction(n+"_eqMixed"),t.exportFunction(n+"_eqAffine"),t.exportFunction(n+"_copy"),t.exportFunction(n+"_copyAffine"),t.exportFunction(n+"_zero"),t.exportFunction(n+"_zeroAffine"),t.exportFunction(n+"_double"),t.exportFunction(n+"_doubleAffine"),t.exportFunction(n+"_add"),t.exportFunction(n+"_addMixed"),t.exportFunction(n+"_addAffine"),t.exportFunction(n+"_neg"),t.exportFunction(n+"_negAffine"),t.exportFunction(n+"_sub"),t.exportFunction(n+"_subMixed"),t.exportFunction(n+"_subAffine"),t.exportFunction(n+"_fromMontgomery"),t.exportFunction(n+"_fromMontgomeryAffine"),t.exportFunction(n+"_toMontgomery"),t.exportFunction(n+"_toMontgomeryAffine"),t.exportFunction(n+"_timesScalar"),t.exportFunction(n+"_timesScalarAffine"),t.exportFunction(n+"_normalize"),t.exportFunction(n+"_LEMtoU"),t.exportFunction(n+"_LEMtoC"),t.exportFunction(n+"_UtoLEM"),t.exportFunction(n+"_CtoLEM"),t.exportFunction(n+"_batchLEMtoU"),t.exportFunction(n+"_batchLEMtoC"),t.exportFunction(n+"_batchUtoLEM"),t.exportFunction(n+"_batchCtoLEM"),t.exportFunction(n+"_toAffine"),t.exportFunction(n+"_toJacobian"),t.exportFunction(n+"_batchToAffine"),t.exportFunction(n+"_batchToJacobian"),t.exportFunction(n+"_inCurve"),t.exportFunction(n+"_inCurveAffine"),n};const{isOdd:uc,modInv:bo,modPow:$n}=Jt,ie=xn;var La=function(t,n,e,o,c){const s=t.modules[o].n64*8,u=t.modules[e].n64*8,l=t.modules[o].q;let B=l-1n,x=0;for(;!uc(B);)x++,B=B>>1n;let y=2n;for(;$n(y,l>>1n,l)===1n;)y=y+1n;const $=new Array(x+1);$[x]=$n(y,B,l);let R=x-1;for(;R>=0;)$[R]=$n($[R+1],2n,l),R--;const I=[],G=(1n<<BigInt(s*8))%l;for(let E=0;E<$.length;E++){const d=$[E]*G%l;I.push(...ie.bigInt2BytesLE(d,s))}const A=t.alloc(I),Q=new Array(x+1);Q[0]=1n;for(let E=1;E<=x;E++)Q[E]=Q[E-1]*2n;const M=[];for(let E=0;E<=x;E++){const d=bo(Q[E],l)*G%l;M.push(...ie.bigInt2BytesLE(d,s))}const ct=t.alloc(M),C=$n(y,2n,l),_=[],h=[];for(let E=0;E<=x;E++){const d=$n(C,2n**BigInt(E),l),K=bo(l+1n-d,l);_.push(...ie.bigInt2BytesLE(d*G%l,s)),h.push(...ie.bigInt2BytesLE(K*G%l,s))}const X=t.alloc(_),J=t.alloc(h);function nt(E){let d=0;for(let K=0;K<8;K++)E&1<<K&&(d=d|128>>K);return d}const O=Array(256);for(let E=0;E<256;E++)O[E]=nt(E);const w=t.alloc(O);function U(){const E=t.addFunction(n+"__log2");E.addParam("n","i32"),E.setReturnType("i32"),E.addLocal("bits","i32"),E.addLocal("aux","i32");const d=E.getCodeBuilder();E.addCode(d.setLocal("aux",d.i32_shr_u(d.getLocal("n"),d.i32_const(1)))),E.addCode(d.setLocal("bits",d.i32_const(0))),E.addCode(d.block(d.loop(d.br_if(1,d.i32_eqz(d.getLocal("aux"))),d.setLocal("aux",d.i32_shr_u(d.getLocal("aux"),d.i32_const(1))),d.setLocal("bits",d.i32_add(d.getLocal("bits"),d.i32_const(1))),d.br(0)))),E.addCode(d.if(d.i32_ne(d.getLocal("n"),d.i32_shl(d.i32_const(1),d.getLocal("bits"))),d.unreachable())),E.addCode(d.if(d.i32_gt_u(d.getLocal("bits"),d.i32_const(x)),d.unreachable())),E.addCode(d.getLocal("bits"))}function W(){const E=t.addFunction(n+"_fft");E.addParam("px","i32"),E.addParam("n","i32"),E.addLocal("bits","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s));E.addCode(d.setLocal("bits",d.call(n+"__log2",d.getLocal("n"))),d.call(o+"_one",K),d.call(n+"_rawfft",d.getLocal("px"),d.getLocal("bits"),d.i32_const(0),K))}function dt(){const E=t.addFunction(n+"_ifft");E.addParam("px","i32"),E.addParam("n","i32"),E.addLocal("bits","i32"),E.addLocal("pInv2","i32");const d=E.getCodeBuilder();E.addCode(d.setLocal("bits",d.call(n+"__log2",d.getLocal("n"))),d.setLocal("pInv2",d.i32_add(d.i32_const(ct),d.i32_mul(d.getLocal("bits"),d.i32_const(s)))),d.call(n+"_rawfft",d.getLocal("px"),d.getLocal("bits"),d.i32_const(1),d.getLocal("pInv2")))}function st(){const E=t.addFunction(n+"_rawfft");E.addParam("px","i32"),E.addParam("bits","i32"),E.addParam("reverse","i32"),E.addParam("mulFactor","i32"),E.addLocal("s","i32"),E.addLocal("k","i32"),E.addLocal("j","i32"),E.addLocal("m","i32"),E.addLocal("mdiv2","i32"),E.addLocal("n","i32"),E.addLocal("pwm","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u)),L=d.i32_const(t.alloc(u));E.addCode(d.call(n+"__reversePermutation",d.getLocal("px"),d.getLocal("bits")),d.setLocal("n",d.i32_shl(d.i32_const(1),d.getLocal("bits"))),d.setLocal("s",d.i32_const(1)),d.block(d.loop(d.br_if(1,d.i32_gt_u(d.getLocal("s"),d.getLocal("bits"))),d.setLocal("m",d.i32_shl(d.i32_const(1),d.getLocal("s"))),d.setLocal("pwm",d.i32_add(d.i32_const(A),d.i32_mul(d.getLocal("s"),d.i32_const(s)))),d.setLocal("k",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_ge_u(d.getLocal("k"),d.getLocal("n"))),d.call(o+"_one",K),d.setLocal("mdiv2",d.i32_shr_u(d.getLocal("m"),d.i32_const(1))),d.setLocal("j",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_ge_u(d.getLocal("j"),d.getLocal("mdiv2"))),d.setLocal("idx1",d.i32_add(d.getLocal("px"),d.i32_mul(d.i32_add(d.getLocal("k"),d.getLocal("j")),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("idx1"),d.i32_mul(d.getLocal("mdiv2"),d.i32_const(u)))),d.call(c,d.getLocal("idx2"),K,k),d.call(e+"_copy",d.getLocal("idx1"),L),d.call(e+"_add",L,k,d.getLocal("idx1")),d.call(e+"_sub",L,k,d.getLocal("idx2")),d.call(o+"_mul",K,d.getLocal("pwm"),K),d.setLocal("j",d.i32_add(d.getLocal("j"),d.i32_const(1))),d.br(0))),d.setLocal("k",d.i32_add(d.getLocal("k"),d.getLocal("m"))),d.br(0))),d.setLocal("s",d.i32_add(d.getLocal("s"),d.i32_const(1))),d.br(0))),d.call(n+"__fftFinal",d.getLocal("px"),d.getLocal("bits"),d.getLocal("reverse"),d.getLocal("mulFactor")))}function H(){const E=t.addFunction(n+"__fftFinal");E.addParam("px","i32"),E.addParam("bits","i32"),E.addParam("reverse","i32"),E.addParam("mulFactor","i32"),E.addLocal("n","i32"),E.addLocal("ndiv2","i32"),E.addLocal("pInv2","i32"),E.addLocal("i","i32"),E.addLocal("mask","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(u));E.addCode(d.if(d.i32_and(d.i32_eqz(d.getLocal("reverse")),d.call(o+"_isOne",d.getLocal("mulFactor"))),d.ret([])),d.setLocal("n",d.i32_shl(d.i32_const(1),d.getLocal("bits"))),d.setLocal("mask",d.i32_sub(d.getLocal("n"),d.i32_const(1))),d.setLocal("i",d.i32_const(1)),d.setLocal("ndiv2",d.i32_shr_u(d.getLocal("n"),d.i32_const(1))),d.block(d.loop(d.br_if(1,d.i32_ge_u(d.getLocal("i"),d.getLocal("ndiv2"))),d.setLocal("idx1",d.i32_add(d.getLocal("px"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("px"),d.i32_mul(d.i32_sub(d.getLocal("n"),d.getLocal("i")),d.i32_const(u)))),d.if(d.getLocal("reverse"),d.if(d.call(o+"_isOne",d.getLocal("mulFactor")),[...d.call(e+"_copy",d.getLocal("idx1"),K),...d.call(e+"_copy",d.getLocal("idx2"),d.getLocal("idx1")),...d.call(e+"_copy",K,d.getLocal("idx2"))],[...d.call(e+"_copy",d.getLocal("idx1"),K),...d.call(c,d.getLocal("idx2"),d.getLocal("mulFactor"),d.getLocal("idx1")),...d.call(c,K,d.getLocal("mulFactor"),d.getLocal("idx2"))]),d.if(d.call(o+"_isOne",d.getLocal("mulFactor")),[],[...d.call(c,d.getLocal("idx1"),d.getLocal("mulFactor"),d.getLocal("idx1")),...d.call(c,d.getLocal("idx2"),d.getLocal("mulFactor"),d.getLocal("idx2"))])),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))),d.if(d.call(o+"_isOne",d.getLocal("mulFactor")),[],[...d.call(c,d.getLocal("px"),d.getLocal("mulFactor"),d.getLocal("px")),...d.setLocal("idx2",d.i32_add(d.getLocal("px"),d.i32_mul(d.getLocal("ndiv2"),d.i32_const(u)))),...d.call(c,d.getLocal("idx2"),d.getLocal("mulFactor"),d.getLocal("idx2"))]))}function ut(){const E=t.addFunction(n+"__reversePermutation");E.addParam("px","i32"),E.addParam("bits","i32"),E.addLocal("n","i32"),E.addLocal("i","i32"),E.addLocal("ri","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(u));E.addCode(d.setLocal("n",d.i32_shl(d.i32_const(1),d.getLocal("bits"))),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.setLocal("idx1",d.i32_add(d.getLocal("px"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("ri",d.call(n+"__rev",d.getLocal("i"),d.getLocal("bits"))),d.setLocal("idx2",d.i32_add(d.getLocal("px"),d.i32_mul(d.getLocal("ri"),d.i32_const(u)))),d.if(d.i32_lt_u(d.getLocal("i"),d.getLocal("ri")),[...d.call(e+"_copy",d.getLocal("idx1"),K),...d.call(e+"_copy",d.getLocal("idx2"),d.getLocal("idx1")),...d.call(e+"_copy",K,d.getLocal("idx2"))]),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function ot(){const E=t.addFunction(n+"__rev");E.addParam("x","i32"),E.addParam("bits","i32"),E.setReturnType("i32");const d=E.getCodeBuilder();E.addCode(d.i32_rotl(d.i32_add(d.i32_add(d.i32_shl(d.i32_load8_u(d.i32_and(d.getLocal("x"),d.i32_const(255)),w,0),d.i32_const(24)),d.i32_shl(d.i32_load8_u(d.i32_and(d.i32_shr_u(d.getLocal("x"),d.i32_const(8)),d.i32_const(255)),w,0),d.i32_const(16))),d.i32_add(d.i32_shl(d.i32_load8_u(d.i32_and(d.i32_shr_u(d.getLocal("x"),d.i32_const(16)),d.i32_const(255)),w,0),d.i32_const(8)),d.i32_load8_u(d.i32_and(d.i32_shr_u(d.getLocal("x"),d.i32_const(24)),d.i32_const(255)),w,0))),d.getLocal("bits")))}function lt(){const E=t.addFunction(n+"_fftJoin");E.addParam("pBuff1","i32"),E.addParam("pBuff2","i32"),E.addParam("n","i32"),E.addParam("first","i32"),E.addParam("inc","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u)),L=d.i32_const(t.alloc(u));E.addCode(d.call(o+"_copy",d.getLocal("first"),K),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff1"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("pBuff2"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.call(c,d.getLocal("idx2"),K,k),d.call(e+"_copy",d.getLocal("idx1"),L),d.call(e+"_add",L,k,d.getLocal("idx1")),d.call(e+"_sub",L,k,d.getLocal("idx2")),d.call(o+"_mul",K,d.getLocal("inc"),K),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function Et(){const E=t.addFunction(n+"_fftJoinExt");E.addParam("pBuff1","i32"),E.addParam("pBuff2","i32"),E.addParam("n","i32"),E.addParam("first","i32"),E.addParam("inc","i32"),E.addParam("totalBits","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32"),E.addLocal("pShiftToM","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u));E.addCode(d.setLocal("pShiftToM",d.i32_add(d.i32_const(X),d.i32_mul(d.getLocal("totalBits"),d.i32_const(s)))),d.call(o+"_copy",d.getLocal("first"),K),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff1"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("pBuff2"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.call(e+"_add",d.getLocal("idx1"),d.getLocal("idx2"),k),d.call(c,d.getLocal("idx2"),d.getLocal("pShiftToM"),d.getLocal("idx2")),d.call(e+"_add",d.getLocal("idx1"),d.getLocal("idx2"),d.getLocal("idx2")),d.call(c,d.getLocal("idx2"),K,d.getLocal("idx2")),d.call(e+"_copy",k,d.getLocal("idx1")),d.call(o+"_mul",K,d.getLocal("inc"),K),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function Tt(){const E=t.addFunction(n+"_fftJoinExtInv");E.addParam("pBuff1","i32"),E.addParam("pBuff2","i32"),E.addParam("n","i32"),E.addParam("first","i32"),E.addParam("inc","i32"),E.addParam("totalBits","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32"),E.addLocal("pShiftToM","i32"),E.addLocal("pSConst","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u));E.addCode(d.setLocal("pShiftToM",d.i32_add(d.i32_const(X),d.i32_mul(d.getLocal("totalBits"),d.i32_const(s)))),d.setLocal("pSConst",d.i32_add(d.i32_const(J),d.i32_mul(d.getLocal("totalBits"),d.i32_const(s)))),d.call(o+"_copy",d.getLocal("first"),K),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff1"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("pBuff2"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.call(c,d.getLocal("idx2"),K,k),d.call(e+"_sub",d.getLocal("idx1"),k,d.getLocal("idx2")),d.call(c,d.getLocal("idx2"),d.getLocal("pSConst"),d.getLocal("idx2")),d.call(c,d.getLocal("idx1"),d.getLocal("pShiftToM"),d.getLocal("idx1")),d.call(e+"_sub",k,d.getLocal("idx1"),d.getLocal("idx1")),d.call(c,d.getLocal("idx1"),d.getLocal("pSConst"),d.getLocal("idx1")),d.call(o+"_mul",K,d.getLocal("inc"),K),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function Ft(){const E=t.addFunction(n+"_prepareLagrangeEvaluation");E.addParam("pBuff1","i32"),E.addParam("pBuff2","i32"),E.addParam("n","i32"),E.addParam("first","i32"),E.addParam("inc","i32"),E.addParam("totalBits","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32"),E.addLocal("pShiftToM","i32"),E.addLocal("pSConst","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u));E.addCode(d.setLocal("pShiftToM",d.i32_add(d.i32_const(X),d.i32_mul(d.getLocal("totalBits"),d.i32_const(s)))),d.setLocal("pSConst",d.i32_add(d.i32_const(J),d.i32_mul(d.getLocal("totalBits"),d.i32_const(s)))),d.call(o+"_copy",d.getLocal("first"),K),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("n"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff1"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("pBuff2"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.call(c,d.getLocal("idx1"),d.getLocal("pShiftToM"),k),d.call(e+"_sub",d.getLocal("idx2"),k,k),d.call(e+"_sub",d.getLocal("idx1"),d.getLocal("idx2"),d.getLocal("idx2")),d.call(c,k,d.getLocal("pSConst"),d.getLocal("idx1")),d.call(c,d.getLocal("idx2"),K,d.getLocal("idx2")),d.call(o+"_mul",K,d.getLocal("inc"),K),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function v(){const E=t.addFunction(n+"_fftMix");E.addParam("pBuff","i32"),E.addParam("n","i32"),E.addParam("exp","i32"),E.addLocal("nGroups","i32"),E.addLocal("nPerGroup","i32"),E.addLocal("nPerGroupDiv2","i32"),E.addLocal("pairOffset","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32"),E.addLocal("j","i32"),E.addLocal("pwm","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(s)),k=d.i32_const(t.alloc(u)),L=d.i32_const(t.alloc(u));E.addCode(d.setLocal("nPerGroup",d.i32_shl(d.i32_const(1),d.getLocal("exp"))),d.setLocal("nPerGroupDiv2",d.i32_shr_u(d.getLocal("nPerGroup"),d.i32_const(1))),d.setLocal("nGroups",d.i32_shr_u(d.getLocal("n"),d.getLocal("exp"))),d.setLocal("pairOffset",d.i32_mul(d.getLocal("nPerGroupDiv2"),d.i32_const(u))),d.setLocal("pwm",d.i32_add(d.i32_const(A),d.i32_mul(d.getLocal("exp"),d.i32_const(s)))),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("i"),d.getLocal("nGroups"))),d.call(o+"_one",K),d.setLocal("j",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_eq(d.getLocal("j"),d.getLocal("nPerGroupDiv2"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff"),d.i32_mul(d.i32_add(d.i32_mul(d.getLocal("i"),d.getLocal("nPerGroup")),d.getLocal("j")),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("idx1"),d.getLocal("pairOffset"))),d.call(c,d.getLocal("idx2"),K,k),d.call(e+"_copy",d.getLocal("idx1"),L),d.call(e+"_add",L,k,d.getLocal("idx1")),d.call(e+"_sub",L,k,d.getLocal("idx2")),d.call(o+"_mul",K,d.getLocal("pwm"),K),d.setLocal("j",d.i32_add(d.getLocal("j"),d.i32_const(1))),d.br(0))),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}function i(){const E=t.addFunction(n+"_fftFinal");E.addParam("pBuff","i32"),E.addParam("n","i32"),E.addParam("factor","i32"),E.addLocal("idx1","i32"),E.addLocal("idx2","i32"),E.addLocal("i","i32"),E.addLocal("ndiv2","i32");const d=E.getCodeBuilder(),K=d.i32_const(t.alloc(u));E.addCode(d.setLocal("ndiv2",d.i32_shr_u(d.getLocal("n"),d.i32_const(1))),d.if(d.i32_and(d.getLocal("n"),d.i32_const(1)),d.call(c,d.i32_add(d.getLocal("pBuff"),d.i32_mul(d.getLocal("ndiv2"),d.i32_const(u))),d.getLocal("factor"),d.i32_add(d.getLocal("pBuff"),d.i32_mul(d.getLocal("ndiv2"),d.i32_const(u))))),d.setLocal("i",d.i32_const(0)),d.block(d.loop(d.br_if(1,d.i32_ge_u(d.getLocal("i"),d.getLocal("ndiv2"))),d.setLocal("idx1",d.i32_add(d.getLocal("pBuff"),d.i32_mul(d.getLocal("i"),d.i32_const(u)))),d.setLocal("idx2",d.i32_add(d.getLocal("pBuff"),d.i32_mul(d.i32_sub(d.i32_sub(d.getLocal("n"),d.i32_const(1)),d.getLocal("i")),d.i32_const(u)))),d.call(c,d.getLocal("idx2"),d.getLocal("factor"),K),d.call(c,d.getLocal("idx1"),d.getLocal("factor"),d.getLocal("idx2")),d.call(e+"_copy",K,d.getLocal("idx1")),d.setLocal("i",d.i32_add(d.getLocal("i"),d.i32_const(1))),d.br(0))))}ot(),ut(),H(),st(),U(),W(),dt(),lt(),Et(),Tt(),v(),i(),Ft(),t.exportFunction(n+"_fft"),t.exportFunction(n+"_ifft"),t.exportFunction(n+"_rawfft"),t.exportFunction(n+"_fftJoin"),t.exportFunction(n+"_fftJoinExt"),t.exportFunction(n+"_fftJoinExtInv"),t.exportFunction(n+"_fftMix"),t.exportFunction(n+"_fftFinal"),t.exportFunction(n+"_prepareLagrangeEvaluation")},ma=function(t,n,e){const c=t.modules[e].n64*8;function f(){const b=t.addFunction(n+"_zero");b.addParam("px","i32"),b.addParam("n","i32"),b.addLocal("lastp","i32"),b.addLocal("p","i32");const u=b.getCodeBuilder();b.addCode(u.setLocal("p",u.getLocal("px")),u.setLocal("lastp",u.i32_add(u.getLocal("px"),u.i32_mul(u.getLocal("n"),u.i32_const(c)))),u.block(u.loop(u.br_if(1,u.i32_eq(u.getLocal("p"),u.getLocal("lastp"))),u.call(e+"_zero",u.getLocal("p")),u.setLocal("p",u.i32_add(u.getLocal("p"),u.i32_const(c))),u.br(0))))}function s(){const b=t.addFunction(n+"_constructLC");b.addParam("ppolynomials","i32"),b.addParam("psignals","i32"),b.addParam("nSignals","i32"),b.addParam("pres","i32"),b.addLocal("i","i32"),b.addLocal("j","i32"),b.addLocal("pp","i32"),b.addLocal("ps","i32"),b.addLocal("pd","i32"),b.addLocal("ncoefs","i32");const u=b.getCodeBuilder(),l=u.i32_const(t.alloc(c));b.addCode(u.setLocal("i",u.i32_const(0)),u.setLocal("pp",u.getLocal("ppolynomials")),u.setLocal("ps",u.getLocal("psignals")),u.block(u.loop(u.br_if(1,u.i32_eq(u.getLocal("i"),u.getLocal("nSignals"))),u.setLocal("ncoefs",u.i32_load(u.getLocal("pp"))),u.setLocal("pp",u.i32_add(u.getLocal("pp"),u.i32_const(4))),u.setLocal("j",u.i32_const(0)),u.block(u.loop(u.br_if(1,u.i32_eq(u.getLocal("j"),u.getLocal("ncoefs"))),u.setLocal("pd",u.i32_add(u.getLocal("pres"),u.i32_mul(u.i32_load(u.getLocal("pp")),u.i32_const(c)))),u.setLocal("pp",u.i32_add(u.getLocal("pp"),u.i32_const(4))),u.call(e+"_mul",u.getLocal("ps"),u.getLocal("pp"),l),u.call(e+"_add",l,u.getLocal("pd"),u.getLocal("pd")),u.setLocal("pp",u.i32_add(u.getLocal("pp"),u.i32_const(c))),u.setLocal("j",u.i32_add(u.getLocal("j"),u.i32_const(1))),u.br(0))),u.setLocal("ps",u.i32_add(u.getLocal("ps"),u.i32_const(c))),u.setLocal("i",u.i32_add(u.getLocal("i"),u.i32_const(1))),u.br(0))))}return f(),s(),t.exportFunction(n+"_zero"),t.exportFunction(n+"_constructLC"),n},ya=function(t,n,e){const c=t.modules[e].n64*8;function f(){const u=t.addFunction(n+"_buildABC");u.addParam("pCoefs","i32"),u.addParam("nCoefs","i32"),u.addParam("pWitness","i32"),u.addParam("pA","i32"),u.addParam("pB","i32"),u.addParam("pC","i32"),u.addParam("offsetOut","i32"),u.addParam("nOut","i32"),u.addParam("offsetWitness","i32"),u.addParam("nWitness","i32"),u.addLocal("it","i32"),u.addLocal("ita","i32"),u.addLocal("itb","i32"),u.addLocal("last","i32"),u.addLocal("m","i32"),u.addLocal("c","i32"),u.addLocal("s","i32"),u.addLocal("pOut","i32");const l=u.getCodeBuilder(),B=l.i32_const(t.alloc(c));u.addCode(l.setLocal("ita",l.getLocal("pA")),l.setLocal("itb",l.getLocal("pB")),l.setLocal("last",l.i32_add(l.getLocal("pA"),l.i32_mul(l.getLocal("nOut"),l.i32_const(c)))),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("ita"),l.getLocal("last"))),l.call(e+"_zero",l.getLocal("ita")),l.call(e+"_zero",l.getLocal("itb")),l.setLocal("ita",l.i32_add(l.getLocal("ita"),l.i32_const(c))),l.setLocal("itb",l.i32_add(l.getLocal("itb"),l.i32_const(c))),l.br(0))),l.setLocal("it",l.getLocal("pCoefs")),l.setLocal("last",l.i32_add(l.getLocal("pCoefs"),l.i32_mul(l.getLocal("nCoefs"),l.i32_const(c+12)))),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("it"),l.getLocal("last"))),l.setLocal("s",l.i32_load(l.getLocal("it"),8)),l.if(l.i32_or(l.i32_lt_u(l.getLocal("s"),l.getLocal("offsetWitness")),l.i32_ge_u(l.getLocal("s"),l.i32_add(l.getLocal("offsetWitness"),l.getLocal("nWitness")))),[...l.setLocal("it",l.i32_add(l.getLocal("it"),l.i32_const(c+12))),...l.br(1)]),l.setLocal("m",l.i32_load(l.getLocal("it"))),l.if(l.i32_eq(l.getLocal("m"),l.i32_const(0)),l.setLocal("pOut",l.getLocal("pA")),l.if(l.i32_eq(l.getLocal("m"),l.i32_const(1)),l.setLocal("pOut",l.getLocal("pB")),[...l.setLocal("it",l.i32_add(l.getLocal("it"),l.i32_const(c+12))),...l.br(1)])),l.setLocal("c",l.i32_load(l.getLocal("it"),4)),l.if(l.i32_or(l.i32_lt_u(l.getLocal("c"),l.getLocal("offsetOut")),l.i32_ge_u(l.getLocal("c"),l.i32_add(l.getLocal("offsetOut"),l.getLocal("nOut")))),[...l.setLocal("it",l.i32_add(l.getLocal("it"),l.i32_const(c+12))),...l.br(1)]),l.setLocal("pOut",l.i32_add(l.getLocal("pOut"),l.i32_mul(l.i32_sub(l.getLocal("c"),l.getLocal("offsetOut")),l.i32_const(c)))),l.call(e+"_mul",l.i32_add(l.getLocal("pWitness"),l.i32_mul(l.i32_sub(l.getLocal("s"),l.getLocal("offsetWitness")),l.i32_const(c))),l.i32_add(l.getLocal("it"),l.i32_const(12)),B),l.call(e+"_add",l.getLocal("pOut"),B,l.getLocal("pOut")),l.setLocal("it",l.i32_add(l.getLocal("it"),l.i32_const(c+12))),l.br(0))),l.setLocal("ita",l.getLocal("pA")),l.setLocal("itb",l.getLocal("pB")),l.setLocal("it",l.getLocal("pC")),l.setLocal("last",l.i32_add(l.getLocal("pA"),l.i32_mul(l.getLocal("nOut"),l.i32_const(c)))),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("ita"),l.getLocal("last"))),l.call(e+"_mul",l.getLocal("ita"),l.getLocal("itb"),l.getLocal("it")),l.setLocal("ita",l.i32_add(l.getLocal("ita"),l.i32_const(c))),l.setLocal("itb",l.i32_add(l.getLocal("itb"),l.i32_const(c))),l.setLocal("it",l.i32_add(l.getLocal("it"),l.i32_const(c))),l.br(0))))}function s(){const u=t.addFunction(n+"_joinABC");u.addParam("pA","i32"),u.addParam("pB","i32"),u.addParam("pC","i32"),u.addParam("n","i32"),u.addParam("pP","i32"),u.addLocal("ita","i32"),u.addLocal("itb","i32"),u.addLocal("itc","i32"),u.addLocal("itp","i32"),u.addLocal("last","i32");const l=u.getCodeBuilder(),B=l.i32_const(t.alloc(c));u.addCode(l.setLocal("ita",l.getLocal("pA")),l.setLocal("itb",l.getLocal("pB")),l.setLocal("itc",l.getLocal("pC")),l.setLocal("itp",l.getLocal("pP")),l.setLocal("last",l.i32_add(l.getLocal("pA"),l.i32_mul(l.getLocal("n"),l.i32_const(c)))),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("ita"),l.getLocal("last"))),l.call(e+"_mul",l.getLocal("ita"),l.getLocal("itb"),B),l.call(e+"_sub",B,l.getLocal("itc"),l.getLocal("itp")),l.setLocal("ita",l.i32_add(l.getLocal("ita"),l.i32_const(c))),l.setLocal("itb",l.i32_add(l.getLocal("itb"),l.i32_const(c))),l.setLocal("itc",l.i32_add(l.getLocal("itc"),l.i32_const(c))),l.setLocal("itp",l.i32_add(l.getLocal("itp"),l.i32_const(c))),l.br(0))))}function b(){const u=t.addFunction(n+"_batchAdd");u.addParam("pa","i32"),u.addParam("pb","i32"),u.addParam("n","i32"),u.addParam("pr","i32"),u.addLocal("ita","i32"),u.addLocal("itb","i32"),u.addLocal("itr","i32"),u.addLocal("last","i32");const l=u.getCodeBuilder();u.addCode(l.setLocal("ita",l.getLocal("pa")),l.setLocal("itb",l.getLocal("pb")),l.setLocal("itr",l.getLocal("pr")),l.setLocal("last",l.i32_add(l.getLocal("pa"),l.i32_mul(l.getLocal("n"),l.i32_const(c)))),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("ita"),l.getLocal("last"))),l.call(e+"_add",l.getLocal("ita"),l.getLocal("itb"),l.getLocal("itr")),l.setLocal("ita",l.i32_add(l.getLocal("ita"),l.i32_const(c))),l.setLocal("itb",l.i32_add(l.getLocal("itb"),l.i32_const(c))),l.setLocal("itr",l.i32_add(l.getLocal("itr"),l.i32_const(c))),l.br(0))))}return f(),s(),b(),t.exportFunction(n+"_buildABC"),t.exportFunction(n+"_joinABC"),t.exportFunction(n+"_batchAdd"),n},ba=function(t,n,e,o,c,f,s,b){const u=t.addFunction(n);u.addParam("pIn","i32"),u.addParam("n","i32"),u.addParam("pFirst","i32"),u.addParam("pInc","i32"),u.addParam("pOut","i32"),u.addLocal("pOldFree","i32"),u.addLocal("i","i32"),u.addLocal("pFrom","i32"),u.addLocal("pTo","i32");const l=u.getCodeBuilder(),B=l.i32_const(t.alloc(s));u.addCode(l.setLocal("pFrom",l.getLocal("pIn")),l.setLocal("pTo",l.getLocal("pOut"))),u.addCode(l.call(o+"_copy",l.getLocal("pFirst"),B)),u.addCode(l.setLocal("i",l.i32_const(0)),l.block(l.loop(l.br_if(1,l.i32_eq(l.getLocal("i"),l.getLocal("n"))),l.call(b,l.getLocal("pFrom"),B,l.getLocal("pTo")),l.setLocal("pFrom",l.i32_add(l.getLocal("pFrom"),l.i32_const(c))),l.setLocal("pTo",l.i32_add(l.getLocal("pTo"),l.i32_const(f))),l.call(o+"_mul",B,l.getLocal("pInc"),B),l.setLocal("i",l.i32_add(l.getLocal("i"),l.i32_const(1))),l.br(0)))),t.exportFunction(n)};const qt=xn,_c=oo,gc=ga,wo=fa,fc=pa,Bo=ha,Se=La,pc=ma,hc=ya,Gn=ba,{bitLength:Lc,modInv:mc,isOdd:xo,isNegative:yc}=Jt;var bc=function(t,n){const e=n||"bn128";if(t.modules[e])return e;const o=21888242871839275222246405745257275088696311157297823662689037894645226208583n,c=21888242871839275222246405745257275088548364400416034343698204186575808495617n,f=Math.floor((Lc(o-1n)-1)/64)+1,s=f*8,b=s,u=s,l=u*2,B=u*12,x=t.alloc(qt.bigInt2BytesLE(c,b)),y=_c(t,o,"f1m");gc(t,c,"fr","frm");const $=t.alloc(qt.bigInt2BytesLE(M(3n),u)),R=Bo(t,"g1m","f1m",$);Se(t,"frm","frm","frm","frm_mul"),pc(t,"pol","frm"),hc(t,"qap","frm");const I=wo(t,"f1m_neg","f2m","f1m"),G=t.alloc([...qt.bigInt2BytesLE(M(19485874751759354771024239261021720505790618469301721065564631296452457478373n),u),...qt.bigInt2BytesLE(M(266929791119991161246907387137283842545076965332900288569378510910307636690n),u)]),A=Bo(t,"g2m","f2m",G);function Q(P,r){const g=t.addFunction(P);g.addParam("pG","i32"),g.addParam("pFr","i32"),g.addParam("pr","i32");const T=g.getCodeBuilder(),N=T.i32_const(t.alloc(s));g.addCode(T.call("frm_fromMontgomery",T.getLocal("pFr"),N),T.call(r,T.getLocal("pG"),N,T.i32_const(s),T.getLocal("pr"))),t.exportFunction(P)}Q("g1m_timesFr","g1m_timesScalar"),Se(t,"g1m","g1m","frm","g1m_timesFr"),Q("g2m_timesFr","g2m_timesScalar"),Se(t,"g2m","g2m","frm","g2m_timesFr"),Q("g1m_timesFrAffine","g1m_timesScalarAffine"),Q("g2m_timesFrAffine","g2m_timesScalarAffine"),Gn(t,"frm_batchApplyKey","fmr","frm",s,s,s,"frm_mul"),Gn(t,"g1m_batchApplyKey","g1m","frm",s*3,s*3,s,"g1m_timesFr"),Gn(t,"g1m_batchApplyKeyMixed","g1m","frm",s*2,s*3,s,"g1m_timesFrAffine"),Gn(t,"g2m_batchApplyKey","g2m","frm",s*2*3,s*3*2,s,"g2m_timesFr"),Gn(t,"g2m_batchApplyKeyMixed","g2m","frm",s*2*2,s*3*2,s,"g2m_timesFrAffine");function M(P){return BigInt(P)*(1n<<BigInt(u*8))%o}const ct=[1n,2n,1n],C=t.alloc([...qt.bigInt2BytesLE(M(ct[0]),u),...qt.bigInt2BytesLE(M(ct[1]),u),...qt.bigInt2BytesLE(M(ct[2]),u)]),_=[0n,1n,0n],h=t.alloc([...qt.bigInt2BytesLE(M(_[0]),u),...qt.bigInt2BytesLE(M(_[1]),u),...qt.bigInt2BytesLE(M(_[2]),u)]),X=[[10857046999023057135944570762232829481370756359578518086990519993285655852781n,11559732032986387107991004021392285783925812861821192530917403151452391805634n],[8495653923123431417604973247489272438418190587263600148770280649306958101930n,4082367875863433681332203403145435568316851327593401208105741076214120093531n],[1n,0n]],J=t.alloc([...qt.bigInt2BytesLE(M(X[0][0]),u),...qt.bigInt2BytesLE(M(X[0][1]),u),...qt.bigInt2BytesLE(M(X[1][0]),u),...qt.bigInt2BytesLE(M(X[1][1]),u),...qt.bigInt2BytesLE(M(X[2][0]),u),...qt.bigInt2BytesLE(M(X[2][1]),u)]),nt=[[0n,0n],[1n,0n],[0n,0n]],O=t.alloc([...qt.bigInt2BytesLE(M(nt[0][0]),u),...qt.bigInt2BytesLE(M(nt[0][1]),u),...qt.bigInt2BytesLE(M(nt[1][0]),u),...qt.bigInt2BytesLE(M(nt[1][1]),u),...qt.bigInt2BytesLE(M(nt[2][0]),u),...qt.bigInt2BytesLE(M(nt[2][1]),u)]),w=t.alloc([...qt.bigInt2BytesLE(M(1),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u),...qt.bigInt2BytesLE(M(0),u)]),U=t.alloc([...qt.bigInt2BytesLE(M(9),u),...qt.bigInt2BytesLE(M(1),u)]),W=t.alloc([...qt.bigInt2BytesLE(M(mc(2n,o)),u),...qt.bigInt2BytesLE(0n,u)]),dt=U,st=t.alloc([...qt.bigInt2BytesLE(M(19485874751759354771024239261021720505790618469301721065564631296452457478373n),u),...qt.bigInt2BytesLE(M(266929791119991161246907387137283842545076965332900288569378510910307636690n),u)]);function H(){const P=t.addFunction(e+"_mulNR6");P.addParam("x","i32"),P.addParam("pr","i32");const r=P.getCodeBuilder();P.addCode(r.call(I+"_mul",r.i32_const(U),r.getLocal("x"),r.getLocal("pr")))}H();const ut=fc(t,e+"_mulNR6","f6m","f2m");function ot(){const P=t.addFunction(e+"_mulNR12");P.addParam("x","i32"),P.addParam("pr","i32");const r=P.getCodeBuilder();P.addCode(r.call(I+"_mul",r.i32_const(U),r.i32_add(r.getLocal("x"),r.i32_const(s*4)),r.getLocal("pr")),r.call(I+"_copy",r.getLocal("x"),r.i32_add(r.getLocal("pr"),r.i32_const(s*2))),r.call(I+"_copy",r.i32_add(r.getLocal("x"),r.i32_const(s*2)),r.i32_add(r.getLocal("pr"),r.i32_const(s*4))))}ot();const lt=wo(t,e+"_mulNR12","ftm",ut),Tt=pt(29793968203157093288n),Ft=t.alloc(Tt),v=3*l,i=Tt.length-1,d=Tt.reduce((P,r)=>P+(r!=0?1:0),0)+i+1,K=3*2*s,k=3*s*2+d*v;t.modules[e]={n64:f,pG1gen:C,pG1zero:h,pG1b:$,pG2gen:J,pG2zero:O,pG2b:G,pq:t.modules.f1m.pq,pr:x,pOneT:w,prePSize:K,preQSize:k,r:c.toString(),q:o.toString()};const L=4965661367192848881n;function et(P){let r=P;const g=[];for(;r>0n;){if(xo(r)){const T=2-Number(r%4n);g.push(T),r=r-BigInt(T)}else g.push(0);r=r>>1n}return g}function pt(P){let r=P;const g=[];for(;r>0n;)xo(r)?g.push(1):g.push(0),r=r>>1n;return g}function gt(){const P=t.addFunction(e+"_prepareG1");P.addParam("pP","i32"),P.addParam("ppreP","i32");const r=P.getCodeBuilder();P.addCode(r.call(R+"_normalize",r.getLocal("pP"),r.getLocal("ppreP")))}function ht(){const P=t.addFunction(e+"_prepAddStep");P.addParam("pQ","i32"),P.addParam("pR","i32"),P.addParam("pCoef","i32");const r=P.getCodeBuilder(),g=r.getLocal("pQ"),T=r.i32_add(r.getLocal("pQ"),r.i32_const(l)),N=r.getLocal("pR"),q=r.i32_add(r.getLocal("pR"),r.i32_const(l)),V=r.i32_add(r.getLocal("pR"),r.i32_const(2*l)),j=r.getLocal("pCoef"),tt=r.i32_add(r.getLocal("pCoef"),r.i32_const(l)),at=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*l)),it=tt,Y=r.i32_const(t.alloc(l)),rt=r.i32_const(t.alloc(l)),wt=r.i32_const(t.alloc(l)),yt=r.i32_const(t.alloc(l)),_t=r.i32_const(t.alloc(l)),At=r.i32_const(t.alloc(l)),vt=r.i32_const(t.alloc(l));P.addCode(r.call(I+"_mul",g,V,it),r.call(I+"_sub",N,it,it),r.call(I+"_mul",T,V,Y),r.call(I+"_sub",q,Y,Y),r.call(I+"_square",it,rt),r.call(I+"_square",Y,wt),r.call(I+"_mul",it,rt,yt),r.call(I+"_mul",N,rt,_t),r.call(I+"_add",_t,_t,vt),r.call(I+"_mul",V,wt,At),r.call(I+"_add",yt,At,At),r.call(I+"_sub",At,vt,At),r.call(I+"_mul",it,At,N),r.call(I+"_mul",yt,q,q),r.call(I+"_sub",_t,At,vt),r.call(I+"_mul",Y,vt,vt),r.call(I+"_sub",vt,q,q),r.call(I+"_mul",V,yt,V),r.call(I+"_mul",it,T,vt),r.call(I+"_mul",Y,g,j),r.call(I+"_sub",j,vt,j),r.call(I+"_mul",j,r.i32_const(dt),j),r.call(I+"_neg",Y,at))}function Ct(){const P=t.addFunction(e+"_prepDblStep");P.addParam("pR","i32"),P.addParam("pCoef","i32");const r=P.getCodeBuilder(),g=r.getLocal("pR"),T=r.i32_add(r.getLocal("pR"),r.i32_const(l)),N=r.i32_add(r.getLocal("pR"),r.i32_const(2*l)),q=r.getLocal("pCoef"),V=r.i32_add(r.getLocal("pCoef"),r.i32_const(l)),j=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*l)),tt=r.i32_const(t.alloc(l)),at=r.i32_const(t.alloc(l)),it=r.i32_const(t.alloc(l)),Y=r.i32_const(t.alloc(l)),rt=r.i32_const(t.alloc(l)),wt=r.i32_const(t.alloc(l)),yt=r.i32_const(t.alloc(l)),_t=r.i32_const(t.alloc(l)),At=r.i32_const(t.alloc(l)),vt=r.i32_const(t.alloc(l)),zt=r.i32_const(t.alloc(l)),St=r.i32_const(t.alloc(l));P.addCode(r.call(I+"_mul",T,r.i32_const(W),tt),r.call(I+"_mul",g,tt,tt),r.call(I+"_square",T,at),r.call(I+"_square",N,it),r.call(I+"_add",it,it,Y),r.call(I+"_add",Y,it,Y),r.call(I+"_mul",r.i32_const(st),Y,rt),r.call(I+"_add",rt,rt,wt),r.call(I+"_add",rt,wt,wt),r.call(I+"_add",at,wt,yt),r.call(I+"_mul",yt,r.i32_const(W),yt),r.call(I+"_add",at,it,St),r.call(I+"_add",T,N,_t),r.call(I+"_square",_t,_t),r.call(I+"_sub",_t,St,_t),r.call(I+"_sub",rt,at,At),r.call(I+"_square",g,vt),r.call(I+"_square",rt,zt),r.call(I+"_sub",at,wt,St),r.call(I+"_mul",tt,St,g),r.call(I+"_add",zt,zt,St),r.call(I+"_add",zt,St,St),r.call(I+"_square",yt,T),r.call(I+"_sub",T,St,T),r.call(I+"_mul",at,_t,N),r.call(I+"_mul",r.i32_const(dt),At,q),r.call(I+"_neg",_t,V),r.call(I+"_add",vt,vt,j),r.call(I+"_add",vt,j,j))}function Lt(){const P=t.addFunction(e+"_mulByQ");P.addParam("p1","i32"),P.addParam("pr","i32");const r=P.getCodeBuilder(),g=r.getLocal("p1"),T=r.i32_add(r.getLocal("p1"),r.i32_const(l)),N=r.i32_add(r.getLocal("p1"),r.i32_const(l*2)),q=r.getLocal("pr"),V=r.i32_add(r.getLocal("pr"),r.i32_const(l)),j=r.i32_add(r.getLocal("pr"),r.i32_const(l*2)),tt=r.i32_const(t.alloc([...qt.bigInt2BytesLE(M("21575463638280843010398324269430826099269044274347216827212613867836435027261"),u),...qt.bigInt2BytesLE(M("10307601595873709700152284273816112264069230130616436755625194854815875713954"),u)])),at=r.i32_const(t.alloc([...qt.bigInt2BytesLE(M("2821565182194536844548159561693502659359617185244120367078079554186484126554"),u),...qt.bigInt2BytesLE(M("3505843767911556378687030309984248845540243509899259641013678093033130930403"),u)]));P.addCode(r.call(I+"_conjugate",g,q),r.call(I+"_mul",tt,q,q),r.call(I+"_conjugate",T,V),r.call(I+"_mul",at,V,V),r.call(I+"_conjugate",N,j))}function xt(){Lt();const P=t.addFunction(e+"_prepareG2");P.addParam("pQ","i32"),P.addParam("ppreQ","i32"),P.addLocal("pCoef","i32"),P.addLocal("i","i32");const r=P.getCodeBuilder(),g=r.getLocal("pQ"),T=t.alloc(l*3),N=r.i32_const(T),q=r.i32_const(T),V=r.i32_const(T+l),j=r.i32_const(T+2*l),tt=r.i32_add(r.getLocal("ppreQ"),r.i32_const(0)),at=r.i32_add(r.getLocal("ppreQ"),r.i32_const(l)),it=t.alloc(l*3),Y=r.i32_const(it),rt=t.alloc(l*3),wt=r.i32_const(rt),yt=r.i32_const(rt+l);P.addCode(r.call(A+"_normalize",g,tt),r.call(I+"_copy",tt,q),r.call(I+"_copy",at,V),r.call(I+"_one",j)),P.addCode(r.setLocal("pCoef",r.i32_add(r.getLocal("ppreQ"),r.i32_const(l*3))),r.setLocal("i",r.i32_const(Tt.length-2)),r.block(r.loop(r.call(e+"_prepDblStep",N,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))),r.if(r.i32_load8_s(r.getLocal("i"),Ft),[...r.call(e+"_prepAddStep",tt,N,r.getLocal("pCoef")),...r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v)))]),r.br_if(1,r.i32_eqz(r.getLocal("i"))),r.setLocal("i",r.i32_sub(r.getLocal("i"),r.i32_const(1))),r.br(0)))),P.addCode(r.call(e+"_mulByQ",tt,Y),r.call(e+"_mulByQ",Y,wt)),P.addCode(r.call(I+"_neg",yt,yt),r.call(e+"_prepAddStep",Y,N,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))),r.call(e+"_prepAddStep",wt,N,r.getLocal("pCoef")),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))))}function Ut(){const P=t.addFunction(e+"__mulBy024Old");P.addParam("pEll0","i32"),P.addParam("pEllVW","i32"),P.addParam("pEllVV","i32"),P.addParam("pR","i32");const r=P.getCodeBuilder(),g=r.getLocal("pEll0"),T=r.getLocal("pEllVV"),N=r.getLocal("pEllVW"),q=r.getLocal("pR"),V=t.alloc(B),j=r.i32_const(V),tt=r.i32_const(V),at=r.i32_const(V+l),it=r.i32_const(V+l*2),Y=r.i32_const(V+l*3),rt=r.i32_const(V+l*4),wt=r.i32_const(V+l*5);P.addCode(r.call(I+"_copy",g,tt),r.call(I+"_zero",at),r.call(I+"_copy",T,it),r.call(I+"_zero",Y),r.call(I+"_copy",N,rt),r.call(I+"_zero",wt),r.call(lt+"_mul",j,q,q))}function mt(){const P=t.addFunction(e+"__mulBy024");P.addParam("pEll0","i32"),P.addParam("pEllVW","i32"),P.addParam("pEllVV","i32"),P.addParam("pR","i32");const r=P.getCodeBuilder(),g=r.getLocal("pEll0"),T=r.getLocal("pEllVV"),N=r.getLocal("pEllVW"),q=r.getLocal("pR"),V=r.i32_add(r.getLocal("pR"),r.i32_const(2*s)),j=r.i32_add(r.getLocal("pR"),r.i32_const(4*s)),tt=r.i32_add(r.getLocal("pR"),r.i32_const(6*s)),at=r.i32_add(r.getLocal("pR"),r.i32_const(8*s)),it=r.i32_add(r.getLocal("pR"),r.i32_const(10*s)),Y=r.i32_const(t.alloc(l)),rt=r.i32_const(t.alloc(l)),wt=r.i32_const(t.alloc(l)),yt=r.i32_const(t.alloc(l)),_t=r.i32_const(t.alloc(l)),At=r.i32_const(t.alloc(l)),vt=r.i32_const(t.alloc(l)),zt=r.i32_const(t.alloc(l)),St=r.i32_const(t.alloc(l)),Pt=r.i32_const(t.alloc(l)),Bt=r.i32_const(t.alloc(l));P.addCode(r.call(I+"_mul",q,g,vt),r.call(I+"_mul",j,T,zt),r.call(I+"_mul",at,N,St),r.call(I+"_add",q,at,wt),r.call(I+"_add",q,j,rt),r.call(I+"_add",V,tt,yt),r.call(I+"_add",yt,it,yt),r.call(I+"_mul",V,T,Pt),r.call(I+"_add",Pt,St,_t),r.call(I+"_mul",r.i32_const(U),_t,At),r.call(I+"_add",At,vt,q),r.call(I+"_mul",it,N,_t),r.call(I+"_add",Pt,_t,Pt),r.call(I+"_add",_t,zt,_t),r.call(I+"_mul",r.i32_const(U),_t,At),r.call(I+"_mul",V,g,_t),r.call(I+"_add",Pt,_t,Pt),r.call(I+"_add",At,_t,V),r.call(I+"_add",g,T,Y),r.call(I+"_mul",rt,Y,_t),r.call(I+"_add",vt,zt,Bt),r.call(I+"_sub",_t,Bt,_t),r.call(I+"_mul",tt,N,At),r.call(I+"_add",Pt,At,Pt),r.call(I+"_add",j,at,Y),r.call(I+"_add",_t,At,j),r.call(I+"_add",T,N,rt),r.call(I+"_mul",rt,Y,_t),r.call(I+"_add",zt,St,Bt),r.call(I+"_sub",_t,Bt,_t),r.call(I+"_mul",r.i32_const(U),_t,At),r.call(I+"_mul",tt,g,_t),r.call(I+"_add",Pt,_t,Pt),r.call(I+"_add",At,_t,tt),r.call(I+"_mul",it,T,_t),r.call(I+"_add",Pt,_t,Pt),r.call(I+"_mul",r.i32_const(U),_t,At),r.call(I+"_add",g,N,Y),r.call(I+"_mul",wt,Y,_t),r.call(I+"_add",vt,St,Bt),r.call(I+"_sub",_t,Bt,_t),r.call(I+"_add",At,_t,at),r.call(I+"_add",g,T,Y),r.call(I+"_add",Y,N,Y),r.call(I+"_mul",yt,Y,_t),r.call(I+"_sub",_t,Pt,it))}function ft(){const P=t.addFunction(e+"_millerLoop");P.addParam("ppreP","i32"),P.addParam("ppreQ","i32"),P.addParam("r","i32"),P.addLocal("pCoef","i32"),P.addLocal("i","i32");const r=P.getCodeBuilder(),g=r.getLocal("ppreP"),T=r.i32_add(r.getLocal("ppreP"),r.i32_const(u)),N=r.getLocal("pCoef"),q=r.i32_add(r.getLocal("pCoef"),r.i32_const(l)),V=r.i32_add(r.getLocal("pCoef"),r.i32_const(2*l)),j=t.alloc(l),tt=r.i32_const(j),at=t.alloc(l),it=r.i32_const(at),Y=r.getLocal("r");P.addCode(r.call(lt+"_one",Y),r.setLocal("pCoef",r.i32_add(r.getLocal("ppreQ"),r.i32_const(l*3))),r.setLocal("i",r.i32_const(Tt.length-2)),r.block(r.loop(r.call(lt+"_square",Y,Y),r.call(I+"_mul1",q,T,tt),r.call(I+"_mul1",V,g,it),r.call(e+"__mulBy024",N,tt,it,Y),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))),r.if(r.i32_load8_s(r.getLocal("i"),Ft),[...r.call(I+"_mul1",q,T,tt),...r.call(I+"_mul1",V,g,it),...r.call(e+"__mulBy024",N,tt,it,Y),...r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v)))]),r.br_if(1,r.i32_eqz(r.getLocal("i"))),r.setLocal("i",r.i32_sub(r.getLocal("i"),r.i32_const(1))),r.br(0)))),P.addCode(r.call(I+"_mul1",q,T,tt),r.call(I+"_mul1",V,g,it),r.call(e+"__mulBy024",N,tt,it,Y),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))),r.call(I+"_mul1",q,T,tt),r.call(I+"_mul1",V,g,it),r.call(e+"__mulBy024",N,tt,it,Y),r.setLocal("pCoef",r.i32_add(r.getLocal("pCoef"),r.i32_const(v))))}function bt(P){const r=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[8376118865763821496583973867626364092589906065868298776909617916018768340080n,16469823323077808223889137241176536799009286646108169935659301613961712198316n],[21888242871839275220042445260109153167277707414472061641714758635765020556617n,0n],[11697423496358154304825782922584725312912383441159505038794027105778954184319n,303847389135065887422783454877609941456349188919719272345083954437860409601n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[3321304630594332808241809054958361220322477375291206261884409189760185844239n,5722266937896532885780051958958348231143373700109372999374820235121374419868n],[21888242871839275222246405745257275088696311157297823662689037894645226208582n,0n],[13512124006075453725662431877630910996106405091429524885779419978626457868503n,5418419548761466998357268504080738289687024511189653727029736280683514010267n],[2203960485148121921418603742825762020974279258880205651966n,0n],[10190819375481120917420622822672549775783927716138318623895010788866272024264n,21584395482704209334823622290379665147239961968378104390343953940207365798982n],[2203960485148121921418603742825762020974279258880205651967n,0n],[18566938241244942414004596690298913868373833782006617400804628704885040364344n,16165975933942742336466353786298926857552937457188450663314217659523851788715n]]],g=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[21575463638280843010398324269430826099269044274347216827212613867836435027261n,10307601595873709700152284273816112264069230130616436755625194854815875713954n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[3772000881919853776433695186713858239009073593817195771773381919316419345261n,2236595495967245188281701248203181795121068902605861227855261137820944008926n],[2203960485148121921418603742825762020974279258880205651966n,0n],[18429021223477853657660792034369865839114504446431234726392080002137598044644n,9344045779998320333812420223237981029506012124075525679208581902008406485703n]],[[1n,0n],[2581911344467009335267311115468803099551665605076196740867805258568234346338n,19937756971775647987995932169929341994314640652964949448313374472400716661030n],[2203960485148121921418603742825762020974279258880205651966n,0n],[5324479202449903542726783395506214481928257762400643279780343368557297135718n,16208900380737693084919495127334387981393726419856888799917914180988844123039n],[21888242871839275220042445260109153167277707414472061641714758635765020556616n,0n],[13981852324922362344252311234282257507216387789820983642040889267519694726527n,7629828391165209371577384193250820201684255241773809077146787135900891633097n]]],T=t.addFunction(e+"__frobeniusMap"+P);T.addParam("x","i32"),T.addParam("r","i32");const N=T.getCodeBuilder();for(let V=0;V<6;V++){const j=V==0?N.getLocal("x"):N.i32_add(N.getLocal("x"),N.i32_const(V*l)),tt=j,at=N.i32_add(N.getLocal("x"),N.i32_const(V*l+u)),it=V==0?N.getLocal("r"):N.i32_add(N.getLocal("r"),N.i32_const(V*l)),Y=it,rt=N.i32_add(N.getLocal("r"),N.i32_const(V*l+u)),wt=q(r[Math.floor(V/3)][P%12],g[V%3][P%6]),yt=t.alloc([...qt.bigInt2BytesLE(M(wt[0]),32),...qt.bigInt2BytesLE(M(wt[1]),32)]);P%2==1?T.addCode(N.call(y+"_copy",tt,Y),N.call(y+"_neg",at,rt),N.call(I+"_mul",it,N.i32_const(yt),it)):T.addCode(N.call(I+"_mul",j,N.i32_const(yt),it))}function q(V,j){const tt=BigInt(V[0]),at=BigInt(V[1]),it=BigInt(j[0]),Y=BigInt(j[1]),rt=[(tt*it-at*Y)%o,(tt*Y+at*it)%o];return yc(rt[0])&&(rt[0]=rt[0]+o),rt}}function Mt(){const P=t.addFunction(e+"__finalExponentiationFirstChunk");P.addParam("x","i32"),P.addParam("r","i32");const r=P.getCodeBuilder(),g=r.getLocal("x"),T=g,N=r.i32_add(g,r.i32_const(s*6)),q=r.getLocal("r"),V=t.alloc(B),j=r.i32_const(V),tt=j,at=r.i32_const(V+s*6),it=r.i32_const(t.alloc(B)),Y=r.i32_const(t.alloc(B)),rt=r.i32_const(t.alloc(B));P.addCode(r.call(ut+"_copy",T,tt),r.call(ut+"_neg",N,at),r.call(lt+"_inverse",g,it),r.call(lt+"_mul",j,it,Y),r.call(e+"__frobeniusMap2",Y,rt),r.call(lt+"_mul",Y,rt,q))}function Wt(){const P=t.addFunction(e+"__cyclotomicSquare");P.addParam("x","i32"),P.addParam("r","i32");const r=P.getCodeBuilder(),g=r.getLocal("x"),T=r.i32_add(r.getLocal("x"),r.i32_const(l)),N=r.i32_add(r.getLocal("x"),r.i32_const(2*l)),q=r.i32_add(r.getLocal("x"),r.i32_const(3*l)),V=r.i32_add(r.getLocal("x"),r.i32_const(4*l)),j=r.i32_add(r.getLocal("x"),r.i32_const(5*l)),tt=r.getLocal("r"),at=r.i32_add(r.getLocal("r"),r.i32_const(l)),it=r.i32_add(r.getLocal("r"),r.i32_const(2*l)),Y=r.i32_add(r.getLocal("r"),r.i32_const(3*l)),rt=r.i32_add(r.getLocal("r"),r.i32_const(4*l)),wt=r.i32_add(r.getLocal("r"),r.i32_const(5*l)),yt=r.i32_const(t.alloc(l)),_t=r.i32_const(t.alloc(l)),At=r.i32_const(t.alloc(l)),vt=r.i32_const(t.alloc(l)),zt=r.i32_const(t.alloc(l)),St=r.i32_const(t.alloc(l)),Pt=r.i32_const(t.alloc(l)),Bt=r.i32_const(t.alloc(l));P.addCode(r.call(I+"_mul",g,V,Pt),r.call(I+"_mul",V,r.i32_const(U),yt),r.call(I+"_add",g,yt,yt),r.call(I+"_add",g,V,Bt),r.call(I+"_mul",Bt,yt,yt),r.call(I+"_mul",r.i32_const(U),Pt,Bt),r.call(I+"_add",Pt,Bt,Bt),r.call(I+"_sub",yt,Bt,yt),r.call(I+"_add",Pt,Pt,_t),r.call(I+"_mul",q,N,Pt),r.call(I+"_mul",N,r.i32_const(U),At),r.call(I+"_add",q,At,At),r.call(I+"_add",q,N,Bt),r.call(I+"_mul",Bt,At,At),r.call(I+"_mul",r.i32_const(U),Pt,Bt),r.call(I+"_add",Pt,Bt,Bt),r.call(I+"_sub",At,Bt,At),r.call(I+"_add",Pt,Pt,vt),r.call(I+"_mul",T,j,Pt),r.call(I+"_mul",j,r.i32_const(U),zt),r.call(I+"_add",T,zt,zt),r.call(I+"_add",T,j,Bt),r.call(I+"_mul",Bt,zt,zt),r.call(I+"_mul",r.i32_const(U),Pt,Bt),r.call(I+"_add",Pt,Bt,Bt),r.call(I+"_sub",zt,Bt,zt),r.call(I+"_add",Pt,Pt,St),r.call(I+"_sub",yt,g,tt),r.call(I+"_add",tt,tt,tt),r.call(I+"_add",yt,tt,tt),r.call(I+"_add",_t,V,rt),r.call(I+"_add",rt,rt,rt),r.call(I+"_add",_t,rt,rt),r.call(I+"_mul",St,r.i32_const(dt),Bt),r.call(I+"_add",Bt,q,Y),r.call(I+"_add",Y,Y,Y),r.call(I+"_add",Bt,Y,Y),r.call(I+"_sub",zt,N,it),r.call(I+"_add",it,it,it),r.call(I+"_add",zt,it,it),r.call(I+"_sub",At,T,at),r.call(I+"_add",at,at,at),r.call(I+"_add",At,at,at),r.call(I+"_add",vt,j,wt),r.call(I+"_add",wt,wt,wt),r.call(I+"_add",vt,wt,wt))}function Dt(P,r){const g=et(P).map(at=>at==-1?255:at),T=t.alloc(g),N=t.addFunction(e+"__cyclotomicExp_"+r);N.addParam("x","i32"),N.addParam("r","i32"),N.addLocal("bit","i32"),N.addLocal("i","i32");const q=N.getCodeBuilder(),V=q.getLocal("x"),j=q.getLocal("r"),tt=q.i32_const(t.alloc(B));N.addCode(q.call(lt+"_conjugate",V,tt),q.call(lt+"_one",j),q.if(q.teeLocal("bit",q.i32_load8_s(q.i32_const(g.length-1),T)),q.if(q.i32_eq(q.getLocal("bit"),q.i32_const(1)),q.call(lt+"_mul",j,V,j),q.call(lt+"_mul",j,tt,j))),q.setLocal("i",q.i32_const(g.length-2)),q.block(q.loop(q.call(e+"__cyclotomicSquare",j,j),q.if(q.teeLocal("bit",q.i32_load8_s(q.getLocal("i"),T)),q.if(q.i32_eq(q.getLocal("bit"),q.i32_const(1)),q.call(lt+"_mul",j,V,j),q.call(lt+"_mul",j,tt,j))),q.br_if(1,q.i32_eqz(q.getLocal("i"))),q.setLocal("i",q.i32_sub(q.getLocal("i"),q.i32_const(1))),q.br(0))))}function Qt(){Wt(),Dt(L,"w0");const P=t.addFunction(e+"__finalExponentiationLastChunk");P.addParam("x","i32"),P.addParam("r","i32");const r=P.getCodeBuilder(),g=r.getLocal("x"),T=r.getLocal("r"),N=r.i32_const(t.alloc(B)),q=r.i32_const(t.alloc(B)),V=r.i32_const(t.alloc(B)),j=r.i32_const(t.alloc(B)),tt=r.i32_const(t.alloc(B)),at=r.i32_const(t.alloc(B)),it=r.i32_const(t.alloc(B)),Y=r.i32_const(t.alloc(B)),rt=r.i32_const(t.alloc(B)),wt=r.i32_const(t.alloc(B)),yt=r.i32_const(t.alloc(B)),_t=r.i32_const(t.alloc(B)),At=r.i32_const(t.alloc(B)),vt=r.i32_const(t.alloc(B)),zt=r.i32_const(t.alloc(B)),St=r.i32_const(t.alloc(B)),Pt=r.i32_const(t.alloc(B)),Bt=r.i32_const(t.alloc(B)),$t=r.i32_const(t.alloc(B)),en=r.i32_const(t.alloc(B)),mn=r.i32_const(t.alloc(B));P.addCode(r.call(e+"__cyclotomicExp_w0",g,N),r.call(lt+"_conjugate",N,N),r.call(e+"__cyclotomicSquare",N,q),r.call(e+"__cyclotomicSquare",q,V),r.call(lt+"_mul",V,q,j),r.call(e+"__cyclotomicExp_w0",j,tt),r.call(lt+"_conjugate",tt,tt),r.call(e+"__cyclotomicSquare",tt,at),r.call(e+"__cyclotomicExp_w0",at,it),r.call(lt+"_conjugate",it,it),r.call(lt+"_conjugate",j,Y),r.call(lt+"_conjugate",it,rt),r.call(lt+"_mul",rt,tt,wt),r.call(lt+"_mul",wt,Y,yt),r.call(lt+"_mul",yt,q,_t),r.call(lt+"_mul",yt,tt,At),r.call(lt+"_mul",At,g,vt),r.call(e+"__frobeniusMap1",_t,zt),r.call(lt+"_mul",zt,vt,St),r.call(e+"__frobeniusMap2",yt,Pt),r.call(lt+"_mul",Pt,St,Bt),r.call(lt+"_conjugate",g,$t),r.call(lt+"_mul",$t,_t,en),r.call(e+"__frobeniusMap3",en,mn),r.call(lt+"_mul",mn,Bt,T))}function F(){Mt(),Qt();const P=t.addFunction(e+"_finalExponentiation");P.addParam("x","i32"),P.addParam("r","i32");const r=P.getCodeBuilder(),g=r.getLocal("x"),T=r.getLocal("r"),N=r.i32_const(t.alloc(B));P.addCode(r.call(e+"__finalExponentiationFirstChunk",g,N),r.call(e+"__finalExponentiationLastChunk",N,T))}function p(){const P=t.addFunction(e+"_finalExponentiationOld");P.addParam("x","i32"),P.addParam("r","i32");const g=t.alloc(qt.bigInt2BytesLE(552484233613224096312617126783173147097382103762957654188882734314196910839907541213974502761540629817009608548654680343627701153829446747810907373256841551006201639677726139946029199968412598804882391702273019083653272047566316584365559776493027495458238373902875937659943504873220554161550525926302303331747463515644711876653177129578303191095900909191624817826566688241804408081892785725967931714097716709526092261278071952560171111444072049229123565057483750161460024353346284167282452756217662335528813519139808291170539072125381230815729071544861602750936964829313608137325426383735122175229541155376346436093930287402089517426973178917569713384748081827255472576937471496195752727188261435633271238710131736096299798168852925540549342330775279877006784354801422249722573783561685179618816480037695005515426162362431072245638324744480n,352)),T=P.getCodeBuilder();P.addCode(T.call(lt+"_exp",T.getLocal("x"),T.i32_const(g),T.i32_const(352),T.getLocal("r")))}const m=t.alloc(K),S=t.alloc(k);function z(P){const r=t.addFunction(e+"_pairingEq"+P);for(let q=0;q<P;q++)r.addParam("p_"+q,"i32"),r.addParam("q_"+q,"i32");r.addParam("c","i32"),r.setReturnType("i32");const g=r.getCodeBuilder(),T=g.i32_const(t.alloc(B)),N=g.i32_const(t.alloc(B));r.addCode(g.call(lt+"_one",T));for(let q=0;q<P;q++)r.addCode(g.call(e+"_prepareG1",g.getLocal("p_"+q),g.i32_const(m))),r.addCode(g.call(e+"_prepareG2",g.getLocal("q_"+q),g.i32_const(S))),r.addCode(g.call(e+"_millerLoop",g.i32_const(m),g.i32_const(S),N)),r.addCode(g.call(lt+"_mul",T,N,T));r.addCode(g.call(e+"_finalExponentiation",T,T)),r.addCode(g.call(lt+"_eq",T,g.getLocal("c")))}function Z(){const P=t.addFunction(e+"_pairing");P.addParam("p","i32"),P.addParam("q","i32"),P.addParam("r","i32");const r=P.getCodeBuilder(),g=r.i32_const(t.alloc(B));P.addCode(r.call(e+"_prepareG1",r.getLocal("p"),r.i32_const(m))),P.addCode(r.call(e+"_prepareG2",r.getLocal("q"),r.i32_const(S))),P.addCode(r.call(e+"_millerLoop",r.i32_const(m),r.i32_const(S),g)),P.addCode(r.call(e+"_finalExponentiation",g,r.getLocal("r")))}ht(),Ct(),gt(),xt(),mt(),Ut(),ft();for(let P=0;P<10;P++)bt(P),t.exportFunction(e+"__frobeniusMap"+P);p(),F();for(let P=1;P<=5;P++)z(P),t.exportFunction(e+"_pairingEq"+P);Z(),t.exportFunction(e+"_pairing"),t.exportFunction(e+"_prepareG1"),t.exportFunction(e+"_prepareG2"),t.exportFunction(e+"_millerLoop"),t.exportFunction(e+"_finalExponentiation"),t.exportFunction(e+"_finalExponentiationOld"),t.exportFunction(e+"__mulBy024"),t.exportFunction(e+"__mulBy024Old"),t.exportFunction(e+"__cyclotomicSquare"),t.exportFunction(e+"__cyclotomicExp_w0")};const Ot=xn,wc=oo,Bc=ga,Fo=fa,xc=pa,Co=ha,ve=La,Fc=ma,Cc=ya,Wn=ba,{bitLength:Ao,isOdd:Io,isNegative:Ac}=Jt;var Ic=function(t,n){const e=n||"bls12381";if(t.modules[e])return e;const o=0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaabn,c=0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001n,f=Math.floor((Ao(o-1n)-1)/64)+1,s=f*8,b=s,u=b*2,l=b*12,B=Math.floor((Ao(c-1n)-1)/64)+1,x=B*8,y=x,$=t.alloc(Ot.bigInt2BytesLE(c,y)),R=wc(t,o,"f1m","intq");Bc(t,c,"fr","frm","intr");const I=t.alloc(Ot.bigInt2BytesLE(C(4n),b)),G=Co(t,"g1m","f1m",I);ve(t,"frm","frm","frm","frm_mul"),Fc(t,"pol","frm"),Cc(t,"qap","frm");const A=Fo(t,"f1m_neg","f2m","f1m"),Q=t.alloc([...Ot.bigInt2BytesLE(C(4n),b),...Ot.bigInt2BytesLE(C(4n),b)]),M=Co(t,"g2m","f2m",Q);function ct(r,g){const T=t.addFunction(r);T.addParam("pG","i32"),T.addParam("pFr","i32"),T.addParam("pr","i32");const N=T.getCodeBuilder(),q=N.i32_const(t.alloc(x));T.addCode(N.call("frm_fromMontgomery",N.getLocal("pFr"),q),N.call(g,N.getLocal("pG"),q,N.i32_const(x),N.getLocal("pr"))),t.exportFunction(r)}ct("g1m_timesFr","g1m_timesScalar"),ve(t,"g1m","g1m","frm","g1m_timesFr"),ct("g2m_timesFr","g2m_timesScalar"),ve(t,"g2m","g2m","frm","g2m_timesFr"),ct("g1m_timesFrAffine","g1m_timesScalarAffine"),ct("g2m_timesFrAffine","g2m_timesScalarAffine"),Wn(t,"frm_batchApplyKey","fmr","frm",x,x,x,"frm_mul"),Wn(t,"g1m_batchApplyKey","g1m","frm",s*3,s*3,x,"g1m_timesFr"),Wn(t,"g1m_batchApplyKeyMixed","g1m","frm",s*2,s*3,x,"g1m_timesFrAffine"),Wn(t,"g2m_batchApplyKey","g2m","frm",s*2*3,s*3*2,x,"g2m_timesFr"),Wn(t,"g2m_batchApplyKeyMixed","g2m","frm",s*2*2,s*3*2,x,"g2m_timesFrAffine");function C(r){return BigInt(r)*(1n<<BigInt(b*8))%o}const _=[3685416753713387016781088315183077757961620795782546409894578378688607592378376318836054947676345821548104185464507n,1339506544944476473020471379941921221584933875938349620426543736416511423956333506472724655353366534992391756441569n,1n],h=t.alloc([...Ot.bigInt2BytesLE(C(_[0]),b),...Ot.bigInt2BytesLE(C(_[1]),b),...Ot.bigInt2BytesLE(C(_[2]),b)]),X=[0n,1n,0n],J=t.alloc([...Ot.bigInt2BytesLE(C(X[0]),b),...Ot.bigInt2BytesLE(C(X[1]),b),...Ot.bigInt2BytesLE(C(X[2]),b)]),nt=[[352701069587466618187139116011060144890029952792775240219908644239793785735715026873347600343865175952761926303160n,3059144344244213709971259814753781636986470325476647558659373206291635324768958432433509563104347017837885763365758n],[1985150602287291935568054521177171638300868978215655730859378665066344726373823718423869104263333984641494340347905n,927553665492332455747201965776037880757740193453592970025027978793976877002675564980949289727957565575433344219582n],[1n,0n]],O=t.alloc([...Ot.bigInt2BytesLE(C(nt[0][0]),b),...Ot.bigInt2BytesLE(C(nt[0][1]),b),...Ot.bigInt2BytesLE(C(nt[1][0]),b),...Ot.bigInt2BytesLE(C(nt[1][1]),b),...Ot.bigInt2BytesLE(C(nt[2][0]),b),...Ot.bigInt2BytesLE(C(nt[2][1]),b)]),w=[[0n,0n],[1n,0n],[0n,0n]],U=t.alloc([...Ot.bigInt2BytesLE(C(w[0][0]),b),...Ot.bigInt2BytesLE(C(w[0][1]),b),...Ot.bigInt2BytesLE(C(w[1][0]),b),...Ot.bigInt2BytesLE(C(w[1][1]),b),...Ot.bigInt2BytesLE(C(w[2][0]),b),...Ot.bigInt2BytesLE(C(w[2][1]),b)]),W=t.alloc([...Ot.bigInt2BytesLE(C(1n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b),...Ot.bigInt2BytesLE(C(0n),b)]),dt=t.alloc([...Ot.bigInt2BytesLE(C(1n),b),...Ot.bigInt2BytesLE(C(1n),b)]);function st(){const r=t.addFunction(A+"_mulNR");r.addParam("x","i32"),r.addParam("pr","i32");const g=r.getCodeBuilder(),T=g.i32_const(t.alloc(b)),N=g.getLocal("x"),q=g.i32_add(g.getLocal("x"),g.i32_const(b)),V=g.getLocal("pr"),j=g.i32_add(g.getLocal("pr"),g.i32_const(b));r.addCode(g.call(R+"_copy",N,T),g.call(R+"_sub",N,q,V),g.call(R+"_add",T,q,j))}st();const H=xc(t,A+"_mulNR","f6m","f2m");function ut(){const r=t.addFunction(H+"_mulNR");r.addParam("x","i32"),r.addParam("pr","i32");const g=r.getCodeBuilder(),T=g.i32_const(t.alloc(b*2));r.addCode(g.call(A+"_copy",g.getLocal("x"),T),g.call(A+"_mulNR",g.i32_add(g.getLocal("x"),g.i32_const(s*4)),g.getLocal("pr")),g.call(A+"_copy",g.i32_add(g.getLocal("x"),g.i32_const(s*2)),g.i32_add(g.getLocal("pr"),g.i32_const(s*4))),g.call(A+"_copy",T,g.i32_add(g.getLocal("pr"),g.i32_const(s*2))))}ut();const ot=Fo(t,H+"_mulNR","ftm",H),Et=pt(0xd201000000010000n),Tt=t.alloc(Et),Ft=3*u,v=Et.length-1,E=Et.reduce((r,g)=>r+(g!=0?1:0),0)+v+1,d=3*2*s,K=3*s*2+E*Ft,k=!0,L=15132376222941642752n;t.modules[e]={n64q:f,n64r:B,n8q:s,n8r:x,pG1gen:h,pG1zero:J,pG1b:I,pG2gen:O,pG2zero:U,pG2b:Q,pq:t.modules.f1m.pq,pr:$,pOneT:W,r:c,q:o,prePSize:d,preQSize:K};function et(r){let g=r;const T=[];for(;g>0n;){if(Io(g)){const N=2-Number(g%4n);T.push(N),g=g-BigInt(N)}else T.push(0);g=g>>1n}return T}function pt(r){let g=r;const T=[];for(;g>0n;)Io(g)?T.push(1):T.push(0),g=g>>1n;return T}function gt(){const r=t.addFunction(e+"_prepareG1");r.addParam("pP","i32"),r.addParam("ppreP","i32");const g=r.getCodeBuilder();r.addCode(g.call(G+"_normalize",g.getLocal("pP"),g.getLocal("ppreP")))}function ht(){const r=t.addFunction(e+"_prepDblStep");r.addParam("R","i32"),r.addParam("r","i32");const g=r.getCodeBuilder(),T=g.getLocal("R"),N=g.i32_add(g.getLocal("R"),g.i32_const(2*s)),q=g.i32_add(g.getLocal("R"),g.i32_const(4*s)),V=g.getLocal("r"),j=g.i32_add(g.getLocal("r"),g.i32_const(2*s)),tt=g.i32_add(g.getLocal("r"),g.i32_const(4*s)),at=g.i32_const(t.alloc(u)),it=g.i32_const(t.alloc(u)),Y=g.i32_const(t.alloc(u)),rt=g.i32_const(t.alloc(u)),wt=g.i32_const(t.alloc(u));r.addCode(g.call(A+"_square",T,V),g.call(A+"_square",N,it),g.call(A+"_square",it,Y),g.call(A+"_add",it,T,j),g.call(A+"_square",j,j),g.call(A+"_sub",j,V,j),g.call(A+"_sub",j,Y,j),g.call(A+"_add",j,j,j),g.call(A+"_add",V,V,rt),g.call(A+"_add",rt,V,rt),g.call(A+"_add",T,rt,tt),g.call(A+"_square",rt,wt),g.call(A+"_square",q,at),g.call(A+"_sub",wt,j,T),g.call(A+"_sub",T,j,T),g.call(A+"_add",q,N,q),g.call(A+"_square",q,q),g.call(A+"_sub",q,it,q),g.call(A+"_sub",q,at,q),g.call(A+"_sub",j,T,N),g.call(A+"_mul",N,rt,N),g.call(A+"_add",Y,Y,Y),g.call(A+"_add",Y,Y,Y),g.call(A+"_add",Y,Y,Y),g.call(A+"_sub",N,Y,N),g.call(A+"_mul",rt,at,j),g.call(A+"_add",j,j,j),g.call(A+"_neg",j,j),g.call(A+"_square",tt,tt),g.call(A+"_sub",tt,V,tt),g.call(A+"_sub",tt,wt,tt),g.call(A+"_add",it,it,it),g.call(A+"_add",it,it,it),g.call(A+"_sub",tt,it,tt),g.call(A+"_mul",q,at,V),g.call(A+"_add",V,V,V))}function Ct(){const r=t.addFunction(e+"_prepAddStep");r.addParam("R","i32"),r.addParam("Q","i32"),r.addParam("r","i32");const g=r.getCodeBuilder(),T=g.getLocal("R"),N=g.i32_add(g.getLocal("R"),g.i32_const(2*s)),q=g.i32_add(g.getLocal("R"),g.i32_const(4*s)),V=g.getLocal("Q"),j=g.i32_add(g.getLocal("Q"),g.i32_const(2*s)),tt=g.getLocal("r"),at=g.i32_add(g.getLocal("r"),g.i32_const(2*s)),it=g.i32_add(g.getLocal("r"),g.i32_const(4*s)),Y=g.i32_const(t.alloc(u)),rt=g.i32_const(t.alloc(u)),wt=g.i32_const(t.alloc(u)),yt=g.i32_const(t.alloc(u)),_t=g.i32_const(t.alloc(u)),At=g.i32_const(t.alloc(u)),vt=g.i32_const(t.alloc(u)),zt=g.i32_const(t.alloc(u)),St=g.i32_const(t.alloc(u)),Pt=g.i32_const(t.alloc(u)),Bt=g.i32_const(t.alloc(u));r.addCode(g.call(A+"_square",q,Y),g.call(A+"_square",j,rt),g.call(A+"_mul",Y,V,yt),g.call(A+"_add",j,q,at),g.call(A+"_square",at,at),g.call(A+"_sub",at,rt,at),g.call(A+"_sub",at,Y,at),g.call(A+"_mul",at,Y,at),g.call(A+"_sub",yt,T,_t),g.call(A+"_square",_t,At),g.call(A+"_add",At,At,vt),g.call(A+"_add",vt,vt,vt),g.call(A+"_mul",vt,_t,zt),g.call(A+"_sub",at,N,St),g.call(A+"_sub",St,N,St),g.call(A+"_mul",St,V,it),g.call(A+"_mul",vt,T,Pt),g.call(A+"_square",St,T),g.call(A+"_sub",T,zt,T),g.call(A+"_sub",T,Pt,T),g.call(A+"_sub",T,Pt,T),g.call(A+"_add",q,_t,q),g.call(A+"_square",q,q),g.call(A+"_sub",q,Y,q),g.call(A+"_sub",q,At,q),g.call(A+"_add",j,q,tt),g.call(A+"_sub",Pt,T,Bt),g.call(A+"_mul",Bt,St,Bt),g.call(A+"_mul",N,zt,yt),g.call(A+"_add",yt,yt,yt),g.call(A+"_sub",Bt,yt,N),g.call(A+"_square",tt,tt),g.call(A+"_sub",tt,rt,tt),g.call(A+"_square",q,wt),g.call(A+"_sub",tt,wt,tt),g.call(A+"_add",it,it,it),g.call(A+"_sub",it,tt,it),g.call(A+"_add",q,q,tt),g.call(A+"_neg",St,St),g.call(A+"_add",St,St,at))}function Lt(){const r=t.addFunction(e+"_prepareG2");r.addParam("pQ","i32"),r.addParam("ppreQ","i32"),r.addLocal("pCoef","i32"),r.addLocal("i","i32");const g=r.getCodeBuilder(),T=g.getLocal("pQ"),N=t.alloc(u*3),q=g.i32_const(N),V=g.getLocal("ppreQ");r.addCode(g.call(M+"_normalize",T,V),g.if(g.call(M+"_isZero",V),g.ret([])),g.call(M+"_copy",V,q),g.setLocal("pCoef",g.i32_add(g.getLocal("ppreQ"),g.i32_const(u*3)))),r.addCode(g.setLocal("i",g.i32_const(Et.length-2)),g.block(g.loop(g.call(e+"_prepDblStep",q,g.getLocal("pCoef")),g.setLocal("pCoef",g.i32_add(g.getLocal("pCoef"),g.i32_const(Ft))),g.if(g.i32_load8_s(g.getLocal("i"),Tt),[...g.call(e+"_prepAddStep",q,V,g.getLocal("pCoef")),...g.setLocal("pCoef",g.i32_add(g.getLocal("pCoef"),g.i32_const(Ft)))]),g.br_if(1,g.i32_eqz(g.getLocal("i"))),g.setLocal("i",g.i32_sub(g.getLocal("i"),g.i32_const(1))),g.br(0))))}function xt(){const r=t.addFunction(H+"_mul1");r.addParam("pA","i32"),r.addParam("pC1","i32"),r.addParam("pR","i32");const g=r.getCodeBuilder(),T=g.getLocal("pA"),N=g.i32_add(g.getLocal("pA"),g.i32_const(b*2)),q=g.i32_add(g.getLocal("pA"),g.i32_const(b*4)),V=g.getLocal("pC1"),j=g.getLocal("pR"),tt=g.i32_add(g.getLocal("pR"),g.i32_const(b*2)),at=g.i32_add(g.getLocal("pR"),g.i32_const(b*4)),it=g.i32_const(t.alloc(b*2)),Y=g.i32_const(t.alloc(b*2));r.addCode(g.call(A+"_add",T,N,it),g.call(A+"_add",N,q,Y),g.call(A+"_mul",N,V,at),g.call(A+"_mul",Y,V,j),g.call(A+"_sub",j,at,j),g.call(A+"_mulNR",j,j),g.call(A+"_mul",it,V,tt),g.call(A+"_sub",tt,at,tt))}xt();function Ut(){const r=t.addFunction(H+"_mul01");r.addParam("pA","i32"),r.addParam("pC0","i32"),r.addParam("pC1","i32"),r.addParam("pR","i32");const g=r.getCodeBuilder(),T=g.getLocal("pA"),N=g.i32_add(g.getLocal("pA"),g.i32_const(b*2)),q=g.i32_add(g.getLocal("pA"),g.i32_const(b*4)),V=g.getLocal("pC0"),j=g.getLocal("pC1"),tt=g.getLocal("pR"),at=g.i32_add(g.getLocal("pR"),g.i32_const(b*2)),it=g.i32_add(g.getLocal("pR"),g.i32_const(b*4)),Y=g.i32_const(t.alloc(b*2)),rt=g.i32_const(t.alloc(b*2)),wt=g.i32_const(t.alloc(b*2)),yt=g.i32_const(t.alloc(b*2));r.addCode(g.call(A+"_mul",T,V,Y),g.call(A+"_mul",N,j,rt),g.call(A+"_add",T,N,wt),g.call(A+"_add",T,q,yt),g.call(A+"_add",N,q,tt),g.call(A+"_mul",tt,j,tt),g.call(A+"_sub",tt,rt,tt),g.call(A+"_mulNR",tt,tt),g.call(A+"_add",tt,Y,tt),g.call(A+"_add",V,j,at),g.call(A+"_mul",at,wt,at),g.call(A+"_sub",at,Y,at),g.call(A+"_sub",at,rt,at),g.call(A+"_mul",yt,V,it),g.call(A+"_sub",it,Y,it),g.call(A+"_add",it,rt,it))}Ut();function mt(){const r=t.addFunction(ot+"_mul014");r.addParam("pA","i32"),r.addParam("pC0","i32"),r.addParam("pC1","i32"),r.addParam("pC4","i32"),r.addParam("pR","i32");const g=r.getCodeBuilder(),T=g.getLocal("pA"),N=g.i32_add(g.getLocal("pA"),g.i32_const(b*6)),q=g.getLocal("pC0"),V=g.getLocal("pC1"),j=g.getLocal("pC4"),tt=g.i32_const(t.alloc(b*6)),at=g.i32_const(t.alloc(b*6)),it=g.i32_const(t.alloc(b*2)),Y=g.getLocal("pR"),rt=g.i32_add(g.getLocal("pR"),g.i32_const(b*6));r.addCode(g.call(H+"_mul01",T,q,V,tt),g.call(H+"_mul1",N,j,at),g.call(A+"_add",V,j,it),g.call(H+"_add",N,T,rt),g.call(H+"_mul01",rt,q,it,rt),g.call(H+"_sub",rt,tt,rt),g.call(H+"_sub",rt,at,rt),g.call(H+"_copy",at,Y),g.call(H+"_mulNR",Y,Y),g.call(H+"_add",Y,tt,Y))}mt();function ft(){const r=t.addFunction(e+"_ell");r.addParam("pP","i32"),r.addParam("pCoefs","i32"),r.addParam("pF","i32");const g=r.getCodeBuilder(),T=g.getLocal("pP"),N=g.i32_add(g.getLocal("pP"),g.i32_const(s)),q=g.getLocal("pF"),V=g.getLocal("pCoefs"),j=g.i32_add(g.getLocal("pCoefs"),g.i32_const(b)),tt=g.i32_add(g.getLocal("pCoefs"),g.i32_const(b*2)),at=g.i32_add(g.getLocal("pCoefs"),g.i32_const(b*3)),it=g.i32_add(g.getLocal("pCoefs"),g.i32_const(b*4)),Y=t.alloc(b*2),rt=g.i32_const(Y),wt=g.i32_const(Y),yt=g.i32_const(Y+b),_t=t.alloc(b*2),At=g.i32_const(_t),vt=g.i32_const(_t),zt=g.i32_const(_t+b);r.addCode(g.call(R+"_mul",V,N,wt),g.call(R+"_mul",j,N,yt),g.call(R+"_mul",tt,T,vt),g.call(R+"_mul",at,T,zt),g.call(ot+"_mul014",q,it,At,rt,q))}ft();function bt(){const r=t.addFunction(e+"_millerLoop");r.addParam("ppreP","i32"),r.addParam("ppreQ","i32"),r.addParam("r","i32"),r.addLocal("pCoef","i32"),r.addLocal("i","i32");const g=r.getCodeBuilder(),T=g.getLocal("ppreP"),N=g.getLocal("pCoef"),q=g.getLocal("r");r.addCode(g.call(ot+"_one",q),g.if(g.call(G+"_isZero",T),g.ret([])),g.if(g.call(G+"_isZero",g.getLocal("ppreQ")),g.ret([])),g.setLocal("pCoef",g.i32_add(g.getLocal("ppreQ"),g.i32_const(u*3))),g.setLocal("i",g.i32_const(Et.length-2)),g.block(g.loop(g.call(e+"_ell",T,N,q),g.setLocal("pCoef",g.i32_add(g.getLocal("pCoef"),g.i32_const(Ft))),g.if(g.i32_load8_s(g.getLocal("i"),Tt),[...g.call(e+"_ell",T,N,q),...g.setLocal("pCoef",g.i32_add(g.getLocal("pCoef"),g.i32_const(Ft)))]),g.call(ot+"_square",q,q),g.br_if(1,g.i32_eq(g.getLocal("i"),g.i32_const(1))),g.setLocal("i",g.i32_sub(g.getLocal("i"),g.i32_const(1))),g.br(0))),g.call(e+"_ell",T,N,q)),r.addCode(g.call(ot+"_conjugate",q,q))}function Mt(r){const g=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[3850754370037169011952147076051364057158807420970682438676050522613628423219637725072182697113062777891589506424760n,151655185184498381465642749684540099398075398968325446656007613510403227271200139370504932015952886146304766135027n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620351n,0n],[2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n,1028732146235106349975324479215795277384839936929757896155643118032610843298655225875571310552543014690878354869257n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[3125332594171059424908108096204648978570118281977575435832422631601824034463382777937621250592425535493320683825557n,877076961050607968509681729531255177986764537961432449499635504522207616027455086505066378536590128544573588734230n],[4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559786n,0n],[151655185184498381465642749684540099398075398968325446656007613510403227271200139370504932015952886146304766135027n,3850754370037169011952147076051364057158807420970682438676050522613628423219637725072182697113062777891589506424760n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[1028732146235106349975324479215795277384839936929757896155643118032610843298655225875571310552543014690878354869257n,2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939437n,0n],[877076961050607968509681729531255177986764537961432449499635504522207616027455086505066378536590128544573588734230n,3125332594171059424908108096204648978570118281977575435832422631601824034463382777937621250592425535493320683825557n]]],T=[[[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n],[1n,0n]],[[1n,0n],[0n,4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[0n,1n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[0n,793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n]],[[1n,0n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939437n,0n],[4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,0n],[4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559786n,0n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,0n],[793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620351n,0n]]],N=t.addFunction(ot+"_frobeniusMap"+r);N.addParam("x","i32"),N.addParam("r","i32");const q=N.getCodeBuilder();for(let j=0;j<6;j++){const tt=j==0?q.getLocal("x"):q.i32_add(q.getLocal("x"),q.i32_const(j*u)),at=tt,it=q.i32_add(q.getLocal("x"),q.i32_const(j*u+b)),Y=j==0?q.getLocal("r"):q.i32_add(q.getLocal("r"),q.i32_const(j*u)),rt=Y,wt=q.i32_add(q.getLocal("r"),q.i32_const(j*u+b)),yt=V(g[Math.floor(j/3)][r%12],T[j%3][r%6]),_t=t.alloc([...Ot.bigInt2BytesLE(C(yt[0]),s),...Ot.bigInt2BytesLE(C(yt[1]),s)]);r%2==1?N.addCode(q.call(R+"_copy",at,rt),q.call(R+"_neg",it,wt),q.call(A+"_mul",Y,q.i32_const(_t),Y)):N.addCode(q.call(A+"_mul",tt,q.i32_const(_t),Y))}function V(j,tt){const at=j[0],it=j[1],Y=tt[0],rt=tt[1],wt=[(at*Y-it*rt)%o,(at*rt+it*Y)%o];return Ac(wt[0])&&(wt[0]=wt[0]+o),wt}}function Wt(){const r=t.addFunction(e+"__cyclotomicSquare");r.addParam("x","i32"),r.addParam("r","i32");const g=r.getCodeBuilder(),T=g.getLocal("x"),N=g.i32_add(g.getLocal("x"),g.i32_const(u)),q=g.i32_add(g.getLocal("x"),g.i32_const(2*u)),V=g.i32_add(g.getLocal("x"),g.i32_const(3*u)),j=g.i32_add(g.getLocal("x"),g.i32_const(4*u)),tt=g.i32_add(g.getLocal("x"),g.i32_const(5*u)),at=g.getLocal("r"),it=g.i32_add(g.getLocal("r"),g.i32_const(u)),Y=g.i32_add(g.getLocal("r"),g.i32_const(2*u)),rt=g.i32_add(g.getLocal("r"),g.i32_const(3*u)),wt=g.i32_add(g.getLocal("r"),g.i32_const(4*u)),yt=g.i32_add(g.getLocal("r"),g.i32_const(5*u)),_t=g.i32_const(t.alloc(u)),At=g.i32_const(t.alloc(u)),vt=g.i32_const(t.alloc(u)),zt=g.i32_const(t.alloc(u)),St=g.i32_const(t.alloc(u)),Pt=g.i32_const(t.alloc(u)),Bt=g.i32_const(t.alloc(u)),$t=g.i32_const(t.alloc(u));r.addCode(g.call(A+"_mul",T,j,Bt),g.call(A+"_mulNR",j,_t),g.call(A+"_add",T,_t,_t),g.call(A+"_add",T,j,$t),g.call(A+"_mul",$t,_t,_t),g.call(A+"_mulNR",Bt,$t),g.call(A+"_add",Bt,$t,$t),g.call(A+"_sub",_t,$t,_t),g.call(A+"_add",Bt,Bt,At),g.call(A+"_mul",V,q,Bt),g.call(A+"_mulNR",q,vt),g.call(A+"_add",V,vt,vt),g.call(A+"_add",V,q,$t),g.call(A+"_mul",$t,vt,vt),g.call(A+"_mulNR",Bt,$t),g.call(A+"_add",Bt,$t,$t),g.call(A+"_sub",vt,$t,vt),g.call(A+"_add",Bt,Bt,zt),g.call(A+"_mul",N,tt,Bt),g.call(A+"_mulNR",tt,St),g.call(A+"_add",N,St,St),g.call(A+"_add",N,tt,$t),g.call(A+"_mul",$t,St,St),g.call(A+"_mulNR",Bt,$t),g.call(A+"_add",Bt,$t,$t),g.call(A+"_sub",St,$t,St),g.call(A+"_add",Bt,Bt,Pt),g.call(A+"_sub",_t,T,at),g.call(A+"_add",at,at,at),g.call(A+"_add",_t,at,at),g.call(A+"_add",At,j,wt),g.call(A+"_add",wt,wt,wt),g.call(A+"_add",At,wt,wt),g.call(A+"_mul",Pt,g.i32_const(dt),$t),g.call(A+"_add",$t,V,rt),g.call(A+"_add",rt,rt,rt),g.call(A+"_add",$t,rt,rt),g.call(A+"_sub",St,q,Y),g.call(A+"_add",Y,Y,Y),g.call(A+"_add",St,Y,Y),g.call(A+"_sub",vt,N,it),g.call(A+"_add",it,it,it),g.call(A+"_add",vt,it,it),g.call(A+"_add",zt,tt,yt),g.call(A+"_add",yt,yt,yt),g.call(A+"_add",zt,yt,yt))}function Dt(r,g,T){const N=et(r).map(Y=>Y==-1?255:Y),q=t.alloc(N),V=t.addFunction(e+"__cyclotomicExp_"+T);V.addParam("x","i32"),V.addParam("r","i32"),V.addLocal("bit","i32"),V.addLocal("i","i32");const j=V.getCodeBuilder(),tt=j.getLocal("x"),at=j.getLocal("r"),it=j.i32_const(t.alloc(l));V.addCode(j.call(ot+"_conjugate",tt,it),j.call(ot+"_one",at),j.if(j.teeLocal("bit",j.i32_load8_s(j.i32_const(N.length-1),q)),j.if(j.i32_eq(j.getLocal("bit"),j.i32_const(1)),j.call(ot+"_mul",at,tt,at),j.call(ot+"_mul",at,it,at))),j.setLocal("i",j.i32_const(N.length-2)),j.block(j.loop(j.call(e+"__cyclotomicSquare",at,at),j.if(j.teeLocal("bit",j.i32_load8_s(j.getLocal("i"),q)),j.if(j.i32_eq(j.getLocal("bit"),j.i32_const(1)),j.call(ot+"_mul",at,tt,at),j.call(ot+"_mul",at,it,at))),j.br_if(1,j.i32_eqz(j.getLocal("i"))),j.setLocal("i",j.i32_sub(j.getLocal("i"),j.i32_const(1))),j.br(0)))),V.addCode(j.call(ot+"_conjugate",at,at))}function Qt(){Wt(),Dt(L,k,"w0");const r=t.addFunction(e+"_finalExponentiation");r.addParam("x","i32"),r.addParam("r","i32");const g=r.getCodeBuilder(),T=g.getLocal("x"),N=g.getLocal("r"),q=g.i32_const(t.alloc(l)),V=g.i32_const(t.alloc(l)),j=g.i32_const(t.alloc(l)),tt=g.i32_const(t.alloc(l)),at=g.i32_const(t.alloc(l)),it=g.i32_const(t.alloc(l)),Y=g.i32_const(t.alloc(l));r.addCode(g.call(ot+"_frobeniusMap6",T,q),g.call(ot+"_inverse",T,V),g.call(ot+"_mul",q,V,j),g.call(ot+"_copy",j,V),g.call(ot+"_frobeniusMap2",j,j),g.call(ot+"_mul",j,V,j),g.call(e+"__cyclotomicSquare",j,V),g.call(ot+"_conjugate",V,V),g.call(e+"__cyclotomicExp_w0",j,tt),g.call(e+"__cyclotomicSquare",tt,at),g.call(ot+"_mul",V,tt,it),g.call(e+"__cyclotomicExp_w0",it,V),g.call(e+"__cyclotomicExp_w0",V,q),g.call(e+"__cyclotomicExp_w0",q,Y),g.call(ot+"_mul",Y,at,Y),g.call(e+"__cyclotomicExp_w0",Y,at),g.call(ot+"_conjugate",it,it),g.call(ot+"_mul",at,it,at),g.call(ot+"_mul",at,j,at),g.call(ot+"_conjugate",j,it),g.call(ot+"_mul",V,j,V),g.call(ot+"_frobeniusMap3",V,V),g.call(ot+"_mul",Y,it,Y),g.call(ot+"_frobeniusMap1",Y,Y),g.call(ot+"_mul",tt,q,tt),g.call(ot+"_frobeniusMap2",tt,tt),g.call(ot+"_mul",tt,V,tt),g.call(ot+"_mul",tt,Y,tt),g.call(ot+"_mul",tt,at,N))}function F(){const r=t.addFunction(e+"_finalExponentiationOld");r.addParam("x","i32"),r.addParam("r","i32");const T=t.alloc(Ot.bigInt2BytesLE(322277361516934140462891564586510139908379969514828494218366688025288661041104682794998680497580008899973249814104447692778988208376779573819485263026159588510513834876303014016798809919343532899164848730280942609956670917565618115867287399623286813270357901731510188149934363360381614501334086825442271920079363289954510565375378443704372994881406797882676971082200626541916413184642520269678897559532260949334760604962086348898118982248842634379637598665468817769075878555493752214492790122785850202957575200176084204422751485957336465472324810982833638490904279282696134323072515220044451592646885410572234451732790590013479358343841220074174848221722017083597872017638514103174122784843925578370430843522959600095676285723737049438346544753168912974976791528535276317256904336520179281145394686565050419250614107803233314658825463117900250701199181529205942363159325765991819433914303908860460720581408201373164047773794825411011922305820065611121544561808414055302212057471395719432072209245600258134364584636810093520285711072578721435517884103526483832733289802426157301542744476740008494780363354305116978805620671467071400711358839553375340724899735460480144599782014906586543813292157922220645089192130209334926661588737007768565838519456601560804957985667880395221049249803753582637708560n,544)),N=r.getCodeBuilder();r.addCode(N.call(ot+"_exp",N.getLocal("x"),N.i32_const(T),N.i32_const(544),N.getLocal("r")))}const p=t.alloc(d),m=t.alloc(K);function S(r){const g=t.addFunction(e+"_pairingEq"+r);for(let V=0;V<r;V++)g.addParam("p_"+V,"i32"),g.addParam("q_"+V,"i32");g.addParam("c","i32"),g.setReturnType("i32");const T=g.getCodeBuilder(),N=T.i32_const(t.alloc(l)),q=T.i32_const(t.alloc(l));g.addCode(T.call(ot+"_one",N));for(let V=0;V<r;V++)g.addCode(T.call(e+"_prepareG1",T.getLocal("p_"+V),T.i32_const(p))),g.addCode(T.call(e+"_prepareG2",T.getLocal("q_"+V),T.i32_const(m))),g.addCode(T.if(T.i32_eqz(T.call(G+"_inGroupAffine",T.i32_const(p))),T.ret(T.i32_const(0))),T.if(T.i32_eqz(T.call(M+"_inGroupAffine",T.i32_const(m))),T.ret(T.i32_const(0)))),g.addCode(T.call(e+"_millerLoop",T.i32_const(p),T.i32_const(m),q)),g.addCode(T.call(ot+"_mul",N,q,N));g.addCode(T.call(e+"_finalExponentiation",N,N)),g.addCode(T.call(ot+"_eq",N,T.getLocal("c")))}function z(){const r=t.addFunction(e+"_pairing");r.addParam("p","i32"),r.addParam("q","i32"),r.addParam("r","i32");const g=r.getCodeBuilder(),T=g.i32_const(t.alloc(l));r.addCode(g.call(e+"_prepareG1",g.getLocal("p"),g.i32_const(p))),r.addCode(g.call(e+"_prepareG2",g.getLocal("q"),g.i32_const(m))),r.addCode(g.call(e+"_millerLoop",g.i32_const(p),g.i32_const(m),T)),r.addCode(g.call(e+"_finalExponentiation",T,g.getLocal("r")))}function Z(){const r=t.addFunction(M+"_inGroupAffine");r.addParam("p","i32"),r.setReturnType("i32");const g=r.getCodeBuilder(),T=[2001204777610833696708894912867952078278441409969503942666029068062015825245418932221343814564507832018947136279894n,2001204777610833696708894912867952078278441409969503942666029068062015825245418932221343814564507832018947136279893n],N=4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,q=[2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n,2973677408986561043442465346520108879172042883009249989176415018091420807192182638567116318576472649347015917690530n],V=g.i32_const(t.alloc([...Ot.bigInt2BytesLE(C(T[0]),s),...Ot.bigInt2BytesLE(C(T[1]),s)])),j=g.i32_const(t.alloc(Ot.bigInt2BytesLE(C(N),s))),tt=g.i32_const(t.alloc([...Ot.bigInt2BytesLE(C(q[0]),s),...Ot.bigInt2BytesLE(C(q[1]),s)])),at=g.i32_const(t.alloc(Ot.bigInt2BytesLE(L,8))),it=g.getLocal("p"),Y=g.i32_add(g.getLocal("p"),g.i32_const(u)),rt=g.i32_const(t.alloc(b)),wt=g.i32_const(t.alloc(u)),yt=g.i32_const(t.alloc(u)),_t=t.alloc(u*2),At=g.i32_const(_t),vt=g.i32_const(_t),zt=g.i32_const(_t),St=g.i32_const(_t+b),Pt=g.i32_const(_t+u),Bt=g.i32_const(_t+u),$t=g.i32_const(_t+u+b),en=t.alloc(u*3),mn=g.i32_const(en),Qa=g.i32_const(en),be=g.i32_const(en),we=g.i32_const(en+b),Ha=g.i32_const(en+u),Be=g.i32_const(en+u),xe=g.i32_const(en+u+b),Ja=g.i32_const(en+u*2);r.addCode(g.if(g.call(M+"_isZeroAffine",g.getLocal("p")),g.ret(g.i32_const(1))),g.if(g.i32_eqz(g.call(M+"_inCurveAffine",g.getLocal("p"))),g.ret(g.i32_const(0))),g.call(A+"_mul",it,V,wt),g.call(A+"_mul",Y,V,yt),g.call(A+"_mul1",wt,j,vt),g.call(A+"_neg",yt,Pt),g.call(A+"_neg",wt,Qa),g.call(A+"_mul",yt,tt,Ha),g.call(R+"_sub",zt,St,rt),g.call(R+"_add",zt,St,St),g.call(R+"_copy",rt,zt),g.call(R+"_sub",Bt,$t,rt),g.call(R+"_add",Bt,$t,$t),g.call(R+"_copy",rt,Bt),g.call(R+"_add",be,we,rt),g.call(R+"_sub",be,we,we),g.call(R+"_copy",rt,be),g.call(R+"_sub",xe,Be,rt),g.call(R+"_add",Be,xe,xe),g.call(R+"_copy",rt,Be),g.call(A+"_one",Ja),g.call(M+"_timesScalar",mn,at,g.i32_const(8),mn),g.call(M+"_addMixed",mn,At,mn),g.ret(g.call(M+"_eqMixed",mn,g.getLocal("p"))));const oe=t.addFunction(M+"_inGroup");oe.addParam("pIn","i32"),oe.setReturnType("i32");const Rn=oe.getCodeBuilder(),ro=Rn.i32_const(t.alloc(u*2));oe.addCode(Rn.call(M+"_toAffine",Rn.getLocal("pIn"),ro),Rn.ret(Rn.call(M+"_inGroupAffine",ro)))}function P(){const r=t.addFunction(G+"_inGroupAffine");r.addParam("p","i32"),r.setReturnType("i32");const g=r.getCodeBuilder(),T=4002409555221667392624310435006688643935503118305586438271171395842971157480381377015405980053539358417135540939436n,N=793479390729215512621379701633421447060886740281060493010456487427281649075476305620758731620350n,q=(L*L-1n)/3n,V=g.i32_const(t.alloc(Ot.bigInt2BytesLE(C(T),s))),j=g.i32_const(t.alloc(Ot.bigInt2BytesLE(C(N),s))),tt=g.i32_const(t.alloc(Ot.bigInt2BytesLE(q,16))),at=g.getLocal("p"),it=g.i32_add(g.getLocal("p"),g.i32_const(b)),Y=t.alloc(b*3),rt=g.i32_const(Y),wt=g.i32_const(Y),yt=g.i32_const(Y+b),_t=t.alloc(b*2),At=g.i32_const(_t),vt=g.i32_const(_t),zt=g.i32_const(_t+b);r.addCode(g.if(g.call(G+"_isZeroAffine",g.getLocal("p")),g.ret(g.i32_const(1))),g.if(g.i32_eqz(g.call(G+"_inCurveAffine",g.getLocal("p"))),g.ret(g.i32_const(0))),g.call(R+"_mul",at,V,wt),g.call(R+"_copy",it,yt),g.call(R+"_mul",at,j,vt),g.call(R+"_copy",it,zt),g.call(G+"_doubleAffine",rt,rt),g.call(G+"_subMixed",rt,g.getLocal("p"),rt),g.call(G+"_subMixed",rt,At,rt),g.call(G+"_timesScalar",rt,tt,g.i32_const(16),rt),g.ret(g.call(G+"_eqMixed",rt,At)));const St=t.addFunction(G+"_inGroup");St.addParam("pIn","i32"),St.setReturnType("i32");const Pt=St.getCodeBuilder(),Bt=Pt.i32_const(t.alloc(b*2));St.addCode(Pt.call(G+"_toAffine",Pt.getLocal("pIn"),Bt),Pt.ret(Pt.call(G+"_inGroupAffine",Bt)))}for(let r=0;r<10;r++)Mt(r),t.exportFunction(ot+"_frobeniusMap"+r);P(),Z(),Ct(),ht(),gt(),Lt(),bt(),F(),Qt();for(let r=1;r<=5;r++)S(r),t.exportFunction(e+"_pairingEq"+r);z(),t.exportFunction(e+"_pairing"),t.exportFunction(e+"_prepareG1"),t.exportFunction(e+"_prepareG2"),t.exportFunction(e+"_millerLoop"),t.exportFunction(e+"_finalExponentiation"),t.exportFunction(e+"_finalExponentiationOld"),t.exportFunction(e+"__cyclotomicSquare"),t.exportFunction(e+"__cyclotomicExp_w0"),t.exportFunction(H+"_mul1"),t.exportFunction(H+"_mul01"),t.exportFunction(ot+"_mul014"),t.exportFunction(G+"_inGroupAffine"),t.exportFunction(G+"_inGroup"),t.exportFunction(M+"_inGroupAffine"),t.exportFunction(M+"_inGroup")},Ec=bc,Sc=Ic;function Re(a){if(typeof a=="bigint"||a.eq!==void 0)return a.toString(10);if(a instanceof Uint8Array)return Kn(a,0);if(Array.isArray(a))return a.map(Re);if(typeof a=="object"){const t={};return Object.keys(a).forEach(e=>{t[e]=Re(a[e])}),t}else return a}function Ne(a){if(typeof a=="string"&&/^[0-9]+$/.test(a))return BigInt(a);if(typeof a=="string"&&/^0x[0-9a-fA-F]+$/.test(a))return BigInt(a);if(Array.isArray(a))return a.map(Ne);if(typeof a=="object"){if(a===null)return null;const t={};return Object.keys(a).forEach(e=>{t[e]=Ne(a[e])}),t}else return a}function vc(a){let t=BigInt(0),n=a.length,e=0;const o=new DataView(a.buffer,a.byteOffset,a.byteLength);for(;n>0;)n>=4?(n-=4,t+=BigInt(o.getUint32(n))<<BigInt(e*8),e+=4):n>=2?(n-=2,t+=BigInt(o.getUint16(n))<<BigInt(e*8),e+=2):(n-=1,t+=BigInt(o.getUint8(n))<<BigInt(e*8),e+=1);return t}function Pc(a,t){let n=a;const e=new Uint8Array(t),o=new DataView(e.buffer);let c=t;for(;c>0;)c-4>=0?(c-=4,o.setUint32(c,Number(n&BigInt(4294967295))),n=n>>BigInt(32)):c-2>=0?(c-=2,o.setUint16(c,Number(n&BigInt(65535))),n=n>>BigInt(16)):(c-=1,o.setUint8(c,Number(n&BigInt(255))),n=n>>BigInt(8));if(n)throw new Error("Number does not fit in this length");return e}function Oc(a){let t=BigInt(0),n=0;const e=new DataView(a.buffer,a.byteOffset,a.byteLength);for(;n<a.length;)n+4<=a.length?(t+=BigInt(e.getUint32(n,!0))<<BigInt(n*8),n+=4):n+2<=a.length?(t+=BigInt(e.getUint16(n,!0))<<BigInt(n*8),n+=2):(t+=BigInt(e.getUint8(n,!0))<<BigInt(n*8),n+=1);return t}function wa(a,t){let n=a;typeof t>"u"&&(t=Math.floor((Hn(a)-1)/8)+1,t==0&&(t=1));const e=new Uint8Array(t),o=new DataView(e.buffer);let c=0;for(;c<t;)c+4<=t?(o.setUint32(c,Number(n&BigInt(4294967295)),!0),c+=4,n=n>>BigInt(32)):c+2<=t?(o.setUint16(c,Number(n&BigInt(65535)),!0),c+=2,n=n>>BigInt(16)):(o.setUint8(c,Number(n&BigInt(255)),!0),c+=1,n=n>>BigInt(8));if(n)throw new Error("Number does not fit in this length");return e}function $e(a,t){if(typeof t=="bigint"||t.eq!==void 0)return t.toString(10);if(t instanceof Uint8Array)return a.toString(a.e(t));if(Array.isArray(t))return t.map($e.bind(this,a));if(typeof t=="object"){const n={};return Object.keys(t).forEach(o=>{n[o]=$e(a,t[o])}),n}else return t}function Ge(a,t){if(typeof t=="string"&&/^[0-9]+$/.test(t))return a.e(t);if(typeof t=="string"&&/^0x[0-9a-fA-F]+$/.test(t))return a.e(t);if(Array.isArray(t))return t.map(Ge.bind(this,a));if(typeof t=="object"){if(t===null)return null;const n={};return Object.keys(t).forEach(o=>{n[o]=Ge(a,t[o])}),n}else return t}const Dn=[];for(let a=0;a<256;a++)Dn[a]=kc(a,8);function kc(a,t){let n=0,e=a;for(let o=0;o<t;o++)n<<=1,n=n|e&1,e>>=1;return n}function Ba(a,t){return(Dn[a>>>24]|Dn[a>>>16&255]<<8|Dn[a>>>8&255]<<16|Dn[a&255]<<24)>>>32-t}function Yt(a){return(a&4294901760?(a&=4294901760,16):0)|(a&4278255360?(a&=4278255360,8):0)|(a&4042322160?(a&=4042322160,4):0)|(a&3435973836?(a&=3435973836,2):0)|(a&2863311530)!==0}function xa(a,t){const n=a.byteLength/t,e=Yt(n);if(n!=1<<e)throw new Error("Invalid number of pointers");for(let o=0;o<n;o++){const c=Ba(o,e);if(o>c){const f=a.slice(o*t,(o+1)*t);a.set(a.slice(c*t,(c+1)*t),o*t),a.set(f,c*t)}}}function ao(a,t){const n=new Uint8Array(t*a.length);for(let e=0;e<a.length;e++)n.set(a[e],e*t);return n}function ue(a,t){const n=a.byteLength/t,e=new Array(n);for(let o=0;o<n;o++)e[o]=a.slice(o*t,o*t+t);return e}var qc=Object.freeze({__proto__:null,array2buffer:ao,beBuff2int:vc,beInt2Buff:Pc,bitReverse:Ba,buffReverseBits:xa,buffer2array:ue,leBuff2int:Oc,leInt2Buff:wa,log2:Yt,stringifyBigInts:Re,stringifyFElements:$e,unstringifyBigInts:Ne,unstringifyFElements:Ge});const Vt=1<<30;class Nt{constructor(t){this.buffers=[],this.byteLength=t;for(let n=0;n<t;n+=Vt){const e=Math.min(t-n,Vt);this.buffers.push(new Uint8Array(e))}}slice(t,n){n===void 0&&(n=this.byteLength),t===void 0&&(t=0);const e=n-t,o=Math.floor(t/Vt),c=Math.floor((t+e-1)/Vt);if(o==c||e==0)return this.buffers[o].slice(t%Vt,t%Vt+e);let f,s=o,b=t%Vt,u=e;for(;u>0;){const l=b+u>Vt?Vt-b:u,B=new Uint8Array(this.buffers[s].buffer,this.buffers[s].byteOffset+b,l);if(l==e)return B.slice();f||(e<=Vt?f=new Uint8Array(e):f=new Nt(e)),f.set(B,e-u),u=u-l,s++,b=0}return f}set(t,n){n===void 0&&(n=0);const e=t.byteLength;if(e==0)return;const o=Math.floor(n/Vt),c=Math.floor((n+e-1)/Vt);if(o==c)return t instanceof Nt&&t.buffers.length==1?this.buffers[o].set(t.buffers[0],n%Vt):this.buffers[o].set(t,n%Vt);let f=o,s=n%Vt,b=e;for(;b>0;){const u=s+b>Vt?Vt-s:b,l=t.slice(e-b,e-b+u);new Uint8Array(this.buffers[f].buffer,this.buffers[f].byteOffset+s,u).set(l),b=b-u,f++,s=0}}}function bn(a,t,n,e){return async function(c){const f=Math.floor(c.byteLength/n);if(f*n!==c.byteLength)throw new Error("Invalid buffer size");const s=Math.floor(f/a.concurrency),b=[];for(let x=0;x<a.concurrency;x++){let y;if(x<a.concurrency-1?y=s:y=f-x*s,y==0)continue;const R=[{cmd:"ALLOCSET",var:0,buff:c.slice(x*s*n,x*s*n+y*n)},{cmd:"ALLOC",var:1,len:e*y},{cmd:"CALL",fnName:t,params:[{var:0},{val:y},{var:1}]},{cmd:"GET",out:0,var:1,len:e*y}];b.push(a.queueAction(R))}const u=await Promise.all(b);let l;c instanceof Nt?l=new Nt(f*e):l=new Uint8Array(f*e);let B=0;for(let x=0;x<u.length;x++)l.set(u[x][0],B),B+=u[x][0].byteLength;return l}}class Eo{constructor(t,n,e,o){if(this.tm=t,this.prefix=n,this.p=o,this.n8=e,this.type="F1",this.m=1,this.half=On(o,In),this.bitLength=Hn(o),this.mask=pn(re(In,this.bitLength),In),this.pOp1=t.alloc(e),this.pOp2=t.alloc(e),this.pOp3=t.alloc(e),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=this.tm.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=this.tm.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one),this.n64=Math.floor(e/8),this.n32=Math.floor(e/4),this.n64*8!=this.n8)throw new Error("n8 must be a multiple of 8");this.half=On(this.p,In),this.nqr=this.two;let c=this.exp(this.nqr,this.half);for(;!this.eq(c,this.negone);)this.nqr=this.add(this.nqr,this.one),c=this.exp(this.nqr,this.half);this.shift=this.mul(this.nqr,this.nqr),this.shiftInv=this.inv(this.shift),this.s=0;let f=pn(this.p,In);for(;!Ve(f);)this.s=this.s+1,f=On(f,In);this.w=[],this.w[this.s]=this.exp(this.nqr,f);for(let s=this.s-1;s>=0;s--)this.w[s]=this.square(this.w[s+1]);if(!this.eq(this.w[0],this.one))throw new Error("Error calculating roots of unity");this.batchToMontgomery=bn(t,n+"_batchToMontgomery",this.n8,this.n8),this.batchFromMontgomery=bn(t,n+"_batchFromMontgomery",this.n8,this.n8)}op2(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){return this.op2("_add",t,n)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=qn(jt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}isNegative(t){return this.op1Bool("_isNegative",t)}e(t,n){if(t instanceof Uint8Array)return t;let e=jt(t,n);Vo(e)?(e=Yo(e),ze(e,this.p)&&(e=rn(e,this.p)),e=pn(this.p,e)):ze(e,this.p)&&(e=rn(e,this.p));const o=wa(e,this.n8);return this.toMontgomery(o)}toString(t,n){const e=this.fromMontgomery(t),o=Kn(e,0);return aa(o,n)}fromRng(t){let n;const e=new Uint8Array(this.n8);do{n=ia;for(let o=0;o<this.n64;o++)n=Qe(n,re(t.nextU64(),64*o));n=He(n,this.mask)}while(na(n,this.p));return Xn(e,0,n,this.n8),e}random(){return this.fromRng(Je())}toObject(t){const n=this.fromMontgomery(t);return Kn(n,0)}fromObject(t){const n=new Uint8Array(this.n8);return Xn(n,0,t,this.n8),this.toMontgomery(n)}toRprLE(t,n,e){t.set(this.fromMontgomery(e),n)}toRprBE(t,n,e){const o=this.fromMontgomery(e);for(let c=0;c<this.n8/2;c++){const f=o[c];o[c]=o[this.n8-1-c],o[this.n8-1-c]=f}t.set(o,n)}fromRprLE(t,n){n=n||0;const e=t.slice(n,n+this.n8);return this.toMontgomery(e)}async batchInverse(t){let n=!1;const e=this.n8,o=this.n8;Array.isArray(t)?(t=ao(t,e),n=!0):t=t.slice(0,t.byteLength);const c=Math.floor(t.byteLength/e);if(c*e!==t.byteLength)throw new Error("Invalid buffer size");const f=Math.floor(c/this.tm.concurrency),s=[];for(let B=0;B<this.tm.concurrency;B++){let x;if(B<this.tm.concurrency-1?x=f:x=c-B*f,x==0)continue;const $=[{cmd:"ALLOCSET",var:0,buff:t.slice(B*f*e,B*f*e+x*e)},{cmd:"ALLOC",var:1,len:o*x},{cmd:"CALL",fnName:this.prefix+"_batchInverse",params:[{var:0},{val:e},{val:x},{var:1},{val:o}]},{cmd:"GET",out:0,var:1,len:o*x}];s.push(this.tm.queueAction($))}const b=await Promise.all(s);let u;t instanceof Nt?u=new Nt(c*o):u=new Uint8Array(c*o);let l=0;for(let B=0;B<b.length;B++)u.set(b[B][0],l),l+=b[B][0].byteLength;return n?ue(u,o):u}}class So{constructor(t,n,e){this.tm=t,this.prefix=n,this.F=e,this.type="F2",this.m=e.m*2,this.n8=this.F.n8*2,this.n32=this.F.n32*2,this.n64=this.F.n64*2,this.pOp1=t.alloc(e.n8*2),this.pOp2=t.alloc(e.n8*2),this.pOp3=t.alloc(e.n8*2),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=t.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=t.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one)}op2(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){return this.op2("_add",t,n)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}isNegative(t){return this.op1Bool("_isNegative",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}mul1(t,n){return this.op2("_mul1",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=qn(jt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}e(t,n){if(t instanceof Uint8Array)return t;if(Array.isArray(t)&&t.length==2){const e=this.F.e(t[0],n),o=this.F.e(t[1],n),c=new Uint8Array(this.F.n8*2);return c.set(e),c.set(o,this.F.n8*2),c}else throw new Error("invalid F2")}toString(t,n){const e=this.F.toString(t.slice(0,this.F.n8),n),o=this.F.toString(t.slice(this.F.n8),n);return`[${e}, ${o}]`}fromRng(t){const n=this.F.fromRng(t),e=this.F.fromRng(t),o=new Uint8Array(this.F.n8*2);return o.set(n),o.set(e,this.F.n8),o}random(){return this.fromRng(Je())}toObject(t){const n=this.F.toObject(t.slice(0,this.F.n8)),e=this.F.toObject(t.slice(this.F.n8,this.F.n8*2));return[n,e]}fromObject(t){const n=new Uint8Array(this.F.n8*2),e=this.F.fromObject(t[0]),o=this.F.fromObject(t[1]);return n.set(e),n.set(o,this.F.n8),n}c1(t){return t.slice(0,this.F.n8)}c2(t){return t.slice(this.F.n8)}}class Tc{constructor(t,n,e){this.tm=t,this.prefix=n,this.F=e,this.type="F3",this.m=e.m*3,this.n8=this.F.n8*3,this.n32=this.F.n32*3,this.n64=this.F.n64*3,this.pOp1=t.alloc(e.n8*3),this.pOp2=t.alloc(e.n8*3),this.pOp3=t.alloc(e.n8*3),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=t.getBuff(this.pOp1,this.n8),this.tm.instance.exports[n+"_one"](this.pOp1),this.one=t.getBuff(this.pOp1,this.n8),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one)}op2(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op2Bool(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}eq(t,n){return this.op2Bool("_eq",t,n)}isZero(t){return this.op1Bool("_isZero",t)}add(t,n){return this.op2("_add",t,n)}sub(t,n){return this.op2("_sub",t,n)}neg(t){return this.op1("_neg",t)}inv(t){return this.op1("_inverse",t)}isNegative(t){return this.op1Bool("_isNegative",t)}toMontgomery(t){return this.op1("_toMontgomery",t)}fromMontgomery(t){return this.op1("_fromMontgomery",t)}mul(t,n){return this.op2("_mul",t,n)}div(t,n){return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_inverse"](this.pOp2,this.pOp2),this.tm.instance.exports[this.prefix+"_mul"](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.n8)}square(t){return this.op1("_square",t)}isSquare(t){return this.op1Bool("_isSquare",t)}sqrt(t){return this.op1("_sqrt",t)}exp(t,n){return n instanceof Uint8Array||(n=qn(jt(n))),this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[this.prefix+"_exp"](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.getBuff(this.pOp3,this.n8)}e(t,n){if(t instanceof Uint8Array)return t;if(Array.isArray(t)&&t.length==3){const e=this.F.e(t[0],n),o=this.F.e(t[1],n),c=this.F.e(t[2],n),f=new Uint8Array(this.F.n8*3);return f.set(e),f.set(o,this.F.n8),f.set(c,this.F.n8*2),f}else throw new Error("invalid F3")}toString(t,n){const e=this.F.toString(t.slice(0,this.F.n8),n),o=this.F.toString(t.slice(this.F.n8,this.F.n8*2),n),c=this.F.toString(t.slice(this.F.n8*2),n);return`[${e}, ${o}, ${c}]`}fromRng(t){const n=this.F.fromRng(t),e=this.F.fromRng(t),o=this.F.fromRng(t),c=new Uint8Array(this.F.n8*3);return c.set(n),c.set(e,this.F.n8),c.set(o,this.F.n8*2),c}random(){return this.fromRng(Je())}toObject(t){const n=this.F.toObject(t.slice(0,this.F.n8)),e=this.F.toObject(t.slice(this.F.n8,this.F.n8*2)),o=this.F.toObject(t.slice(this.F.n8*2,this.F.n8*3));return[n,e,o]}fromObject(t){const n=new Uint8Array(this.F.n8*3),e=this.F.fromObject(t[0]),o=this.F.fromObject(t[1]),c=this.F.fromObject(t[2]);return n.set(e),n.set(o,this.F.n8),n.set(c,this.F.n8*2),n}c1(t){return t.slice(0,this.F.n8)}c2(t){return t.slice(this.F.n8,this.F.n8*2)}c3(t){return t.slice(this.F.n8*2)}}class vo{constructor(t,n,e,o,c,f){this.tm=t,this.prefix=n,this.F=e,this.pOp1=t.alloc(e.n8*3),this.pOp2=t.alloc(e.n8*3),this.pOp3=t.alloc(e.n8*3),this.tm.instance.exports[n+"_zero"](this.pOp1),this.zero=this.tm.getBuff(this.pOp1,e.n8*3),this.tm.instance.exports[n+"_zeroAffine"](this.pOp1),this.zeroAffine=this.tm.getBuff(this.pOp1,e.n8*2),this.one=this.tm.getBuff(o,e.n8*3),this.g=this.one,this.oneAffine=this.tm.getBuff(o,e.n8*2),this.gAffine=this.oneAffine,this.b=this.tm.getBuff(c,e.n8),f&&(this.cofactor=qn(f)),this.negone=this.neg(this.one),this.two=this.add(this.one,this.one),this.batchLEMtoC=bn(t,n+"_batchLEMtoC",e.n8*2,e.n8),this.batchLEMtoU=bn(t,n+"_batchLEMtoU",e.n8*2,e.n8*2),this.batchCtoLEM=bn(t,n+"_batchCtoLEM",e.n8,e.n8*2),this.batchUtoLEM=bn(t,n+"_batchUtoLEM",e.n8*2,e.n8*2),this.batchToJacobian=bn(t,n+"_batchToJacobian",e.n8*2,e.n8*3),this.batchToAffine=bn(t,n+"_batchToAffine",e.n8*3,e.n8*2)}op2(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}op2bool(t,n,e){return this.tm.setBuff(this.pOp1,n),this.tm.setBuff(this.pOp2,e),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp2,this.pOp3)}op1(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}op1Affine(t,n){return this.tm.setBuff(this.pOp1,n),this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*2)}op1Bool(t,n){return this.tm.setBuff(this.pOp1,n),!!this.tm.instance.exports[this.prefix+t](this.pOp1,this.pOp3)}add(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2("_add",t,n);if(n.byteLength==this.F.n8*2)return this.op2("_addMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2("_addMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2("_addAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}sub(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2("_sub",t,n);if(n.byteLength==this.F.n8*2)return this.op2("_subMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2("_subMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2("_subAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}neg(t){if(t.byteLength==this.F.n8*3)return this.op1("_neg",t);if(t.byteLength==this.F.n8*2)return this.op1Affine("_negAffine",t);throw new Error("invalid point size")}double(t){if(t.byteLength==this.F.n8*3)return this.op1("_double",t);if(t.byteLength==this.F.n8*2)return this.op1("_doubleAffine",t);throw new Error("invalid point size")}isZero(t){if(t.byteLength==this.F.n8*3)return this.op1Bool("_isZero",t);if(t.byteLength==this.F.n8*2)return this.op1Bool("_isZeroAffine",t);throw new Error("invalid point size")}timesScalar(t,n){n instanceof Uint8Array||(n=qn(jt(n)));let e;if(t.byteLength==this.F.n8*3)e=this.prefix+"_timesScalar";else if(t.byteLength==this.F.n8*2)e=this.prefix+"_timesScalarAffine";else throw new Error("invalid point size");return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[e](this.pOp1,this.pOp2,n.byteLength,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}timesFr(t,n){let e;if(t.byteLength==this.F.n8*3)e=this.prefix+"_timesFr";else if(t.byteLength==this.F.n8*2)e=this.prefix+"_timesFrAffine";else throw new Error("invalid point size");return this.tm.setBuff(this.pOp1,t),this.tm.setBuff(this.pOp2,n),this.tm.instance.exports[e](this.pOp1,this.pOp2,this.pOp3),this.tm.getBuff(this.pOp3,this.F.n8*3)}eq(t,n){if(t.byteLength==this.F.n8*3){if(n.byteLength==this.F.n8*3)return this.op2bool("_eq",t,n);if(n.byteLength==this.F.n8*2)return this.op2bool("_eqMixed",t,n);throw new Error("invalid point size")}else if(t.byteLength==this.F.n8*2){if(n.byteLength==this.F.n8*3)return this.op2bool("_eqMixed",n,t);if(n.byteLength==this.F.n8*2)return this.op2bool("_eqAffine",t,n);throw new Error("invalid point size")}else throw new Error("invalid point size")}toAffine(t){if(t.byteLength==this.F.n8*3)return this.op1Affine("_toAffine",t);if(t.byteLength==this.F.n8*2)return t;throw new Error("invalid point size")}toJacobian(t){if(t.byteLength==this.F.n8*3)return t;if(t.byteLength==this.F.n8*2)return this.op1("_toJacobian",t);throw new Error("invalid point size")}toRprUncompressed(t,n,e){if(this.tm.setBuff(this.pOp1,e),e.byteLength==this.F.n8*3)this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);else if(e.byteLength!=this.F.n8*2)throw new Error("invalid point size");this.tm.instance.exports[this.prefix+"_LEMtoU"](this.pOp1,this.pOp1);const o=this.tm.getBuff(this.pOp1,this.F.n8*2);t.set(o,n)}fromRprUncompressed(t,n){const e=t.slice(n,n+this.F.n8*2);return this.tm.setBuff(this.pOp1,e),this.tm.instance.exports[this.prefix+"_UtoLEM"](this.pOp1,this.pOp1),this.tm.getBuff(this.pOp1,this.F.n8*2)}toRprCompressed(t,n,e){if(this.tm.setBuff(this.pOp1,e),e.byteLength==this.F.n8*3)this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);else if(e.byteLength!=this.F.n8*2)throw new Error("invalid point size");this.tm.instance.exports[this.prefix+"_LEMtoC"](this.pOp1,this.pOp1);const o=this.tm.getBuff(this.pOp1,this.F.n8);t.set(o,n)}fromRprCompressed(t,n){const e=t.slice(n,n+this.F.n8);return this.tm.setBuff(this.pOp1,e),this.tm.instance.exports[this.prefix+"_CtoLEM"](this.pOp1,this.pOp2),this.tm.getBuff(this.pOp2,this.F.n8*2)}toUncompressed(t){const n=new Uint8Array(this.F.n8*2);return this.toRprUncompressed(n,0,t),n}toRprLEM(t,n,e){if(e.byteLength==this.F.n8*2){t.set(e,n);return}else if(e.byteLength==this.F.n8*3){this.tm.setBuff(this.pOp1,e),this.tm.instance.exports[this.prefix+"_toAffine"](this.pOp1,this.pOp1);const o=this.tm.getBuff(this.pOp1,this.F.n8*2);t.set(o,n)}else throw new Error("invalid point size")}fromRprLEM(t,n){return n=n||0,t.slice(n,n+this.F.n8*2)}toString(t,n){if(t.byteLength==this.F.n8*3){const e=this.F.toString(t.slice(0,this.F.n8),n),o=this.F.toString(t.slice(this.F.n8,this.F.n8*2),n),c=this.F.toString(t.slice(this.F.n8*2),n);return`[ ${e}, ${o}, ${c} ]`}else if(t.byteLength==this.F.n8*2){const e=this.F.toString(t.slice(0,this.F.n8),n),o=this.F.toString(t.slice(this.F.n8),n);return`[ ${e}, ${o} ]`}else throw new Error("invalid point size")}isValid(t){if(this.isZero(t))return!0;const n=this.F,e=this.toAffine(t),o=e.slice(0,this.F.n8),c=e.slice(this.F.n8,this.F.n8*2),f=n.add(n.mul(n.square(o),o),this.b),s=n.square(c);return n.eq(f,s)}fromRng(t){const n=this.F;let e=[],o,c;do e[0]=n.fromRng(t),o=t.nextBool(),c=n.add(n.mul(n.square(e[0]),e[0]),this.b);while(!n.isSquare(c));e[1]=n.sqrt(c);const f=n.isNegative(e[1]);o^f&&(e[1]=n.neg(e[1]));let s=new Uint8Array(this.F.n8*2);return s.set(e[0]),s.set(e[1],this.F.n8),this.cofactor&&(s=this.timesScalar(s,this.cofactor)),s}toObject(t){if(this.isZero(t))return[this.F.toObject(this.F.zero),this.F.toObject(this.F.one),this.F.toObject(this.F.zero)];const n=this.F.toObject(t.slice(0,this.F.n8)),e=this.F.toObject(t.slice(this.F.n8,this.F.n8*2));let o;return t.byteLength==this.F.n8*3?o=this.F.toObject(t.slice(this.F.n8*2,this.F.n8*3)):o=this.F.toObject(this.F.one),[n,e,o]}fromObject(t){const n=this.F.fromObject(t[0]),e=this.F.fromObject(t[1]);let o;if(t.length==3?o=this.F.fromObject(t[2]):o=this.F.one,this.F.isZero(o,this.F.one))return this.zeroAffine;if(this.F.eq(o,this.F.one)){const c=new Uint8Array(this.F.n8*2);return c.set(n),c.set(e,this.F.n8),c}else{const c=new Uint8Array(this.F.n8*3);return c.set(n),c.set(e,this.F.n8),c.set(o,this.F.n8*2),c}}e(t){return t instanceof Uint8Array?t:this.fromObject(t)}x(t){return this.toAffine(t).slice(0,this.F.n8)}y(t){return this.toAffine(t).slice(this.F.n8)}}function Uc(a){let n,e;async function o(l){const B=new Uint8Array(l.code),x=await WebAssembly.compile(B);e=new WebAssembly.Memory({initial:l.init,maximum:32767}),n=await WebAssembly.instantiate(x,{env:{memory:e}})}function c(l){const B=new Uint32Array(e.buffer,0,1);for(;B[0]&3;)B[0]++;const x=B[0];if(B[0]+=l,B[0]+l>e.buffer.byteLength){const y=e.buffer.byteLength/65536;let $=Math.floor((B[0]+l)/65536)+1;$>32767&&($=32767),e.grow($-y)}return x}function f(l){const B=c(l.byteLength);return b(B,l),B}function s(l,B){const x=new Uint8Array(e.buffer);return new Uint8Array(x.buffer,x.byteOffset+l,B)}function b(l,B){new Uint8Array(e.buffer).set(new Uint8Array(B),l)}function u(l){if(l[0].cmd=="INIT")return o(l[0]);const B={vars:[],out:[]},y=new Uint32Array(e.buffer,0,1)[0];for(let R=0;R<l.length;R++)switch(l[R].cmd){case"ALLOCSET":B.vars[l[R].var]=f(l[R].buff);break;case"ALLOC":B.vars[l[R].var]=c(l[R].len);break;case"SET":b(B.vars[l[R].var],l[R].buff);break;case"CALL":{const I=[];for(let G=0;G<l[R].params.length;G++){const A=l[R].params[G];typeof A.var<"u"?I.push(B.vars[A.var]+(A.offset||0)):typeof A.val<"u"&&I.push(A.val)}n.exports[l[R].fnName](...I);break}case"GET":B.out[l[R].out]=s(B.vars[l[R].var],l[R].len).slice();break;default:throw new Error("Invalid cmd")}const $=new Uint32Array(e.buffer,0,1);return $[0]=y,B.out}return u}const Pe=25;class Po{constructor(){this.promise=new Promise((t,n)=>{this.reject=n,this.resolve=t})}}function Mc(a){return new Promise(t=>setTimeout(t,a))}let We;const Oo=`(function thread(self) {
    const MAXMEM = 32767;
    let instance;
    let memory;

    if (self) {
        self.onmessage = function(e) {
            let data;
            if (e.data) {
                data = e.data;
            } else {
                data = e;
            }

            if (data[0].cmd == "INIT") {
                init(data[0]).then(function() {
                    self.postMessage(data.result);
                });
            } else if (data[0].cmd == "TERMINATE") {
                self.close();
            } else {
                const res = runTask(data);
                self.postMessage(res);
            }
        };
    }

    async function init(data) {
        const code = new Uint8Array(data.code);
        const wasmModule = await WebAssembly.compile(code);
        memory = new WebAssembly.Memory({initial:data.init, maximum: MAXMEM});

        instance = await WebAssembly.instantiate(wasmModule, {
            env: {
                "memory": memory
            }
        });
    }



    function alloc(length) {
        const u32 = new Uint32Array(memory.buffer, 0, 1);
        while (u32[0] & 3) u32[0]++;  // Return always aligned pointers
        const res = u32[0];
        u32[0] += length;
        if (u32[0] + length > memory.buffer.byteLength) {
            const currentPages = memory.buffer.byteLength / 0x10000;
            let requiredPages = Math.floor((u32[0] + length) / 0x10000)+1;
            if (requiredPages>MAXMEM) requiredPages=MAXMEM;
            memory.grow(requiredPages-currentPages);
        }
        return res;
    }

    function allocBuffer(buffer) {
        const p = alloc(buffer.byteLength);
        setBuffer(p, buffer);
        return p;
    }

    function getBuffer(pointer, length) {
        const u8 = new Uint8Array(memory.buffer);
        return new Uint8Array(u8.buffer, u8.byteOffset + pointer, length);
    }

    function setBuffer(pointer, buffer) {
        const u8 = new Uint8Array(memory.buffer);
        u8.set(new Uint8Array(buffer), pointer);
    }

    function runTask(task) {
        if (task[0].cmd == "INIT") {
            return init(task[0]);
        }
        const ctx = {
            vars: [],
            out: []
        };
        const u32a = new Uint32Array(memory.buffer, 0, 1);
        const oldAlloc = u32a[0];
        for (let i=0; i<task.length; i++) {
            switch (task[i].cmd) {
            case "ALLOCSET":
                ctx.vars[task[i].var] = allocBuffer(task[i].buff);
                break;
            case "ALLOC":
                ctx.vars[task[i].var] = alloc(task[i].len);
                break;
            case "SET":
                setBuffer(ctx.vars[task[i].var], task[i].buff);
                break;
            case "CALL": {
                const params = [];
                for (let j=0; j<task[i].params.length; j++) {
                    const p = task[i].params[j];
                    if (typeof p.var !== "undefined") {
                        params.push(ctx.vars[p.var] + (p.offset || 0));
                    } else if (typeof p.val != "undefined") {
                        params.push(p.val);
                    }
                }
                instance.exports[task[i].fnName](...params);
                break;
            }
            case "GET":
                ctx.out[task[i].out] = getBuffer(ctx.vars[task[i].var], task[i].len).slice();
                break;
            default:
                throw new Error("Invalid cmd");
            }
        }
        const u32b = new Uint32Array(memory.buffer, 0, 1);
        u32b[0] = oldAlloc;
        return ctx.out;
    }


    return runTask;
})(self)`;if(globalThis!=null&&globalThis.Blob){const a=new TextEncoder().encode(Oo),t=new Blob([a],{type:"application/javascript"});We=URL.createObjectURL(t)}else We="data:application/javascript;base64,"+globalThis.btoa(Oo);async function zc(a,t){const n=new Rc;n.memory=new WebAssembly.Memory({initial:Pe}),n.u8=new Uint8Array(n.memory.buffer),n.u32=new Uint32Array(n.memory.buffer);const e=await WebAssembly.compile(a.code);if(n.instance=await WebAssembly.instantiate(e,{env:{memory:n.memory}}),globalThis!=null&&globalThis.Worker||(t=!0),n.singleThread=t,n.initalPFree=n.u32[0],n.pq=a.pq,n.pr=a.pr,n.pG1gen=a.pG1gen,n.pG1zero=a.pG1zero,n.pG2gen=a.pG2gen,n.pG2zero=a.pG2zero,n.pOneT=a.pOneT,t)n.code=a.code,n.taskManager=Uc(),await n.taskManager([{cmd:"INIT",init:Pe,code:n.code.slice()}]),n.concurrency=1;else{n.workers=[],n.pendingDeferreds=[],n.working=[];let c=2;typeof navigator=="object"&&navigator.hardwareConcurrency&&(c=navigator.hardwareConcurrency),c==0&&(c=2),c>64&&(c=64),n.concurrency=c;for(let s=0;s<c;s++)n.workers[s]=new Worker(We),n.workers[s].addEventListener("message",o(s)),n.working[s]=!1;const f=[];for(let s=0;s<n.workers.length;s++){const b=a.code.slice();f.push(n.postAction(s,[{cmd:"INIT",init:Pe,code:b}],[b.buffer]))}await Promise.all(f)}return n;function o(c){return function(f){let s;f&&f.data?s=f.data:s=f,n.working[c]=!1,n.pendingDeferreds[c].resolve(s),n.processWorks()}}}class Rc{constructor(){this.actionQueue=[],this.oldPFree=0}startSyncOp(){if(this.oldPFree!=0)throw new Error("Sync operation in progress");this.oldPFree=this.u32[0]}endSyncOp(){if(this.oldPFree==0)throw new Error("No sync operation in progress");this.u32[0]=this.oldPFree,this.oldPFree=0}postAction(t,n,e,o){if(this.working[t])throw new Error("Posting a job t a working worker");return this.working[t]=!0,this.pendingDeferreds[t]=o||new Po,this.workers[t].postMessage(n,e),this.pendingDeferreds[t].promise}processWorks(){for(let t=0;t<this.workers.length&&this.actionQueue.length>0;t++)if(this.working[t]==!1){const n=this.actionQueue.shift();this.postAction(t,n.data,n.transfers,n.deferred)}}queueAction(t,n){const e=new Po;if(this.singleThread){const o=this.taskManager(t);e.resolve(o)}else this.actionQueue.push({data:t,transfers:n,deferred:e}),this.processWorks();return e.promise}resetMemory(){this.u32[0]=this.initalPFree}allocBuff(t){const n=this.alloc(t.byteLength);return this.setBuff(n,t),n}getBuff(t,n){return this.u8.slice(t,t+n)}setBuff(t,n){this.u8.set(new Uint8Array(n),t)}alloc(t){for(;this.u32[0]&3;)this.u32[0]++;const n=this.u32[0];return this.u32[0]+=t,n}async terminate(){for(let t=0;t<this.workers.length;t++)this.workers[t].postMessage([{cmd:"TERMINATE"}]);await Mc(200)}}function Oe(a,t){const n=a[t],e=a.Fr,o=a.tm;a[t].batchApplyKey=async function(c,f,s,b,u){b=b||"affine",u=u||"affine";let l,B,x,y,$;if(t=="G1")b=="jacobian"?(x=n.F.n8*3,l="g1m_batchApplyKey"):(x=n.F.n8*2,l="g1m_batchApplyKeyMixed"),y=n.F.n8*3,u=="jacobian"?$=n.F.n8*3:(B="g1m_batchToAffine",$=n.F.n8*2);else if(t=="G2")b=="jacobian"?(x=n.F.n8*3,l="g2m_batchApplyKey"):(x=n.F.n8*2,l="g2m_batchApplyKeyMixed"),y=n.F.n8*3,u=="jacobian"?$=n.F.n8*3:(B="g2m_batchToAffine",$=n.F.n8*2);else if(t=="Fr")l="frm_batchApplyKey",x=n.n8,y=n.n8,$=n.n8;else throw new Error("Invalid group: "+t);const R=Math.floor(c.byteLength/x),I=Math.floor(R/o.concurrency),G=[];s=e.e(s);let A=e.e(f);for(let C=0;C<o.concurrency;C++){let _;if(C<o.concurrency-1?_=I:_=R-C*I,_==0)continue;const h=[];h.push({cmd:"ALLOCSET",var:0,buff:c.slice(C*I*x,C*I*x+_*x)}),h.push({cmd:"ALLOCSET",var:1,buff:A}),h.push({cmd:"ALLOCSET",var:2,buff:s}),h.push({cmd:"ALLOC",var:3,len:_*Math.max(y,$)}),h.push({cmd:"CALL",fnName:l,params:[{var:0},{val:_},{var:1},{var:2},{var:3}]}),B&&h.push({cmd:"CALL",fnName:B,params:[{var:3},{val:_},{var:3}]}),h.push({cmd:"GET",out:0,var:3,len:_*$}),G.push(o.queueAction(h)),A=e.mul(A,e.exp(s,_))}const Q=await Promise.all(G);let M;c instanceof Nt?M=new Nt(R*$):M=new Uint8Array(R*$);let ct=0;for(let C=0;C<Q.length;C++)M.set(Q[C][0],ct),ct+=Q[C][0].byteLength;return M}}function Nc(a){const t=a.tm;a.pairing=function(e,o){t.startSyncOp();const c=t.allocBuff(a.G1.toJacobian(e)),f=t.allocBuff(a.G2.toJacobian(o)),s=t.alloc(a.Gt.n8);t.instance.exports[a.name+"_pairing"](c,f,s);const b=t.getBuff(s,a.Gt.n8);return t.endSyncOp(),b},a.pairingEq=async function(){let e,o;arguments.length%2==1?(e=arguments[arguments.length-1],o=(arguments.length-1)/2):(e=a.Gt.one,o=arguments.length/2);const c=[];for(let l=0;l<o;l++){const B=[],x=a.G1.toJacobian(arguments[l*2]);B.push({cmd:"ALLOCSET",var:0,buff:x}),B.push({cmd:"ALLOC",var:1,len:a.prePSize});const y=a.G2.toJacobian(arguments[l*2+1]);B.push({cmd:"ALLOCSET",var:2,buff:y}),B.push({cmd:"ALLOC",var:3,len:a.preQSize}),B.push({cmd:"ALLOC",var:4,len:a.Gt.n8}),B.push({cmd:"CALL",fnName:a.name+"_prepareG1",params:[{var:0},{var:1}]}),B.push({cmd:"CALL",fnName:a.name+"_prepareG2",params:[{var:2},{var:3}]}),B.push({cmd:"CALL",fnName:a.name+"_millerLoop",params:[{var:1},{var:3},{var:4}]}),B.push({cmd:"GET",out:0,var:4,len:a.Gt.n8}),c.push(t.queueAction(B))}const f=await Promise.all(c);t.startSyncOp();const s=t.alloc(a.Gt.n8);t.instance.exports.ftm_one(s);for(let l=0;l<f.length;l++){const B=t.allocBuff(f[l][0]);t.instance.exports.ftm_mul(s,B,s)}t.instance.exports[a.name+"_finalExponentiation"](s,s);const b=t.allocBuff(e),u=!!t.instance.exports.ftm_eq(s,b);return t.endSyncOp(),u},a.prepareG1=function(n){this.tm.startSyncOp();const e=this.tm.allocBuff(n),o=this.tm.alloc(this.prePSize);this.tm.instance.exports[this.name+"_prepareG1"](e,o);const c=this.tm.getBuff(o,this.prePSize);return this.tm.endSyncOp(),c},a.prepareG2=function(n){this.tm.startSyncOp();const e=this.tm.allocBuff(n),o=this.tm.alloc(this.preQSize);this.tm.instance.exports[this.name+"_prepareG2"](e,o);const c=this.tm.getBuff(o,this.preQSize);return this.tm.endSyncOp(),c},a.millerLoop=function(n,e){this.tm.startSyncOp();const o=this.tm.allocBuff(n),c=this.tm.allocBuff(e),f=this.tm.alloc(this.Gt.n8);this.tm.instance.exports[this.name+"_millerLoop"](o,c,f);const s=this.tm.getBuff(f,this.Gt.n8);return this.tm.endSyncOp(),s},a.finalExponentiation=function(n){this.tm.startSyncOp();const e=this.tm.allocBuff(n),o=this.tm.alloc(this.Gt.n8);this.tm.instance.exports[this.name+"_finalExponentiation"](e,o);const c=this.tm.getBuff(o,this.Gt.n8);return this.tm.endSyncOp(),c}}const ko=[1,1,1,1,2,3,4,5,6,7,7,8,9,10,11,12,13,13,14,15,16,16,17,17,17,17,17,17,17,17,17,17];function qo(a,t){const n=a[t],e=n.tm;async function o(f,s,b,u,l){if(!(f instanceof Uint8Array))throw u&&u.error(`${l} _multiExpChunk buffBases is not Uint8Array`),new Error(`${l} _multiExpChunk buffBases is not Uint8Array`);if(!(s instanceof Uint8Array))throw u&&u.error(`${l} _multiExpChunk buffScalars is not Uint8Array`),new Error(`${l} _multiExpChunk buffScalars is not Uint8Array`);b=b||"affine";let B,x;if(t=="G1")b=="affine"?(x="g1m_multiexpAffine_chunk",B=n.F.n8*2):(x="g1m_multiexp_chunk",B=n.F.n8*3);else if(t=="G2")b=="affine"?(x="g2m_multiexpAffine_chunk",B=n.F.n8*2):(x="g2m_multiexp_chunk",B=n.F.n8*3);else throw new Error("Invalid group");const y=Math.floor(f.byteLength/B);if(y==0)return n.zero;const $=Math.floor(s.byteLength/y);if($*y!=s.byteLength)throw new Error("Scalar size does not match");const R=ko[Yt(y)],I=Math.floor(($*8-1)/R)+1,G=[];for(let M=0;M<I;M++){const ct=[{cmd:"ALLOCSET",var:0,buff:f},{cmd:"ALLOCSET",var:1,buff:s},{cmd:"ALLOC",var:2,len:n.F.n8*3},{cmd:"CALL",fnName:x,params:[{var:0},{var:1},{val:$},{val:y},{val:M*R},{val:Math.min($*8-M*R,R)},{var:2}]},{cmd:"GET",out:0,var:2,len:n.F.n8*3}];G.push(n.tm.queueAction(ct))}const A=await Promise.all(G);let Q=n.zero;for(let M=A.length-1;M>=0;M--){if(!n.isZero(Q))for(let ct=0;ct<R;ct++)Q=n.double(Q);Q=n.add(Q,A[M][0])}return Q}async function c(f,s,b,u,l){let y;if(t=="G1")b=="affine"?y=n.F.n8*2:y=n.F.n8*3;else if(t=="G2")b=="affine"?y=n.F.n8*2:y=n.F.n8*3;else throw new Error("Invalid group");const $=Math.floor(f.byteLength/y);if($==0)return n.zero;const R=Math.floor(s.byteLength/$);if(R*$!=s.byteLength)throw new Error("Scalar size does not match");const I=ko[Yt($)],G=Math.floor((R*8-1)/I)+1;let A;A=Math.floor($/(e.concurrency/G)),A>4194304&&(A=4194304),A<1024&&(A=1024);const Q=[];for(let C=0;C<$;C+=A){u&&u.debug(`Multiexp start: ${l}: ${C}/${$}`);const _=Math.min($-C,A),h=f.slice(C*y,(C+_)*y),X=s.slice(C*R,(C+_)*R);Q.push(o(h,X,b,u,l).then(J=>(u&&u.debug(`Multiexp end: ${l}: ${C}/${$}`),J)))}const M=await Promise.all(Q);let ct=n.zero;for(let C=M.length-1;C>=0;C--)ct=n.add(ct,M[C]);return ct}n.multiExp=async function(s,b,u,l){return await c(s,b,"jacobian",u,l)},n.multiExpAffine=async function(s,b,u,l){return await c(s,b,"affine",u,l)}}function ke(a,t){const n=a[t],e=a.Fr,o=n.tm;async function c(u,l,B,x,y,$){B=B||"affine",x=x||"affine";const R=14;let I,G,A,Q,M,ct,C,_;t=="G1"?(B=="affine"?(I=n.F.n8*2,Q="g1m_batchToJacobian"):I=n.F.n8*3,G=n.F.n8*3,l&&(_="g1m_fftFinal"),C="g1m_fftJoin",ct="g1m_fftMix",x=="affine"?(A=n.F.n8*2,M="g1m_batchToAffine"):A=n.F.n8*3):t=="G2"?(B=="affine"?(I=n.F.n8*2,Q="g2m_batchToJacobian"):I=n.F.n8*3,G=n.F.n8*3,l&&(_="g2m_fftFinal"),C="g2m_fftJoin",ct="g2m_fftMix",x=="affine"?(A=n.F.n8*2,M="g2m_batchToAffine"):A=n.F.n8*3):t=="Fr"&&(I=n.n8,G=n.n8,A=n.n8,l&&(_="frm_fftFinal"),ct="frm_fftMix",C="frm_fftJoin");let h=!1;Array.isArray(u)?(u=ao(u,I),h=!0):u=u.slice(0,u.byteLength);const X=u.byteLength/I,J=Yt(X);if(1<<J!=X)throw new Error("fft must be multiple of 2");if(J==e.s+1){let H;return l?H=await s(u,B,x,y,$):H=await f(u,B,x,y,$),h?ue(H,A):H}let nt;l&&(nt=e.inv(e.e(X)));let O;xa(u,I);let w,U=Math.min(1<<R,X),W=X/U;for(;W<o.concurrency&&U>=16;)W*=2,U/=2;const dt=Yt(U),st=[];for(let H=0;H<W;H++){y&&y.debug(`${$}: fft ${J} mix start: ${H}/${W}`);const ut=[];ut.push({cmd:"ALLOC",var:0,len:G*U});const ot=u.slice(U*H*I,U*(H+1)*I);ut.push({cmd:"SET",var:0,buff:ot}),Q&&ut.push({cmd:"CALL",fnName:Q,params:[{var:0},{val:U},{var:0}]});for(let lt=1;lt<=dt;lt++)ut.push({cmd:"CALL",fnName:ct,params:[{var:0},{val:U},{val:lt}]});dt==J?(_&&(ut.push({cmd:"ALLOCSET",var:1,buff:nt}),ut.push({cmd:"CALL",fnName:_,params:[{var:0},{val:U},{var:1}]})),M&&ut.push({cmd:"CALL",fnName:M,params:[{var:0},{val:U},{var:0}]}),ut.push({cmd:"GET",out:0,var:0,len:U*A})):ut.push({cmd:"GET",out:0,var:0,len:G*U}),st.push(o.queueAction(ut).then(lt=>(y&&y.debug(`${$}: fft ${J} mix end: ${H}/${W}`),lt)))}w=await Promise.all(st);for(let H=0;H<W;H++)w[H]=w[H][0];for(let H=dt+1;H<=J;H++){y&&y.debug(`${$}: fft  ${J}  join: ${H}/${J}`);const ut=1<<J-H,ot=W/ut,lt=[];for(let Tt=0;Tt<ut;Tt++)for(let Ft=0;Ft<ot/2;Ft++){const v=e.exp(e.w[H],Ft*U),i=e.w[H],E=Tt*ot+Ft,d=Tt*ot+Ft+ot/2,K=[];K.push({cmd:"ALLOCSET",var:0,buff:w[E]}),K.push({cmd:"ALLOCSET",var:1,buff:w[d]}),K.push({cmd:"ALLOCSET",var:2,buff:v}),K.push({cmd:"ALLOCSET",var:3,buff:i}),K.push({cmd:"CALL",fnName:C,params:[{var:0},{var:1},{val:U},{var:2},{var:3}]}),H==J?(_&&(K.push({cmd:"ALLOCSET",var:4,buff:nt}),K.push({cmd:"CALL",fnName:_,params:[{var:0},{val:U},{var:4}]}),K.push({cmd:"CALL",fnName:_,params:[{var:1},{val:U},{var:4}]})),M&&(K.push({cmd:"CALL",fnName:M,params:[{var:0},{val:U},{var:0}]}),K.push({cmd:"CALL",fnName:M,params:[{var:1},{val:U},{var:1}]})),K.push({cmd:"GET",out:0,var:0,len:U*A}),K.push({cmd:"GET",out:1,var:1,len:U*A})):(K.push({cmd:"GET",out:0,var:0,len:U*G}),K.push({cmd:"GET",out:1,var:1,len:U*G})),lt.push(o.queueAction(K).then(k=>(y&&y.debug(`${$}: fft ${J} join  ${H}/${J}  ${Tt+1}/${ut} ${Ft}/${ot/2}`),k)))}const Et=await Promise.all(lt);for(let Tt=0;Tt<ut;Tt++)for(let Ft=0;Ft<ot/2;Ft++){const v=Tt*ot+Ft,i=Tt*ot+Ft+ot/2,E=Et.shift();w[v]=E[0],w[i]=E[1]}}if(u instanceof Nt?O=new Nt(X*A):O=new Uint8Array(X*A),l){O.set(w[0].slice((U-1)*A));let H=A;for(let ut=W-1;ut>0;ut--)O.set(w[ut],H),H+=U*A,delete w[ut];O.set(w[0].slice(0,(U-1)*A),H),delete w[0]}else for(let H=0;H<W;H++)O.set(w[H],U*A*H),delete w[H];return h?ue(O,A):O}async function f(u,l,B,x,y){let $,R;$=u.slice(0,u.byteLength/2),R=u.slice(u.byteLength/2,u.byteLength);const I=[];[$,R]=await b($,R,"fftJoinExt",e.one,e.shift,l,"jacobian",x,y),I.push(c($,!1,"jacobian",B,x,y)),I.push(c(R,!1,"jacobian",B,x,y));const G=await Promise.all(I);let A;return G[0].byteLength>1<<28?A=new Nt(G[0].byteLength*2):A=new Uint8Array(G[0].byteLength*2),A.set(G[0]),A.set(G[1],G[0].byteLength),A}async function s(u,l,B,x,y){let $,R;$=u.slice(0,u.byteLength/2),R=u.slice(u.byteLength/2,u.byteLength);const I=[];I.push(c($,!0,l,"jacobian",x,y)),I.push(c(R,!0,l,"jacobian",x,y)),[$,R]=await Promise.all(I);const G=await b($,R,"fftJoinExtInv",e.one,e.shiftInv,"jacobian",B,x,y);let A;return G[0].byteLength>1<<28?A=new Nt(G[0].byteLength*2):A=new Uint8Array(G[0].byteLength*2),A.set(G[0]),A.set(G[1],G[0].byteLength),A}async function b(u,l,B,x,y,$,R,I,G){let M,ct,C,_,h,X;if(t=="G1")$=="affine"?(h=n.F.n8*2,ct="g1m_batchToJacobian"):h=n.F.n8*3,X=n.F.n8*3,M="g1m_"+B,R=="affine"?(C="g1m_batchToAffine",_=n.F.n8*2):_=n.F.n8*3;else if(t=="G2")$=="affine"?(h=n.F.n8*2,ct="g2m_batchToJacobian"):h=n.F.n8*3,M="g2m_"+B,X=n.F.n8*3,R=="affine"?(C="g2m_batchToAffine",_=n.F.n8*2):_=n.F.n8*3;else if(t=="Fr")h=e.n8,_=e.n8,X=e.n8,M="frm_"+B;else throw new Error("Invalid group");if(u.byteLength!=l.byteLength)throw new Error("Invalid buffer size");const J=Math.floor(u.byteLength/h);if(J!=1<<Yt(J))throw new Error("Invalid number of points");let nt=Math.floor(J/o.concurrency);nt<16&&(nt=16),nt>65536&&(nt=65536);const O=[];for(let st=0;st<J;st+=nt){I&&I.debug(`${G}: fftJoinExt Start: ${st}/${J}`);const H=Math.min(J-st,nt),ut=e.mul(x,e.exp(y,st)),ot=[],lt=u.slice(st*h,(st+H)*h),Et=l.slice(st*h,(st+H)*h);ot.push({cmd:"ALLOC",var:0,len:X*H}),ot.push({cmd:"SET",var:0,buff:lt}),ot.push({cmd:"ALLOC",var:1,len:X*H}),ot.push({cmd:"SET",var:1,buff:Et}),ot.push({cmd:"ALLOCSET",var:2,buff:ut}),ot.push({cmd:"ALLOCSET",var:3,buff:y}),ct&&(ot.push({cmd:"CALL",fnName:ct,params:[{var:0},{val:H},{var:0}]}),ot.push({cmd:"CALL",fnName:ct,params:[{var:1},{val:H},{var:1}]})),ot.push({cmd:"CALL",fnName:M,params:[{var:0},{var:1},{val:H},{var:2},{var:3},{val:e.s}]}),C&&(ot.push({cmd:"CALL",fnName:C,params:[{var:0},{val:H},{var:0}]}),ot.push({cmd:"CALL",fnName:C,params:[{var:1},{val:H},{var:1}]})),ot.push({cmd:"GET",out:0,var:0,len:H*_}),ot.push({cmd:"GET",out:1,var:1,len:H*_}),O.push(o.queueAction(ot).then(Tt=>(I&&I.debug(`${G}: fftJoinExt End: ${st}/${J}`),Tt)))}const w=await Promise.all(O);let U,W;J*_>1<<28?(U=new Nt(J*_),W=new Nt(J*_)):(U=new Uint8Array(J*_),W=new Uint8Array(J*_));let dt=0;for(let st=0;st<w.length;st++)U.set(w[st][0],dt),W.set(w[st][1],dt),dt+=w[st][0].byteLength;return[U,W]}n.fft=async function(u,l,B,x,y){return await c(u,!1,l,B,x,y)},n.ifft=async function(u,l,B,x,y){return await c(u,!0,l,B,x,y)},n.lagrangeEvaluations=async function(u,l,B,x,y){l=l||"affine",B=B||"affine";let $;if(t=="G1")l=="affine"?$=n.F.n8*2:$=n.F.n8*3;else if(t=="G2")l=="affine"?$=n.F.n8*2:$=n.F.n8*3;else if(t=="Fr")$=e.n8;else throw new Error("Invalid group");const R=u.byteLength/$,I=Yt(R);if(2**I*$!=u.byteLength)throw x&&x.error("lagrangeEvaluations iinvalid input size"),new Error("lagrangeEvaluations invalid Input size");if(I<=e.s)return await n.ifft(u,l,B,x,y);if(I>e.s+1)throw x&&x.error("lagrangeEvaluations input too big"),new Error("lagrangeEvaluations input too big");let G=u.slice(0,u.byteLength/2),A=u.slice(u.byteLength/2,u.byteLength);const Q=e.exp(e.shift,R/2),M=e.inv(e.sub(e.one,Q));[G,A]=await b(G,A,"prepareLagrangeEvaluation",M,e.shiftInv,l,"jacobian",x,y+" prep");const ct=[];ct.push(c(G,!0,"jacobian",B,x,y+" t0")),ct.push(c(A,!0,"jacobian",B,x,y+" t1")),[G,A]=await Promise.all(ct);let C;return G.byteLength>1<<28?C=new Nt(G.byteLength*2):C=new Uint8Array(G.byteLength*2),C.set(G),C.set(A,G.byteLength),C},n.fftMix=async function(l){const B=n.F.n8*3;let x,y;if(t=="G1")x="g1m_fftMix",y="g1m_fftJoin";else if(t=="G2")x="g2m_fftMix",y="g2m_fftJoin";else if(t=="Fr")x="frm_fftMix",y="frm_fftJoin";else throw new Error("Invalid group");const $=Math.floor(l.byteLength/B),R=Yt($);let I=1<<Yt(o.concurrency);$<=I*2&&(I=1);const G=$/I,A=Yt(G),Q=[];for(let h=0;h<I;h++){const X=[],J=l.slice(h*G*B,(h+1)*G*B);X.push({cmd:"ALLOCSET",var:0,buff:J});for(let nt=1;nt<=A;nt++)X.push({cmd:"CALL",fnName:x,params:[{var:0},{val:G},{val:nt}]});X.push({cmd:"GET",out:0,var:0,len:G*B}),Q.push(o.queueAction(X))}const M=await Promise.all(Q),ct=[];for(let h=0;h<M.length;h++)ct[h]=M[h][0];for(let h=A+1;h<=R;h++){const X=1<<R-h,J=I/X,nt=[];for(let w=0;w<X;w++)for(let U=0;U<J/2;U++){const W=e.exp(e.w[h],U*G),dt=e.w[h],st=w*J+U,H=w*J+U+J/2,ut=[];ut.push({cmd:"ALLOCSET",var:0,buff:ct[st]}),ut.push({cmd:"ALLOCSET",var:1,buff:ct[H]}),ut.push({cmd:"ALLOCSET",var:2,buff:W}),ut.push({cmd:"ALLOCSET",var:3,buff:dt}),ut.push({cmd:"CALL",fnName:y,params:[{var:0},{var:1},{val:G},{var:2},{var:3}]}),ut.push({cmd:"GET",out:0,var:0,len:G*B}),ut.push({cmd:"GET",out:1,var:1,len:G*B}),nt.push(o.queueAction(ut))}const O=await Promise.all(nt);for(let w=0;w<X;w++)for(let U=0;U<J/2;U++){const W=w*J+U,dt=w*J+U+J/2,st=O.shift();ct[W]=st[0],ct[dt]=st[1]}}let C;l instanceof Nt?C=new Nt($*B):C=new Uint8Array($*B);let _=0;for(let h=0;h<I;h++)C.set(ct[h],_),_+=ct[h].byteLength;return C},n.fftJoin=async function(l,B,x,y){const $=n.F.n8*3;let R;if(t=="G1")R="g1m_fftJoin";else if(t=="G2")R="g2m_fftJoin";else if(t=="Fr")R="frm_fftJoin";else throw new Error("Invalid group");if(l.byteLength!=B.byteLength)throw new Error("Invalid buffer size");const I=Math.floor(l.byteLength/$);if(I!=1<<Yt(I))throw new Error("Invalid number of points");let G=1<<Yt(o.concurrency);I<=G*2&&(G=1);const A=I/G,Q=[];for(let h=0;h<G;h++){const X=[],J=e.mul(x,e.exp(y,h*A)),nt=l.slice(h*A*$,(h+1)*A*$),O=B.slice(h*A*$,(h+1)*A*$);X.push({cmd:"ALLOCSET",var:0,buff:nt}),X.push({cmd:"ALLOCSET",var:1,buff:O}),X.push({cmd:"ALLOCSET",var:2,buff:J}),X.push({cmd:"ALLOCSET",var:3,buff:y}),X.push({cmd:"CALL",fnName:R,params:[{var:0},{var:1},{val:A},{var:2},{var:3}]}),X.push({cmd:"GET",out:0,var:0,len:A*$}),X.push({cmd:"GET",out:1,var:1,len:A*$}),Q.push(o.queueAction(X))}const M=await Promise.all(Q);let ct,C;l instanceof Nt?(ct=new Nt(I*$),C=new Nt(I*$)):(ct=new Uint8Array(I*$),C=new Uint8Array(I*$));let _=0;for(let h=0;h<M.length;h++)ct.set(M[h][0],_),C.set(M[h][1],_),_+=M[h][0].byteLength;return[ct,C]},n.fftFinal=async function(l,B){const x=n.F.n8*3,y=n.F.n8*2;let $,R;if(t=="G1")$="g1m_fftFinal",R="g1m_batchToAffine";else if(t=="G2")$="g2m_fftFinal",R="g2m_batchToAffine";else throw new Error("Invalid group");const I=Math.floor(l.byteLength/x);if(I!=1<<Yt(I))throw new Error("Invalid number of points");const G=Math.floor(I/o.concurrency),A=[];for(let C=0;C<o.concurrency;C++){let _;if(C<o.concurrency-1?_=G:_=I-C*G,_==0)continue;const h=[],X=l.slice(C*G*x,(C*G+_)*x);h.push({cmd:"ALLOCSET",var:0,buff:X}),h.push({cmd:"ALLOCSET",var:1,buff:B}),h.push({cmd:"CALL",fnName:$,params:[{var:0},{val:_},{var:1}]}),h.push({cmd:"CALL",fnName:R,params:[{var:0},{val:_},{var:0}]}),h.push({cmd:"GET",out:0,var:0,len:_*y}),A.push(o.queueAction(h))}const Q=await Promise.all(A);let M;l instanceof Nt?M=new Nt(I*y):M=new Uint8Array(I*y);let ct=0;for(let C=Q.length-1;C>=0;C--)M.set(Q[C][0],ct),ct+=Q[C][0].byteLength;return M}}async function Fa(a){const t=await zc(a.wasm,a.singleThread),n={};return n.q=jt(a.wasm.q.toString()),n.r=jt(a.wasm.r.toString()),n.name=a.name,n.tm=t,n.prePSize=a.wasm.prePSize,n.preQSize=a.wasm.preQSize,n.Fr=new Eo(t,"frm",a.n8r,a.r),n.F1=new Eo(t,"f1m",a.n8q,a.q),n.F2=new So(t,"f2m",n.F1),n.G1=new vo(t,"g1m",n.F1,a.wasm.pG1gen,a.wasm.pG1b,a.cofactorG1),n.G2=new vo(t,"g2m",n.F2,a.wasm.pG2gen,a.wasm.pG2b,a.cofactorG2),n.F6=new Tc(t,"f6m",n.F2),n.F12=new So(t,"ftm",n.F6),n.Gt=n.F12,Oe(n,"G1"),Oe(n,"G2"),Oe(n,"Fr"),qo(n,"G1"),qo(n,"G2"),ke(n,"G1"),ke(n,"G2"),ke(n,"Fr"),Nc(n),n.array2buffer=function(e,o){const c=new Uint8Array(o*e.length);for(let f=0;f<e.length;f++)c.set(e[f],f*o);return c},n.buffer2array=function(e,o){const c=e.byteLength/o,f=new Array(c);for(let s=0;s<c;s++)f[s]=e.slice(s*o,s*o+o);return f},n}function Mn(a){return BigInt(a)}function Ca(a){return a<0n}function $c(a){return a===0n}function Gc(a){return Ca(a)?a.toString(2).length-1:a.toString(2).length}function qe(a){const t=[],n=Mn(a);return t.push(Number(n&0xFFn)),t.push(Number(n>>8n&0xFFn)),t.push(Number(n>>16n&0xFFn)),t.push(Number(n>>24n&0xFFn)),t}function Wc(a){for(var t=[],n=0;n<a.length;n++){var e=a.charCodeAt(n);e<128?t.push(e):e<2048?t.push(192|e>>6,128|e&63):e<55296||e>=57344?t.push(224|e>>12,128|e>>6&63,128|e&63):(n++,e=65536+((e&1023)<<10|a.charCodeAt(n)&1023),t.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|e&63))}return t}function jn(a){const t=Wc(a);return[...kt(t.length),...t]}function Aa(a){const t=[];let n=Mn(a);if(Ca(n))throw new Error("Number cannot be negative");for(;!$c(n);)t.push(Number(n&0x7Fn)),n=n>>7n;t.length==0&&t.push(0);for(let e=0;e<t.length-1;e++)t[e]=t[e]|128;return t}function Ia(a){let t,n;const e=Gc(a);a<0?(n=!0,t=(1n<<BigInt(e))+a):(n=!1,t=Mn(a));const o=7-e%7,c=(1n<<BigInt(o))-1n<<BigInt(e),f=(1<<7-o)-1|128,s=Aa(t+c);return n||(s[s.length-1]=s[s.length-1]&f),s}function je(a){let t=Mn(a);if(t>0xFFFFFFFFn)throw new Error("Number too big");if(t>0x7FFFFFFFn&&(t=t-0x100000000n),t<-2147483648n)throw new Error("Number too small");return Ia(t)}function jc(a){let t=Mn(a);if(t>0xFFFFFFFFFFFFFFFFn)throw new Error("Number too big");if(t>0x7FFFFFFFFFFFFFFFn&&(t=t-0x10000000000000000n),t<-9223372036854775808n)throw new Error("Number too small");return Ia(t)}function kt(a){let t=Mn(a);if(t>0xFFFFFFFFn)throw new Error("Number too big");return Aa(t)}function To(a){return Array.from(a,function(t){return("0"+(t&255).toString(16)).slice(-2)}).join("")}class Dc{constructor(t){this.func=t,this.functionName=t.functionName,this.module=t.module}setLocal(t,n){const e=this.func.localIdxByName[t];if(e===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[...n,33,...kt(e)]}teeLocal(t,n){const e=this.func.localIdxByName[t];if(e===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[...n,34,...kt(e)]}getLocal(t){const n=this.func.localIdxByName[t];if(n===void 0)throw new Error(`Local Variable not defined: Function: ${this.functionName} local: ${t} `);return[32,...kt(n)]}i64_load8_s(t,n,e){const o=n||0,c=e===void 0?0:e;return[...t,48,c,...kt(o)]}i64_load8_u(t,n,e){const o=n||0,c=e===void 0?0:e;return[...t,49,c,...kt(o)]}i64_load16_s(t,n,e){const o=n||0,c=e===void 0?1:e;return[...t,50,c,...kt(o)]}i64_load16_u(t,n,e){const o=n||0,c=e===void 0?1:e;return[...t,51,c,...kt(o)]}i64_load32_s(t,n,e){const o=n||0,c=e===void 0?2:e;return[...t,52,c,...kt(o)]}i64_load32_u(t,n,e){const o=n||0,c=e===void 0?2:e;return[...t,53,c,...kt(o)]}i64_load(t,n,e){const o=n||0,c=e===void 0?3:e;return[...t,41,c,...kt(o)]}i64_store(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=3,s=n):Array.isArray(e)?(c=n,f=3,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,55,f,...kt(c)]}i64_store32(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=2,s=n):Array.isArray(e)?(c=n,f=2,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,62,f,...kt(c)]}i64_store16(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=1,s=n):Array.isArray(e)?(c=n,f=1,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,61,f,...kt(c)]}i64_store8(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=0,s=n):Array.isArray(e)?(c=n,f=0,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,60,f,...kt(c)]}i32_load8_s(t,n,e){const o=n||0,c=e===void 0?0:e;return[...t,44,c,...kt(o)]}i32_load8_u(t,n,e){const o=n||0,c=e===void 0?0:e;return[...t,45,c,...kt(o)]}i32_load16_s(t,n,e){const o=n||0,c=e===void 0?1:e;return[...t,46,c,...kt(o)]}i32_load16_u(t,n,e){const o=n||0,c=e===void 0?1:e;return[...t,47,c,...kt(o)]}i32_load(t,n,e){const o=n||0,c=e===void 0?2:e;return[...t,40,c,...kt(o)]}i32_store(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=2,s=n):Array.isArray(e)?(c=n,f=2,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,54,f,...kt(c)]}i32_store16(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=1,s=n):Array.isArray(e)?(c=n,f=1,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,59,f,...kt(c)]}i32_store8(t,n,e,o){let c,f,s;return Array.isArray(n)?(c=0,f=0,s=n):Array.isArray(e)?(c=n,f=0,s=e):Array.isArray(o)&&(c=n,f=e,s=o),[...t,...s,58,f,...kt(c)]}call(t,...n){const e=this.module.functionIdxByName[t];if(e===void 0)throw new Error(`Function not defined: Function: ${t}`);return[...[].concat(...n),16,...kt(e)]}call_indirect(t,...n){return[...[].concat(...n),...t,17,0,0]}if(t,n,e){return e?[...t,4,64,...n,5,...e,11]:[...t,4,64,...n,11]}block(t){return[2,64,...t,11]}loop(...t){return[3,64,...[].concat(...t),11]}br_if(t,n){return[...n,13,...kt(t)]}br(t){return[12,...kt(t)]}ret(t){return[...t,15]}drop(t){return[...t,26]}i64_const(t){return[66,...jc(t)]}i32_const(t){return[65,...je(t)]}i64_eqz(t){return[...t,80]}i64_eq(t,n){return[...t,...n,81]}i64_ne(t,n){return[...t,...n,82]}i64_lt_s(t,n){return[...t,...n,83]}i64_lt_u(t,n){return[...t,...n,84]}i64_gt_s(t,n){return[...t,...n,85]}i64_gt_u(t,n){return[...t,...n,86]}i64_le_s(t,n){return[...t,...n,87]}i64_le_u(t,n){return[...t,...n,88]}i64_ge_s(t,n){return[...t,...n,89]}i64_ge_u(t,n){return[...t,...n,90]}i64_add(t,n){return[...t,...n,124]}i64_sub(t,n){return[...t,...n,125]}i64_mul(t,n){return[...t,...n,126]}i64_div_s(t,n){return[...t,...n,127]}i64_div_u(t,n){return[...t,...n,128]}i64_rem_s(t,n){return[...t,...n,129]}i64_rem_u(t,n){return[...t,...n,130]}i64_and(t,n){return[...t,...n,131]}i64_or(t,n){return[...t,...n,132]}i64_xor(t,n){return[...t,...n,133]}i64_shl(t,n){return[...t,...n,134]}i64_shr_s(t,n){return[...t,...n,135]}i64_shr_u(t,n){return[...t,...n,136]}i64_extend_i32_s(t){return[...t,172]}i64_extend_i32_u(t){return[...t,173]}i64_clz(t){return[...t,121]}i64_ctz(t){return[...t,122]}i32_eqz(t){return[...t,69]}i32_eq(t,n){return[...t,...n,70]}i32_ne(t,n){return[...t,...n,71]}i32_lt_s(t,n){return[...t,...n,72]}i32_lt_u(t,n){return[...t,...n,73]}i32_gt_s(t,n){return[...t,...n,74]}i32_gt_u(t,n){return[...t,...n,75]}i32_le_s(t,n){return[...t,...n,76]}i32_le_u(t,n){return[...t,...n,77]}i32_ge_s(t,n){return[...t,...n,78]}i32_ge_u(t,n){return[...t,...n,79]}i32_add(t,n){return[...t,...n,106]}i32_sub(t,n){return[...t,...n,107]}i32_mul(t,n){return[...t,...n,108]}i32_div_s(t,n){return[...t,...n,109]}i32_div_u(t,n){return[...t,...n,110]}i32_rem_s(t,n){return[...t,...n,111]}i32_rem_u(t,n){return[...t,...n,112]}i32_and(t,n){return[...t,...n,113]}i32_or(t,n){return[...t,...n,114]}i32_xor(t,n){return[...t,...n,115]}i32_shl(t,n){return[...t,...n,116]}i32_shr_s(t,n){return[...t,...n,117]}i32_shr_u(t,n){return[...t,...n,118]}i32_rotl(t,n){return[...t,...n,119]}i32_rotr(t,n){return[...t,...n,120]}i32_wrap_i64(t){return[...t,167]}i32_clz(t){return[...t,103]}i32_ctz(t){return[...t,104]}unreachable(){return[0]}current_memory(){return[63,0]}comment(){return[]}}const Te={i32:127,i64:126,f32:125,f64:124,anyfunc:112,func:96,emptyblock:64};class Uo{constructor(t,n,e,o,c){if(e=="import")this.fnType="import",this.moduleName=o,this.fieldName=c;else if(e=="internal")this.fnType="internal";else throw new Error("Invalid function fnType: "+e);this.module=t,this.fnName=n,this.params=[],this.locals=[],this.localIdxByName={},this.code=[],this.returnType=null,this.nextLocal=0}addParam(t,n){if(this.localIdxByName[t])throw new Error(`param already exists. Function: ${this.fnName}, Param: ${t} `);const e=this.nextLocal++;this.localIdxByName[t]=e,this.params.push({type:n})}addLocal(t,n,e){const o=e||1;if(this.localIdxByName[t])throw new Error(`local already exists. Function: ${this.fnName}, Param: ${t} `);const c=this.nextLocal++;this.localIdxByName[t]=c,this.locals.push({type:n,length:o})}setReturnType(t){if(this.returnType)throw new Error(`returnType already defined. Function: ${this.fnName}`);this.returnType=t}getSignature(){const t=[...kt(this.params.length),...this.params.map(e=>Te[e.type])],n=this.returnType?[1,Te[this.returnType]]:[0];return[96,...t,...n]}getBody(){const t=this.locals.map(e=>[...kt(e.length),Te[e.type]]),n=[...kt(this.locals.length),...[].concat(...t),...this.code,11];return[...kt(n.length),...n]}addCode(...t){this.code.push(...[].concat(...t))}getCodeBuilder(){return new Dc(this)}}class Ea{constructor(){this.functions=[],this.functionIdxByName={},this.nImportFunctions=0,this.nInternalFunctions=0,this.memory={pagesSize:1,moduleName:"env",fieldName:"memory"},this.free=8,this.datas=[],this.modules={},this.exports=[],this.functionsTable=[]}build(){return this._setSignatures(),new Uint8Array([...qe(1836278016),...qe(1),...this._buildType(),...this._buildImport(),...this._buildFunctionDeclarations(),...this._buildFunctionsTable(),...this._buildExports(),...this._buildElements(),...this._buildCode(),...this._buildData()])}addFunction(t){if(typeof this.functionIdxByName[t]<"u")throw new Error(`Function already defined: ${t}`);const n=this.functions.length;return this.functionIdxByName[t]=n,this.functions.push(new Uo(this,t,"internal")),this.nInternalFunctions++,this.functions[n]}addIimportFunction(t,n,e){if(typeof this.functionIdxByName[t]<"u")throw new Error(`Function already defined: ${t}`);if(this.functions.length>0&&this.functions[this.functions.length-1].type=="internal")throw new Error(`Import functions must be declared before internal: ${t}`);let o=e||t;const c=this.functions.length;return this.functionIdxByName[t]=c,this.functions.push(new Uo(this,t,"import",n,o)),this.nImportFunctions++,this.functions[c]}setMemory(t,n,e){this.memory={pagesSize:t,moduleName:n||"env",fieldName:e||"memory"}}exportFunction(t,n){const e=n||t;if(typeof this.functionIdxByName[t]>"u")throw new Error(`Function not defined: ${t}`);const o=this.functionIdxByName[t];e!=t&&(this.functionIdxByName[e]=o),this.exports.push({exportName:e,idx:o})}addFunctionToTable(t){const n=this.functionIdxByName[t];this.functionsTable.push(n)}addData(t,n){this.datas.push({offset:t,bytes:n})}alloc(t,n){let e,o;(Array.isArray(t)||ArrayBuffer.isView(t))&&typeof n>"u"?(e=t.length,o=t):(e=t,o=n),e=(e-1>>3)+1<<3;const c=this.free;return this.free+=e,o&&this.addData(c,o),c}allocString(t){const e=new globalThis.TextEncoder().encode(t);return this.alloc([...e,0])}_setSignatures(){this.signatures=[];const t={};if(this.functionsTable.length>0){const n=this.functions[this.functionsTable[0]].getSignature(),e="s_"+To(n);t[e]=0,this.signatures.push(n)}for(let n=0;n<this.functions.length;n++){const e=this.functions[n].getSignature(),o="s_"+To(e);typeof t[o]>"u"&&(t[o]=this.signatures.length,this.signatures.push(e)),this.functions[n].signatureIdx=t[o]}}_buildSection(t,n){return[t,...kt(n.length),...n]}_buildType(){return this._buildSection(1,[...kt(this.signatures.length),...[].concat(...this.signatures)])}_buildImport(){const t=[];t.push([...jn(this.memory.moduleName),...jn(this.memory.fieldName),2,0,...kt(this.memory.pagesSize)]);for(let n=0;n<this.nImportFunctions;n++)t.push([...jn(this.functions[n].moduleName),...jn(this.functions[n].fieldName),0,...kt(this.functions[n].signatureIdx)]);return this._buildSection(2,kt(t.length).concat(...t))}_buildFunctionDeclarations(){const t=[];for(let n=this.nImportFunctions;n<this.nImportFunctions+this.nInternalFunctions;n++)t.push(...kt(this.functions[n].signatureIdx));return this._buildSection(3,[...kt(t.length),...t])}_buildFunctionsTable(){return this.functionsTable.length==0?[]:this._buildSection(4,[...kt(1),112,0,...kt(this.functionsTable.length)])}_buildElements(){if(this.functionsTable.length==0)return[];const t=[];for(let n=0;n<this.functionsTable.length;n++)t.push(...kt(this.functionsTable[n]));return this._buildSection(9,[...kt(1),...kt(0),65,...je(0),11,...kt(this.functionsTable.length),...t])}_buildExports(){const t=[];for(let n=0;n<this.exports.length;n++)t.push([...jn(this.exports[n].exportName),0,...kt(this.exports[n].idx)]);return this._buildSection(7,kt(t.length).concat(...t))}_buildCode(){const t=[];for(let n=this.nImportFunctions;n<this.nImportFunctions+this.nInternalFunctions;n++)t.push(this.functions[n].getBody());return this._buildSection(10,kt(t.length).concat(...t))}_buildData(){const t=[];t.push([0,65,0,11,4,...qe(this.free)]);for(let n=0;n<this.datas.length;n++)t.push([0,65,...je(this.datas[n].offset),11,...kt(this.datas[n].bytes.length),...this.datas[n].bytes]);return this._buildSection(11,kt(t.length).concat(...t))}}globalThis.curve_bn128=null;async function Sa(a,t){if(!a&&globalThis.curve_bn128)return globalThis.curve_bn128;const n=new Ea;n.setMemory(25),Ec(n);const e={};e.code=n.build(),e.pq=n.modules.f1m.pq,e.pr=n.modules.frm.pq,e.pG1gen=n.modules.bn128.pG1gen,e.pG1zero=n.modules.bn128.pG1zero,e.pG1b=n.modules.bn128.pG1b,e.pG2gen=n.modules.bn128.pG2gen,e.pG2zero=n.modules.bn128.pG2zero,e.pG2b=n.modules.bn128.pG2b,e.pOneT=n.modules.bn128.pOneT,e.prePSize=n.modules.bn128.prePSize,e.preQSize=n.modules.bn128.preQSize,e.n8q=32,e.n8r=32,e.q=n.modules.bn128.q,e.r=n.modules.bn128.r;const o={name:"bn128",wasm:e,q:jt("21888242871839275222246405745257275088696311157297823662689037894645226208583"),r:jt("21888242871839275222246405745257275088548364400416034343698204186575808495617"),n8q:32,n8r:32,cofactorG2:jt("30644e72e131a029b85045b68181585e06ceecda572a2489345f2299c0f9fa8d",16),singleThread:!!a},c=await Fa(o);return c.terminate=async function(){o.singleThread||(globalThis.curve_bn128=null,await this.tm.terminate())},a||(globalThis.curve_bn128=c),c}globalThis.curve_bls12381=null;async function va(a,t){if(!a&&globalThis.curve_bls12381)return globalThis.curve_bls12381;const n=new Ea;n.setMemory(25),Sc(n);const e={};e.code=n.build(),e.pq=n.modules.f1m.pq,e.pr=n.modules.frm.pq,e.pG1gen=n.modules.bls12381.pG1gen,e.pG1zero=n.modules.bls12381.pG1zero,e.pG1b=n.modules.bls12381.pG1b,e.pG2gen=n.modules.bls12381.pG2gen,e.pG2zero=n.modules.bls12381.pG2zero,e.pG2b=n.modules.bls12381.pG2b,e.pOneT=n.modules.bls12381.pOneT,e.prePSize=n.modules.bls12381.prePSize,e.preQSize=n.modules.bls12381.preQSize,e.n8q=48,e.n8r=32,e.q=n.modules.bls12381.q,e.r=n.modules.bls12381.r;const o={name:"bls12381",wasm:e,q:jt("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16),r:jt("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16),n8q:48,n8r:32,cofactorG1:jt("0x396c8c005555e1568c00aaab0000aaab",16),cofactorG2:jt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5",16),singleThread:!!a},c=await Fa(o);return c.terminate=async function(){o.singleThread||(globalThis.curve_bls12381=null,await this.tm.terminate())},a||(globalThis.curve_bls12381=c),c}jt("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);jt("21888242871839275222246405745257275088548364400416034343698204186575808495617");jt("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16);jt("21888242871839275222246405745257275088696311157297823662689037894645226208583");const Gt=Ii,Ht=qc;var Pa={};async function Oa(a,t,n,e){if(n=n||4096*64,typeof t!="number"&&["w+","wx+","r","ax+","a+"].indexOf(t)<0)throw new Error("Invalid open option");const o=await Pa.promises.open(a,t),c=await o.stat();return new Zc(o,c,n,e,a)}class Zc{constructor(t,n,e,o,c){for(this.fileName=c,this.fd=t,this.pos=0,this.pageSize=o||256;this.pageSize<n.blksize;)this.pageSize*=2;this.totalSize=n.size,this.totalPages=Math.floor((n.size-1)/this.pageSize)+1,this.maxPagesLoaded=Math.floor(e/this.pageSize)+1,this.pages={},this.pendingLoads=[],this.writing=!1,this.reading=!1,this.avBuffs=[],this.history={}}_loadPage(t){const n=this,e=new Promise((o,c)=>{n.pendingLoads.push({page:t,resolve:o,reject:c})});return n.__statusPage("After Load request: ",t),e}__statusPage(t,n){const e=[],o=this;if(!o.logHistory)return;e.push("=="+t+" "+n);let c="";for(let f=0;f<o.pendingLoads.length;f++)o.pendingLoads[f].page==n&&(c=c+" "+f);if(c&&e.push("Pending loads:"+c),typeof o.pages[n]<"u"){const f=o.pages[n];e.push("Loaded"),e.push("pendingOps: "+f.pendingOps),f.loading&&e.push("loading: "+f.loading),f.writing&&e.push("writing"),f.dirty&&e.push("dirty")}e.push("=="),o.history[n]||(o.history[n]=[]),o.history[n].push(e)}__printHistory(t){const n=this;n.history[t]||console.log("Empty History ",t),console.log("History "+t);for(let e=0;e<n.history[t].length;e++)for(let o=0;o<n.history[t][e].length;o++)console.log("-> "+n.history[t][e][o])}_triggerLoad(){const t=this;if(t.reading||t.pendingLoads.length==0)return;const n=Object.keys(t.pages),e=[];for(let s=0;s<n.length;s++){const b=t.pages[parseInt(n[s])];b.dirty==!1&&b.pendingOps==0&&!b.writing&&!b.loading&&e.push(parseInt(n[s]))}let o=t.maxPagesLoaded-n.length;const c=[];for(;t.pendingLoads.length>0&&(typeof t.pages[t.pendingLoads[0].page]<"u"||o>0||e.length>0);){const s=t.pendingLoads.shift();if(typeof t.pages[s.page]<"u"){t.pages[s.page].pendingOps++;const b=e.indexOf(s.page);b>=0&&e.splice(b,1),t.pages[s.page].loading?t.pages[s.page].loading.push(s):s.resolve(),t.__statusPage("After Load (cached): ",s.page)}else{if(o)o--;else{const b=e.shift();t.__statusPage("Before Unload: ",b),t.avBuffs.unshift(t.pages[b]),delete t.pages[b],t.__statusPage("After Unload: ",b)}s.page>=t.totalPages?(t.pages[s.page]=f(),s.resolve(),t.__statusPage("After Load (new): ",s.page)):(t.reading=!0,t.pages[s.page]=f(),t.pages[s.page].loading=[s],c.push(t.fd.read(t.pages[s.page].buff,0,t.pageSize,s.page*t.pageSize).then(b=>{t.pages[s.page].size=b.bytesRead;const u=t.pages[s.page].loading;delete t.pages[s.page].loading;for(let l=0;l<u.length;l++)u[l].resolve();return t.__statusPage("After Load (loaded): ",s.page),b},b=>{s.reject(b)})),t.__statusPage("After Load (loading): ",s.page))}}Promise.all(c).then(()=>{t.reading=!1,t.pendingLoads.length>0&&setImmediate(t._triggerLoad.bind(t)),t._tryClose()});function f(){if(t.avBuffs.length>0){const s=t.avBuffs.shift();return s.dirty=!1,s.pendingOps=1,s.size=0,s}else return{dirty:!1,buff:new Uint8Array(t.pageSize),pendingOps:1,size:0}}}_triggerWrite(){const t=this;if(t.writing)return;const n=Object.keys(t.pages),e=[];for(let o=0;o<n.length;o++){const c=t.pages[parseInt(n[o])];c.dirty&&(c.dirty=!1,c.writing=!0,t.writing=!0,e.push(t.fd.write(c.buff,0,c.size,parseInt(n[o])*t.pageSize).then(()=>{c.writing=!1},f=>{console.log("ERROR Writing: "+f),t.error=f,t._tryClose()})))}t.writing&&Promise.all(e).then(()=>{t.writing=!1,setImmediate(t._triggerWrite.bind(t)),t._tryClose(),t.pendingLoads.length>0&&setImmediate(t._triggerLoad.bind(t))})}_getDirtyPage(){for(let t in this.pages)if(this.pages[t].dirty)return t;return-1}async write(t,n){if(t.byteLength==0)return;const e=this;if(typeof n>"u"&&(n=e.pos),e.pos=n+t.byteLength,e.totalSize<n+t.byteLength&&(e.totalSize=n+t.byteLength),e.pendingClose)throw new Error("Writing a closing file");const o=Math.floor(n/e.pageSize),c=Math.floor((n+t.byteLength-1)/e.pageSize),f=[];for(let l=o;l<=c;l++)f.push(e._loadPage(l));e._triggerLoad();let s=o,b=n%e.pageSize,u=t.byteLength;for(;u>0;){await f[s-o];const l=b+u>e.pageSize?e.pageSize-b:u,B=t.slice(t.byteLength-u,t.byteLength-u+l);new Uint8Array(e.pages[s].buff.buffer,b,l).set(B),e.pages[s].dirty=!0,e.pages[s].pendingOps--,e.pages[s].size=Math.max(b+l,e.pages[s].size),s>=e.totalPages&&(e.totalPages=s+1),u=u-l,s++,b=0,e.writing||setImmediate(e._triggerWrite.bind(e))}}async read(t,n){const e=this;let o=new Uint8Array(t);return await e.readToBuffer(o,0,t,n),o}async readToBuffer(t,n,e,o){if(e==0)return;const c=this;if(e>c.pageSize*c.maxPagesLoaded*.8){const x=Math.floor(e*1.1);this.maxPagesLoaded=Math.floor(x/c.pageSize)+1}if(typeof o>"u"&&(o=c.pos),c.pos=o+e,c.pendingClose)throw new Error("Reading a closing file");const f=Math.floor(o/c.pageSize),s=Math.floor((o+e-1)/c.pageSize),b=[];for(let x=f;x<=s;x++)b.push(c._loadPage(x));c._triggerLoad();let u=f,l=o%c.pageSize,B=o+e>c.totalSize?e-(o+e-c.totalSize):e;for(;B>0;){await b[u-f],c.__statusPage("After Await (read): ",u);const x=l+B>c.pageSize?c.pageSize-l:B,y=new Uint8Array(c.pages[u].buff.buffer,c.pages[u].buff.byteOffset+l,x);t.set(y,n+e-B),c.pages[u].pendingOps--,c.__statusPage("After Op done: ",u),B=B-x,u++,l=0,c.pendingLoads.length>0&&setImmediate(c._triggerLoad.bind(c))}this.pos=o+e}_tryClose(){const t=this;!t.pendingClose||(t.error&&t.pendingCloseReject(t.error),t._getDirtyPage()>=0||t.writing||t.reading||t.pendingLoads.length>0)||t.pendingClose()}close(){const t=this;if(t.pendingClose)throw new Error("Closing the file twice");return new Promise((n,e)=>{t.pendingClose=n,t.pendingCloseReject=e,t._tryClose()}).then(()=>{t.fd.close()},n=>{throw t.fd.close(),n})}async discard(){await this.close(),await Pa.promises.unlink(this.fileName)}async writeULE32(t,n){const e=this,o=new Uint8Array(4);new DataView(o.buffer).setUint32(0,t,!0),await e.write(o,n)}async writeUBE32(t,n){const e=this,o=new Uint8Array(4);new DataView(o.buffer).setUint32(0,t,!1),await e.write(o,n)}async writeULE64(t,n){const e=this,o=new Uint8Array(8),c=new DataView(o.buffer);c.setUint32(0,t&4294967295,!0),c.setUint32(4,Math.floor(t/4294967296),!0),await e.write(o,n)}async readULE32(t){const e=await this.read(4,t);return new Uint32Array(e.buffer)[0]}async readUBE32(t){const e=await this.read(4,t);return new DataView(e.buffer).getUint32(0,!1)}async readULE64(t){const e=await this.read(8,t),o=new Uint32Array(e.buffer);return o[1]*4294967296+o[0]}async readString(t){const n=this;if(n.pendingClose)throw new Error("Reading a closing file");let e=typeof t>"u"?n.pos:t,o=Math.floor(e/n.pageSize),c=!1,f="";for(;!c;){let s=n._loadPage(o);n._triggerLoad(),await s,n.__statusPage("After Await (read): ",o);let b=e%n.pageSize;const u=new Uint8Array(n.pages[o].buff.buffer,n.pages[o].buff.byteOffset+b,n.pageSize-b);let l=u.findIndex(B=>B===0);c=l!==-1,c?(f+=new TextDecoder().decode(u.slice(0,l)),n.pos=o*this.pageSize+b+l+1):(f+=new TextDecoder().decode(u),n.pos=o*this.pageSize+b+u.length),n.pages[o].pendingOps--,n.__statusPage("After Op done: ",o),e=n.pos,o++,n.pendingLoads.length>0&&setImmediate(n._triggerLoad.bind(n))}return f}}function Xc(a){const t=a.initialSize||1048576,n=new qa;return n.o=a,n.o.data=new Uint8Array(t),n.allocSize=t,n.totalSize=0,n.readOnly=!1,n.pos=0,n}function Kc(a){const t=new qa;return t.o=a,t.allocSize=a.data.byteLength,t.totalSize=a.data.byteLength,t.readOnly=!0,t.pos=0,t}const De=new Uint8Array(4),Mo=new DataView(De.buffer),ka=new Uint8Array(8),zo=new DataView(ka.buffer);class qa{constructor(){this.pageSize=16384}_resizeIfNeeded(t){if(t>this.allocSize){const n=Math.max(this.allocSize+1048576,Math.floor(this.allocSize*1.1),t),e=new Uint8Array(n);e.set(this.o.data),this.o.data=e,this.allocSize=n}}async write(t,n){if(typeof n>"u"&&(n=this.pos),this.readOnly)throw new Error("Writing a read only file");this._resizeIfNeeded(n+t.byteLength),this.o.data.set(t.slice(),n),n+t.byteLength>this.totalSize&&(this.totalSize=n+t.byteLength),this.pos=n+t.byteLength}async readToBuffer(t,n,e,o){if(typeof o>"u"&&(o=this.pos),this.readOnly&&o+e>this.totalSize)throw new Error("Reading out of bounds");this._resizeIfNeeded(o+e);const f=new Uint8Array(this.o.data.buffer,this.o.data.byteOffset+o,e);t.set(f,n),this.pos=o+e}async read(t,n){const e=this,o=new Uint8Array(t);return await e.readToBuffer(o,0,t,n),o}close(){this.o.data.byteLength!=this.totalSize&&(this.o.data=this.o.data.slice(0,this.totalSize))}async discard(){}async writeULE32(t,n){const e=this;Mo.setUint32(0,t,!0),await e.write(De,n)}async writeUBE32(t,n){const e=this;Mo.setUint32(0,t,!1),await e.write(De,n)}async writeULE64(t,n){const e=this;zo.setUint32(0,t&4294967295,!0),zo.setUint32(4,Math.floor(t/4294967296),!0),await e.write(ka,n)}async readULE32(t){const e=await this.read(4,t);return new Uint32Array(e.buffer)[0]}async readUBE32(t){const e=await this.read(4,t);return new DataView(e.buffer).getUint32(0,!1)}async readULE64(t){const e=await this.read(8,t),o=new Uint32Array(e.buffer);return o[1]*4294967296+o[0]}async readString(t){const n=this;let e=typeof t>"u"?n.pos:t;if(e>this.totalSize){if(this.readOnly)throw new Error("Reading out of bounds");this._resizeIfNeeded(t)}const o=new Uint8Array(n.o.data.buffer,e,this.totalSize-e);let c=o.findIndex(b=>b===0),f=c!==-1,s="";return f?(s=new TextDecoder().decode(o.slice(0,c)),n.pos=e+c+1):n.pos=e,s}}const Zt=1<<22;function Vc(a){const t=a.initialSize||0,n=new Ua;n.o=a;const e=t?Math.floor((t-1)/Zt)+1:0;n.o.data=[];for(let o=0;o<e-1;o++)n.o.data.push(new Uint8Array(Zt));return e&&n.o.data.push(new Uint8Array(t-Zt*(e-1))),n.totalSize=0,n.readOnly=!1,n.pos=0,n}function Qc(a){const t=new Ua;return t.o=a,t.totalSize=(a.data.length-1)*Zt+a.data[a.data.length-1].byteLength,t.readOnly=!0,t.pos=0,t}const Ze=new Uint8Array(4),Ro=new DataView(Ze.buffer),Ta=new Uint8Array(8),No=new DataView(Ta.buffer);class Ua{constructor(){this.pageSize=16384}_resizeIfNeeded(t){if(t<=this.totalSize)return;if(this.readOnly)throw new Error("Reading out of file bounds");const n=Math.floor((t-1)/Zt)+1;for(let e=Math.max(this.o.data.length-1,0);e<n;e++){const o=e<n-1?Zt:t-(n-1)*Zt,c=new Uint8Array(o);e==this.o.data.length-1&&c.set(this.o.data[e]),this.o.data[e]=c}this.totalSize=t}async write(t,n){const e=this;if(typeof n>"u"&&(n=e.pos),this.readOnly)throw new Error("Writing a read only file");this._resizeIfNeeded(n+t.byteLength);let c=Math.floor(n/Zt),f=n%Zt,s=t.byteLength;for(;s>0;){const b=f+s>Zt?Zt-f:s,u=t.slice(t.byteLength-s,t.byteLength-s+b);new Uint8Array(e.o.data[c].buffer,f,b).set(u),s=s-b,c++,f=0}this.pos=n+t.byteLength}async readToBuffer(t,n,e,o){const c=this;if(typeof o>"u"&&(o=c.pos),this.readOnly&&o+e>this.totalSize)throw new Error("Reading out of bounds");this._resizeIfNeeded(o+e);let s=Math.floor(o/Zt),b=o%Zt,u=e;for(;u>0;){const l=b+u>Zt?Zt-b:u,B=new Uint8Array(c.o.data[s].buffer,b,l);t.set(B,n+e-u),u=u-l,s++,b=0}this.pos=o+e}async read(t,n){const e=this,o=new Uint8Array(t);return await e.readToBuffer(o,0,t,n),o}close(){}async discard(){}async writeULE32(t,n){const e=this;Ro.setUint32(0,t,!0),await e.write(Ze,n)}async writeUBE32(t,n){const e=this;Ro.setUint32(0,t,!1),await e.write(Ze,n)}async writeULE64(t,n){const e=this;No.setUint32(0,t&4294967295,!0),No.setUint32(4,Math.floor(t/4294967296),!0),await e.write(Ta,n)}async readULE32(t){const e=await this.read(4,t);return new Uint32Array(e.buffer)[0]}async readUBE32(t){const e=await this.read(4,t);return new DataView(e.buffer).getUint32(0,!1)}async readULE64(t){const e=await this.read(8,t),o=new Uint32Array(e.buffer);return o[1]*4294967296+o[0]}async readString(t){const n=this,e=2048;let o=typeof t>"u"?n.pos:t;if(o>this.totalSize){if(this.readOnly)throw new Error("Reading out of bounds");this._resizeIfNeeded(t)}let c=!1,f="";for(;!c;){let s=Math.floor(o/Zt),b=o%Zt;if(n.o.data[s]===void 0)throw new Error("ERROR");let u=Math.min(e,n.o.data[s].length-b);const l=new Uint8Array(n.o.data[s].buffer,b,u);let B=l.findIndex(x=>x===0);c=B!==-1,c?(f+=new TextDecoder().decode(l.slice(0,B)),n.pos=s*Zt+b+B+1):(f+=new TextDecoder().decode(l),n.pos=s*Zt+b+l.length),o=n.pos}return f}}const Hc=1024,Jc=512,Yc=2,ts=0,ns=65536,es=8192;async function Ma(a,t,n){if(typeof a=="string"&&(a={type:"file",fileName:a,cacheSize:ns,pageSize:es}),a.type=="file")return await Oa(a.fileName,Hc|Jc|Yc,a.cacheSize,a.pageSize);if(a.type=="mem")return Xc(a);if(a.type=="bigMem")return Vc(a);throw new Error("Invalid FastFile type: "+a.type)}async function za(a,t,n){if(a instanceof Uint8Array&&(a={type:"mem",data:a}),typeof a=="string"&&(a={type:"mem",data:await fetch(a).then(function(o){return o.arrayBuffer()}).then(function(o){return new Uint8Array(o)})}),a.type=="file")return await Oa(a.fileName,ts,a.cacheSize,a.pageSize);if(a.type=="mem")return await Kc(a);if(a.type=="bigMem")return await Qc(a);throw new Error("Invalid FastFile type: "+a.type)}async function $o(a,t,n,e,o){const c=await za(a),f=await c.read(4);let s="";for(let B=0;B<4;B++)s+=String.fromCharCode(f[B]);if(s!=t)throw new Error(a+": Invalid File format");if(await c.readULE32()>n)throw new Error("Version not supported");const u=await c.readULE32();let l=[];for(let B=0;B<u;B++){let x=await c.readULE32(),y=await c.readULE64();typeof l[x]>"u"&&(l[x]=[]),l[x].push({p:c.pos,size:y}),c.pos+=y}return{fd:c,sections:l}}async function os(a,t,n,e,o,c){const f=await Ma(a),s=new Uint8Array(4);for(let b=0;b<4;b++)s[b]=t.charCodeAt(b);return await f.write(s,0),await f.writeULE32(n),await f.writeULE32(e),f}async function Go(a,t){if(typeof a.writingSection<"u")throw new Error("Already writing a section");await a.writeULE32(t),a.writingSection={pSectionSize:a.pos},await a.writeULE64(0)}async function Wo(a){if(typeof a.writingSection>"u")throw new Error("Not writing a section");const t=a.pos-a.writingSection.pSectionSize-8,n=a.pos;a.pos=a.writingSection.pSectionSize,await a.writeULE64(t),a.pos=n,delete a.writingSection}async function te(a,t,n){if(typeof a.readingSection<"u")throw new Error("Already reading a section");if(!t[n])throw new Error(a.fileName+": Missing section "+n);if(t[n].length>1)throw new Error(a.fileName+": Section Duplicated "+n);a.pos=t[n][0].p,a.readingSection=t[n][0]}async function ne(a,t){if(typeof a.readingSection>"u")throw new Error("Not reading a section");if(a.pos-a.readingSection.p!=a.readingSection.size)throw new Error("Invalid section size reading");delete a.readingSection}async function as(a,t,n,e){const o=new Uint8Array(n);Gt.toRprLE(o,0,t,n),await a.write(o,e)}async function En(a,t,n){const e=await a.read(t,n);return Gt.fromRprLE(e,0,t)}async function Cn(a,t,n,e,o){if(e=typeof e>"u"?0:e,o=typeof o>"u"?t[n][0].size-e:o,e+o>t[n][0].size)throw new Error("Reading out of the range of the section");let c;return o<1<<30?c=new Uint8Array(o):c=new Nt(o),await a.readToBuffer(c,0,o,t[n][0].p+e),c}Gt.e("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);Gt.e("21888242871839275222246405745257275088548364400416034343698204186575808495617");const is=Gt.e("1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",16),cs=Gt.e("21888242871839275222246405745257275088696311157297823662689037894645226208583");async function io(a,t){let n,e=t&&t.singleThread;if(Gt.eq(a,cs))n=await Sa(e);else if(Gt.eq(a,is))n=await va(e);else throw new Error(`Curve not supported: ${Gt.toString(a)}`);return n}async function ss(a,t){let n,e=t&&t.singleThread;const o=c(a);if(["BN128","BN254","ALTBN128"].indexOf(o)>=0)n=await Sa(e);else if(["BLS12381"].indexOf(o)>=0)n=await va(e);else throw new Error(`Curve not supported: ${a}`);return n;function c(f){return f.toUpperCase().match(/[A-Za-z0-9]+/g).join("")}}new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Le(a){return(a&4294901760?(a&=4294901760,16):0)|(a&4278255360?(a&=4278255360,8):0)|(a&4042322160?(a&=4042322160,4):0)|(a&3435973836?(a&=3435973836,2):0)|(a&2863311530)!==0}const ls=1,rs=2,Ra=10,ds=2;async function nn(a,t,n){const e=await a.read(t.G1.F.n8*2),o=t.G1.fromRprLEM(e,0);return n?t.G1.toObject(o):o}async function Zn(a,t,n){const e=await a.read(t.G2.F.n8*2),o=t.G2.fromRprLEM(e,0);return n?t.G2.toObject(o):o}async function us(a,t,n,e){await te(a,t,1);const o=await a.readULE32();if(await ne(a),o===ls)return await _s(a,t,n,e);if(o===rs)return await gs(a,t,n,e);if(o===Ra)return await fs(a,t,n,e);throw new Error("Protocol not supported: ")}async function _s(a,t,n,e){const o={};o.protocol="groth16",await te(a,t,2);const c=await a.readULE32();o.n8q=c,o.q=await En(a,c);const f=await a.readULE32();return o.n8r=f,o.r=await En(a,f),o.curve=await io(o.q,e),o.nVars=await a.readULE32(),o.nPublic=await a.readULE32(),o.domainSize=await a.readULE32(),o.power=Le(o.domainSize),o.vk_alpha_1=await nn(a,o.curve,n),o.vk_beta_1=await nn(a,o.curve,n),o.vk_beta_2=await Zn(a,o.curve,n),o.vk_gamma_2=await Zn(a,o.curve,n),o.vk_delta_1=await nn(a,o.curve,n),o.vk_delta_2=await Zn(a,o.curve,n),await ne(a),o}async function gs(a,t,n,e){const o={};o.protocol="plonk",await te(a,t,2);const c=await a.readULE32();o.n8q=c,o.q=await En(a,c);const f=await a.readULE32();return o.n8r=f,o.r=await En(a,f),o.curve=await io(o.q,e),o.nVars=await a.readULE32(),o.nPublic=await a.readULE32(),o.domainSize=await a.readULE32(),o.power=Le(o.domainSize),o.nAdditions=await a.readULE32(),o.nConstraints=await a.readULE32(),o.k1=await a.read(f),o.k2=await a.read(f),o.Qm=await nn(a,o.curve,n),o.Ql=await nn(a,o.curve,n),o.Qr=await nn(a,o.curve,n),o.Qo=await nn(a,o.curve,n),o.Qc=await nn(a,o.curve,n),o.S1=await nn(a,o.curve,n),o.S2=await nn(a,o.curve,n),o.S3=await nn(a,o.curve,n),o.X_2=await Zn(a,o.curve,n),await ne(a),o}async function fs(a,t,n,e){const o={};o.protocol="fflonk",o.protocolId=Ra,await te(a,t,ds);const c=await a.readULE32();o.n8q=c,o.q=await En(a,c),o.curve=await io(o.q,e);const f=await a.readULE32();return o.n8r=f,o.r=await En(a,f),o.nVars=await a.readULE32(),o.nPublic=await a.readULE32(),o.domainSize=await a.readULE32(),o.power=Le(o.domainSize),o.nAdditions=await a.readULE32(),o.nConstraints=await a.readULE32(),o.k1=await a.read(f),o.k2=await a.read(f),o.w3=await a.read(f),o.w4=await a.read(f),o.w8=await a.read(f),o.wr=await a.read(f),o.X_2=await Zn(a,o.curve,n),o.C0=await nn(a,o.curve,n),await ne(a),o}async function ps(a,t,n){await Go(a,1);const e=(Math.floor((Gt.bitLength(n)-1)/64)+1)*8;if(await a.writeULE32(e),await as(a,n,e),t.byteLength%e!=0)throw new Error("Invalid witness length");await a.writeULE32(t.byteLength/e),await Wo(a),await Go(a,2),await a.write(t),await Wo(a)}async function hs(a,t){await te(a,t,1);const n=await a.readULE32(),e=await En(a,n),o=await a.readULE32();return await ne(a),{n8:n,q:e,nWitness:o}}const{stringifyBigInts:jo}=Ht;async function Na(a,t,n,e){const{fd:o,sections:c}=await $o(t,"wtns",2),f=await hs(o,c),{fd:s,sections:b}=await $o(a,"zkey",2),u=await us(s,b,void 0,e);if(u.protocol!="groth16")throw new Error("zkey file is not groth16");if(!Gt.eq(u.r,f.q))throw new Error("Curve of the witness does not match the curve of the proving key");if(f.nWitness!=u.nVars)throw new Error(`Invalid witness length. Circuit: ${u.nVars}, witness: ${f.nWitness}`);const l=u.curve,B=l.Fr,x=l.G1,y=l.G2,$=Le(u.domainSize);n&&n.debug("Reading Wtns");const R=await Cn(o,c,2);n&&n.debug("Reading Coeffs");const I=await Cn(s,b,4);n&&n.debug("Building ABC");const[G,A,Q]=await Ls(l,u,R,I,n),M=$==B.s?l.Fr.shift:l.Fr.w[$+1],ct=await B.ifft(G,"","",n,"IFFT_A"),C=await B.batchApplyKey(ct,B.e(1),M),_=await B.fft(C,"","",n,"FFT_A"),h=await B.ifft(A,"","",n,"IFFT_B"),X=await B.batchApplyKey(h,B.e(1),M),J=await B.fft(X,"","",n,"FFT_B"),nt=await B.ifft(Q,"","",n,"IFFT_C"),O=await B.batchApplyKey(nt,B.e(1),M),w=await B.fft(O,"","",n,"FFT_C");n&&n.debug("Join ABC");const U=await ms(l,u,_,J,w,n);let W={};n&&n.debug("Reading A Points");const dt=await Cn(s,b,5);W.pi_a=await l.G1.multiExpAffine(dt,R,n,"multiexp A"),n&&n.debug("Reading B1 Points");const st=await Cn(s,b,6);let H=await l.G1.multiExpAffine(st,R,n,"multiexp B1");n&&n.debug("Reading B2 Points");const ut=await Cn(s,b,7);W.pi_b=await l.G2.multiExpAffine(ut,R,n,"multiexp B2"),n&&n.debug("Reading C Points");const ot=await Cn(s,b,8);W.pi_c=await l.G1.multiExpAffine(ot,R.slice((u.nPublic+1)*l.Fr.n8),n,"multiexp C"),n&&n.debug("Reading H Points");const lt=await Cn(s,b,9),Et=await l.G1.multiExpAffine(lt,U,n,"multiexp H"),Tt=l.Fr.random(),Ft=l.Fr.random();W.pi_a=x.add(W.pi_a,u.vk_alpha_1),W.pi_a=x.add(W.pi_a,x.timesFr(u.vk_delta_1,Tt)),W.pi_b=y.add(W.pi_b,u.vk_beta_2),W.pi_b=y.add(W.pi_b,y.timesFr(u.vk_delta_2,Ft)),H=x.add(H,u.vk_beta_1),H=x.add(H,x.timesFr(u.vk_delta_1,Ft)),W.pi_c=x.add(W.pi_c,Et),W.pi_c=x.add(W.pi_c,x.timesFr(W.pi_a,Ft)),W.pi_c=x.add(W.pi_c,x.timesFr(H,Tt)),W.pi_c=x.add(W.pi_c,x.timesFr(u.vk_delta_1,B.neg(B.mul(Tt,Ft))));let v=[];for(let i=1;i<=u.nPublic;i++){const E=R.slice(i*B.n8,i*B.n8+B.n8);v.push(Gt.fromRprLE(E))}return W.pi_a=x.toObject(x.toAffine(W.pi_a)),W.pi_b=y.toObject(y.toAffine(W.pi_b)),W.pi_c=x.toObject(x.toAffine(W.pi_c)),W.protocol="groth16",W.curve=l.name,await s.close(),await o.close(),W=jo(W),v=jo(v),{proof:W,publicSignals:v}}async function Ls(a,t,n,e,o){const c=a.Fr.n8,f=4*3+t.n8r,s=(e.byteLength-4)/f,b=new Nt(t.domainSize*c),u=new Nt(t.domainSize*c),l=new Nt(t.domainSize*c),B=[b,u];for(let x=0;x<s;x++){o&&x%1e6==0&&o.debug(`QAP AB: ${x}/${s}`);const y=e.slice(4+x*f,4+x*f+f),$=new DataView(y.buffer),R=$.getUint32(0,!0),I=$.getUint32(4,!0),G=$.getUint32(8,!0),A=y.slice(12,12+c);B[R].set(a.Fr.add(B[R].slice(I*c,I*c+c),a.Fr.mul(A,n.slice(G*c,G*c+c))),I*c)}for(let x=0;x<t.domainSize;x++)o&&x%1e6==0&&o.debug(`QAP C: ${x}/${t.domainSize}`),l.set(a.Fr.mul(b.slice(x*c,x*c+c),u.slice(x*c,x*c+c)),x*c);return[b,u,l]}async function ms(a,t,n,e,o,c){const s=a.Fr.n8,b=Math.floor(n.byteLength/a.Fr.n8),u=[];for(let y=0;y<b;y+=4194304){c&&c.debug(`JoinABC: ${y}/${b}`);const $=Math.min(b-y,4194304),R=[],I=n.slice(y*s,(y+$)*s),G=e.slice(y*s,(y+$)*s),A=o.slice(y*s,(y+$)*s);R.push({cmd:"ALLOCSET",var:0,buff:I}),R.push({cmd:"ALLOCSET",var:1,buff:G}),R.push({cmd:"ALLOCSET",var:2,buff:A}),R.push({cmd:"ALLOC",var:3,len:$*s}),R.push({cmd:"CALL",fnName:"qap_joinABC",params:[{var:0},{var:1},{var:2},{val:$},{var:3}]}),R.push({cmd:"CALL",fnName:"frm_batchFromMontgomery",params:[{var:3},{val:$},{var:3}]}),R.push({cmd:"GET",out:0,var:3,len:$*s}),u.push(a.tm.queueAction(R))}const l=await Promise.all(u);let B;n instanceof Nt?B=new Nt(n.byteLength):B=new Uint8Array(n.byteLength);let x=0;for(let y=0;y<l.length;y++)B.set(l[y][0],x),x+=l[y][0].byteLength;return B}function $a(a){let t=[];return n(t,a),t;function n(e,o){if(Array.isArray(o))for(let c=0;c<o.length;c++)n(e,o[c]);else e.push(o)}}function ys(a,t){let n=BigInt(a)%t;return n<0&&(n+=t),n}function Ga(a){const t=BigInt(2)**BigInt(64);let n=BigInt("0xCBF29CE484222325");for(let c=0;c<a.length;c++)n^=BigInt(a[c].charCodeAt(0)),n*=BigInt(1099511628211),n%=t;let e=n.toString(16),o=16-e.length;return e="0".repeat(o).concat(e),e}function bs(a,t){const n=[];let e=BigInt(a);const o=BigInt(4294967296);for(;e;)n.unshift(Number(e%o)),e=e/o;if(t){let c=t-n.length;for(;c>0;)n.unshift(0),c--}return n}async function ws(a,t){let n,e,o;t=t||{};let c=1,f=0,s=0,b=!1;if(a instanceof WebAssembly.Instance)n=a,b=!0;else{let x=32767;if(t.memorySize&&(x=parseInt(t.memorySize),x<0))throw new Error("Invalid memory size");let y=!1;for(;!y;)try{o=new WebAssembly.Memory({initial:x}),y=!0}catch(G){if(x<=1)throw G;console.warn("Could not allocate "+x*1024*64+" bytes. This may cause severe instability. Trying with "+x*1024*64/2+" bytes"),x=Math.floor(x/2)}const $=await WebAssembly.compile(a);let R="",I="";n=await WebAssembly.instantiate($,{env:{memory:o},runtime:{printDebug:function(G){console.log("printDebug:",G)},exceptionHandler:function(G){let A;throw G===1?A="Signal not found. ":G===2?A="Too many signals set. ":G===3?A="Signal already set. ":G===4?A="Assert Failed. ":G===5?A="Not enough memory. ":G===6?A="Input signal array access exceeds the size. ":A="Unknown error. ",console.error("ERROR: ",G,R),new Error(A+R)},printErrorMessage:function(){R+=l()+`
`},writeBufferMessage:function(){const G=l();G===`
`?(console.log(I),I=""):(I!==""&&(I+=" "),I+=G)},showSharedRWMemory:function(){const G=n.exports.getFieldNumLen32(),A=new Uint32Array(G);for(let Q=0;Q<G;Q++)A[G-1-Q]=n.exports.readSharedRWMemory(Q);if(c>=2&&(f>=1||s>=7)){I!==""&&(I+=" ");const Q=Gt.fromArray(A,4294967296).toString();I+=Q}else console.log(Gt.fromArray(A,4294967296))},error:function(G,A,Q,M,ct,C){let _;throw G===7?_=B(A)+" "+e.getFr(M).toString()+" != "+e.getFr(ct).toString()+" "+B(C):G===9?_=B(A)+" "+e.getFr(M).toString()+" "+B(ct):G===5&&t.sym?_=B(A)+" "+t.sym.labelIdx2Name[ct]:_=B(A)+" "+Q+" "+M+" "+ct+" "+C,console.log("ERROR: ",G,_),new Error(_)},log:function(G){console.log(e.getFr(G).toString())},logGetSignal:function(G,A){t.logGetSignal&&t.logGetSignal(G,e.getFr(A))},logSetSignal:function(G,A){t.logSetSignal&&t.logSetSignal(G,e.getFr(A))},logStartComponent:function(G){t.logStartComponent&&t.logStartComponent(G)},logFinishComponent:function(G){t.logFinishComponent&&t.logFinishComponent(G)}}})}typeof n.exports.getVersion=="function"&&(c=n.exports.getVersion()),typeof n.exports.getMinorVersion=="function"&&(f=n.exports.getMinorVersion()),typeof n.exports.getPatchVersion=="function"&&(s=n.exports.getPatchVersion());const u=t&&(t.sanityCheck||t.logGetSignal||t.logSetSignal||t.logStartComponent||t.logFinishComponent);if(c===2)e=new xs(n,u);else if(c===1){if(b)throw new Error("Loading code from WebAssembly instance is not supported for circom version 1");e=new Bs(o,n,u)}else throw new Error(`Unsupported circom version: ${c}`);return e;function l(){let x="",y=n.exports.getMessageChar();for(;y!==0;)x+=String.fromCharCode(y),y=n.exports.getMessageChar();return x}function B(x){const y=new Uint8Array(o.buffer),$=[];for(let R=0;y[x+R]>0;R++)$.push(y[x+R]);return String.fromCharCode.apply(null,$)}}class Bs{constructor(t,n,e){this.memory=t,this.i32=new Uint32Array(t.buffer),this.instance=n,this.n32=(this.instance.exports.getFrLen()>>2)-2;const o=this.instance.exports.getPRawPrime(),c=new Array(this.n32);for(let f=0;f<this.n32;f++)c[this.n32-1-f]=this.i32[(o>>2)+f];this.prime=Gt.fromArray(c,4294967296),this.Fr=new Ni(this.prime),this.mask32=Gt.fromString("FFFFFFFF",16),this.NVars=this.instance.exports.getNVars(),this.n64=Math.floor((this.Fr.bitLength-1)/64)+1,this.R=this.Fr.e(Gt.shiftLeft(1,this.n64*64)),this.RInv=this.Fr.inv(this.R),this.sanityCheck=e}circom_version(){return 1}async _doCalculateWitness(t,n){this.instance.exports.init(this.sanityCheck||n?1:0);const e=this.allocInt(),o=this.allocFr();Object.keys(t).forEach(f=>{const s=Ga(f),b=parseInt(s.slice(0,8),16),u=parseInt(s.slice(8,16),16);try{this.instance.exports.getSignalOffset32(e,0,b,u)}catch{throw new Error(`Signal ${f} is not an input of the circuit.`)}const l=this.getInt(e),B=$a(t[f]);for(let x=0;x<B.length;x++)this.setFr(o,B[x]),this.instance.exports.setSignal(0,0,l+x,o)})}async calculateWitness(t,n){const e=this,o=e.i32[0],c=[];await e._doCalculateWitness(t,n);for(let f=0;f<e.NVars;f++){const s=e.instance.exports.getPWitness(f);c.push(e.getFr(s))}return e.i32[0]=o,c}async calculateBinWitness(t,n){const e=this,o=e.i32[0];await e._doCalculateWitness(t,n);const c=e.instance.exports.getWitnessBuffer();e.i32[0]=o;const f=e.memory.buffer.slice(c,c+e.NVars*e.n64*8);return new Uint8Array(f)}allocInt(){const t=this.i32[0];return this.i32[0]=t+8,t}allocFr(){const t=this.i32[0];return this.i32[0]=t+this.n32*4+8,t}getInt(t){return this.i32[t>>2]}setInt(t,n){this.i32[t>>2]=n}getFr(t){const n=this,e=t>>2;if(n.i32[e+1]&2147483648){const c=new Array(n.n32);for(let s=0;s<n.n32;s++)c[n.n32-1-s]=n.i32[e+2+s];const f=n.Fr.e(Gt.fromArray(c,4294967296));return n.i32[e+1]&1073741824?o(f):f}else return n.i32[e]&2147483648?n.Fr.e(n.i32[e]-4294967296):n.Fr.e(n.i32[e]);function o(c){return n.Fr.mul(n.RInv,c)}}setFr(t,n){const e=this;n=e.Fr.e(n);const o=e.Fr.neg(e.Fr.e("80000000",16)),c=e.Fr.e("7FFFFFFF",16);if(e.Fr.geq(n,o)&&e.Fr.leq(n,c)){let s;e.Fr.geq(n,e.Fr.zero)?s=Gt.toNumber(n):(s=Gt.toNumber(e.Fr.sub(n,o)),s=s-2147483648,s=4294967296+s),e.i32[t>>2]=s,e.i32[(t>>2)+1]=0;return}e.i32[t>>2]=0,e.i32[(t>>2)+1]=2147483648;const f=Gt.toArray(n,4294967296);for(let s=0;s<e.n32;s++){const b=f.length-1-s;b>=0?e.i32[(t>>2)+2+s]=f[b]:e.i32[(t>>2)+2+s]=0}}}class xs{constructor(t,n){this.instance=t,this.version=this.instance.exports.getVersion(),this.n32=this.instance.exports.getFieldNumLen32(),this.instance.exports.getRawPrime();const e=new Uint32Array(this.n32);for(let o=0;o<this.n32;o++)e[this.n32-1-o]=this.instance.exports.readSharedRWMemory(o);this.prime=Gt.fromArray(e,4294967296),this.witnessSize=this.instance.exports.getWitnessSize(),this.sanityCheck=n}circom_version(){return this.instance.exports.getVersion()}async _doCalculateWitness(t,n){this.instance.exports.init(this.sanityCheck||n?1:0);const e=Object.keys(t);let o=0;if(e.forEach(c=>{const f=Ga(c),s=parseInt(f.slice(0,8),16),b=parseInt(f.slice(8,16),16),u=$a(t[c]);if(typeof this.instance.exports.getInputSignalSize=="function"){let l=this.instance.exports.getInputSignalSize(s,b);if(l<0)throw new Error(`Signal ${c} not found
`);if(u.length<l)throw new Error(`Not enough values for input signal ${c}
`);if(u.length>l)throw new Error(`Too many values for input signal ${c}
`)}for(let l=0;l<u.length;l++){const B=bs(ys(u[l],this.prime),this.n32);for(let x=0;x<this.n32;x++)this.instance.exports.writeSharedRWMemory(x,B[this.n32-1-x]);try{this.instance.exports.setInputSignal(s,b,l),o++}catch(x){throw new Error(x)}}}),o<this.instance.exports.getInputSize())throw new Error(`Not all inputs have been set. Only ${o} out of ${this.instance.exports.getInputSize()}`)}async calculateWitness(t,n){const e=[];await this._doCalculateWitness(t,n);for(let o=0;o<this.witnessSize;o++){this.instance.exports.getWitness(o);const c=new Uint32Array(this.n32);for(let f=0;f<this.n32;f++)c[this.n32-1-f]=this.instance.exports.readSharedRWMemory(f);e.push(Gt.fromArray(c,4294967296))}return e}async calculateWTNSBin(t,n){const e=new Uint32Array(this.witnessSize*this.n32+this.n32+11),o=new Uint8Array(e.buffer);await this._doCalculateWitness(t,n),o[0]=119,o[1]=116,o[2]=110,o[3]=115,e[1]=2,e[2]=2,e[3]=1;const c=this.n32*4,s=(8+c).toString(16);e[4]=parseInt(s.slice(0,8),16),e[5]=parseInt(s.slice(8,16),16),e[6]=c,this.instance.exports.getRawPrime();let b=7;for(let B=0;B<this.n32;B++)e[b+B]=this.instance.exports.readSharedRWMemory(B);b+=this.n32,e[b]=this.witnessSize,b++,e[b]=2,b++;const l=(c*this.witnessSize).toString(16);e[b]=parseInt(l.slice(0,8),16),e[b+1]=parseInt(l.slice(8,16),16),b+=2;for(let B=0;B<this.witnessSize;B++){this.instance.exports.getWitness(B);for(let x=0;x<this.n32;x++)e[b+x]=this.instance.exports.readSharedRWMemory(x);b+=this.n32}return o}}const{unstringifyBigInts:Fs}=Ht;async function Cs(a,t,n,e){const o=Fs(a),c=await za(t),f=await c.read(c.totalSize);await c.close();const s=await ws(f,e);if(s.circom_version()===1){const b=await s.calculateBinWitness(o),u=await os(n,"wtns",2,2);await ps(u,b,s.prime),await u.close()}else{const b=await Ma(n),u=await s.calculateWTNSBin(o);await b.write(u),await b.close()}}const{unstringifyBigInts:As}=Ht;async function Is(a,t,n,e,o,c){const f=As(a),s={type:"mem"};return await Cs(f,t,s,o),await Na(n,s,e,c)}const{unstringifyBigInts:Ue}=Ht;async function Es(a,t,n,e){const o=Ue(a),c=Ue(n),f=Ue(t),s=await ss(o.curve),b=s.G1.fromObject(o.IC[0]),u=new Uint8Array(s.G1.F.n8*2*f.length),l=new Uint8Array(s.Fr.n8*f.length);if(!Ps(s,f))return e&&e.error("Public inputs are not valid."),!1;for(let M=0;M<f.length;M++){const ct=s.G1.fromObject(o.IC[M+1]);u.set(ct,M*s.G1.F.n8*2),Gt.toRprLE(l,s.Fr.n8*M,f[M],s.Fr.n8)}let B=await s.G1.multiExpAffine(u,l);B=s.G1.add(B,b);const x=s.G1.fromObject(c.pi_a),y=s.G2.fromObject(c.pi_b),$=s.G1.fromObject(c.pi_c);if(!Ss(s,{pi_a:x,pi_b:y,pi_c:$}))return e&&e.error("Proof commitments are not valid."),!1;const R=s.G2.fromObject(o.vk_gamma_2),I=s.G2.fromObject(o.vk_delta_2),G=s.G1.fromObject(o.vk_alpha_1),A=s.G2.fromObject(o.vk_beta_2);return await s.pairingEq(s.G1.neg(x),y,B,R,$,I,G,A)?(e&&e.info("OK!"),!0):(e&&e.error("Invalid proof"),!1)}function Ss(a,t){const n=a.G1,e=a.G2;return n.isValid(t.pi_a)&&e.isValid(t.pi_b)&&n.isValid(t.pi_c)}function vs(a,t){return Gt.geq(t,0)&&Gt.lt(t,a.r)}function Ps(a,t){for(let n=0;n<t.length;n++)if(!vs(a,t[n]))return!1;return!0}const{unstringifyBigInts:Do}=Ht;function fn(a){let t=a.toString(16);for(;t.length<64;)t="0"+t;return t=`"0x${t}"`,t}async function Os(a,t){const n=Do(a),e=Do(t);let o="";for(let f=0;f<e.length;f++)o!=""&&(o=o+","),o=o+fn(e[f]);let c;return c=`[${fn(n.pi_a[0])}, ${fn(n.pi_a[1])}],[[${fn(n.pi_b[0][1])}, ${fn(n.pi_b[0][0])}],[${fn(n.pi_b[1][1])}, ${fn(n.pi_b[1][0])}]],[${fn(n.pi_c[0])}, ${fn(n.pi_c[1])}],[${o}]`,c}var co=Object.freeze({__proto__:null,fullProve:Is,prove:Na,verify:Es,exportSolidityCallData:Os});Gt.e("73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001",16);Gt.e("21888242871839275222246405745257275088548364400416034343698204186575808495617");const{unstringifyBigInts:Cl}=Ht,{stringifyBigInts:Al}=Ht,{unstringifyBigInts:Il,stringifyBigInts:El}=Ht,{stringifyBigInts:Sl}=Ht,{unstringifyBigInts:vl}=Ht,{unstringifyBigInts:Pl}=Ht,{unstringifyBigInts:Ol}=Ht,{stringifyBigInts:kl}=Ht,{unstringifyBigInts:ql}=Ht,{unstringifyBigInts:Tl}=Ht,{unstringifyBigInts:Ul}=Ht,ks={swap:{wasm:"/circuits/private_swap.wasm",zkey:"/circuits/private_swap.zkey"},addLiquidity:{wasm:"/circuits/private_add_liquidity.wasm",zkey:"/circuits/private_add_liquidity.zkey"},removeLiquidity:{wasm:"/circuits/private_remove_liquidity.wasm",zkey:"/circuits/private_remove_liquidity.zkey"}};let ce=null,Me=null;async function zn(){return ce||(Me||(Me=(async()=>{const{buildPoseidon:a}=await ri(async()=>{const{buildPoseidon:t}=await import("./main-D2UaypfZ.js");return{buildPoseidon:t}},[]);return ce=await a(),ce})()),Me)}async function cn(a){const t=await zn(),n=t(a.map(e=>BigInt(e)));return t.F.toString(n)}async function hn(a,t,n,e){return cn([a,t,n,e])}async function ee(a,t,n){return cn([a,t,n])}async function Un(a,t,n,e){const o=Sn(n);return cn([a,t,o,e])}async function _e(a,t,n){const e=Sn(t);return cn([a,e,n])}async function Vn(a){return cn([a])}function Kt(){const a=new Uint8Array(31);crypto.getRandomValues(a);let t=BigInt(0);for(let n=0;n<31;n++)t=t*256n+BigInt(a[n]);return t.toString()}async function Wa(a,t,n,e){return cn([a,t.toString(),n.toString(),e.toString()])}async function Xe(a,t,n,e,o,c=1e3){for(let f=0;f<c;f++){const s=await Wa(t,f,e,o);if(await hn(e.toString(),o.toString(),n,s)===a)return{nonce:f,blinding:s}}return null}const qs="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Ts=21888242871839275222246405745257275088548364400416034343698204186575808495617n;function Sn(a){if(/^\d+$/.test(a))return a;let t=BigInt(0);for(const n of a){const e=qs.indexOf(n);if(e===-1)throw new Error(`Invalid base58 character: ${n}`);t=t*58n+BigInt(e)}return t=t%Ts,t.toString()}async function so(a){const t=ks[a];if(!t)throw new Error(`Unknown circuit type: ${a}`);const e=await(await fetch(t.wasm)).arrayBuffer(),c=await(await fetch(t.zkey)).arrayBuffer();return{wasm:new Uint8Array(e),zkey:new Uint8Array(c)}}async function Us(a){var A;const{root:t,inputUtxos:n,outputUtxos:e,poolState:o,newPoolState:c,swapParams:f,extDataHash:s}=a;await zn();const b=[];for(let Q=0;Q<2;Q++){const M=n[Q],ct=await Vn(M.privateKey),C=await hn(M.amount,M.assetId,ct,M.blinding);console.log(`=== Input UTXO ${Q} Debug ===`),console.log(`Amount: ${M.amount}`),console.log(`AssetId: ${M.assetId}`),console.log(`Pubkey (derived): ${ct.slice(0,20)}...`),console.log(`Blinding: ${M.blinding.slice(0,20)}...`),console.log(`Computed commitment: ${C.slice(0,20)}...`),console.log(`Root passed: ${t.slice(0,20)}...`),console.log(`PathElements[0]: ${(A=M.pathElements[0])==null?void 0:A.slice(0,20)}...`),console.log("=== End Debug ===");const _=await ee(C,M.privateKey,M.pathIndices[0]);b.push(_)}const u=[];for(let Q=0;Q<2;Q++){const M=e[Q],ct=await hn(M.amount,M.assetId,M.pubkey,M.blinding);u.push(ct)}const l=await Un(o.reserveA,o.reserveB,o.poolPubkey,o.poolBlinding),B=await Un(c.reserveA,c.reserveB,o.poolPubkey,c.poolBlinding),x=Sn(o.poolPubkey),y={root:t,inputNullifier:b,outputCommitment:u,poolStateHash:l,newPoolStateHash:B,extDataHash:s,inAmount:n.map(Q=>Q.amount),inAssetId:n.map(Q=>Q.assetId),inPrivateKey:n.map(Q=>Q.privateKey),inBlinding:n.map(Q=>Q.blinding),inPathElements:n.map(Q=>Q.pathElements),inPathIndices:n.map(Q=>Q.pathIndices),outAmount:e.map(Q=>Q.amount),outAssetId:e.map(Q=>Q.assetId),outPubkey:e.map(Q=>Q.pubkey),outBlinding:e.map(Q=>Q.blinding),reserveA:o.reserveA,reserveB:o.reserveB,poolPubkey:x,poolBlinding:o.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,swapAmountIn:f.amountIn,swapAssetIn:f.assetIn,swapAmountOut:f.amountOut,minAmountOut:f.minAmountOut},{wasm:$,zkey:R}=await so("swap"),{proof:I,publicSignals:G}=await co.fullProve(y,$,R);return{proof:I,publicSignals:G,inputNullifiers:b,outputCommitments:u,poolStateHash:l,newPoolStateHash:B}}async function Ms(a){const{root:t,inputUtxos:n,outputUtxo:e,poolState:o,newPoolState:c,lpState:f,newLpState:s,extDataHash:b}=a;await zn();const u=[];for(let C=0;C<2;C++){const _=n[C],h=await Vn(_.privateKey),X=C,J=await hn(_.amount,X,h,_.blinding),nt=await ee(J,_.privateKey,_.pathIndices[0]);u.push(nt)}const l=await hn(e.lpAmount,"2",e.pubkey,e.blinding),B=await Un(o.reserveA,o.reserveB,o.poolPubkey,o.poolBlinding),x=await Un(c.reserveA,c.reserveB,o.poolPubkey,c.poolBlinding),y=await _e(f.totalLpSupply,f.lpPoolPubkey,f.lpBlinding),$=await _e(s.totalLpSupply,f.lpPoolPubkey,s.lpBlinding),R=Sn(o.poolPubkey),I=Sn(f.lpPoolPubkey),G={root:t,inputNullifier:u,outputCommitment:l,poolStateHash:B,newPoolStateHash:x,lpStateHash:y,newLpStateHash:$,extDataHash:b,inAmountA:n[0].amount,inAmountB:n[1].amount,inPrivateKey:n.map(C=>C.privateKey),inBlinding:n.map(C=>C.blinding),inPathElements:n.map(C=>C.pathElements),inPathIndices:n.map(C=>C.pathIndices),outLpAmount:e.lpAmount,outPubkey:e.pubkey,outBlinding:e.blinding,reserveA:o.reserveA,reserveB:o.reserveB,poolPubkey:R,poolBlinding:o.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,totalLpSupply:f.totalLpSupply,lpPoolPubkey:I,lpBlinding:f.lpBlinding,newTotalLpSupply:s.totalLpSupply,newLpBlinding:s.lpBlinding},{wasm:A,zkey:Q}=await so("addLiquidity"),{proof:M,publicSignals:ct}=await co.fullProve(G,A,Q);return{proof:M,publicSignals:ct,inputNullifiers:u,outputCommitment:l,poolStateHash:B,newPoolStateHash:x,lpStateHash:y,newLpStateHash:$}}async function zs(a){const{root:t,inputUtxo:n,outputUtxos:e,poolState:o,newPoolState:c,lpState:f,newLpState:s,extDataHash:b}=a;await zn();const u=await Vn(n.privateKey),l=await hn(n.lpAmount,"2",u,n.blinding),B=await ee(l,n.privateKey,n.pathIndices[0]),x=[];for(let h=0;h<2;h++){const X=e[h],J=await hn(X.amount,h,X.pubkey,X.blinding);x.push(J)}const y=await Un(o.reserveA,o.reserveB,o.poolPubkey,o.poolBlinding),$=await Un(c.reserveA,c.reserveB,o.poolPubkey,c.poolBlinding),R=await _e(f.totalLpSupply,f.lpPoolPubkey,f.lpBlinding),I=await _e(s.totalLpSupply,f.lpPoolPubkey,s.lpBlinding),G=Sn(o.poolPubkey),A=Sn(f.lpPoolPubkey),Q={root:t,inputNullifier:B,outputCommitment:x,poolStateHash:y,newPoolStateHash:$,lpStateHash:R,newLpStateHash:I,extDataHash:b,inLpAmount:n.lpAmount,inPrivateKey:n.privateKey,inBlinding:n.blinding,inPathElements:n.pathElements,inPathIndices:n.pathIndices,outAmountA:e[0].amount,outPubkeyA:e[0].pubkey,outBlindingA:e[0].blinding,outAmountB:e[1].amount,outPubkeyB:e[1].pubkey,outBlindingB:e[1].blinding,reserveA:o.reserveA,reserveB:o.reserveB,poolPubkey:G,poolBlinding:o.poolBlinding,newReserveA:c.reserveA,newReserveB:c.reserveB,newPoolBlinding:c.poolBlinding,totalLpSupply:f.totalLpSupply,lpPoolPubkey:A,lpBlinding:f.lpBlinding,newTotalLpSupply:s.totalLpSupply,newLpBlinding:s.lpBlinding},{wasm:M,zkey:ct}=await so("removeLiquidity"),{proof:C,publicSignals:_}=await co.fullProve(Q,M,ct);return{proof:C,publicSignals:_,inputNullifier:B,outputCommitments:x,poolStateHash:y,newPoolStateHash:$,lpStateHash:R,newLpStateHash:I}}const on=20,Rs=2**on;let an=null;async function Ns(){if(an)return an;await zn(),an=new Array(on+1),an[0]="0";for(let a=1;a<=on;a++)an[a]=await cn([an[a-1],an[a-1]]);return an}class $s{constructor(){this.leaves=[],this.layers=[],this.nextIndex=0}async init(){await Ns(),this.layers=new Array(on+1);for(let t=0;t<=on;t++)this.layers[t]=new Map}async insert(t){if(this.nextIndex>=Rs)throw new Error("Merkle tree is full");const n=this.nextIndex;this.leaves.push(t);let e=n,o=t;for(let c=0;c<on;c++){this.layers[c].set(e,o);const f=e^1,s=this.layers[c].get(f)||an[c];e%2===0?o=await cn([o,s]):o=await cn([s,o]),e=Math.floor(e/2)}return this.layers[on].set(0,o),this.nextIndex++,n}getRoot(){return this.nextIndex===0?an[on]:this.layers[on].get(0)}getProof(t){if(t>=this.nextIndex)throw new Error("Leaf index out of bounds");const n=[],e=[];let o=t;for(let c=0;c<on;c++){const f=o^1,s=this.layers[c].get(f)||an[c];n.push(s),e.push(o%2),o=Math.floor(o/2)}return{pathElements:n,pathIndices:e}}async verifyProof(t,n,e){let o=t;for(let c=0;c<on;c++)e[c]===0?o=await cn([o,n[c]]):o=await cn([n[c],o]);return o===this.getRoot()}getLeafCount(){return this.nextIndex}serialize(){return JSON.stringify({leaves:this.leaves,nextIndex:this.nextIndex})}async deserialize(t){const{leaves:n,nextIndex:e}=JSON.parse(t);await this.init();for(const o of n)await this.insert(o);return this}}async function se(){const a=new $s;return await a.init(),a}async function me(a,t){try{const e=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getAccountInfo",params:[t,{encoding:"base64"}]})})).json();if(!e.result||!e.result.value)return console.warn("Merkle account not found, using empty tree"),se();const o=Buffer.from(e.result.value.data[0],"base64"),c=32,f=c,s=c+4,b=32,u=o.readUInt32LE(f);console.log(`On-chain Merkle tree has ${u} leaves`);const l=await se();for(let B=0;B<u;B++){const x=s+B*b,y=o.slice(x,x+b);let $=BigInt(0);for(let R=31;R>=0;R--)$=$*256n+BigInt(y[R]);await l.insert($.toString())}return console.log(`Synced ${u} leaves from on-chain Merkle tree`),l}catch(n){return console.error("Failed to sync Merkle tree:",n),se()}}const Gs="privacy-amm-utxos-encrypted";async function Ws(a,t){const n=new TextEncoder,e=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,n.encode(JSON.stringify(a))),c=new Uint8Array(e.length+o.byteLength);return c.set(e),c.set(new Uint8Array(o),e.length),btoa(String.fromCharCode(...c))}async function Zo(a,t){const n=Uint8Array.from(atob(a),s=>s.charCodeAt(0)),e=n.slice(0,12),o=n.slice(12),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:e},t,o),f=new TextDecoder;return JSON.parse(f.decode(c))}class js{constructor(){this.key=null,this.utxos=[],this.initialized=!1}async init(t,n){return this.walletKey=n,this.storageKey=`privacy-amm-utxos-${n}`,this.key=null,this.loadWalletUtxos(),this.initialized=!0,console.log(`UTXO storage initialized for wallet ${n.slice(0,8)}...`),console.log(`Loaded ${this.utxos.length} UTXOs from storage`),!0}loadWalletUtxos(){try{const t=localStorage.getItem(this.storageKey);if(t){this.utxos=JSON.parse(t),console.log(`Loaded UTXOs from wallet-specific storage: ${this.utxos.length}`);return}const n=localStorage.getItem("privacy-amm-utxos");if(n){this.utxos=JSON.parse(n),console.log(`Migrated UTXOs from legacy storage: ${this.utxos.length}`),this.saveSync();return}this.utxos=[]}catch(t){console.error("Failed to load UTXOs:",t),this.utxos=[]}}saveSync(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.utxos))}catch(t){console.error("Failed to save UTXOs:",t)}}async load(){try{const t=localStorage.getItem(Gs);t&&this.key?this.utxos=await Zo(t,this.key):this.utxos=[]}catch(t){console.error("Failed to load UTXOs:",t),this.utxos=[]}}loadUnencrypted(){try{const t=localStorage.getItem("privacy-amm-utxos");this.utxos=t?JSON.parse(t):[]}catch{this.utxos=[]}}async save(){try{const t=this.storageKey||"privacy-amm-utxos";localStorage.setItem(t,JSON.stringify(this.utxos))}catch(t){console.error("Failed to save UTXOs:",t)}}async addUtxo(t){this.utxos.push({...t,createdAt:Date.now()}),await this.save()}async removeUtxo(t){this.utxos=this.utxos.filter(n=>n.commitment!==t),await this.save()}async markSpent(t,n){const e=this.utxos.find(o=>o.commitment===t);e&&(e.spent=!0,e.nullifier=n,e.spentAt=Date.now(),await this.save())}getUnspent(){return this.utxos.filter(t=>!t.spent)}getByAsset(t){return this.getUnspent().filter(n=>n.assetId===t)}getBalance(t){return this.getByAsset(t).reduce((n,e)=>n+BigInt(e.amount),0n)}selectUtxos(t,n){const e=this.getByAsset(t).sort((s,b)=>{const u=BigInt(b.amount)-BigInt(s.amount);return u>0n?1:u<0n?-1:0}),o=[];let c=0n;const f=BigInt(n);for(const s of e){if(c>=f)break;o.push(s),c+=BigInt(s.amount)}if(c<f)throw new Error("Insufficient balance");return{utxos:o,total:c.toString(),change:(c-f).toString()}}getAll(){return[...this.utxos]}async clear(){this.utxos=[],await this.save()}async export(){return this.key?await Ws(this.utxos,this.key):JSON.stringify(this.utxos)}async import(t){try{this.key?this.utxos=await Zo(t,this.key):this.utxos=JSON.parse(t),await this.save()}catch(n){throw console.error("Failed to import UTXOs:",n),n}}}function Ds(){return new js}function ye(){const a=localStorage.getItem("privacy-amm-deposit-nonce");return a?parseInt(a,10):0}function Zs(){const a=ye();return localStorage.setItem("privacy-amm-deposit-nonce",(a+1).toString()),a+1}function Xs(){localStorage.setItem("privacy-amm-deposit-nonce","0")}window.Buffer=wn.Buffer;const It={relayerUrl:"https://privacy-amm-relayer-staging.davirain-yin.workers.dev",rpcUrl:"https://api.testnet.solana.com",wsUrl:"wss://api.testnet.solana.com",network:"testnet",programId:"GZfqgHqekzR4D8TAq165XB8U2boVdK5ehEEH4n7u4Xts",poolAccounts:{poolAccount:"4K65JKhxhUtDarHarbKXLnk6Uq8XN6ocnqfPTTmweQ1D",merkleAccount:"FhmBWQcLxFAFqRUvGPzUeZ6N8gSEk7eqc2LQbJidbBfr",nullifierAccount:"jeXXRuP24GSd43E6kjTa1yct6P65XwbjvjNxQ99AymY",poolAuthority:"DEuAfZux9RonRvB3bP4BL6xeE576y54dLFuAQEoTub55"},tokenAccounts:{wsolMint:"So11111111111111111111111111111111111111112",usdcMint:"3fZgymugtSbiW6eQgnVkGRwPeJxueXrSHPgMhBRWkFN6",lpMint:"5jx6pL7uGSfZqiG94Bh6b94M1yNt7YwLS1AWcQQ2i3XB",poolWsolVault:"HNgkrsnGRZRPStxuv8LuDWaxQFQfGA9TpjvLHPavW7k8",poolUsdcVault:"6wpex9bRe3Gw2yeAYpXSFfjZPLVyVpWYhGoqJnDzuhWJ"}},sn=0,un=1,lo=2,D={wallet:null,publicKey:null,privateKey:null,zkPubkey:null,utxoStorage:null,merkleTree:null,poolState:null,initialized:!1};document.addEventListener("DOMContentLoaded",async()=>{console.log("Privacy AMM initializing..."),await zn(),console.log("Poseidon initialized"),Ks(),Vs(),Ys(),ol(),ll(),_l(),ml(),await Va(),D.merkleTree=await se(),console.log("Merkle tree initialized");try{D.merkleTree=await me(It.rpcUrl,It.poolAccounts.merkleAccount),console.log("Merkle tree synced from chain")}catch(a){console.warn("Failed to sync Merkle tree:",a)}D.initialized=!0,console.log("Privacy AMM ready")});function Ks(){const a=document.querySelectorAll(".nav-link");a.forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const e=t.dataset.tab;a.forEach(o=>o.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active")),document.getElementById(`${e}-tab`).classList.add("active")})})}function Vs(){const a=document.getElementById("connect-wallet"),t=document.getElementById("disconnect-wallet");a.addEventListener("click",ja),t.addEventListener("click",Hs),Js()}async function ja(){var a;try{const t=((a=window.backpack)==null?void 0:a.solana)||window.solana;if(!t){alert("Please install a Solana wallet (Phantom, Backpack, etc.) to use this app.");return}const n=await t.connect();D.publicKey=n.publicKey.toString(),D.wallet=t,D.utxoStorage=Ds();const e=await D.utxoStorage.init(D.wallet,D.publicKey);console.log(e?"UTXO storage initialized with encryption":"UTXO storage initialized without encryption"),await Qs(),Da(!0),Za(!0),Fn(),await vn(),console.log("Connected:",D.publicKey)}catch(t){console.error("Wallet connection failed:",t),alert("Failed to connect wallet: "+t.message)}}async function Qs(){const a=`privacy-amm-zk-keypair-${D.publicKey}`,t=localStorage.getItem(a);if(t)try{const n=JSON.parse(t);D.privateKey=n.privateKey,D.zkPubkey=n.zkPubkey,console.log("ZK keypair loaded from localStorage");return}catch(n){console.error("Failed to parse saved keypair:",n)}try{const n=`Privacy AMM ZK Keypair
Public Key: ${D.publicKey}
Network: ${It.network}`,e=new TextEncoder().encode(n);let o;try{o=await D.wallet.signMessage(e,"utf8")}catch{o=await D.wallet.signMessage(e)}const c=o.signature||o,f=Array.isArray(c)?c.slice(0,31):Array.from(new Uint8Array(c)).slice(0,31);let s=BigInt(0);for(let b=0;b<31;b++)s=s*256n+BigInt(f[b]);D.privateKey=s.toString(),D.zkPubkey=await Vn(D.privateKey),localStorage.setItem(a,JSON.stringify({privateKey:D.privateKey,zkPubkey:D.zkPubkey})),console.log("ZK keypair derived from wallet signature and saved")}catch(n){console.error("Failed to derive ZK keypair from signature:",n),D.privateKey=Kt(),D.zkPubkey=await Vn(D.privateKey),localStorage.setItem(a,JSON.stringify({privateKey:D.privateKey,zkPubkey:D.zkPubkey})),console.log("Generated new ZK keypair and saved to localStorage"),console.log("WARNING: This keypair is random. Future sessions will use the same keypair from localStorage.")}}function Hs(){D.wallet&&D.wallet.disconnect(),D.wallet=null,D.publicKey=null,D.privateKey=null,D.zkPubkey=null,D.utxoStorage=null,Da(!1),Za(!1)}function Js(){var t,n;const a=((t=window.backpack)==null?void 0:t.solana)||window.solana;a&&a.isConnected&&(D.wallet=a,D.publicKey=(n=a.publicKey)==null?void 0:n.toString(),D.publicKey&&ja())}function Da(a){const t=document.getElementById("connect-wallet"),n=document.getElementById("wallet-info"),e=document.getElementById("wallet-address");a?(t.classList.add("hidden"),n.classList.remove("hidden"),e.textContent=xl(D.publicKey)):(t.classList.remove("hidden"),n.classList.add("hidden"))}function Za(a){document.getElementById("swap-btn").disabled=!a,document.getElementById("public-swap-btn").disabled=!a,document.getElementById("add-liquidity-btn").disabled=!a,document.getElementById("remove-liquidity-btn").disabled=!a,document.getElementById("deposit-btn").disabled=!a,document.getElementById("withdraw-btn").disabled=!a;const t=document.getElementById("clear-rebuild-btn");t&&(t.disabled=!a);const n=document.getElementById("recover-utxo-btn");n&&(n.disabled=!a);const e=document.getElementById("manual-recover-btn");e&&(e.disabled=!a),a?(document.getElementById("swap-btn").textContent="Swap",document.getElementById("public-swap-btn").textContent="Swap"):(document.getElementById("swap-btn").textContent="Connect Wallet to Swap",document.getElementById("public-swap-btn").textContent="Connect Wallet to Swap")}function Ys(){const a=document.getElementById("swap-from-amount"),t=document.getElementById("swap-direction"),n=document.getElementById("swap-btn");a.addEventListener("input",Xa),t.addEventListener("click",nl),n.addEventListener("click",el)}function Xa(){const a=parseFloat(document.getElementById("swap-from-amount").value)||0,t=document.getElementById("swap-from-token").value;if(document.getElementById("swap-to-token").value,!D.poolState||a===0){document.getElementById("swap-to-amount").value="";return}const{reserveA:n,reserveB:e}=D.poolState;let o;if(t==="SOL"){const f=a*1e9;o=ge(f,n,e),o=o/1e6}else{const f=a*1e6;o=ge(f,e,n),o=o/1e9}document.getElementById("swap-to-amount").value=o.toFixed(6);const c=tl(a,t);document.getElementById("price-impact").textContent=c.toFixed(2)+"%"}function ge(a,t,n){const e=a*997,o=e*n,c=t*1e3+e;return Math.floor(o/c)}function tl(a,t){if(!D.poolState||a===0)return 0;const{reserveA:n}=D.poolState;return(t==="SOL"?a*1e9:a*1e6)/n*100}function nl(){const a=document.getElementById("swap-from-token"),t=document.getElementById("swap-to-token"),n=a.value;a.value=t.value,t.value=n,Xa()}async function el(){var e,o;const a=parseFloat(document.getElementById("swap-from-amount").value),t=parseFloat(document.getElementById("swap-to-amount").value),n=document.getElementById("swap-from-token").value;if(!a||!t){alert("Please enter an amount");return}if(!D.utxoStorage){alert("Please connect wallet first");return}ln("Syncing Merkle tree...");try{try{D.merkleTree=await me(It.rpcUrl,It.poolAccounts.merkleAccount),console.log(`Merkle tree synced: ${D.merkleTree.getLeafCount()} leaves`)}catch(O){throw console.error("Failed to sync Merkle tree:",O),new Error("Failed to sync with blockchain. Please try again.")}Rt("Selecting UTXOs...");const c=n==="SOL"?sn:un,f=n==="SOL"?un:sn,s=Math.floor(n==="SOL"?a*1e9:a*1e6),b=Math.floor(n==="SOL"?t*1e6:t*1e9),u=D.utxoStorage.getAll();console.log("=== UTXO Debug ==="),console.log("All stored UTXOs:",u),console.log("Looking for assetId:",c,"(type:",typeof c,")"),console.log("Target amount:",s),u.forEach((O,w)=>{console.log(`UTXO ${w}: assetId=${O.assetId} (type: ${typeof O.assetId}), amount=${O.amount}, spent=${O.spent}`)});const l=u.filter(O=>O.assetId===c&&!O.spent);console.log("Matching UTXOs (same assetId, not spent):",l);const B=D.utxoStorage.getBalance(c);console.log("Balance for asset:",B.toString()),console.log("=== End Debug ===");let x;try{x=D.utxoStorage.selectUtxos(c,s)}catch(O){throw console.error("selectUtxos failed:",O),new Error(`Insufficient private ${n} balance. Please deposit first or recover your UTXOs. (Balance: ${B.toString()}, Need: ${s})`)}if(x.utxos.length===0)throw new Error(`No private ${n} balance. Please deposit first or recover your UTXOs.`);const $=D.utxoStorage.getUnspent().filter(O=>O.assetId===c);if($.length<2)throw new Error(`Private swap requires at least 2 ${n} UTXOs. You currently have ${$.length} ${n} UTXO(s). Please make ${2-$.length} more ${n} deposit(s) first, or use Public Swap instead.`);Rt("Validating UTXOs...");for(const O of x.utxos){const w=D.merkleTree.leaves;if(console.log(`Validating UTXO: commitment=${O.commitment.slice(0,20)}..., leafIndex=${O.leafIndex}`),O.leafIndex!==void 0&&O.leafIndex<w.length&&w[O.leafIndex]===O.commitment){console.log(`UTXO validated at leafIndex ${O.leafIndex}`);continue}console.log(`LeafIndex ${O.leafIndex} invalid, searching tree for commitment...`);let U=-1;for(let W=0;W<w.length;W++)if(w[W]===O.commitment){U=W;break}if(U>=0)console.log(`Found commitment at index ${U}, updating UTXO`),O.leafIndex=U,await D.utxoStorage.save();else throw console.error("Commitment not found in tree:",{stored:O.commitment,treeSize:w.length,firstFewLeaves:w.slice(0,5)}),new Error("UTXO commitment not found on-chain. This UTXO may not have been deposited successfully. Try using Auto-Recover to find your UTXOs.")}Rt("Building input UTXOs...");const R=[];for(let O=0;O<2;O++){let w,U;if(O<x.utxos.length)w=x.utxos[O];else{const dt=$.find(st=>!x.utxos.some(H=>H.commitment===st.commitment)&&st.leafIndex!==void 0);if(!dt)throw new Error("Cannot find a second UTXO of the same asset. This should not happen.");w=dt}U=D.merkleTree.getProof(w.leafIndex);const W=D.merkleTree.leaves[w.leafIndex];console.log(`Input UTXO ${O}: leafIndex=${w.leafIndex}, amount=${w.amount}, assetId=${w.assetId}`),console.log(`  Stored commitment: ${(e=w.commitment)==null?void 0:e.slice(0,30)}...`),console.log(`  Tree commitment:   ${W==null?void 0:W.slice(0,30)}...`),console.log(`  Blinding: ${(o=w.blinding)==null?void 0:o.slice(0,30)}...`),R.push({amount:w.amount||"0",assetId:c.toString(),privateKey:D.privateKey,blinding:w.blinding,pathElements:U.pathElements,pathIndices:U.pathIndices})}const I=R.reduce((O,w)=>O+BigInt(w.amount),0n),G=I-BigInt(s);console.log(`Total input: ${I}, Swap: ${s}, Change: ${G}`);const A=[{amount:b.toString(),assetId:f.toString(),pubkey:D.zkPubkey,blinding:Kt()},{amount:G.toString(),assetId:c.toString(),pubkey:D.zkPubkey,blinding:Kt()}],{reserveA:Q,reserveB:M}=D.poolState,ct=Kt(),C=Kt();let _,h;n==="SOL"?(_=(BigInt(Q)+BigInt(s)).toString(),h=(BigInt(M)-BigInt(b)).toString()):(_=(BigInt(Q)-BigInt(b)).toString(),h=(BigInt(M)+BigInt(s)).toString()),Rt("Generating ZK proof... (this may take 30-60 seconds)");const X=await Us({root:D.merkleTree.getRoot(),inputUtxos:R,outputUtxos:A,poolState:{reserveA:Q.toString(),reserveB:M.toString(),poolPubkey:It.poolAccounts.poolAccount,poolBlinding:ct},newPoolState:{reserveA:_,reserveB:h,poolBlinding:C},swapParams:{amountIn:s.toString(),assetIn:c.toString(),amountOut:b.toString(),minAmountOut:Math.floor(b*.99).toString()},extDataHash:"0"});Rt("Submitting to relayer...");const nt=await(await fetch(`${It.relayerUrl}/swap`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:X.proof,publicSignals:X.publicSignals,nullifiers:X.inputNullifiers,outputCommitments:X.outputCommitments,newPoolStateHash:X.newPoolStateHash,newPoolBlinding:C})})).json();if(nt.success){for(const O of x.utxos)await D.utxoStorage.markSpent(O.commitment,X.inputNullifiers[0]);for(let O=0;O<A.length;O++)BigInt(A[O].amount)>0n&&await D.utxoStorage.addUtxo({commitment:X.outputCommitments[O],amount:A[O].amount,assetId:parseInt(A[O].assetId),blinding:A[O].blinding,leafIndex:D.merkleTree.getLeafCount()+O});Fn(),_n(nt.signature,nt.explorer)}else Xt(nt.error||"Swap failed")}catch(c){console.error("Swap failed:",c),Xt(c.message)}}function ol(){const a=document.querySelectorAll(".swap-mode-tabs .tab-btn");a.forEach(o=>{o.addEventListener("click",()=>{a.forEach(f=>f.classList.remove("active")),o.classList.add("active");const c=o.dataset.swapMode;document.getElementById("public-swap-form").classList.toggle("hidden",c!=="public"),document.getElementById("private-swap-form").classList.toggle("hidden",c!=="private")})});const t=document.getElementById("public-swap-from-amount"),n=document.getElementById("public-swap-direction"),e=document.getElementById("public-swap-btn");t.addEventListener("input",le),n.addEventListener("click",al),e.addEventListener("click",il),document.getElementById("wrap-sol-btn").addEventListener("click",cl),document.getElementById("unwrap-sol-btn").addEventListener("click",sl),document.getElementById("public-swap-from-token").addEventListener("change",le),document.getElementById("public-swap-to-token").addEventListener("change",le)}function le(){const a=parseFloat(document.getElementById("public-swap-from-amount").value)||0,t=document.getElementById("public-swap-from-token").value;if(document.getElementById("public-swap-to-token").value,!D.poolState||a===0){document.getElementById("public-swap-to-amount").value="",document.getElementById("public-swap-rate").textContent=t==="wSOL"?"1 wSOL = -- tUSDC":"1 tUSDC = -- wSOL",document.getElementById("public-price-impact").textContent="--";return}const{reserveA:n,reserveB:e}=D.poolState;let o,c,f,s;t==="wSOL"?(o=a*1e9,f=n,s=e,c=ge(o,f,s),c=c/1e6):(o=a*1e6,f=e,s=n,c=ge(o,f,s),c=c/1e9),document.getElementById("public-swap-to-amount").value=c.toFixed(6);const b=t==="wSOL"?(e/n*1e3).toFixed(2):(n/e/1e3).toFixed(6);document.getElementById("public-swap-rate").textContent=t==="wSOL"?`1 wSOL = ${b} tUSDC`:`1 tUSDC = ${b} wSOL`;const u=o/f*100;document.getElementById("public-price-impact").textContent=u.toFixed(3)+"%"}function al(){const a=document.getElementById("public-swap-from-token"),t=document.getElementById("public-swap-to-token"),n=a.value;a.value=t.value,t.value=n,le(),D.publicKey&&vn()}async function il(){const a=parseFloat(document.getElementById("public-swap-from-amount").value),t=parseFloat(document.getElementById("public-swap-to-amount").value),n=document.getElementById("public-swap-from-token").value;if(!a||!t){alert("Please enter an amount");return}if(!D.wallet||!D.publicKey){alert("Please connect wallet first");return}ln("Building transaction...");try{const{Connection:e,PublicKey:o,Transaction:c,TransactionInstruction:f}=window.solanaWeb3||await Ln(),s=new e(It.rpcUrl,"confirmed"),b=Math.floor(n==="wSOL"?a*1e9:a*1e6),u=Math.floor(n==="wSOL"?t*.95*1e6:t*.95*1e9);Rt("Getting token accounts...");const l=new o(D.publicKey),B=new o(It.tokenAccounts.wsolMint),x=new o(It.tokenAccounts.usdcMint),y=new o("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),$=new o("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"),R=await Bn(l,B),I=await Bn(l,x);let G,A,Q,M,ct;n==="wSOL"?(G=R,A=I,Q=new o(It.tokenAccounts.poolWsolVault),M=new o(It.tokenAccounts.poolUsdcVault),ct=x):(G=I,A=R,Q=new o(It.tokenAccounts.poolUsdcVault),M=new o(It.tokenAccounts.poolWsolVault),ct=B),Rt("Checking output token account...");const _=!await s.getAccountInfo(A);_&&console.log("Output token account does not exist, will create it"),Rt("Building PublicSwap instruction...");const h=new Uint8Array(18);let X=0;h[X++]=6;let J=BigInt(b);for(let ut=0;ut<8;ut++)h[X++]=Number(J&0xFFn),J>>=8n;let nt=BigInt(u);for(let ut=0;ut<8;ut++)h[X++]=Number(nt&0xFFn),nt>>=8n;const O=n==="wSOL"?0:1;h[X++]=O;const{blockhash:w,lastValidBlockHeight:U}=await s.getLatestBlockhash(),W=new c({recentBlockhash:w,feePayer:l});if(_){Rt("Adding create ATA instruction...");const{SystemProgram:ut}=window.solanaWeb3,ot=new f({programId:$,keys:[{pubkey:l,isSigner:!0,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:ut.programId,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1}],data:wn.Buffer.alloc(0)});W.add(ot)}const dt=new f({programId:new o(It.programId),keys:[{pubkey:l,isSigner:!0,isWritable:!0},{pubkey:new o(It.poolAccounts.poolAccount),isSigner:!1,isWritable:!0},{pubkey:G,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:Q,isSigner:!1,isWritable:!0},{pubkey:M,isSigner:!1,isWritable:!0},{pubkey:new o(It.poolAccounts.poolAuthority),isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1}],data:wn.Buffer.from(h)});W.add(dt),Rt("Please approve in wallet...");const st=await D.wallet.signTransaction(W),H=await s.sendRawTransaction(st.serialize());Rt("Confirming transaction..."),await s.confirmTransaction({signature:H,blockhash:w,lastValidBlockHeight:U}),await vn(),await Va(),_n(H,`https://explorer.solana.com/tx/${H}?cluster=testnet`)}catch(e){console.error("Public swap failed:",e),Xt(e.message)}}async function Bn(a,t){const{PublicKey:n}=window.solanaWeb3||await Ln(),e=new n("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"),o=new n("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),[c]=n.findProgramAddressSync([a.toBuffer(),o.toBuffer(),t.toBuffer()],e);return c}async function vn(){if(D.publicKey)try{const{Connection:a,PublicKey:t,LAMPORTS_PER_SOL:n}=window.solanaWeb3||await Ln(),e=new a(It.rpcUrl,"confirmed"),o=new t(D.publicKey),c=new t(It.tokenAccounts.wsolMint),f=new t(It.tokenAccounts.usdcMint),b=await e.getBalance(o)/n;document.getElementById("native-sol-balance").textContent=b.toFixed(4);const u=await Bn(o,c),l=await Bn(o,f);let B=0,x=0;try{const R=await e.getTokenAccountBalance(u);B=parseFloat(R.value.uiAmountString)||0}catch{B=0}try{const R=await e.getTokenAccountBalance(l);x=parseFloat(R.value.uiAmountString)||0}catch{x=0}const y=document.getElementById("public-swap-from-token").value,$=document.getElementById("public-swap-to-token").value;document.getElementById("public-from-balance").textContent=y==="wSOL"?B.toFixed(4):x.toFixed(2),document.getElementById("public-to-balance").textContent=$==="wSOL"?B.toFixed(4):x.toFixed(2),console.log(`Balances - Native SOL: ${b}, wSOL: ${B}, tUSDC: ${x}`)}catch(a){console.error("Failed to fetch token balances:",a)}}async function cl(){if(!D.wallet||!D.publicKey){alert("Please connect wallet first");return}const a=prompt("Enter amount of SOL to wrap:","0.1");if(!a)return;const t=parseFloat(a);if(isNaN(t)||t<=0){alert("Invalid amount");return}ln("Wrapping SOL to wSOL...");try{const{Connection:n,PublicKey:e,Transaction:o,TransactionInstruction:c,SystemProgram:f,LAMPORTS_PER_SOL:s}=window.solanaWeb3||await Ln(),b=new n(It.rpcUrl,"confirmed"),u=new e(D.publicKey),l=new e(It.tokenAccounts.wsolMint),B=new e("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),x=new e("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"),y=await Bn(u,l),{blockhash:$,lastValidBlockHeight:R}=await b.getLatestBlockhash(),I=new o({recentBlockhash:$,feePayer:u});if(!await b.getAccountInfo(y)){Rt("Creating wSOL token account...");const _=new c({programId:x,keys:[{pubkey:u,isSigner:!0,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:f.programId,isSigner:!1,isWritable:!1},{pubkey:B,isSigner:!1,isWritable:!1}],data:wn.Buffer.alloc(0)});I.add(_)}Rt("Transferring SOL...");const A=Math.floor(t*s),Q=f.transfer({fromPubkey:u,toPubkey:y,lamports:A});I.add(Q);const M=new c({programId:B,keys:[{pubkey:y,isSigner:!1,isWritable:!0}],data:wn.Buffer.from([17])});I.add(M),Rt("Please approve in wallet...");const ct=await D.wallet.signTransaction(I),C=await b.sendRawTransaction(ct.serialize());Rt("Confirming transaction..."),await b.confirmTransaction({signature:C,blockhash:$,lastValidBlockHeight:R}),await vn(),_n(C,`https://explorer.solana.com/tx/${C}?cluster=testnet`)}catch(n){console.error("Wrap SOL failed:",n),Xt(n.message)}}async function sl(){if(!D.wallet||!D.publicKey){alert("Please connect wallet first");return}ln("Unwrapping wSOL to SOL...");try{const{Connection:a,PublicKey:t,Transaction:n,TransactionInstruction:e}=window.solanaWeb3||await Ln(),o=new a(It.rpcUrl,"confirmed"),c=new t(D.publicKey),f=new t(It.tokenAccounts.wsolMint),s=new t("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),b=await Bn(c,f);let u=0;try{const I=await o.getTokenAccountBalance(b);u=parseFloat(I.value.uiAmountString)||0}catch{throw new Error("No wSOL token account found")}if(u<=0)throw new Error("No wSOL balance to unwrap");Rt(`Closing wSOL account (${u.toFixed(4)} wSOL)...`);const{blockhash:l,lastValidBlockHeight:B}=await o.getLatestBlockhash(),x=new n({recentBlockhash:l,feePayer:c}),y=new e({programId:s,keys:[{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!0,isWritable:!1}],data:wn.Buffer.from([9])});x.add(y),Rt("Please approve in wallet...");const $=await D.wallet.signTransaction(x),R=await o.sendRawTransaction($.serialize());Rt("Confirming transaction..."),await o.confirmTransaction({signature:R,blockhash:l,lastValidBlockHeight:B}),await vn(),_n(R,`https://explorer.solana.com/tx/${R}?cluster=testnet`)}catch(a){console.error("Unwrap SOL failed:",a),Xt(a.message)}}function ll(){const a=document.querySelectorAll(".tabs-inner .tab-btn"),t=document.getElementById("add-liquidity-btn"),n=document.getElementById("remove-liquidity-btn");a.forEach(e=>{e.addEventListener("click",()=>{a.forEach(c=>c.classList.remove("active")),e.classList.add("active");const o=e.dataset.action;document.getElementById("add-liquidity").classList.toggle("hidden",o!=="add"),document.getElementById("remove-liquidity").classList.toggle("hidden",o!=="remove")})}),t.addEventListener("click",dl),n.addEventListener("click",ul),document.getElementById("add-token-a").addEventListener("input",Xo),document.getElementById("add-token-b").addEventListener("input",Xo),document.getElementById("remove-lp").addEventListener("input",rl)}function Xo(){const a=parseFloat(document.getElementById("add-token-a").value)||0,t=parseFloat(document.getElementById("add-token-b").value)||0;if(!D.poolState||a===0||t===0){document.getElementById("lp-receive").textContent="0.00",document.getElementById("pool-share").textContent="0.00%";return}const{reserveA:n,reserveB:e,totalLpSupply:o}=D.poolState,c=a*1e9/n,f=t*1e6/e,s=Math.min(c,f)*o/1e6;document.getElementById("lp-receive").textContent=s.toFixed(2);const b=parseFloat(o)/1e6+s,u=s/b*100;document.getElementById("pool-share").textContent=u.toFixed(2)+"%"}function rl(){const a=parseFloat(document.getElementById("remove-lp").value)||0;if(!D.poolState||a===0){document.getElementById("receive-sol").textContent="0.00",document.getElementById("receive-usdc").textContent="0.00";return}const{reserveA:t,reserveB:n,totalLpSupply:e}=D.poolState,o=a*1e6/e,c=o*t/1e9,f=o*n/1e6;document.getElementById("receive-sol").textContent=c.toFixed(4),document.getElementById("receive-usdc").textContent=f.toFixed(2)}async function dl(){var n,e,o,c,f,s,b,u;const a=parseFloat(document.getElementById("add-token-a").value),t=parseFloat(document.getElementById("add-token-b").value);if(!a||!t){alert("Please enter amounts for both tokens");return}if(!D.utxoStorage){alert("Please connect wallet first");return}ln("Selecting UTXOs...");try{const l=Math.floor(a*1e9),B=Math.floor(t*1e6),x=D.utxoStorage.selectUtxos(sn,l),y=D.utxoStorage.selectUtxos(un,B);Rt("Building input UTXOs...");const $=[{amount:((n=x.utxos[0])==null?void 0:n.amount)||"0",privateKey:D.privateKey,blinding:((e=x.utxos[0])==null?void 0:e.blinding)||Kt(),pathElements:D.merkleTree.getProof(((o=x.utxos[0])==null?void 0:o.leafIndex)||0).pathElements,pathIndices:D.merkleTree.getProof(((c=x.utxos[0])==null?void 0:c.leafIndex)||0).pathIndices},{amount:((f=y.utxos[0])==null?void 0:f.amount)||"0",privateKey:D.privateKey,blinding:((s=y.utxos[0])==null?void 0:s.blinding)||Kt(),pathElements:D.merkleTree.getProof(((b=y.utxos[0])==null?void 0:b.leafIndex)||0).pathElements,pathIndices:D.merkleTree.getProof(((u=y.utxos[0])==null?void 0:u.leafIndex)||0).pathIndices}],{reserveA:R,reserveB:I,totalLpSupply:G}=D.poolState,A=Math.floor(Math.sqrt(l*B)),Q={lpAmount:A.toString(),pubkey:D.zkPubkey,blinding:Kt()};Rt("Generating ZK proof... (this may take 30-60 seconds)");const M=await Ms({root:D.merkleTree.getRoot(),inputUtxos:$,outputUtxo:Q,poolState:{reserveA:R.toString(),reserveB:I.toString(),poolPubkey:It.poolAccounts.poolAccount,poolBlinding:Kt()},newPoolState:{reserveA:(BigInt(R)+BigInt(l)).toString(),reserveB:(BigInt(I)+BigInt(B)).toString(),poolBlinding:Kt()},lpState:{totalLpSupply:G.toString(),lpPoolPubkey:It.poolAccounts.poolAccount,lpBlinding:Kt()},newLpState:{totalLpSupply:(BigInt(G)+BigInt(A)).toString(),lpBlinding:Kt()},extDataHash:"0"});Rt("Submitting to relayer...");const C=await(await fetch(`${It.relayerUrl}/add-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:M.proof,publicSignals:M.publicSignals,nullifiers:M.inputNullifiers,outputCommitment:M.outputCommitment,newPoolStateHash:M.newPoolStateHash,newLpStateHash:M.newLpStateHash})})).json();if(C.success){for(const _ of x.utxos)await D.utxoStorage.markSpent(_.commitment,M.inputNullifiers[0]);for(const _ of y.utxos)await D.utxoStorage.markSpent(_.commitment,M.inputNullifiers[1]);await D.utxoStorage.addUtxo({commitment:M.outputCommitment,amount:A.toString(),assetId:lo,blinding:Q.blinding,leafIndex:D.merkleTree.getLeafCount()}),Fn(),_n(C.signature,C.explorer)}else Xt(C.error)}catch(l){console.error("Add liquidity failed:",l),Xt(l.message)}}async function ul(){const a=parseFloat(document.getElementById("remove-lp").value);if(!a){alert("Please enter LP amount");return}if(!D.utxoStorage){alert("Please connect wallet first");return}ln("Selecting LP UTXOs...");try{const t=Math.floor(a*1e6),n=D.utxoStorage.selectUtxos(lo,t);if(n.utxos.length===0)throw new Error("Insufficient LP balance");Rt("Calculating withdrawal amounts...");const{reserveA:e,reserveB:o,totalLpSupply:c}=D.poolState,f=BigInt(t)*BigInt(1e18)/BigInt(c),s=(BigInt(e)*f/BigInt(1e18)).toString(),b=(BigInt(o)*f/BigInt(1e18)).toString(),u={lpAmount:n.utxos[0].amount,privateKey:D.privateKey,blinding:n.utxos[0].blinding,pathElements:D.merkleTree.getProof(n.utxos[0].leafIndex).pathElements,pathIndices:D.merkleTree.getProof(n.utxos[0].leafIndex).pathIndices},l=[{amount:s,pubkey:D.zkPubkey,blinding:Kt()},{amount:b,pubkey:D.zkPubkey,blinding:Kt()}];Rt("Generating ZK proof... (this may take 20-40 seconds)");const B=await zs({root:D.merkleTree.getRoot(),inputUtxo:u,outputUtxos:l,poolState:{reserveA:e.toString(),reserveB:o.toString(),poolPubkey:It.poolAccounts.poolAccount,poolBlinding:Kt()},newPoolState:{reserveA:(BigInt(e)-BigInt(s)).toString(),reserveB:(BigInt(o)-BigInt(b)).toString(),poolBlinding:Kt()},lpState:{totalLpSupply:c.toString(),lpPoolPubkey:It.poolAccounts.poolAccount,lpBlinding:Kt()},newLpState:{totalLpSupply:(BigInt(c)-BigInt(t)).toString(),lpBlinding:Kt()},extDataHash:"0"});Rt("Submitting to relayer...");const y=await(await fetch(`${It.relayerUrl}/remove-liquidity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:B.proof,publicSignals:B.publicSignals,nullifier:B.inputNullifier,outputCommitments:B.outputCommitments,newPoolStateHash:B.newPoolStateHash,newLpStateHash:B.newLpStateHash})})).json();y.success?(await D.utxoStorage.markSpent(n.utxos[0].commitment,B.inputNullifier),await D.utxoStorage.addUtxo({commitment:B.outputCommitments[0],amount:s,assetId:sn,blinding:l[0].blinding,leafIndex:D.merkleTree.getLeafCount()}),await D.utxoStorage.addUtxo({commitment:B.outputCommitments[1],amount:b,assetId:un,blinding:l[1].blinding,leafIndex:D.merkleTree.getLeafCount()+1}),Fn(),_n(y.signature,y.explorer)):Xt(y.error)}catch(t){console.error("Remove liquidity failed:",t),Xt(t.message)}}function _l(){document.getElementById("deposit-btn").addEventListener("click",yl),document.getElementById("withdraw-btn").addEventListener("click",bl),document.getElementById("confirm-deposit").addEventListener("click",pl),document.getElementById("confirm-withdraw").addEventListener("click",Ll);const a=document.getElementById("clear-rebuild-btn");a&&a.addEventListener("click",gl);const t=document.getElementById("recover-utxo-btn");t&&t.addEventListener("click",Ka);const n=document.getElementById("manual-recover-btn");n&&n.addEventListener("click",wl);const e=document.getElementById("confirm-manual-recovery");e&&e.addEventListener("click",Bl)}function Fn(){if(!D.utxoStorage){document.getElementById("total-value").textContent="$0.00",document.getElementById("utxo-count").textContent="0";return}const a=D.utxoStorage.getUnspent();console.log("Portfolio UTXOs:",a),console.log("All UTXOs (including spent):",D.utxoStorage.getAll());let t=0n,n=0n,e=0n;a.forEach(s=>{const b=BigInt(s.amount);s.assetId===sn&&(t+=b),s.assetId===un&&(n+=b),s.assetId===lo&&(e+=b)});const c=Number(t)/1e9*150+Number(n)/1e6;document.getElementById("total-value").textContent="$"+c.toFixed(2),document.getElementById("utxo-count").textContent=a.length.toString();const f=document.getElementById("asset-list-content");a.length===0?f.innerHTML='<p class="empty-state">No private assets. Deposit to get started!</p>':f.innerHTML=`
            <div class="asset-item">SOL: ${(Number(t)/1e9).toFixed(4)}</div>
            <div class="asset-item">USDC: ${(Number(n)/1e6).toFixed(2)}</div>
            ${e>0n?`<div class="asset-item">LP: ${(Number(e)/1e6).toFixed(2)}</div>`:""}
        `,document.getElementById("from-balance").textContent=(Number(t)/1e9).toFixed(4),document.getElementById("lp-balance").textContent=(Number(e)/1e6).toFixed(2)}async function gl(){if(!D.wallet||!D.privateKey||!D.zkPubkey){alert("Please connect wallet first");return}if(confirm("This will clear your local UTXO data and try to recover from the blockchain. Continue?")){ln("Clearing local data...");try{await D.utxoStorage.clear(),console.log("Cleared local UTXO storage"),Xs(),console.log("Reset deposit nonce to 0"),Rt("Rebuilding from chain..."),await Ka()}catch(a){console.error("Clear and rebuild failed:",a),Xt(a.message)}}}async function Ka(){if(!D.wallet||!D.privateKey||!D.zkPubkey){alert("Please connect wallet first");return}ln("Starting UTXO recovery...");try{Rt("Syncing Merkle tree from chain...");const a=await me(It.rpcUrl,It.poolAccounts.merkleAccount);D.merkleTree=a;const t=a.getLeafCount();if(console.log(`Found ${t} commitments on chain`),t===0){Xt("No commitments found on chain");return}Rt("Checking nullifier set...");const n=await fl();Rt(`Scanning ${t} commitments...`);const e=[],o=[1e6,1e7,1e8,5e8,1e9,2e9,5e9,1e10],c=[1e4,1e5,1e6,5e6,1e7,5e7,1e8,5e8,1e9];for(let b=0;b<t;b++){const u=a.leaves[b];if(Rt(`Scanning commitment ${b+1}/${t}...`),D.utxoStorage.getAll().find(x=>x.commitment===u)){console.log(`Commitment ${b} already in storage`);continue}for(const x of o){const y=await Xe(u,D.privateKey,D.zkPubkey,x,sn,100);if(y){console.log(`Recovered SOL UTXO: amount=${x}, nonce=${y.nonce}`),e.push({commitment:u,amount:x.toString(),assetId:sn,blinding:y.blinding,leafIndex:b,depositNonce:y.nonce,recovered:!0});break}}if(!e.find(x=>x.commitment===u))for(const x of c){const y=await Xe(u,D.privateKey,D.zkPubkey,x,un,100);if(y){console.log(`Recovered USDC UTXO: amount=${x}, nonce=${y.nonce}`),e.push({commitment:u,amount:x.toString(),assetId:un,blinding:y.blinding,leafIndex:b,depositNonce:y.nonce,recovered:!0});break}}}Rt(`Recovered ${e.length} UTXOs, saving...`);for(const b of e){const u=await ee(b.commitment,D.privateKey,b.leafIndex);n.includes(u)?console.log(`Skipping spent UTXO: ${b.commitment.slice(0,10)}...`):(await D.utxoStorage.addUtxo(b),console.log(`Added recovered UTXO: ${b.assetId===sn?"SOL":"USDC"} ${b.amount}`))}const f=Math.max(0,...e.map(b=>b.depositNonce)),s=ye();f>=s&&(localStorage.setItem("privacy-amm-deposit-nonce",(f+1).toString()),console.log(`Updated deposit nonce to ${f+1}`)),Fn(),e.length>0?(_n(null,null),document.getElementById("tx-status-text").textContent=`Successfully recovered ${e.length} UTXOs!`):Xt(`No recoverable UTXOs found. This could mean:
1. No deposits were made from this wallet
2. All UTXOs have already been spent
3. Deposits used random blinding (older version)`)}catch(a){console.error("Recovery failed:",a),Xt("Recovery failed: "+a.message)}}async function fl(){try{const{Connection:a,PublicKey:t}=window.solanaWeb3||await Ln(),n=new a(It.rpcUrl,"confirmed"),e=new t(It.poolAccounts.nullifierAccount),o=await n.getAccountInfo(e);return!o||!o.data?[]:(console.log("Nullifier account size:",o.data.length),[])}catch(a){return console.error("Failed to fetch nullifiers:",a),[]}}async function pl(){const a=parseFloat(document.getElementById("deposit-amount").value),t=document.getElementById("deposit-token").value;if(!a){alert("Please enter an amount");return}if(!D.utxoStorage||!D.wallet){alert("Please connect wallet first");return}Qn(),ln("Computing commitment...");try{const n=t==="SOL"?sn:un,e=Math.floor(t==="SOL"?a*1e9:a*1e6),o=ye(),c=await Wa(D.privateKey,o,e,n);console.log(`Deposit nonce: ${o}, blinding derived deterministically`);const f=await hn(e.toString(),n.toString(),D.zkPubkey,c);Rt("Building transaction...");const s=hl(f,e,n),{Connection:b,PublicKey:u,Transaction:l,TransactionInstruction:B}=window.solanaWeb3||await Ln(),x=new b(It.rpcUrl,"confirmed"),y=new u(D.publicKey),$=new u("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),R=t==="SOL"?new u(It.tokenAccounts.wsolMint):new u(It.tokenAccounts.usdcMint),I=t==="SOL"?new u(It.tokenAccounts.poolWsolVault):new u(It.tokenAccounts.poolUsdcVault),G=await Bn(y,R);Rt("Checking token account...");try{const h=await x.getTokenAccountBalance(G),X=parseFloat(h.value.uiAmountString)||0,J=a;if(X<J)throw new Error(`Insufficient ${t==="SOL"?"wSOL":"tUSDC"} balance. Have: ${X}, Need: ${J}`)}catch(h){throw h.message.includes("Insufficient")?h:new Error(`You need a ${t==="SOL"?"wSOL":"tUSDC"} token account. Please wrap SOL or get tUSDC first.`)}const{blockhash:A,lastValidBlockHeight:Q}=await x.getLatestBlockhash(),M=new l({recentBlockhash:A,feePayer:y}),ct=new B({programId:new u(It.programId),keys:[{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:new u(It.poolAccounts.poolAccount),isSigner:!1,isWritable:!0},{pubkey:new u(It.poolAccounts.merkleAccount),isSigner:!1,isWritable:!0},{pubkey:G,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1}],data:wn.Buffer.from(s)});M.add(ct),Rt("Please approve in wallet...");const C=await D.wallet.signTransaction(M),_=await x.sendRawTransaction(C.serialize());Rt("Confirming transaction..."),await x.confirmTransaction({signature:_,blockhash:A,lastValidBlockHeight:Q}),await D.utxoStorage.addUtxo({commitment:f,amount:e.toString(),assetId:n,blinding:c,leafIndex:D.merkleTree.getLeafCount(),depositNonce:o}),Zs(),await D.merkleTree.insert(f),Fn(),await vn(),_n(_,`https://explorer.solana.com/tx/${_}?cluster=testnet`)}catch(n){console.error("Deposit failed:",n),Xt(n.message)}}function hl(a,t,n){const e=new Uint8Array(42);let o=0;e[o++]=1;let c=BigInt(a);for(let s=0;s<32;s++)e[o++]=Number(c&0xFFn),c>>=8n;let f=BigInt(t);for(let s=0;s<8;s++)e[o++]=Number(f&0xFFn),f>>=8n;return e[o++]=n,e}async function Ln(){return window.solanaWeb3?window.solanaWeb3:new Promise((a,t)=>{const n=document.createElement("script");n.src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js",n.onload=()=>a(window.solanaWeb3),n.onerror=t,document.head.appendChild(n)})}async function Ll(){var e;const a=parseFloat(document.getElementById("withdraw-amount").value),t=document.getElementById("withdraw-recipient").value,n=((e=document.getElementById("withdraw-token"))==null?void 0:e.value)||"SOL";if(!a||!t){alert("Please enter amount and recipient");return}if(!D.utxoStorage){alert("Please connect wallet first");return}Qn(),ln("Selecting UTXOs...");try{const o=n==="SOL"?sn:un,c=Math.floor(n==="SOL"?a*1e9:a*1e6),f=D.utxoStorage.selectUtxos(o,c);if(f.utxos.length===0)throw new Error("Insufficient private balance");const s=f.utxos[0],b=await hn(s.amount,o.toString(),D.zkPubkey,s.blinding),u=await ee(b,D.privateKey,s.leafIndex.toString());Rt("Getting recipient token account...");const{PublicKey:l}=window.solanaWeb3||await Ln(),B=new l(t),x=n==="SOL"?new l(It.tokenAccounts.wsolMint):new l(It.tokenAccounts.usdcMint),y=await Bn(B,x);Rt("Submitting withdrawal...");const R=await(await fetch(`${It.relayerUrl}/withdraw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proof:{},publicSignals:[],nullifier:u,recipient:y.toBase58(),amount:c,assetType:o})})).json();R.success?(await D.utxoStorage.markSpent(s.commitment,u),Fn(),await vn(),_n(R.signature,R.explorer)):Xt(R.error||"Withdrawal failed")}catch(o){console.error("Withdraw failed:",o),Xt(o.message)}}function ml(){document.getElementById("modal-overlay").addEventListener("click",a=>{a.target.id==="modal-overlay"&&Qn()}),document.querySelectorAll(".modal-close").forEach(a=>{a.addEventListener("click",Qn)})}function ln(a){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("tx-modal").classList.remove("hidden"),document.getElementById("tx-status-text").textContent=a,document.getElementById("tx-spinner").style.display="block",document.getElementById("tx-success").classList.add("hidden"),document.getElementById("tx-error").classList.add("hidden"),document.querySelector(".tx-status").classList.remove("hidden")}function Rt(a){document.getElementById("tx-status-text").textContent=a}function _n(a,t){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-success").classList.remove("hidden"),document.getElementById("tx-explorer-link").href=t||`https://explorer.solana.com/tx/${a}?cluster=testnet`}function Xt(a){document.querySelector(".tx-status").classList.add("hidden"),document.getElementById("tx-error").classList.remove("hidden"),document.getElementById("tx-error-text").textContent=a}function yl(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("deposit-modal").classList.remove("hidden")}function bl(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("withdraw-modal").classList.remove("hidden")}function wl(){document.getElementById("modal-overlay").classList.remove("hidden"),document.getElementById("manual-recovery-modal").classList.remove("hidden")}async function Bl(){const a=parseFloat(document.getElementById("manual-recovery-amount").value),t=document.getElementById("manual-recovery-token").value;if(!a){alert("Please enter an amount");return}if(!D.wallet||!D.privateKey||!D.zkPubkey){alert("Please connect wallet first");return}Qn(),ln("Starting manual recovery...");try{const n=t==="SOL"?sn:un,e=Math.floor(t==="SOL"?a*1e9:a*1e6);Rt("Syncing Merkle tree...");const o=await me(It.rpcUrl,It.poolAccounts.merkleAccount);D.merkleTree=o;const c=o.getLeafCount();if(console.log(`Found ${c} commitments, scanning for amount ${e}...`),c===0){Xt("No commitments found on chain");return}let f=0;for(let s=0;s<c;s++){const b=o.leaves[s];if(Rt(`Scanning commitment ${s+1}/${c}...`),D.utxoStorage.getAll().find(B=>B.commitment===b)){console.log(`Commitment ${s} already in storage`);continue}const l=await Xe(b,D.privateKey,D.zkPubkey,e,n,200);if(l){console.log(`Found UTXO! nonce=${l.nonce}`),await D.utxoStorage.addUtxo({commitment:b,amount:e.toString(),assetId:n,blinding:l.blinding,leafIndex:s,depositNonce:l.nonce,recovered:!0});const B=ye();l.nonce>=B&&localStorage.setItem("privacy-amm-deposit-nonce",(l.nonce+1).toString()),f++}}Fn(),f>0?(_n(null,null),document.getElementById("tx-status-text").textContent=`Found ${f} UTXO(s) with amount ${a} ${t}!`):Xt(`No UTXO found with amount ${a} ${t}.
Make sure the amount is exactly what you deposited.`)}catch(n){console.error("Manual recovery failed:",n),Xt("Recovery failed: "+n.message)}}function Qn(){document.getElementById("modal-overlay").classList.add("hidden"),document.querySelectorAll(".modal").forEach(a=>a.classList.add("hidden"))}async function Va(){try{const{Connection:a,PublicKey:t}=window.solanaWeb3||await Ln(),n=new a(It.rpcUrl,"confirmed"),e=new t(It.poolAccounts.poolAccount),o=await n.getAccountInfo(e);if(o&&o.data.length>=90){const c=o.data instanceof Uint8Array?o.data:new Uint8Array(o.data),f=new DataView(c.buffer,c.byteOffset,c.byteLength),s=B=>{const x=f.getUint32(B,!0),y=f.getUint32(B+4,!0);return x+y*4294967296},b=s(66),u=s(74),l=s(82);D.poolState={reserveA:b,reserveB:u,totalLpSupply:l},console.log("Pool state from chain:",{reserveA:(b/1e9).toFixed(4)+" SOL",reserveB:(u/1e6).toFixed(2)+" USDC",totalLp:l})}else throw new Error("Invalid pool account data");if(D.poolState.reserveA>0){const c=D.poolState.reserveB/D.poolState.reserveA*1e3;document.getElementById("swap-rate").textContent=`1 SOL = ${c.toFixed(2)} USDC`}}catch(a){console.error("Failed to load pool state from chain:",a);try{const n=await(await fetch(`${It.relayerUrl}/pool`)).json();D.poolState={reserveA:parseFloat(n.reserveA),reserveB:parseFloat(n.reserveB),totalLpSupply:parseFloat(n.totalLpSupply)}}catch(t){console.error("Relayer also failed:",t),D.poolState={reserveA:1e9,reserveB:1e8,totalLpSupply:316227766}}}}function xl(a){return a?a.slice(0,4)+"..."+a.slice(-4):""}export{wn as b};
