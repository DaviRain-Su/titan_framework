<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy AMM - Solana's First Private DEX</title>
    <link rel="stylesheet" href="/src/style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üîí</span>
                <span class="logo-text">Privacy AMM</span>
            </div>
            <nav class="nav">
                <a href="#swap" class="nav-link active" data-tab="swap">Swap</a>
                <a href="#liquidity" class="nav-link" data-tab="liquidity">Liquidity</a>
                <a href="#portfolio" class="nav-link" data-tab="portfolio">Portfolio</a>
            </nav>
            <div class="wallet-section">
                <button id="connect-wallet" class="btn btn-primary">Connect Wallet</button>
                <div id="wallet-info" class="wallet-info hidden">
                    <span id="wallet-address"></span>
                    <button id="disconnect-wallet" class="btn btn-small">Disconnect</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Swap Tab -->
            <div id="swap-tab" class="tab-content active">
                <div class="card swap-card">
                    <!-- Swap Mode Toggle -->
                    <div class="tabs-inner swap-mode-tabs">
                        <button class="tab-btn active" data-swap-mode="public">Public Swap</button>
                        <button class="tab-btn" data-swap-mode="private">Private Swap</button>
                    </div>

                    <!-- Public Swap Form -->
                    <div id="public-swap-form" class="swap-form">
                        <h2>Public Swap</h2>
                        <p class="subtitle">Swap wSOL/tUSDC directly from your wallet</p>

                        <div class="input-group">
                            <label>From</label>
                            <div class="token-input">
                                <input type="number" id="public-swap-from-amount" placeholder="0.0" step="0.000001">
                                <select id="public-swap-from-token">
                                    <option value="wSOL">wSOL</option>
                                    <option value="tUSDC">tUSDC</option>
                                </select>
                            </div>
                            <div class="balance">Wallet Balance: <span id="public-from-balance">0.00</span></div>
                        </div>

                        <button class="swap-direction" id="public-swap-direction">‚áÖ</button>

                        <div class="input-group">
                            <label>To</label>
                            <div class="token-input">
                                <input type="number" id="public-swap-to-amount" placeholder="0.0" readonly>
                                <select id="public-swap-to-token">
                                    <option value="tUSDC">tUSDC</option>
                                    <option value="wSOL">wSOL</option>
                                </select>
                            </div>
                            <div class="balance">Wallet Balance: <span id="public-to-balance">0.00</span></div>
                        </div>

                        <div class="swap-info">
                            <div class="info-row">
                                <span>Rate</span>
                                <span id="public-swap-rate">1 wSOL = -- tUSDC</span>
                            </div>
                            <div class="info-row">
                                <span>Price Impact</span>
                                <span id="public-price-impact">--</span>
                            </div>
                            <div class="info-row">
                                <span>Fee</span>
                                <span>0.3%</span>
                            </div>
                        </div>

                        <button id="public-swap-btn" class="btn btn-primary btn-large" disabled>
                            Connect Wallet to Swap
                        </button>

                        <div class="info-text" style="margin-top: 1rem; font-size: 0.85rem; color: #888;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Native SOL Balance:</strong> <span id="native-sol-balance">0.00</span> SOL
                            </div>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <button id="wrap-sol-btn" class="btn btn-secondary btn-small" style="flex: 1;">
                                    Wrap SOL ‚Üí wSOL
                                </button>
                                <button id="unwrap-sol-btn" class="btn btn-secondary btn-small" style="flex: 1;">
                                    Unwrap wSOL ‚Üí SOL
                                </button>
                            </div>
                            <div style="font-size: 0.8rem;">
                                Note: Public swap uses wSOL (wrapped SOL). Click "Wrap SOL" to convert.
                            </div>
                        </div>
                    </div>

                    <!-- Private Swap Form (Hidden by default) -->
                    <div id="private-swap-form" class="swap-form hidden">
                        <h2>Private Swap</h2>
                        <p class="subtitle">Swap tokens with zero-knowledge privacy</p>

                        <div class="input-group">
                            <label>From</label>
                            <div class="token-input">
                                <input type="number" id="swap-from-amount" placeholder="0.0" step="0.000001">
                                <select id="swap-from-token">
                                    <option value="SOL">SOL</option>
                                    <option value="USDC">tUSDC</option>
                                </select>
                            </div>
                            <div class="balance">Private Balance: <span id="from-balance">0.00</span></div>
                        </div>

                        <button class="swap-direction" id="swap-direction">‚áÖ</button>

                        <div class="input-group">
                            <label>To</label>
                            <div class="token-input">
                                <input type="number" id="swap-to-amount" placeholder="0.0" readonly>
                                <select id="swap-to-token">
                                    <option value="USDC">tUSDC</option>
                                    <option value="SOL">SOL</option>
                                </select>
                            </div>
                            <div class="balance">Private Balance: <span id="to-balance">0.00</span></div>
                        </div>

                        <div class="swap-info">
                            <div class="info-row">
                                <span>Rate</span>
                                <span id="swap-rate">1 SOL = 150 tUSDC</span>
                            </div>
                            <div class="info-row">
                                <span>Price Impact</span>
                                <span id="price-impact">0.01%</span>
                            </div>
                            <div class="info-row">
                                <span>Slippage Tolerance</span>
                                <span id="slippage">0.5%</span>
                            </div>
                        </div>

                        <button id="swap-btn" class="btn btn-primary btn-large" disabled>
                            Connect Wallet to Swap
                        </button>

                        <div class="privacy-badge">
                            <span class="badge-icon">üõ°Ô∏è</span>
                            <span>Protected by Zero-Knowledge Proofs</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Liquidity Tab -->
            <div id="liquidity-tab" class="tab-content">
                <div class="card">
                    <h2>Private Liquidity</h2>
                    <p class="subtitle">Provide liquidity and earn fees privately</p>

                    <div class="tabs-inner">
                        <button class="tab-btn active" data-action="add">Add Liquidity</button>
                        <button class="tab-btn" data-action="remove">Remove Liquidity</button>
                    </div>

                    <!-- Add Liquidity -->
                    <div id="add-liquidity" class="liquidity-form">
                        <div class="input-group">
                            <label>Token A (SOL)</label>
                            <div class="token-input">
                                <input type="number" id="add-token-a" placeholder="0.0">
                                <span class="token-label">SOL</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>Token B (USDC)</label>
                            <div class="token-input">
                                <input type="number" id="add-token-b" placeholder="0.0">
                                <span class="token-label">USDC</span>
                            </div>
                        </div>

                        <div class="swap-info">
                            <div class="info-row">
                                <span>LP Tokens to Receive</span>
                                <span id="lp-receive">0.00</span>
                            </div>
                            <div class="info-row">
                                <span>Share of Pool</span>
                                <span id="pool-share">0.00%</span>
                            </div>
                        </div>

                        <button id="add-liquidity-btn" class="btn btn-primary btn-large" disabled>
                            Add Liquidity
                        </button>
                    </div>

                    <!-- Remove Liquidity -->
                    <div id="remove-liquidity" class="liquidity-form hidden">
                        <div class="input-group">
                            <label>LP Tokens</label>
                            <div class="token-input">
                                <input type="number" id="remove-lp" placeholder="0.0">
                                <span class="token-label">LP</span>
                            </div>
                            <div class="balance">Your LP Balance: <span id="lp-balance">0.00</span></div>
                        </div>

                        <div class="swap-info">
                            <div class="info-row">
                                <span>SOL to Receive</span>
                                <span id="receive-sol">0.00</span>
                            </div>
                            <div class="info-row">
                                <span>USDC to Receive</span>
                                <span id="receive-usdc">0.00</span>
                            </div>
                        </div>

                        <button id="remove-liquidity-btn" class="btn btn-primary btn-large" disabled>
                            Remove Liquidity
                        </button>
                    </div>
                </div>
            </div>

            <!-- Portfolio Tab -->
            <div id="portfolio-tab" class="tab-content">
                <div class="card">
                    <h2>Private Portfolio</h2>
                    <p class="subtitle">Your hidden assets (only visible to you)</p>

                    <div class="portfolio-summary">
                        <div class="summary-item">
                            <span class="label">Total Value</span>
                            <span class="value" id="total-value">$0.00</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Private UTXOs</span>
                            <span class="value" id="utxo-count">0</span>
                        </div>
                    </div>

                    <div class="asset-list">
                        <h3>Private Assets</h3>
                        <div id="asset-list-content">
                            <p class="empty-state">Connect wallet to view your private assets</p>
                        </div>
                    </div>

                    <div class="actions">
                        <button id="deposit-btn" class="btn btn-secondary" disabled>
                            Deposit (Public ‚Üí Private)
                        </button>
                        <button id="withdraw-btn" class="btn btn-secondary" disabled>
                            Withdraw (Private ‚Üí Public)
                        </button>
                    </div>

                    <div class="recovery-section" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                        <h3 style="font-size: 14px; margin-bottom: 0.5rem;">Lost your UTXOs?</h3>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 0.75rem;">
                            If you cleared browser data or switched devices, click below to recover from the relayer.
                        </p>
                        <button id="clear-rebuild-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;" disabled>
                            Clear & Rebuild from Relayer
                        </button>
                        <button id="recover-utxo-btn" class="btn btn-secondary" style="width: 100%; margin-bottom: 0.5rem;" disabled>
                            Auto-Recover (Common Amounts)
                        </button>
                        <button id="manual-recover-btn" class="btn btn-secondary" style="width: 100%; opacity: 0.8;" disabled>
                            Manual Recovery (Specific Amount)
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-links">
                <a href="https://github.com/anthropics/titan_framework" target="_blank">GitHub</a>
                <a href="https://explorer.solana.com/?cluster=testnet" target="_blank">Explorer</a>
                <a href="#" id="docs-link">Docs</a>
            </div>
            <div class="footer-info">
                <span>Network: Solana Testnet</span>
                <span>‚Ä¢</span>
                <span>Powered by Zero-Knowledge Proofs</span>
            </div>
        </footer>

        <!-- Modals -->
        <div id="modal-overlay" class="modal-overlay hidden">
            <!-- Transaction Modal -->
            <div id="tx-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>Transaction Status</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tx-status">
                        <div class="spinner" id="tx-spinner"></div>
                        <p id="tx-status-text">Generating ZK Proof...</p>
                    </div>
                    <div id="tx-success" class="hidden">
                        <div class="success-icon">‚úì</div>
                        <p>Transaction Successful!</p>
                        <a id="tx-explorer-link" href="#" target="_blank" class="btn btn-secondary">
                            View on Explorer
                        </a>
                    </div>
                    <div id="tx-error" class="hidden">
                        <div class="error-icon">‚úó</div>
                        <p id="tx-error-text">Transaction failed</p>
                    </div>
                </div>
            </div>

            <!-- Deposit Modal -->
            <div id="deposit-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>Deposit to Private Pool</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label>Amount</label>
                        <div class="token-input">
                            <input type="number" id="deposit-amount" placeholder="0.0">
                            <select id="deposit-token">
                                <option value="SOL">wSOL</option>
                                <option value="USDC">tUSDC</option>
                            </select>
                        </div>
                    </div>
                    <p class="info-text">
                        This will transfer wSOL/tUSDC from your wallet to the private pool
                        and create a private UTXO. Only you will know your balance.
                        <br><br>
                        <strong>Note:</strong> You need wSOL (wrapped SOL) or tUSDC tokens.
                    </p>
                    <button id="confirm-deposit" class="btn btn-primary btn-large">
                        Deposit
                    </button>
                </div>
            </div>

            <!-- Withdraw Modal -->
            <div id="withdraw-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>Withdraw from Private Pool</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label>Amount</label>
                        <div class="token-input">
                            <input type="number" id="withdraw-amount" placeholder="0.0">
                            <select id="withdraw-token">
                                <option value="SOL">wSOL</option>
                                <option value="USDC">tUSDC</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Recipient Wallet Address (Optional)</label>
                        <input type="text" id="withdraw-recipient" placeholder="Defaults to connected wallet">
                    </div>
                    <p class="info-text">
                        Leave blank to withdraw to your connected wallet. The recipient must have the corresponding
                        token account.
                    </p>
                    <button id="confirm-withdraw" class="btn btn-primary btn-large">
                        Withdraw
                    </button>
                </div>
            </div>

            <!-- Manual Recovery Modal -->
            <div id="manual-recovery-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>Manual UTXO Recovery</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="info-text" style="margin-bottom: 1rem;">
                        Enter the exact amount you deposited. The system will scan the blockchain to find your UTXO.
                    </p>
                    <div class="input-group">
                        <label>Deposit Amount</label>
                        <div class="token-input">
                            <input type="number" id="manual-recovery-amount" placeholder="0.0" step="0.000001">
                            <select id="manual-recovery-token">
                                <option value="SOL">wSOL</option>
                                <option value="USDC">tUSDC</option>
                            </select>
                        </div>
                    </div>
                    <p style="font-size: 11px; color: var(--text-secondary); margin-bottom: 1rem;">
                        Note: This only works for deposits recorded by the relayer.
                        Deposits made with the old version cannot be recovered.
                    </p>
                    <button id="confirm-manual-recovery" class="btn btn-primary btn-large">
                        Search for UTXO
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
